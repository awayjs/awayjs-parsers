require=function e(t,a,r){function s(n,o){if(!a[n]){if(!t[n]){var l=typeof require=="function"&&require;if(!o&&l)return l(n,!0);if(i)return i(n,!0);var h=new Error("Cannot find module '"+n+"'");throw h.code="MODULE_NOT_FOUND",h}var d=a[n]={exports:{}};t[n][0].call(d.exports,function(e){var a=t[n][1][e];return s(a?a:e)},d,d.exports,e,t,a,r)}return a[n].exports}var i=typeof require=="function"&&require;for(var n=0;n<r.length;n++)s(r[n]);return s}({1:[function(e,t,a){"use strict";var r=e("./lib/AWDParser");a.AWDParser=r.AWDParser;var s=e("./lib/Max3DSParser");a.Max3DSParser=s.Max3DSParser;var i=e("./lib/MD2Parser");a.MD2Parser=i.MD2Parser;var n=e("./lib/MD5AnimParser");a.MD5AnimParser=n.MD5AnimParser;var o=e("./lib/MD5MeshParser");a.MD5MeshParser=o.MD5MeshParser;var l=e("./lib/OBJParser");a.OBJParser=l.OBJParser;var h=e("./lib/Parsers");a.Parsers=h.Parsers},{"./lib/AWDParser":"awayjs-parsers/lib/AWDParser","./lib/MD2Parser":"awayjs-parsers/lib/MD2Parser","./lib/MD5AnimParser":"awayjs-parsers/lib/MD5AnimParser","./lib/MD5MeshParser":"awayjs-parsers/lib/MD5MeshParser","./lib/Max3DSParser":"awayjs-parsers/lib/Max3DSParser","./lib/OBJParser":"awayjs-parsers/lib/OBJParser","./lib/Parsers":"awayjs-parsers/lib/Parsers"}],"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils":[function(e,t,a){"use strict";var r=function(){function e(){}e.BLOCKSTATE_FINALIZE=0;e.BLOCKSTATE_INVALID=1;e.BLOCKSTATE_LOAD_DEPENDENICES=2;e.BLOCKSTATE_NO_ASSET=3;e.COMPRESSIONMODE_LZMA="lzma";e.UNCOMPRESSED=0;e.DEFLATE=1;e.LZMA=2;e.INT8=1;e.INT16=2;e.INT32=3;e.UINT8=4;e.UINT16=5;e.UINT32=6;e.FLOAT32=7;e.FLOAT64=8;e.BOOL=21;e.COLOR=22;e.BADDR=23;e.AWDSTRING=31;e.AWDBYTEARRAY=32;e.VECTOR2x1=41;e.VECTOR3x1=42;e.VECTOR4x1=43;e.MTX3x2=44;e.MTX3x3=45;e.MTX4x3=46;e.MTX4x4=47;return e}();a.AWD3Utils=r},{}],"awayjs-parsers/lib/AWD3ParserUtils/AWDBlock":[function(e,t,a){"use strict";var r=e("../AWD3ParserUtils/AWD3Utils");var s=function(){function e(e,t){this.type=t;this.id=e;this.state=r.AWD3Utils.BLOCKSTATE_FINALIZE;this.dependencies_data=Array();this.dependencies_urls=Array();if(t==83){this.loaded_dependencies=Array(6)}this.loaded_dependencies_cnt=0}e.prototype.dispose=function(){this.id=null;this.bytes=null;this.errorMessages=null;this.uvsForVertexAnimation=null};e.prototype.addError=function(e){if(!this.errorMessages)this.errorMessages=new Array;this.errorMessages.push(e)};return e}();a.AWDBlock=s},{"../AWD3ParserUtils/AWD3Utils":"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils"}],"awayjs-parsers/lib/AWDParser":[function(e,t,a){"use strict";var r=this&&this.__extends||function(e,t){for(var a in t)if(t.hasOwnProperty(a))e[a]=t[a];function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};var s=e("awayjs-core/lib/attributes/AttributesBuffer");var i=e("awayjs-core/lib/attributes/Float3Attributes");var n=e("awayjs-core/lib/attributes/Float2Attributes");var o=e("awayjs-core/lib/attributes/Byte4Attributes");var l=e("awayjs-core/lib/image/BitmapImageCube");var h=e("awayjs-core/lib/image/BlendMode");var d=e("awayjs-core/lib/image/Sampler2D");var c=e("awayjs-core/lib/geom/ColorTransform");var p=e("awayjs-core/lib/geom/Matrix3D");var u=e("awayjs-core/lib/geom/Vector3D");var _=e("awayjs-core/lib/net/URLLoaderDataFormat");var y=e("awayjs-core/lib/net/URLRequest");var f=e("awayjs-core/lib/parsers/ParserBase");var b=e("awayjs-core/lib/parsers/ParserUtils");var m=e("awayjs-core/lib/projections/PerspectiveProjection");var g=e("awayjs-core/lib/projections/OrthographicProjection");var v=e("awayjs-core/lib/projections/OrthographicOffCenterProjection");var w=e("awayjs-core/lib/utils/ByteArray");var B=e("awayjs-display/lib/display/DisplayObjectContainer");var M=e("awayjs-display/lib/graphics/Graphics");var k=e("awayjs-display/lib/graphics/TriangleElements");var D=e("awayjs-display/lib/display/DirectionalLight");var A=e("awayjs-display/lib/display/PointLight");var N=e("awayjs-display/lib/display/Camera");var P=e("awayjs-display/lib/display/Sprite");var T=e("awayjs-display/lib/display/Billboard");var S=e("awayjs-display/lib/display/Skybox");var x=e("awayjs-display/lib/managers/DefaultMaterialManager");var E=e("awayjs-display/lib/materials/lightpickers/StaticLightPicker");var U=e("awayjs-display/lib/materials/shadowmappers/CubeMapShadowMapper");var j=e("awayjs-display/lib/materials/shadowmappers/DirectionalShadowMapper");var I=e("awayjs-display/lib/prefabs/PrefabBase");var R=e("awayjs-display/lib/prefabs/PrimitiveCapsulePrefab");var O=e("awayjs-display/lib/prefabs/PrimitiveConePrefab");var F=e("awayjs-display/lib/prefabs/PrimitiveCubePrefab");var L=e("awayjs-display/lib/prefabs/PrimitiveCylinderPrefab");var C=e("awayjs-display/lib/prefabs/PrimitivePlanePrefab");var V=e("awayjs-display/lib/prefabs/PrimitiveSpherePrefab");var G=e("awayjs-display/lib/prefabs/PrimitiveTorusPrefab");var z=e("awayjs-display/lib/textures/SingleCubeTexture");var W=e("awayjs-display/lib/textures/Single2DTexture");var K=e("awayjs-renderergl/lib/animators/VertexAnimationSet");var X=e("awayjs-renderergl/lib/animators/VertexAnimator");var J=e("awayjs-renderergl/lib/animators/SkeletonAnimationSet");var H=e("awayjs-renderergl/lib/animators/SkeletonAnimator");var Y=e("awayjs-renderergl/lib/animators/data/JointPose");var Q=e("awayjs-renderergl/lib/animators/data/Skeleton");var q=e("awayjs-renderergl/lib/animators/data/SkeletonPose");var Z=e("awayjs-renderergl/lib/animators/data/SkeletonJoint");var $=e("awayjs-renderergl/lib/animators/nodes/SkeletonClipNode");var ee=e("awayjs-renderergl/lib/animators/nodes/VertexClipNode");var te=e("awayjs-methodmaterials/lib/MethodMaterialMode");var ae=e("awayjs-methodmaterials/lib/MethodMaterial");var re=e("awayjs-methodmaterials/lib/methods/AmbientEnvMapMethod");var se=e("awayjs-methodmaterials/lib/methods/DiffuseDepthMethod");var ie=e("awayjs-methodmaterials/lib/methods/DiffuseCelMethod");var ne=e("awayjs-methodmaterials/lib/methods/DiffuseGradientMethod");var oe=e("awayjs-methodmaterials/lib/methods/DiffuseLightMapMethod");var le=e("awayjs-methodmaterials/lib/methods/DiffuseWrapMethod");var he=e("awayjs-methodmaterials/lib/methods/EffectAlphaMaskMethod");var de=e("awayjs-methodmaterials/lib/methods/EffectColorMatrixMethod");var ce=e("awayjs-methodmaterials/lib/methods/EffectColorTransformMethod");var pe=e("awayjs-methodmaterials/lib/methods/EffectEnvMapMethod");var ue=e("awayjs-methodmaterials/lib/methods/EffectFogMethod");var _e=e("awayjs-methodmaterials/lib/methods/EffectFresnelEnvMapMethod");var ye=e("awayjs-methodmaterials/lib/methods/EffectLightMapMethod");var fe=e("awayjs-methodmaterials/lib/methods/EffectRimLightMethod");var be=e("awayjs-methodmaterials/lib/methods/NormalSimpleWaterMethod");var me=e("awayjs-methodmaterials/lib/methods/ShadowDitheredMethod");var ge=e("awayjs-methodmaterials/lib/methods/ShadowFilteredMethod");var ve=e("awayjs-methodmaterials/lib/methods/SpecularFresnelMethod");var we=e("awayjs-methodmaterials/lib/methods/ShadowHardMethod");var Be=e("awayjs-methodmaterials/lib/methods/SpecularAnisotropicMethod");var Me=e("awayjs-methodmaterials/lib/methods/SpecularCelMethod");var ke=e("awayjs-methodmaterials/lib/methods/SpecularPhongMethod");var De=e("awayjs-methodmaterials/lib/methods/ShadowNearMethod");var Ae=e("awayjs-methodmaterials/lib/methods/ShadowSoftMethod");var Ne=e("awayjs-display/lib/materials/BasicMaterial");var Pe=e("awayjs-player/lib/factories/AS2SceneGraphFactory");var Te=e("awayjs-display/lib/base/Timeline");var Se=e("awayjs-core/lib/library/AssetLibrary");var xe=e("awayjs-display/lib/text/Font");var Ee=e("awayjs-display/lib/text/TesselatedFontTable");var Ue=e("awayjs-display/lib/text/TextFormat");var je=e("./AWD3ParserUtils/AWDBlock");var Ie=e("awayjs-core/lib/geom/Rectangle");var Re=e("awayjs-display/lib/base/Style");var Oe=e("awayjs-core/lib/geom/Matrix");var Fe=e("awayjs-display/lib/textures/MappingMode");var Le=e("awayjs-display/lib/graphics/ElementsType");var Ce=function(e){r(t,e);function t(a){if(a===void 0){a=null}e.call(this,_.URLLoaderDataFormat.ARRAY_BUFFER);this._debug=false;this._debugTimers=true;this._startedParsing=false;this._texture_users={};this._parsed_header=false;this._time_all=0;this._time_graphics=0;this._time_graphics_bytes=0;this._time_timeline=0;this._time_fonts=0;this._time_textfields=0;this._time_sounds=0;this._time_textures=0;this._time_materials=0;this._time_sprites=0;this._num_graphics=0;this._num_timeline=0;this._num_fonts=0;this._num_textfields=0;this._num_sounds=0;this._num_textures=0;this._num_materials=0;this._num_sprites=0;this.shadowMethodListProperties={1:t.BADDR,2:t.BADDR,3:t.BADDR,101:t.PROPERTY_NUMBER,102:t.PROPERTY_NUMBER,103:t.PROPERTY_NUMBER,201:t.UINT32,202:t.UINT32,301:t.UINT16,302:t.UINT16,401:t.UINT8,402:t.UINT8,601:t.COLOR,602:t.COLOR,701:t.BOOL,702:t.BOOL,801:t.MTX4x4};this.spritePoseAnimationProperties={1:t.BOOL,2:t.BOOL};this.sharedMethodListProperties={1:t.BADDR,2:t.BADDR,3:t.BADDR,101:t.PROPERTY_NUMBER,102:t.PROPERTY_NUMBER,103:t.PROPERTY_NUMBER,104:t.PROPERTY_NUMBER,105:t.PROPERTY_NUMBER,106:t.PROPERTY_NUMBER,107:t.PROPERTY_NUMBER,201:t.UINT32,202:t.UINT32,301:t.UINT16,302:t.UINT16,401:t.UINT8,402:t.UINT8,601:t.COLOR,602:t.COLOR,701:t.BOOL,702:t.BOOL};this._view=a;this._blocks=new Array;this._blocks[0]=new je.AWDBlock(0,255);this._blocks[0].data=null;this.blendModeDic=new Array;this.blendModeDic.push(h.BlendMode.NORMAL);this.blendModeDic.push(h.BlendMode.ADD);this.blendModeDic.push(h.BlendMode.ALPHA);this.blendModeDic.push(h.BlendMode.DARKEN);this.blendModeDic.push(h.BlendMode.DIFFERENCE);this.blendModeDic.push(h.BlendMode.ERASE);this.blendModeDic.push(h.BlendMode.HARDLIGHT);this.blendModeDic.push(h.BlendMode.INVERT);this.blendModeDic.push(h.BlendMode.LAYER);this.blendModeDic.push(h.BlendMode.LIGHTEN);this.blendModeDic.push(h.BlendMode.MULTIPLY);this.blendModeDic.push(h.BlendMode.NORMAL);this.blendModeDic.push(h.BlendMode.OVERLAY);this.blendModeDic.push(h.BlendMode.SCREEN);this.blendModeDic.push(h.BlendMode.SHADER);this.blendModeDic.push(h.BlendMode.OVERLAY);this._depthSizeDic=new Array;this._depthSizeDic.push(256);this._depthSizeDic.push(512);this._depthSizeDic.push(2048);this._depthSizeDic.push(1024);this._version=Array()}t.supportsType=function(e){e=e.toLowerCase();return e=="awd"};t.supportsData=function(e){return b.ParserUtils.toString(e,3)=="AWD"};t.prototype._iResolveDependency=function(e){if(e.assets.length==1){var t=this._blocks[parseInt(e.id)];if(t.type==82){var a=e.assets[0];t.data=a;this._pFinalizeAsset(a,t.name);if(this._debug)console.log("Parsed Texture: Name = "+t.name)}else if(t.type==44){var r=e.assets[0];t.data=r;this._pFinalizeAsset(r,t.name);if(this._debug)console.log("Parsed WaveAudio: Name = "+t.name)}else if(t.type==83){t.loaded_dependencies[e.sub_id]=e.assets[0];t.loaded_dependencies_cnt++;if(this._debug)console.log("Successfully loaded Bitmap "+e.sub_id+" / 6 for Cubetexture");if(t.loaded_dependencies_cnt==6){var s=new l.BitmapImageCube(t.loaded_dependencies[0].width);for(var i=0;i<6;i++)s.draw(i,t.loaded_dependencies[i]);t.data=s;this._pFinalizeAsset(s,t.name);if(this._debug)console.log("Parsed CubeTexture: Name = "+t.name)}}if(this._debugTimers&&!this._isParsing)this.updateTimers(t.type)}};t.prototype._iResolveDependencyFailure=function(e){};t.prototype._iResolveDependencyName=function(e,t){var a=t.name;if(t){var r=this._blocks[parseInt(e.id)];t.resetAssetPath(r.name,null,true)}var s=t.name;t.name=a;return s};t.prototype._pProceedParsing=function(){if(!this._startedParsing){this._byteData=this._pGetByteData();this._startedParsing=true}if(!this._parsed_header){this.parseHeader();switch(this._compression){case t.DEFLATE:case t.LZMA:this._pDieWithError("Compressed AWD formats not yet supported");break;case t.UNCOMPRESSED:this._body=this._byteData;break}this._parsed_header=true}if(this._body){while(this._body.getBytesAvailable()>0&&!this.parsingPaused)this.parseNextBlock();if(this._body.getBytesAvailable()==0){this.dispose();if(this._debugTimers)console.log("Parsing total: "+(this._time_all|0)+"ms"," | graphics: "+this._num_graphics+", "+(this._time_graphics|0)+"ms"," | graphics bytes: "+this._num_graphics+", "+(this._time_graphics_bytes|0)+"ms"," | timelines: "+this._num_timeline+", "+(this._time_timeline|0)+"ms"," | fonts: "+this._num_fonts+", "+(this._time_fonts|0)+"ms"," | sounds: "+this._num_sounds+", "+(this._time_sounds|0)+"ms"," | mats: "+this._num_materials+", "+(this._time_materials|0)+"ms"," | textures: "+this._num_textures+", "+(this._time_textures|0)+"ms"," | sprites: "+this._num_sprites+", "+(this._time_sprites|0)+"ms");return f.ParserBase.PARSING_DONE}else{return f.ParserBase.MORE_TO_PARSE}}else{switch(this._compression){case t.DEFLATE:case t.LZMA:if(this._debug)console.log("(!) AWDParser Error: Compressed AWD formats not yet supported (!)");break}return f.ParserBase.PARSING_DONE}};t.prototype._pStartParsing=function(t){this._pContent=new B.DisplayObjectContainer;e.prototype._pStartParsing.call(this,t)};t.prototype.dispose=function(){for(var e in this._blocks){var t=this._blocks[e];t.dispose()}};t.prototype.parseNextBlock=function(){var e;var t=false;var a;var r;var s;var i;if(this._debugTimers)this.start_timeing=performance.now();this._cur_block_id=this._body.readUnsignedInt();a=this._body.readUnsignedByte();r=this._body.readUnsignedByte();s=this._body.readUnsignedByte();i=this._body.readUnsignedInt();var n=ze.test(s,ze.FLAG4);var o=ze.test(s,ze.FLAG5);if(this._accuracyOnBlocks){this._accuracyMatrix=ze.test(s,ze.FLAG1);this._accuracyGeo=ze.test(s,ze.FLAG2);this._accuracyProps=ze.test(s,ze.FLAG3)}var l=this._body.position+i;if(i>this._body.getBytesAvailable()){this._pDieWithError("AWD2 block length is bigger than the bytes that are available!");this._body.position+=this._body.getBytesAvailable();return}if(n){this._pDieWithError("Compressed AWD formats not yet supported");this._newBlockBytes=new w.ByteArray;this._body.readBytes(this._newBlockBytes,0,i);this._newBlockBytes.position=0}else{this._newBlockBytes=this._body}e=new je.AWDBlock(this._cur_block_id,r);e.len=i;var h=this._newBlockBytes.position+i;if(n){this._pDieWithError("Compressed AWD formats not yet supported")}if(this._debug)console.log("AWDBlock:  ID = "+this._cur_block_id+" | TypeID = "+r+" | Compression = "+n+" | Matrix-Precision = "+this._accuracyMatrix+" | Graphics-Precision = "+this._accuracyGeo+" | Properties-Precision = "+this._accuracyProps);this._blocks[this._cur_block_id]=e;if(this._version[0]==3&&this._version[1]==0){var d=new Pe.AS2SceneGraphFactory(this._view);switch(r){case 24:this.parseSpriteLibraryBlock(this._cur_block_id);t=true;break;case 25:this.parseBillBoardLibraryBlock(this._cur_block_id);t=true;break;case 4444:this.parseAudioBlock(this._cur_block_id,d);t=true;break;case 133:this.parseMovieClip(this._cur_block_id,d);t=true;break;case 134:this.parseTextField(this._cur_block_id,d);t=true;break;case 135:this.parseTesselatedFont(this._cur_block_id);t=true;break;case 136:this.parseTextFormat(this._cur_block_id);t=true;break}}if(this._version[0]>2||this._version[0]>=2&&this._version[1]>=1){switch(r){case 11:this.parsePrimitves(this._cur_block_id);t=true;break;case 31:this.parseSkyboxInstance(this._cur_block_id);t=true;break;case 41:this.parseLight(this._cur_block_id);t=true;break;case 42:this.parseCamera(this._cur_block_id);t=true;break;case 51:this.parseLightPicker(this._cur_block_id);t=true;break;case 81:this.parseMaterial_v1(this._cur_block_id);t=true;break;case 83:this.parseCubeTexture(this._cur_block_id);t=true;break;case 91:this.parseSharedMethodBlock(this._cur_block_id);t=true;break;case 92:this.parseShadowMethodBlock(this._cur_block_id);t=true;break;case 111:this.parseSpritePoseAnimation(this._cur_block_id,true);t=true;break;case 112:this.parseSpritePoseAnimation(this._cur_block_id);t=true;break;case 113:this.parseVertexAnimationSet(this._cur_block_id);t=true;break;case 122:this.parseAnimatorSet(this._cur_block_id);t=true;break;case 253:this.parseCommand(this._cur_block_id);t=true;break}}if(t==false){switch(r){case 1:this.parseGraphics(this._cur_block_id);break;case 22:this.parseContainer(this._cur_block_id);break;case 23:this.parseSpriteInstance(this._cur_block_id);break;case 81:this.parseMaterial(this._cur_block_id);break;case 82:this.parseTexture(this._cur_block_id);break;case 101:this.parseSkeleton(this._cur_block_id);break;case 102:this.parseSkeletonPose(this._cur_block_id);break;case 103:this.parseSkeletonAnimation(this._cur_block_id);break;case 121:case 254:this.parseNameSpace(this._cur_block_id);break;case 255:this.parseMetaData(this._cur_block_id);break;default:if(this._debug)console.log("AWDBlock:   Unknown BlockType  (BlockID = "+this._cur_block_id+") - Skip "+i+" bytes");this._newBlockBytes.position+=i;break}}if(this._debug){if(this._newBlockBytes.position!=h)console.log("  (!)(!)(!) Error while reading AWDBlock ID "+this._cur_block_id+" = skip to next block");if(e.errorMessages){var i=e.errorMessages.length;for(var c=0;c<i;c++)console.log("        (!) Error: "+e.errorMessages[c]+" (!)")}console.log("\n")}if(this._debugTimers&&!this.parsingPaused)this.updateTimers(r);this._body.position=l;this._newBlockBytes=null};t.prototype.updateTimers=function(e){var t=performance.now();var a=t-this.start_timeing;this._time_all+=a;if(e==1){this._time_graphics+=a;this._num_graphics++}else if(e==133){this._time_timeline+=a;this._num_timeline++}else if(e==135){this._time_fonts+=a;this._num_fonts++}else if(e==134){this._time_textfields+=a;this._num_textfields++}else if(e==44){this._time_sounds+=a;this._num_sounds++}else if(e==82){this._time_textures+=a;this._num_textures++}else if(e==81){this._time_materials+=a;this._num_materials++}else if(e==24){this._time_sprites+=a;this._num_sprites++}};t.prototype.parseTesselatedFont=function(e){var t=this.parseVarStr();this._blocks[e].name=t;var a=Se.AssetLibrary.getAsset(this._blocks[e].name);var r=false;if(a==undefined){a=new xe.Font;r=true}var l=this._newBlockBytes.readUnsignedInt();var h;var d;var c;var p;var u=0;var _;var y;var f,b,m,g;for(var v=0;v<l;++v){d=this.parseVarStr();if(this._blocks[e].name=="Tahoma"&&d=="RegularStyle"){d="BoldStyle"}c=a.get_font_table(d,Ee.TesselatedFontTable.assetType);c.set_font_em_size(this._newBlockBytes.readUnsignedInt());c.set_whitespace_width(this._newBlockBytes.readUnsignedInt());c.ascent=this._newBlockBytes.readFloat();c.descent=this._newBlockBytes.readFloat();h=this._newBlockBytes.readUnsignedInt();for(var B=0;B<h;++B){p=this._newBlockBytes.readUnsignedInt();var M=this._newBlockBytes.readFloat();_=this._newBlockBytes.readUnsignedInt();y=this._newBlockBytes.position+_;while(this._newBlockBytes.position<y){b=this._newBlockBytes.readUnsignedByte();f=this._newBlockBytes.readUnsignedByte();m=this._newBlockBytes.readUnsignedInt();g=this._newBlockBytes.position+m;if(b==2){var D=new Array;for(var A=0;this._newBlockBytes.position<g;A++)D[A]=this._newBlockBytes.readUnsignedShort()}else if(b==11){u=20;var N=new w.ByteArray(m);this._newBlockBytes.readBytes(N,0,m)}else if(b==12){u=12;var N=new w.ByteArray(m);this._newBlockBytes.readBytes(N,0,m)}else if(b==10){u=28;var N=new w.ByteArray(m);this._newBlockBytes.readBytes(N,0,m)}else{this._newBlockBytes.position=g}}if(N){var P=new s.AttributesBuffer(u,m/u);P.bufferView=new Uint8Array(N.arraybytes);var T=new k.TriangleElements(P);T.setPositions(new n.Float2Attributes(P));if(u==20)T.setCustomAttributes("curves",new i.Float3Attributes(P));else if(u==12)T.setCustomAttributes("curves",new o.Byte4Attributes(P,false));if(u==28)T.setUVs(new n.Float2Attributes(P));c.setChar(p.toString(),T,M)}}}this.parseProperties(null);this.parseUserAttributes();if(r){this._pFinalizeAsset(a,t)}this._blocks[e].data=a;if(this._debug)console.log("Parsed a font: Name = '"+t)};t.prototype.parseTextFormat=function(e){var a=this.parseVarStr();this._blocks[e].name=a;var r=this._blocks[this._newBlockBytes.readUnsignedInt()].data;var s=this.parseVarStr();var i=new Ue.TextFormat;i.font_name=r.name;var n=r.get_font_table(s);if(n!=null){i.font_style=s;i.font_table=n}var o=this._blocks[this._newBlockBytes.readUnsignedInt()].data;o.bothSides=true;o.curves=true;var l=this._newBlockBytes.readUnsignedByte();var h=[];for(var d=0;d<l;d++)h[d]=this._newBlockBytes.readFloat();i.uv_values=h;var c=this.parseProperties(t.textFormatProperties);i.size=c.get(1,12);i.letterSpacing=c.get(2,0);i.kerning=c.get(4,true);var p=c.get(6,0);if(p==1){i.align="right"}else if(p==2){i.align="center"}i.indent=c.get(7,0);i.leftMargin=c.get(8,0);i.rightMargin=c.get(9,0);i.leading=c.get(10,0);i.material=o;this.parseUserAttributes();this._pFinalizeAsset(i,a);this._blocks[e].data=i;if(this._debug)console.log("Parsed a TextFormat: Name = '"+a+" font: "+r.name)};t.prototype.parseTextField=function(e,a){var r=this.parseVarStr();this._blocks[e].name=r;var s=a.createTextField();var i=this._newBlockBytes.readUnsignedByte();s.type=t.textFieldTypes[i];if(i==3)s.displayAsPassword=true;s.textWidth=Math.abs(this._newBlockBytes.readFloat());s.textHeight=Math.abs(this._newBlockBytes.readFloat());var n=this._newBlockBytes.readUnsignedInt();var o="";for(var l=0;l<n;l++){var h=this._newBlockBytes.readUnsignedInt();for(var d=0;d<h;d++){var c=this._blocks[this._newBlockBytes.readUnsignedInt()].data;var p=this._newBlockBytes.readUnsignedInt();if(p>0){var u=this._newBlockBytes.readUTFBytes(p);o+=u}}}s.textFormat=c;s.text=o;var _=this.parseProperties(t.textFieldProperties);s.selectable=_.get(1,false);s.border=_.get(3,false);s.extra=this.parseUserAttributes();this._pFinalizeAsset(s,r);this._blocks[e].data=s;if(this._debug)console.log("Parsed a TextField: Name = '"+r+"| text  = "+o)};t.prototype.parseBillBoardLibraryBlock=function(e){var t=this.parseVarStr();var a=this._blocks[this._newBlockBytes.readUnsignedInt()].data;a.bothSides=true;var r=new T.Billboard(a);this.parseProperties(null);r.extra=this.parseUserAttributes();this._pFinalizeAsset(r,t);this._blocks[e].data=r;if(this._debug)console.log("Parsed a Library-Billboard: Name = '"+t+"| Material-Name = "+a.name)};t.prototype.parseSpriteLibraryBlock=function(e){var t=this.parseVarStr();var a=this._newBlockBytes.readUnsignedInt();var r=this._blocks[a].data;this._blocks[e].geoID=a;var s=this._newBlockBytes.readUnsignedShort();var i=new Array;var n=new Array;var o;for(var l=0;l<s;l++){o=this._blocks[this._newBlockBytes.readUnsignedInt()].data||x.DefaultMaterialManager.getDefaultMaterial();o.useColorTransform=true;i[l]=o;n[l]=o.name}var h=performance.now();var c=new P.Sprite;r.copyTo(c.graphics);var p=performance.now();var u=p-h;this._time_graphics_bytes+=u;if(i.length>=1&&c.graphics.count==1){c.material=i[0]}else if(i.length>1){for(var _=0;_<c.graphics.count;_++)c.graphics.getGraphicAt(_).material=i[Math.min(i.length-1,_)]}var y=this._newBlockBytes.readUnsignedShort();for(var _=0;_<y;_++){var f=this._newBlockBytes.readUnsignedByte();var b=new d.Sampler2D;var m=c.graphics.getGraphicAt(_);if(m){m.style=new Re.Style;m.style.addSamplerAt(b,m.material.getTextureAt(0))}if(f==3){var g=this._newBlockBytes.readFloat();var v=this._newBlockBytes.readFloat();if(m){m.material.animateUVs=true;m.style.uvMatrix=new Oe.Matrix(0,0,0,0,g,v)}}else if(f==4){var w=this.parseMatrix32RawData();if(m){m.material.animateUVs=true;m.style.uvMatrix=new Oe.Matrix(w)}}else if(f==5){var B=new Oe.Matrix(this._newBlockBytes.readFloat(),this._newBlockBytes.readFloat(),0,0,this._newBlockBytes.readFloat(),this._newBlockBytes.readFloat());if(m){m.material.animateUVs=true;m.style.uvMatrix=B}}else if(f==6){var M=this._newBlockBytes.readFloat();var k=this._newBlockBytes.readFloat();var D=this._newBlockBytes.readFloat();var A=this._newBlockBytes.readFloat();var w=this.parseMatrix32RawData();if(m){b.imageRect=new Ie.Rectangle(M,k,D,A);m.material.imageRect=true;m.material.animateUVs=true;m.style.uvMatrix=new Oe.Matrix(w)}}if(m){if(m.elements.getCustomAtributes("curves"))m.material.curves=true}this._newBlockBytes.readUnsignedInt()}this.parseProperties(null);c.extra=this.parseUserAttributes();this._pFinalizeAsset(c,t);this._blocks[e].data=c;if(this._debug)console.log("Parsed a Library-Sprite: Name = '"+t+"| Graphics-Name = "+r.name+" | Graphics-Count = "+c.graphics.count+" | Mat-Names = "+n)};t.prototype.parseAudioBlock=function(e,t){this._blocks[e].name=this.parseVarStr();var a=this._newBlockBytes.readUnsignedByte();var r;if(a==0){r=this._newBlockBytes.readUnsignedInt();var s;s=this._newBlockBytes.readUTFBytes(r);this._pAddDependency(this._cur_block_id.toString(),new y.URLRequest(s),false,null,true)}else{r=this._newBlockBytes.readUnsignedInt();var i=new w.ByteArray(r);this._newBlockBytes.readBytes(i,0,r);this._pAddDependency(this._cur_block_id.toString(),null,false,i,true)}this.parseProperties(null);this._blocks[e].extras=this.parseUserAttributes();this._pPauseAndRetrieveDependencies();if(this._debug)console.log("Start parsing a "+["external","embed"][a]+" Audio file")};t.prototype.parseMovieClip=function(e,a){var r;var s;var i;var n=new Te.Timeline;var o=a.createMovieClip(n);var l=this.parseVarStr();var h=this._newBlockBytes.readUnsignedShort();for(r=0;r<h;r++){i=this._blocks[this._newBlockBytes.readUnsignedInt()].data;if(i!=null){n.registerPotentialChild(i)}else{console.log("ERROR when collecting objects for timeline")}}var d=h;var c=this._newBlockBytes.readUnsignedShort();for(r=0;r<c;r++){i=this._blocks[this._newBlockBytes.readUnsignedInt()].data;var p=this._newBlockBytes.readUnsignedShort();d+=p;if(i!=null){for(s=0;s<p;s++)n.registerPotentialChild(i)}else{for(s=0;s<p;s++){console.log("ERROR when collecting objects for timeline")}}}if(this._debug)console.log("Parsed "+(h+c)+" potential childs. They will be used by "+d+" instances.");var u=this._newBlockBytes.readUnsignedShort();var _=this._newBlockBytes.readUnsignedByte();var y=0;var f=0;var b=0;var m=0;for(r=0;r<_;r++){if(m<6)b=m;else b=this._newBlockBytes.readUnsignedByte();f=this._newBlockBytes.readUnsignedByte();y=this._newBlockBytes.readUnsignedInt();if(y>0){var g=new w.ByteArray(y);this._newBlockBytes.readBytes(g,0,y);var v;switch(f){case 1:v=new Uint8Array(g.arraybytes);break;case 2:v=new Uint16Array(g.arraybytes);break;case 4:v=new Uint32Array(g.arraybytes);break}switch(b){case 0:n.keyframe_durations=v;n.numKeyFrames=y/f;break;case 1:n.frame_command_indices=v;break;case 2:n.frame_recipe=v;break;case 3:n.command_length_stream=v;break;case 4:n.command_index_stream=v;break;case 5:n.add_child_stream=v;break;case 6:n.remove_child_stream=v;break;case 7:n.update_child_stream=v;break;case 8:n.update_child_props_indices_stream=v;break;case 9:n.update_child_props_length_stream=v;break;case 10:n.property_type_stream=v;break;case 11:n.property_index_stream=v;break;case 12:n.properties_stream_int=v;break}}m++}var B=0;var M;_=this._newBlockBytes.readUnsignedByte();for(r=0;r<_;r++){b=this._newBlockBytes.readUnsignedByte();y=this._newBlockBytes.readUnsignedInt();switch(b){case 0:M=new w.ByteArray(y);this._newBlockBytes.readBytes(M,0,y);n.properties_stream_f32_mtx_scale_rot=new Float32Array(M.arraybytes);break;case 1:M=new w.ByteArray(y);this._newBlockBytes.readBytes(M,0,y);n.properties_stream_f32_mtx_pos=new Float32Array(M.arraybytes);break;case 2:M=new w.ByteArray(y);this._newBlockBytes.readBytes(M,0,y);n.properties_stream_f32_mtx_all=new Float32Array(M.arraybytes);break;case 3:M=new w.ByteArray(y);this._newBlockBytes.readBytes(M,0,y);n.properties_stream_f32_ct=new Float32Array(M.arraybytes);break;case 4:y=this._newBlockBytes.readUnsignedShort();for(B=0;B<y;B++){n._labels[this.parseVarStr()]=this._newBlockBytes.readUnsignedShort()}break;case 5:y=this._newBlockBytes.readUnsignedShort();var k=[];for(B=0;B<y;B++){k.push(this._newBlockBytes.readUTFBytes(this._newBlockBytes.readUnsignedShort()))}n.properties_stream_strings=k;break;case 6:y=this._newBlockBytes.readUnsignedShort();for(B=0;B<y;B++){var D=this._newBlockBytes.readUnsignedShort();var A=this._newBlockBytes.readUnsignedInt();n.add_framescript(this._newBlockBytes.readUTFBytes(A),D)}break}}n.init();var N=0;var P=25;this.parseProperties(t.movieClipProperties);this.parseUserAttributes();this._pFinalizeAsset(o,l);this._blocks[e].data=o;if(this._debug)console.log("Parsed a TIMELINE: Name = "+l+"| sceneID = "+N+"| numFrames = "+o.timeline.numFrames)};t.prototype.parseGraphics=function(e){var a=new M.Graphics;var r=this.parseVarStr();var l=this._newBlockBytes.readUnsignedShort();var h=this.parseProperties(t.graphicsProperties);var d=h.get(1,1);var c=h.get(2,1);var p=0;var u=0;var _=Ve.STANDART_STREAMS;var y=null;for(var f=0;f<l;f++){var b=false;var m=0;var g,v;var B;var D;p=0;u=0;_=Ve.STANDART_STREAMS;y=null;g=this._newBlockBytes.readUnsignedInt();v=this._newBlockBytes.position+g;var A=this.parseProperties(t.elementsProperties);while(this._newBlockBytes.position<v){var N=0;var P,T,S,x;T=this._newBlockBytes.readUnsignedByte();P=this._newBlockBytes.readUnsignedByte();S=this._newBlockBytes.readUnsignedInt();x=this._newBlockBytes.position+S;var E,U,j;if(T==1){var I=new Array;while(this._newBlockBytes.position<x){E=this.readNumber(this._accuracyGeo);U=this.readNumber(this._accuracyGeo);j=this.readNumber(this._accuracyGeo);I[N++]=E;I[N++]=U;I[N++]=j}}else if(T==2){var R=new Array;while(this._newBlockBytes.position<x)R[N++]=this._newBlockBytes.readUnsignedShort()}else if(T==3){var O=new Array;while(this._newBlockBytes.position<x)O[N++]=this.readNumber(this._accuracyGeo)}else if(T==4){var F=new Array;while(this._newBlockBytes.position<x)F[N++]=this.readNumber(this._accuracyGeo)}else if(T==6){B=Array();while(this._newBlockBytes.position<x)B[N++]=this._newBlockBytes.readUnsignedShort()*3}else if(T==7){D=new Array;while(this._newBlockBytes.position<x)D[N++]=this.readNumber(this._accuracyGeo)}else if(T==8){this._newBlockBytes.position=x}else if(T==9){this._newBlockBytes.position=x}else if(T==10){_=Ve.CONCENATED_STREAMS;m=28;var L=new w.ByteArray(S);this._newBlockBytes.readBytes(L,0,S)}else if(T==11){_=Ve.CONCENATED_STREAMS;m=20;var L=new w.ByteArray(S);this._newBlockBytes.readBytes(L,0,S)}else if(T==12){_=Ve.CONCENATED_STREAMS;m=12;var L=new w.ByteArray(S);this._newBlockBytes.readBytes(L,0,S)}else if(T==13){_=Ve.SHARED_BUFFER;var C=this._blocks[this._newBlockBytes.readUnsignedInt()].data;var V=this._newBlockBytes.readUnsignedByte();y=C.getGraphicAt(V).elements;p=this._newBlockBytes.readUnsignedInt();u=this._newBlockBytes.readUnsignedInt()}else{console.log("skipping unknown subgeom stream");this._newBlockBytes.position=x}}this.parseUserAttributes();if(_==Ve.CONCENATED_STREAMS){var G=new s.AttributesBuffer(m,S/m);G.bufferView=new Uint8Array(L.arraybytes);var z=new k.TriangleElements(G);z.setPositions(new n.Float2Attributes(G));if(m==20){z.setCustomAttributes("curves",new i.Float3Attributes(G))}else if(m==12){z.setCustomAttributes("curves",new o.Byte4Attributes(G,false))}if(m==28)z.setUVs(new n.Float2Attributes(G));a.addGraphic(z);if(this._debug)console.log("Parsed a TriangleElements with curves")}else if(_==Ve.STANDART_STREAMS){var W=new k.TriangleElements(new s.AttributesBuffer);if(D)W.jointsPerVertex=D.length/(I.length/3);if(F)W.autoDeriveNormals=false;W.autoDeriveTangents=true;W.setIndices(R);W.setPositions(I);W.setNormals(F);W.setUVs(O);W.setJointWeights(D);W.setJointIndices(B);var K=A.get(1,1);var X=A.get(2,1);var J=false;if(d!=K||c!=X){J=true;K=d/K;X=c/X}if(J)W.scaleUV(K,X);a.addGraphic(W);if(this._debug)console.log("Parsed a TriangleElements")}else if(_==Ve.SHARED_BUFFER){var H=a.addGraphic(y);H.offset=p;H.count=u;if(this._debug)console.log("Parsed a TriangleElements that shares buffer from target geom")}}if(d!=1||c!=1)a.scaleUV(d,c);this.parseUserAttributes();this._pFinalizeAsset(a,r);this._blocks[e].data=a;if(this._debug)console.log("Parsed Graphics: Name = "+r)};t.prototype.parsePrimitves=function(e){var a;var r;var s;var i;var n;var o;a=this.parseVarStr();s=this._newBlockBytes.readUnsignedByte();n=this.parseProperties(t.primitiveProperties);switch(s){case 1:r=new C.PrimitivePlanePrefab(null,Le.ElementsType.TRIANGLE,n.get(101,100),n.get(102,100),n.get(301,1),n.get(302,1),n.get(701,true),n.get(702,false));
break;case 2:r=new F.PrimitiveCubePrefab(null,Le.ElementsType.TRIANGLE,n.get(101,100),n.get(102,100),n.get(103,100),n.get(301,1),n.get(302,1),n.get(303,1),n.get(701,true));break;case 3:r=new V.PrimitiveSpherePrefab(null,Le.ElementsType.TRIANGLE,n.get(101,50),n.get(301,16),n.get(302,12),n.get(701,true));break;case 4:r=new L.PrimitiveCylinderPrefab(null,Le.ElementsType.TRIANGLE,n.get(101,50),n.get(102,50),n.get(103,100),n.get(301,16),n.get(302,1),true,true,true);if(!n.get(701,true))r.topClosed=false;if(!n.get(702,true))r.bottomClosed=false;if(!n.get(703,true))r.yUp=false;break;case 5:r=new O.PrimitiveConePrefab(null,Le.ElementsType.TRIANGLE,n.get(101,50),n.get(102,100),n.get(301,16),n.get(302,1),n.get(701,true),n.get(702,true));break;case 6:r=new R.PrimitiveCapsulePrefab(null,Le.ElementsType.TRIANGLE,n.get(101,50),n.get(102,100),n.get(301,16),n.get(302,15),n.get(701,true));break;case 7:r=new G.PrimitiveTorusPrefab(null,Le.ElementsType.TRIANGLE,n.get(101,50),n.get(102,50),n.get(301,16),n.get(302,8),n.get(701,true));break;default:r=new I.PrefabBase;console.log("ERROR: UNSUPPORTED PREFAB_TYPE");break}if(n.get(110,1)!=1||n.get(111,1)!=1){}this.parseUserAttributes();r.name=a;this._pFinalizeAsset(r,a);this._blocks[e].data=r;if(this._debug){if(s<0||s>7)s=0;console.log("Parsed a Primivite: Name = "+a+"| type = "+t.primitiveTypes[s])}};t.prototype.parseContainer=function(e){var a;var r;var s;var i=this._blocks[this._newBlockBytes.readUnsignedInt()].data;r=this.parseMatrix3D();a=this.parseVarStr();var n="Root (TopLevel)";s=new B.DisplayObjectContainer;s.transform.matrix3D=r;if(i){i.addChild(s);n=i.name}else{this._pContent.addChild(s)}if(this._version[0]==2&&this._version[1]==1){var o=this.parseProperties(t.containerProperties);s.pivot=new u.Vector3D(o.get(1,0),o.get(2,0),o.get(3,0))}else{this.parseProperties(null)}s.extra=this.parseUserAttributes();this._pFinalizeAsset(s,a);this._blocks[e].data=s;if(this._debug)console.log("Parsed a Container: Name = '"+a+"' | Parent-Name = "+n)};t.prototype.parseSpriteInstance=function(e){var a=this._blocks[this._newBlockBytes.readUnsignedInt()].data;var r=this.parseMatrix3D();var s=this.parseVarStr();var i=this._newBlockBytes.readUnsignedInt();var n=this._blocks[i].data;var o;var l;var h=false;if(n.isAsset(M.Graphics)){o=n}else{h=true;l=n}this._blocks[e].geoID=i;var d=this._newBlockBytes.readUnsignedShort();var c=new Array;var p=new Array;var _;for(var y=0;y<d;y++){_=this._blocks[this._newBlockBytes.readUnsignedInt()].data||x.DefaultMaterialManager.getDefaultMaterial();c[y]=_;p[y]=_.name}var f;if(h){f=l.getNewObject()}else{f=new P.Sprite;o.copyTo(f.graphics)}f.transform.matrix3D=r;var b="Root (TopLevel)";if(a){a.addChild(f);b=a.name}else{this._pContent.addChild(f)}if(c.length>=1&&f.graphics.count==1){f.material=c[0]}else if(c.length>1){for(var m=0;m<f.graphics.count;m++)f.graphics.getGraphicAt(m).material=c[Math.min(c.length-1,m)]}if(this._version[0]==2&&this._version[1]==1){var g=this.parseProperties(t.spriteInstanceProperties);f.pivot=new u.Vector3D(g.get(1,0),g.get(2,0),g.get(3,0));f.castsShadows=g.get(5,true)}else{this.parseProperties(null)}f.extra=this.parseUserAttributes();this._pFinalizeAsset(f,s);this._blocks[e].data=f;if(this._debug){if(h)console.log("Parsed a Sprite for Prefab: Name = '"+s+"' | Parent-Name = "+b+"| Prefab-Name = "+l.name+" | Graphics-Count = "+f.graphics.count+" | Mat-Names = "+p);else console.log("Parsed a Sprite for Graphics: Name = '"+s+"' | Parent-Name = "+b+"| Graphics-Name = "+o.name+" | Graphics-Count = "+f.graphics.count+" | Mat-Names = "+p)}};t.prototype.parseSkyboxInstance=function(e){var t=this.parseVarStr();var a=new S.Skybox;var r=new z.SingleCubeTexture(this._blocks[this._newBlockBytes.readUnsignedInt()].data||x.DefaultMaterialManager.getDefaultImageCube());a.texture=r;this.parseProperties(null);a.extra=this.parseUserAttributes();this._pFinalizeAsset(a,t);this._blocks[e].data=a;if(this._debug)console.log("Parsed a Skybox: Name = '"+t+"' | CubeTexture-Name = "+r.name)};t.prototype.parseLight=function(e){var a;var r;var s=this._blocks[this._newBlockBytes.readUnsignedInt()].data;var i=this.parseMatrix3D();var n=this.parseVarStr();var o=this._newBlockBytes.readUnsignedByte();var l=this.parseProperties(t.lightProperties);var h=l.get(9,0);var d=["Unsupported LightType","PointLight","DirectionalLight"];var c=["No ShadowMapper","DirectionalShadowMapper","NearDirectionalShadowMapper","CascadeShadowMapper","CubeMapShadowMapper"];if(o==1){a=new A.PointLight;a.radius=l.get(1,9e4);a.fallOff=l.get(2,1e5);if(h>0){if(h==4){r=new U.CubeMapShadowMapper}}a.transform.matrix3D=i}if(o==2){a=new D.DirectionalLight(l.get(21,0),l.get(22,-1),l.get(23,1));if(h>0){if(h==1){r=new j.DirectionalShadowMapper}}}a.color=l.get(3,16777215);a.specular=l.get(4,1);a.diffuse=l.get(5,1);a.ambientColor=l.get(7,16777215);a.ambient=l.get(8,0);if(r){if(r instanceof U.CubeMapShadowMapper){if(l.get(10,1)!=1)r.depthMapSize=this._depthSizeDic[l.get(10,1)]}else{if(l.get(10,2)!=2)r.depthMapSize=this._depthSizeDic[l.get(10,2)]}a.shadowMapper=r;a.castsShadows=true}var p="Root (TopLevel)";if(s){s.addChild(a);p=s.name}else{this._pContent.addChild(a)}this.parseUserAttributes();this._pFinalizeAsset(a,n);this._blocks[e].data=a;if(this._debug)console.log("Parsed a Light: Name = '"+n+"' | Type = "+d[o]+" | Parent-Name = "+p+" | ShadowMapper-Type = "+c[h])};t.prototype.parseCamera=function(e){var a=this._blocks[this._newBlockBytes.readUnsignedInt()].data;var r=this.parseMatrix3D();var s=this.parseVarStr();var i;this._newBlockBytes.readUnsignedByte();this._newBlockBytes.readShort();var n=this._newBlockBytes.readShort();var o=this.parseProperties(t.cameraProperties);switch(n){case 5001:i=new m.PerspectiveProjection(o.get(101,60));break;case 5002:i=new g.OrthographicProjection(o.get(101,500));break;case 5003:i=new v.OrthographicOffCenterProjection(o.get(101,-400),o.get(102,400),o.get(103,-300),o.get(104,300));break;default:console.log("unsupportedLenstype");return}var l=new N.Camera(i);l.transform.matrix3D=r;var h="Root (TopLevel)";if(a){a.addChild(l);h=a.name}else{this._pContent.addChild(l)}l.name=s;o=this.parseProperties(t.cameraPivotProperties);l.pivot=new u.Vector3D(o.get(1,0),o.get(2,0),o.get(3,0));l.extra=this.parseUserAttributes();this._pFinalizeAsset(l,s);this._blocks[e].data=l;if(this._debug)console.log("Parsed a Camera: Name = '"+s+"' | Projectiontype = "+i+" | Parent-Name = "+h)};t.prototype.parseLightPicker=function(e){var t=this.parseVarStr();var a=this._newBlockBytes.readUnsignedShort();var r=new Array;var s=new Array;for(var i=0;i<a;i++){var n=this._blocks[this._newBlockBytes.readUnsignedInt()].data;r.push(n);s.push(n.name)}if(r.length==0){this._blocks[e].addError("Could not create this LightPicker, cause no Light was found.");this.parseUserAttributes();return}var o=new E.StaticLightPicker(r);o.name=t;this.parseUserAttributes();this._pFinalizeAsset(o,t);this._blocks[e].data=o;if(this._debug)console.log("Parsed a StaticLightPicker: Name = '"+t+"' | Texture-Name = "+s)};t.prototype.parseMaterial=function(e){var a;var r;var s;var i;var n;var o;var l;var h;a=this.parseVarStr();r=this._newBlockBytes.readUnsignedByte();o=this._newBlockBytes.readUnsignedByte();s=this.parseProperties(t.materialProperties);l=0;while(l<o){var c;c=this._newBlockBytes.readUnsignedShort();this.parseProperties(null);this.parseUserAttributes();l+=1}var p="";if(r===1){p+="Parsed a ColorMaterial(SinglePass): Name = '"+a+"' | ";var u=s.get(1,16777215);if(this.materialMode<2){i=new ae.MethodMaterial(u,s.get(10,1))}else{i=new ae.MethodMaterial(u);i.mode=te.MethodMaterialMode.MULTI_PASS}}else if(r===2){var _=new W.Single2DTexture(this._blocks[s.get(2,0)].data);i=new ae.MethodMaterial;i.ambientMethod.texture=_;if(this.materialMode<2){i.alphaBlending=s.get(11,false);i.alpha=s.get(10,1);p+="Parsed a MethodMaterial(SinglePass): Name = '"+a+"'"+(_?" | Texture-Name = "+_.name:"")}else{i.mode=te.MethodMaterialMode.MULTI_PASS;p+="Parsed a MethodMaterial(MultiPass): Name = '"+a+"'"+(_?" | Texture-Name = "+_.name:"")}}i.extra=this.parseUserAttributes();i.alphaThreshold=s.get(12,0);i.style.sampler=new d.Sampler2D(s.get(13,false));this._pFinalizeAsset(i,a);this._blocks[e].data=i;if(this._debug)console.log(p)};t.prototype.parseMaterial_v1=function(e){var a;var r;var s;var i;var n=this.parseVarStr();var o=this._newBlockBytes.readUnsignedByte();var l=this._newBlockBytes.readUnsignedByte();var h=this.parseProperties(t.material_v1Properties);var c=h.get(4,0);var p="Parsed Material ";if(c>=2){this._blocks[e].addError("Material-spezialType '"+c+"' is not supported, can only be 0:singlePass, 1:MultiPass !");return}if(o<=2){if(this.materialMode==1)c=0;else if(this.materialMode==2)c=1;if(c<2){if(o==1){var u=h.get(1,13421772);if(c==1){a=new ae.MethodMaterial(u);a.mode=te.MethodMaterialMode.MULTI_PASS;p+="Parsed a ColorMaterial(MultiPass): Name = '"+n+"' | "}else{a=new ae.MethodMaterial(u,h.get(10,1));a.alphaBlending=h.get(11,false);p+="Parsed a ColorMaterial(SinglePass): Name = '"+n+"' | "}}else if(o==2){var _=new W.Single2DTexture(this._blocks[h.get(2,0)].data);a=new ae.MethodMaterial;a.ambientMethod.texture=_;if(c==1){a.mode=te.MethodMaterialMode.MULTI_PASS;p+="Parsed a MethodMaterial(MultiPass): Name = '"+n+"'"+(_?" | Texture-Name = "+_.name:"")}else{a.alpha=h.get(10,1);a.alphaBlending=h.get(11,false);p+="Parsed a MethodMaterial(SinglePass): Name = '"+n+"'"+(_?" | Texture-Name = "+_.name:"")}}r=this._blocks[h.get(17,0)].data;s=this._blocks[h.get(3,0)].data;i=this._blocks[h.get(21,0)].data;a.lightPicker=this._blocks[h.get(22,0)].data;a.style.sampler=new d.Sampler2D(h.get(13,false),h.get(5,true),h.get(6,true));a.bothSides=h.get(7,false);a.alphaPremultiplied=h.get(8,false);a.blendMode=this.blendModeDic[h.get(9,0)];if(r){a.diffuseTexture=new W.Single2DTexture(r);p+=" | DiffuseTexture-Name = "+r.name}if(s){a.normalMethod.texture=new W.Single2DTexture(s);p+=" | NormalTexture-Name = "+s.name}if(i){a.specularMethod.texture=new W.Single2DTexture(i);p+=" | SpecularTexture-Name = "+i.name}a.alphaThreshold=h.get(12,0);a.ambientMethod.strength=h.get(15,1);a.diffuseMethod.color=h.get(16,16777215);a.specularMethod.strength=h.get(18,1);a.specularMethod.gloss=h.get(19,50);a.specularMethod.color=h.get(20,16777215);for(var y=0;y<l;y++){var f;f=this._newBlockBytes.readUnsignedShort();h=this.parseProperties(t.method_v1Properties);switch(f){case 999:var b=this._blocks[h.get(1,0)].data;a.addEffectMethod(b);p+=" | EffectMethod-Name = "+b.name;break;case 998:var m=this._blocks[h.get(1,0)].data;a.shadowMethod=m;p+=" | ShadowMethod-Name = "+m.name;break;case 1:var g=new z.SingleCubeTexture(this._blocks[h.get(1,0)].data);a.ambientMethod=new re.AmbientEnvMapMethod;a.ambientMethod.texture=g;p+=" | AmbientEnvMapMethod | EnvMap-Name ="+g.name;break;case 51:a.diffuseMethod=new se.DiffuseDepthMethod;p+=" | DiffuseDepthMethod";break;case 52:var _=new W.Single2DTexture(this._blocks[h.get(1,0)].data);a.diffuseMethod=new ne.DiffuseGradientMethod(_);p+=" | DiffuseGradientMethod | GradientDiffuseTexture-Name ="+_.name;break;case 53:a.diffuseMethod=new le.DiffuseWrapMethod(h.get(101,5));p+=" | DiffuseWrapMethod";break;case 54:var _=new W.Single2DTexture(this._blocks[h.get(1,0)].data);a.diffuseMethod=new oe.DiffuseLightMapMethod(_,this.blendModeDic[h.get(401,10)],false,a.diffuseMethod);p+=" | DiffuseLightMapMethod | LightMapTexture-Name ="+_.name;break;case 55:a.diffuseMethod=new ie.DiffuseCelMethod(h.get(401,3),a.diffuseMethod);a.diffuseMethod.smoothness=h.get(101,.1);p+=" | DiffuseCelMethod";break;case 56:break;case 101:a.specularMethod=new Be.SpecularAnisotropicMethod;p+=" | SpecularAnisotropicMethod";break;case 102:a.specularMethod=new ke.SpecularPhongMethod;p+=" | SpecularPhongMethod";break;case 103:a.specularMethod=new Me.SpecularCelMethod(h.get(101,.5),a.specularMethod);a.specularMethod.smoothness=h.get(102,.1);p+=" | SpecularCelMethod";break;case 104:a.specularMethod=new ve.SpecularFresnelMethod(h.get(701,true),a.specularMethod);a.specularMethod.fresnelPower=h.get(101,5);a.specularMethod.normalReflectance=h.get(102,.1);p+=" | SpecularFresnelMethod";break;case 151:break;case 152:var _=new W.Single2DTexture(this._blocks[h.get(1,0)].data);a.normalMethod=new be.NormalSimpleWaterMethod(a.normalMethod.texture||_,_);p+=" | NormalSimpleWaterMethod | Second-NormalTexture-Name = "+_.name;break}this.parseUserAttributes()}}}else if(o>=3&&o<=7){var u=h.get(1,13421772);p+=u;var v=new W.Single2DTexture(this._blocks[h.get(2,0)].data);if(o==5){v.mappingMode=Fe.MappingMode.LINEAR_GRADIENT}else if(o==6){v.mappingMode=Fe.MappingMode.RADIAL_GRADIENT}var w=new Ne.BasicMaterial;w.texture=v;w.bothSides=true;w.extra=this.parseUserAttributes();this._pFinalizeAsset(w,n);this._blocks[e].data=w;if(this._debug)console.log(p);return}a.extra=this.parseUserAttributes();this._pFinalizeAsset(a,n);this._blocks[e].data=a;if(this._debug)console.log(p)};t.prototype.parseTexture=function(e){this._blocks[e].name=this.parseVarStr();var t=this._newBlockBytes.readUnsignedByte();this._texture_users[this._cur_block_id]=[];if(t==0){var a=this._newBlockBytes.readUTFBytes(this._newBlockBytes.readUnsignedInt());this._pAddDependency(this._cur_block_id.toString(),new y.URLRequest(a),false,null,true)}else{var r=this._newBlockBytes.readUnsignedInt();var s=new w.ByteArray(r);this._newBlockBytes.readBytes(s,0,r);this._pAddDependency(this._cur_block_id.toString(),null,false,s,true)}this.parseProperties(null);this._blocks[e].extras=this.parseUserAttributes();this._pPauseAndRetrieveDependencies();if(this._debug)console.log("Start parsing a "+["external","embed"][t]+" Bitmap for Texture")};t.prototype.parseCubeTexture=function(e){var t;var a;this._texture_users[this._cur_block_id]=[];var r=this._newBlockBytes.readUnsignedByte();this._blocks[e].name=this.parseVarStr();for(a=0;a<6;a++){this._texture_users[this._cur_block_id]=[];if(r==0){t=this._newBlockBytes.readUnsignedInt();var s;s=this._newBlockBytes.readUTFBytes(t);this._pAddDependency(this._cur_block_id.toString(),new y.URLRequest(s),false,null,true,a)}else{t=this._newBlockBytes.readUnsignedInt();var i=new w.ByteArray(t);this._newBlockBytes.readBytes(i,0,t);this._pAddDependency(this._cur_block_id.toString(),null,false,b.ParserUtils.byteArrayToImage(i),true,a)}}this.parseProperties(null);this._blocks[e].extras=this.parseUserAttributes();this._pPauseAndRetrieveDependencies();if(this._debug)console.log("Start parsing 6 "+["external","embed"][r]+" Bitmaps for CubeTexture")};t.prototype.parseSharedMethodBlock=function(e){var t;this._blocks[e].name=this.parseVarStr();t=this.parseSharedMethodList(e);this.parseUserAttributes();this._blocks[e].data=t;this._pFinalizeAsset(t,this._blocks[e].name);this._blocks[e].data=t;if(this._debug)console.log("Parsed a EffectMethod: Name = "+t.name+" Type = "+t)};t.prototype.parseShadowMethodBlock=function(e){this._blocks[e].name=this.parseVarStr();var t=this._blocks[this._newBlockBytes.readUnsignedInt()].data;var a=this.parseShadowMethodList(t,e);if(!a)return;this.parseUserAttributes();this._pFinalizeAsset(a,this._blocks[e].name);this._blocks[e].data=a;if(this._debug)console.log("Parsed a ShadowMapMethodMethod: Name = "+a.name+" | Type = "+a+" | Light-Name = ",t.name)};t.prototype.parseCommand=function(e){var a=this._newBlockBytes.readUnsignedByte()==1;var r=this._blocks[this._newBlockBytes.readUnsignedInt()].data;var s;var i=this.parseMatrix3D();var n=this.parseVarStr();var o=this._newBlockBytes.readShort();var l=this._newBlockBytes.readShort();var h=this.parseProperties(t.commandProperties);switch(l){case 1:s=this._blocks[h.get(1,0)].data;s.transform.matrix3D=i;if(r)r.addChild(s);break}if(s){h=this.parseProperties(t.targetProperties);s.pivot=new u.Vector3D(h.get(1,0),h.get(2,0),h.get(3,0));s.extra=this.parseUserAttributes()}this._blocks[e].data=s;if(this._debug)console.log("Parsed a CommandBlock: Name = '"+n)};t.prototype.parseMetaData=function(e){var a=this.parseProperties(t.metaDataProperties);if(this._debug){console.log("Parsed a MetaDataBlock: TimeStamp         = "+a.get(1,0));console.log("                        EncoderName       = "+a.get(2,"unknown"));console.log("                        EncoderVersion    = "+a.get(3,"unknown"));console.log("                        GeneratorName     = "+a.get(4,"unknown"));console.log("                        GeneratorVersion  = "+a.get(5,"unknown"))}};t.prototype.parseNameSpace=function(e){var t=this._newBlockBytes.readUnsignedByte();var a=this.parseVarStr();if(this._debug)console.log("Parsed a NameSpaceBlock: ID = "+t+" | String = "+a)};t.prototype.parseShadowMethodList=function(e,t){var a=this._newBlockBytes.readUnsignedShort();var r;var s=this.parseProperties(this.shadowMethodListProperties);var i;var n;switch(a){case 1002:r=new De.ShadowNearMethod(this._blocks[s.get(1,0)].data);break;case 1101:r=new ge.ShadowFilteredMethod(e);r.alpha=s.get(101,1);r.epsilon=s.get(102,.002);break;case 1102:r=new me.ShadowDitheredMethod(e,s.get(201,5));r.alpha=s.get(101,1);r.epsilon=s.get(102,.002);r.range=s.get(103,1);break;case 1103:r=new Ae.ShadowSoftMethod(e,s.get(201,5));r.alpha=s.get(101,1);r.epsilon=s.get(102,.002);r.range=s.get(103,1);break;case 1104:r=new we.ShadowHardMethod(e);r.alpha=s.get(101,1);r.epsilon=s.get(102,.002);break}this.parseUserAttributes();return r};t.prototype.parseSkeleton=function(e){var t=this.parseVarStr();var a=this._newBlockBytes.readUnsignedShort();var r=new Q.Skeleton;this.parseProperties(null);for(var s=0;s<a;s++){var i;var n;this._newBlockBytes.readUnsignedShort();i=new Z.SkeletonJoint;i.parentIndex=this._newBlockBytes.readUnsignedShort()-1;i.name=this.parseVarStr();n=this.parseMatrix3D();i.inverseBindPose=n.rawData;this.parseProperties(null);this.parseUserAttributes();r.joints.push(i)}this.parseUserAttributes();this._pFinalizeAsset(r,t);this._blocks[e].data=r;if(this._debug)console.log("Parsed a Skeleton: Name = "+r.name+" | Number of Joints = "+s)};t.prototype.parseSkeletonPose=function(e){var t=this.parseVarStr();var a=this._newBlockBytes.readUnsignedShort();this.parseProperties(null);var r=new q.SkeletonPose;for(var s=0;s<a;s++){var i;var n;i=new Y.JointPose;n=this._newBlockBytes.readUnsignedByte();if(n==1){var o=this.parseMatrix43RawData();var l=new p.Matrix3D(o);i.orientation.fromMatrix(l);i.translation.copyFrom(l.position);r.jointPoses[s]=i}}this.parseUserAttributes();this._pFinalizeAsset(r,t);this._blocks[e].data=r;if(this._debug)console.log("Parsed a SkeletonPose: Name = "+r.name+" | Number of Joints = "+s)};t.prototype.parseSkeletonAnimation=function(e){var t;var a;var r=this.parseVarStr();var s=new $.SkeletonClipNode;var i=this._newBlockBytes.readUnsignedShort();this.parseProperties(null);for(var n=0;n<i;n++){a=this._newBlockBytes.readUnsignedInt();t=this._newBlockBytes.readUnsignedShort();s.addFrame(this._blocks[a].data,t)}if(s.frames.length==0){this._blocks[e].addError("Could not this SkeletonClipNode, because no Frames where set.");return}this.parseUserAttributes();this._pFinalizeAsset(s,r);this._blocks[e].data=s;if(this._debug)console.log("Parsed a SkeletonClipNode: Name = "+s.name+" | Number of Frames = "+s.frames.length)};t.prototype.parseSpritePoseAnimation=function(e,t){if(t===void 0){t=false}var a;var r;var i;var n;var o;var l;var h;var d=0;var c=new ee.VertexClipNode;var p;var u;var _=new Array;var y;var f=this.parseVarStr();var b=this._newBlockBytes.readUnsignedInt();var m=this._blocks[b].data;var g=this.getUVForVertexAnimation(b);var v=!t?this._newBlockBytes.readUnsignedShort():1;var w=this._newBlockBytes.readUnsignedShort();var B=this._newBlockBytes.readUnsignedShort();for(var D=0;D<B;D++)_.push(this._newBlockBytes.readUnsignedShort());y=this.parseProperties(this.spritePoseAnimationProperties);c.looping=y.get(1,true);c.stitchFinalFrame=y.get(2,false);var A;for(var N=0;N<v;N++){A=this._newBlockBytes.readUnsignedShort();m=new M.Graphics;a=0;while(a<w){D=0;o=this._newBlockBytes.readUnsignedInt();l=this._newBlockBytes.position+o;while(D<B){if(_[D]==1){p=m.getGraphicAt(a).elements.indices;u=new Array;d=0;while(this._newBlockBytes.position<l){r=this.readNumber(this._accuracyGeo);i=this.readNumber(this._accuracyGeo);n=this.readNumber(this._accuracyGeo);u[d++]=r;u[d++]=i;u[d++]=n}h=new k.TriangleElements(new s.AttributesBuffer);h.setIndices(p);h.setPositions(u);h.setUVs(g[a]);h.setNormals(null);h.setTangents(null);h.autoDeriveNormals=false;h.autoDeriveTangents=false;a++;m.addGraphic(h)}else this._newBlockBytes.position=l;D++}}c.addFrame(m,A)}this.parseUserAttributes();this._pFinalizeAsset(c,f);this._blocks[e].data=c;if(this._debug)console.log("Parsed a VertexClipNode: Name = "+c.name+" | Target-Graphics-Name = "+m.name+" | Number of Frames = "+c.frames.length)};t.prototype.parseVertexAnimationSet=function(e){var a=this.parseVarStr();var r=this._newBlockBytes.readUnsignedShort();var s=this.parseProperties(t.vertexAnimationSetProperties);var i=new Array;var n=new Array;var o;for(var l=0;l<r;l++){o=this._blocks[this._newBlockBytes.readUnsignedInt()].data;if(o instanceof ee.VertexClipNode)n.push(o);else if(o instanceof $.SkeletonClipNode)i.push(o)}if(n.length==0&&i.length==0){this._blocks[e].addError("Could not create this AnimationSet, because it contains no animations");return}this.parseUserAttributes();if(n.length>0){var h=new K.VertexAnimationSet;for(var d=0;d<n.length;d++)h.addAnimation(n[d]);this._pFinalizeAsset(h,a);this._blocks[e].data=h;if(this._debug)console.log("Parsed a VertexAnimationSet: Name = "+a+" | Animations = "+h.animations.length+" | Animation-Names = "+h.animationNames)}else if(i.length>0){var c=new J.SkeletonAnimationSet(s.get(1,4));for(var d=0;d<i.length;d++)c.addAnimation(i[d]);this._pFinalizeAsset(c,a);this._blocks[e].data=c;if(this._debug)console.log("Parsed a SkeletonAnimationSet: Name = "+a+" | Animations = "+c.animations.length+" | Animation-Names = "+c.animationNames)}};t.prototype.parseAnimatorSet=function(e){var a=this.parseVarStr();var r=this._newBlockBytes.readUnsignedShort();var s=this.parseProperties(t.animatorSetProperties);var i=this._blocks[this._newBlockBytes.readUnsignedInt()].data;var n=new Array;var o=this._newBlockBytes.readUnsignedShort();for(var l=0;l<o;l++)n.push(this._blocks[this._newBlockBytes.readUnsignedInt()].data);var h=this._newBlockBytes.readUnsignedShort();var d=this._newBlockBytes.readUnsignedByte()==1;this.parseUserAttributes();this.parseUserAttributes();var c;if(r==1)c=new H.SkeletonAnimator(i,this._blocks[s.get(1,0)].data);else if(r==2)c=new X.VertexAnimator(i);this._pFinalizeAsset(c,a);this._blocks[e].data=c;for(l=0;l<n.length;l++){if(r==1)n[l].animator=c;else if(r==2)n[l].animator=c}if(this._debug)console.log("Parsed a Animator: Name = "+a)};t.prototype.parseSharedMethodList=function(e){var t=this._newBlockBytes.readUnsignedShort();var a;var r=this.parseProperties(this.sharedMethodListProperties);switch(t){case 401:a=new de.EffectColorMatrixMethod(r.get(101,new Array(0,0,0,1,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)));break;case 402:a=new ce.EffectColorTransformMethod;var s=r.get(601,0);a.colorTransform=new c.ColorTransform(r.get(102,1),r.get(103,1),r.get(104,1),r.get(101,1),s>>16&255,s>>8&255,s&255,s>>24&255);break;case 403:a=new pe.EffectEnvMapMethod(new z.SingleCubeTexture(this._blocks[r.get(1,0)].data),r.get(101,1));var i=r.get(2,0);if(i>0){}break;case 404:a=new ye.EffectLightMapMethod(this._blocks[r.get(1,0)].data,this.blendModeDic[r.get(401,10)]);break;case 406:a=new fe.EffectRimLightMethod(r.get(601,16777215),r.get(101,.4),r.get(101,2));break;case 407:a=new he.EffectAlphaMaskMethod(this._blocks[r.get(1,0)].data,r.get(701,false));break;case 410:a=new _e.EffectFresnelEnvMapMethod(this._blocks[r.get(1,0)].data,r.get(101,1));break;case 411:a=new ue.EffectFogMethod(r.get(101,0),r.get(102,1e3),r.get(601,8421504));break}this.parseUserAttributes();return a};t.prototype.parseUserAttributes=function(){var e=this._newBlockBytes.readUnsignedInt();if(e>0){var a=this._newBlockBytes.position+e;var r={};for(var s=0;this._newBlockBytes.position<a;s++){var i;var n;var o;var l;var h;i=this._newBlockBytes.readUnsignedByte();n=this.parseVarStr();o=this._newBlockBytes.readUnsignedByte();l=this._newBlockBytes.readUnsignedInt();if(this._newBlockBytes.position+l>a){console.log("           Error in reading attribute # "+s+" = skipped to end of attribute-list");this._newBlockBytes.position=a;return r}switch(o){case t.AWDSTRING:h=this._newBlockBytes.readUTFBytes(l);break;case t.INT8:h=this._newBlockBytes.readByte();break;case t.INT16:h=this._newBlockBytes.readShort();break;case t.INT32:h=this._newBlockBytes.readInt();break;case t.BOOL:case t.UINT8:h=this._newBlockBytes.readUnsignedByte();break;case t.UINT16:h=this._newBlockBytes.readUnsignedShort();break;case t.UINT32:case t.BADDR:h=this._newBlockBytes.readUnsignedInt();break;case t.FLOAT32:h=this._newBlockBytes.readFloat();break;case t.FLOAT64:h=this._newBlockBytes.readDouble();break;default:h="unimplemented attribute type "+o;this._newBlockBytes.position+=l;break}r[n]=h;if(this._debug)console.log("attribute = name: "+n+"  / value = "+h)}}return r};t.prototype.parseProperties=function(e){var t=this._newBlockBytes.readUnsignedInt();var a=new Ge;var r=this._newBlockBytes.position+t;if(e){var s;var i;var n;for(var o=0;this._newBlockBytes.position<r;o++){i=this._newBlockBytes.readUnsignedShort();s=this._newBlockBytes.readUnsignedInt();if(this._newBlockBytes.position+s>r){console.log("           Error in reading property # "+o+" = skipped to end of propertie-list");this._newBlockBytes.position=r;return a}if(e[i]){n=e[i];a.set(i,this.parseAttrValue(n,s))}else{this._newBlockBytes.position+=s}}}else{this._newBlockBytes.position=r}return a};t.prototype.parseAttrValue=function(e,a){var r;var s;var i;switch(e){case t.BOOL:case t.INT8:r=1;s=this._newBlockBytes.readByte;break;case t.INT16:r=2;s=this._newBlockBytes.readShort;break;case t.INT32:r=4;s=this._newBlockBytes.readInt;break;case t.UINT8:r=1;s=this._newBlockBytes.readUnsignedByte;break;case t.UINT16:r=2;s=this._newBlockBytes.readUnsignedShort;break;case t.UINT32:case t.COLOR:case t.BADDR:r=4;s=this._newBlockBytes.readUnsignedInt;break;case t.FLOAT32:r=4;s=this._newBlockBytes.readFloat;break;case t.FLOAT64:r=8;s=this._newBlockBytes.readDouble;break;case t.AWDSTRING:return this._newBlockBytes.readUTFBytes(a);case t.VECTOR2x1:case t.VECTOR3x1:case t.VECTOR4x1:case t.MTX3x2:case t.MTX3x3:case t.MTX4x3:case t.MTX4x4:r=8;s=this._newBlockBytes.readDouble;break;case t.GEO_NUMBER:i=this._accuracyGeo;case t.MATRIX_NUMBER:i=this._accuracyMatrix;case t.PROPERTY_NUMBER:i=this._accuracyProps;default:if(i){r=8;s=this._newBlockBytes.readDouble}else{r=4;s=this._newBlockBytes.readFloat}}if(r<a){var n=[];var o=a/r;for(var l=0;l<o;l++)n[l]=s.call(this._newBlockBytes);return n}else{return s.call(this._newBlockBytes)}};t.prototype.parseHeader=function(){this._byteData.position=3;this._version[0]=this._byteData.readUnsignedByte();this._version[1]=this._byteData.readUnsignedByte();var e=this._byteData.readUnsignedShort();this._streaming=ze.test(e,ze.FLAG1);if(this._version[0]==2&&this._version[1]==1){this._accuracyMatrix=ze.test(e,ze.FLAG2);this._accuracyGeo=ze.test(e,ze.FLAG3);this._accuracyProps=ze.test(e,ze.FLAG4)}this._compression=this._byteData.readUnsignedByte();if(this._debug){console.log("Import AWDFile of version = "+this._version[0]+" - "+this._version[1]);console.log("Global Settings = Compression = "+this._compression+" | Streaming = "+this._streaming+" | Matrix-Precision = "+this._accuracyMatrix+" | Graphics-Precision = "+this._accuracyGeo+" | Properties-Precision = "+this._accuracyProps)}var t=this._byteData.readUnsignedInt();if(!this._streaming&&t!=this._byteData.getBytesAvailable())this._pDieWithError("AWD2 body length does not match header integrity field")};t.prototype.getUVForVertexAnimation=function(e){if(this._blocks[e].data instanceof P.Sprite)e=this._blocks[e].geoID;if(this._blocks[e].uvsForVertexAnimation)return this._blocks[e].uvsForVertexAnimation;var t=this._blocks[e].data;var a;var r=this._blocks[e].uvsForVertexAnimation=new Array;var s=t.count;for(var i=0;i<s;i++){a=t.getGraphicAt(i).elements;r[i]=a.uvs.get(a.numVertices)}return this._blocks[e].uvsForVertexAnimation};t.prototype.parseVarStr=function(){return this._newBlockBytes.readUTFBytes(this._newBlockBytes.readUnsignedShort())};t.prototype.readNumber=function(e){if(e===void 0){e=false}if(e)return this._newBlockBytes.readDouble();return this._newBlockBytes.readFloat()};t.prototype.parseMatrix3D=function(){return new p.Matrix3D(this.parseMatrix43RawData())};t.prototype.parseMatrix32RawData=function(){var e=new Float32Array(6);for(var t=0;t<6;t++)e[t]=this._newBlockBytes.readFloat();return e};t.prototype.parseMatrix43RawData=function(){var e=new Float32Array(16);e[0]=this.readNumber(this._accuracyMatrix);e[1]=this.readNumber(this._accuracyMatrix);e[2]=this.readNumber(this._accuracyMatrix);e[3]=0;e[4]=this.readNumber(this._accuracyMatrix);e[5]=this.readNumber(this._accuracyMatrix);e[6]=this.readNumber(this._accuracyMatrix);e[7]=0;e[8]=this.readNumber(this._accuracyMatrix);e[9]=this.readNumber(this._accuracyMatrix);e[10]=this.readNumber(this._accuracyMatrix);e[11]=0;e[12]=this.readNumber(this._accuracyMatrix);e[13]=this.readNumber(this._accuracyMatrix);e[14]=this.readNumber(this._accuracyMatrix);e[15]=1;if(isNaN(e[0])){e[0]=1;e[1]=0;e[2]=0;e[4]=0;e[5]=1;e[6]=0;e[8]=0;e[9]=0;e[10]=1;e[12]=0;e[13]=0;e[14]=0}return e};t.COMPRESSIONMODE_LZMA="lzma";t.UNCOMPRESSED=0;t.DEFLATE=1;t.LZMA=2;t.INT8=1;t.INT16=2;t.INT32=3;t.UINT8=4;t.UINT16=5;t.UINT32=6;t.FLOAT32=7;t.FLOAT64=8;t.BOOL=21;t.COLOR=22;t.BADDR=23;t.AWDSTRING=31;t.AWDBYTEARRAY=32;t.VECTOR2x1=41;t.VECTOR3x1=42;t.VECTOR4x1=43;t.MTX3x2=44;t.MTX3x3=45;t.MTX4x3=46;t.MTX4x4=47;t.GEO_NUMBER=48;t.MATRIX_NUMBER=49;t.PROPERTY_NUMBER=50;t.textFormatProperties={1:t.UINT16,2:t.FLOAT32,3:t.UINT8,4:t.UINT8,5:t.UINT8,6:t.UINT8,7:t.FLOAT32,8:t.FLOAT32,9:t.FLOAT32,10:t.FLOAT32};t.textFieldProperties={1:t.BOOL,3:t.BOOL,4:t.BOOL,5:t.BOOL,7:t.UINT8,8:t.UINT8,9:t.UINT8};t.textFieldTypes=["static","dynamic","input","input"];t.movieClipProperties={1:t.FLOAT32,2:t.UINT16,3:t.UINT8};t.graphicsProperties={1:t.GEO_NUMBER,2:t.GEO_NUMBER};t.elementsProperties={1:t.GEO_NUMBER,2:t.GEO_NUMBER};t.primitiveProperties={101:t.GEO_NUMBER,102:t.GEO_NUMBER,103:t.GEO_NUMBER,110:t.GEO_NUMBER,111:t.GEO_NUMBER,301:t.UINT16,302:t.UINT16,303:t.UINT16,701:t.BOOL,702:t.BOOL,703:t.BOOL,704:t.BOOL};t.primitiveTypes=["Unsupported Type-ID","PrimitivePlanePrefab","PrimitiveCubePrefab","PrimitiveSpherePrefab","PrimitiveCylinderPrefab","PrimitivesConePrefab","PrimitivesCapsulePrefab","PrimitivesTorusPrefab"];t.containerProperties={1:t.MATRIX_NUMBER,2:t.MATRIX_NUMBER,3:t.MATRIX_NUMBER,4:t.UINT8};t.spriteInstanceProperties={1:t.MATRIX_NUMBER,2:t.MATRIX_NUMBER,3:t.MATRIX_NUMBER,4:t.UINT8,5:t.BOOL};t.lightProperties={1:t.PROPERTY_NUMBER,2:t.PROPERTY_NUMBER,3:t.COLOR,4:t.PROPERTY_NUMBER,5:t.PROPERTY_NUMBER,6:t.BOOL,7:t.COLOR,8:t.PROPERTY_NUMBER,9:t.UINT8,10:t.UINT8,11:t.PROPERTY_NUMBER,12:t.UINT16,21:t.MATRIX_NUMBER,22:t.MATRIX_NUMBER,23:t.MATRIX_NUMBER};t.cameraProperties={101:t.PROPERTY_NUMBER,102:t.PROPERTY_NUMBER,103:t.PROPERTY_NUMBER,104:t.PROPERTY_NUMBER};t.cameraPivotProperties={1:t.MATRIX_NUMBER,2:t.MATRIX_NUMBER,3:t.MATRIX_NUMBER,4:t.UINT8};t.materialProperties={1:t.INT32,2:t.BADDR,10:t.PROPERTY_NUMBER,11:t.BOOL,12:t.PROPERTY_NUMBER,13:t.BOOL};t.material_v1Properties={1:t.UINT32,2:t.BADDR,3:t.BADDR,4:t.UINT8,5:t.BOOL,6:t.BOOL,7:t.BOOL,8:t.BOOL,9:t.UINT8,10:t.PROPERTY_NUMBER,11:t.BOOL,12:t.PROPERTY_NUMBER,13:t.BOOL,15:t.PROPERTY_NUMBER,16:t.UINT32,17:t.BADDR,18:t.PROPERTY_NUMBER,19:t.PROPERTY_NUMBER,20:t.UINT32,21:t.BADDR,22:t.BADDR};t.method_v1Properties={1:t.BADDR,2:t.BADDR,3:t.BADDR,101:t.PROPERTY_NUMBER,102:t.PROPERTY_NUMBER,103:t.PROPERTY_NUMBER,201:t.UINT32,202:t.UINT32,301:t.UINT16,302:t.UINT16,401:t.UINT8,402:t.UINT8,601:t.COLOR,602:t.COLOR,701:t.BOOL,702:t.BOOL,801:t.MTX4x4};t.commandProperties={1:t.BADDR};t.targetProperties={1:t.MATRIX_NUMBER,2:t.MATRIX_NUMBER,3:t.MATRIX_NUMBER,
4:t.UINT8};t.metaDataProperties={1:t.UINT32,2:t.AWDSTRING,3:t.AWDSTRING,4:t.AWDSTRING,5:t.AWDSTRING};t.vertexAnimationSetProperties={1:t.UINT16};t.animatorSetProperties={1:t.BADDR};return t}(f.ParserBase);a.AWDParser=Ce;var Ve=function(){function e(){}e.STANDART_STREAMS=0;e.CONCENATED_STREAMS=1;e.SHARED_BUFFER=2;return e}();var Ge=function(){function e(){}e.prototype.set=function(e,t){this[e]=t};e.prototype.get=function(e,t){return this[e]||t};return e}();var ze=function(){function e(){}e.test=function(e,t){return(e&t)==t};e.FLAG1=1;e.FLAG2=2;e.FLAG3=4;e.FLAG4=8;e.FLAG5=16;e.FLAG6=32;e.FLAG7=64;e.FLAG8=128;e.FLAG9=256;e.FLAG10=512;e.FLAG11=1024;e.FLAG12=2048;e.FLAG13=4096;e.FLAG14=8192;e.FLAG15=16384;e.FLAG16=32768;return e}()},{"./AWD3ParserUtils/AWDBlock":"awayjs-parsers/lib/AWD3ParserUtils/AWDBlock","awayjs-core/lib/attributes/AttributesBuffer":undefined,"awayjs-core/lib/attributes/Byte4Attributes":undefined,"awayjs-core/lib/attributes/Float2Attributes":undefined,"awayjs-core/lib/attributes/Float3Attributes":undefined,"awayjs-core/lib/geom/ColorTransform":undefined,"awayjs-core/lib/geom/Matrix":undefined,"awayjs-core/lib/geom/Matrix3D":undefined,"awayjs-core/lib/geom/Rectangle":undefined,"awayjs-core/lib/geom/Vector3D":undefined,"awayjs-core/lib/image/BitmapImageCube":undefined,"awayjs-core/lib/image/BlendMode":undefined,"awayjs-core/lib/image/Sampler2D":undefined,"awayjs-core/lib/library/AssetLibrary":undefined,"awayjs-core/lib/net/URLLoaderDataFormat":undefined,"awayjs-core/lib/net/URLRequest":undefined,"awayjs-core/lib/parsers/ParserBase":undefined,"awayjs-core/lib/parsers/ParserUtils":undefined,"awayjs-core/lib/projections/OrthographicOffCenterProjection":undefined,"awayjs-core/lib/projections/OrthographicProjection":undefined,"awayjs-core/lib/projections/PerspectiveProjection":undefined,"awayjs-core/lib/utils/ByteArray":undefined,"awayjs-display/lib/base/Style":undefined,"awayjs-display/lib/base/Timeline":undefined,"awayjs-display/lib/display/Billboard":undefined,"awayjs-display/lib/display/Camera":undefined,"awayjs-display/lib/display/DirectionalLight":undefined,"awayjs-display/lib/display/DisplayObjectContainer":undefined,"awayjs-display/lib/display/PointLight":undefined,"awayjs-display/lib/display/Skybox":undefined,"awayjs-display/lib/display/Sprite":undefined,"awayjs-display/lib/graphics/ElementsType":undefined,"awayjs-display/lib/graphics/Graphics":undefined,"awayjs-display/lib/graphics/TriangleElements":undefined,"awayjs-display/lib/managers/DefaultMaterialManager":undefined,"awayjs-display/lib/materials/BasicMaterial":undefined,"awayjs-display/lib/materials/lightpickers/StaticLightPicker":undefined,"awayjs-display/lib/materials/shadowmappers/CubeMapShadowMapper":undefined,"awayjs-display/lib/materials/shadowmappers/DirectionalShadowMapper":undefined,"awayjs-display/lib/prefabs/PrefabBase":undefined,"awayjs-display/lib/prefabs/PrimitiveCapsulePrefab":undefined,"awayjs-display/lib/prefabs/PrimitiveConePrefab":undefined,"awayjs-display/lib/prefabs/PrimitiveCubePrefab":undefined,"awayjs-display/lib/prefabs/PrimitiveCylinderPrefab":undefined,"awayjs-display/lib/prefabs/PrimitivePlanePrefab":undefined,"awayjs-display/lib/prefabs/PrimitiveSpherePrefab":undefined,"awayjs-display/lib/prefabs/PrimitiveTorusPrefab":undefined,"awayjs-display/lib/text/Font":undefined,"awayjs-display/lib/text/TesselatedFontTable":undefined,"awayjs-display/lib/text/TextFormat":undefined,"awayjs-display/lib/textures/MappingMode":undefined,"awayjs-display/lib/textures/Single2DTexture":undefined,"awayjs-display/lib/textures/SingleCubeTexture":undefined,"awayjs-methodmaterials/lib/MethodMaterial":undefined,"awayjs-methodmaterials/lib/MethodMaterialMode":undefined,"awayjs-methodmaterials/lib/methods/AmbientEnvMapMethod":undefined,"awayjs-methodmaterials/lib/methods/DiffuseCelMethod":undefined,"awayjs-methodmaterials/lib/methods/DiffuseDepthMethod":undefined,"awayjs-methodmaterials/lib/methods/DiffuseGradientMethod":undefined,"awayjs-methodmaterials/lib/methods/DiffuseLightMapMethod":undefined,"awayjs-methodmaterials/lib/methods/DiffuseWrapMethod":undefined,"awayjs-methodmaterials/lib/methods/EffectAlphaMaskMethod":undefined,"awayjs-methodmaterials/lib/methods/EffectColorMatrixMethod":undefined,"awayjs-methodmaterials/lib/methods/EffectColorTransformMethod":undefined,"awayjs-methodmaterials/lib/methods/EffectEnvMapMethod":undefined,"awayjs-methodmaterials/lib/methods/EffectFogMethod":undefined,"awayjs-methodmaterials/lib/methods/EffectFresnelEnvMapMethod":undefined,"awayjs-methodmaterials/lib/methods/EffectLightMapMethod":undefined,"awayjs-methodmaterials/lib/methods/EffectRimLightMethod":undefined,"awayjs-methodmaterials/lib/methods/NormalSimpleWaterMethod":undefined,"awayjs-methodmaterials/lib/methods/ShadowDitheredMethod":undefined,"awayjs-methodmaterials/lib/methods/ShadowFilteredMethod":undefined,"awayjs-methodmaterials/lib/methods/ShadowHardMethod":undefined,"awayjs-methodmaterials/lib/methods/ShadowNearMethod":undefined,"awayjs-methodmaterials/lib/methods/ShadowSoftMethod":undefined,"awayjs-methodmaterials/lib/methods/SpecularAnisotropicMethod":undefined,"awayjs-methodmaterials/lib/methods/SpecularCelMethod":undefined,"awayjs-methodmaterials/lib/methods/SpecularFresnelMethod":undefined,"awayjs-methodmaterials/lib/methods/SpecularPhongMethod":undefined,"awayjs-player/lib/factories/AS2SceneGraphFactory":undefined,"awayjs-renderergl/lib/animators/SkeletonAnimationSet":undefined,"awayjs-renderergl/lib/animators/SkeletonAnimator":undefined,"awayjs-renderergl/lib/animators/VertexAnimationSet":undefined,"awayjs-renderergl/lib/animators/VertexAnimator":undefined,"awayjs-renderergl/lib/animators/data/JointPose":undefined,"awayjs-renderergl/lib/animators/data/Skeleton":undefined,"awayjs-renderergl/lib/animators/data/SkeletonJoint":undefined,"awayjs-renderergl/lib/animators/data/SkeletonPose":undefined,"awayjs-renderergl/lib/animators/nodes/SkeletonClipNode":undefined,"awayjs-renderergl/lib/animators/nodes/VertexClipNode":undefined}],"awayjs-parsers/lib/FNTParser":[function(e,t,a){"use strict";var r=this&&this.__extends||function(e,t){for(var a in t)if(t.hasOwnProperty(a))e[a]=t[a];function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};var s=e("awayjs-core/lib/library/AssetLibrary");var i=e("awayjs-core/lib/net/URLLoaderDataFormat");var n=e("awayjs-core/lib/net/URLRequest");var o=e("awayjs-core/lib/parsers/ParserBase");var l=e("awayjs-core/lib/parsers/ParserUtils");var h=e("awayjs-core/lib/utils/XmlUtils");var d=e("awayjs-display/lib/text/BitmapFontTable");var c=e("awayjs-display/lib/text/Font");var p=function(e){r(t,e);function t(){e.call(this,i.URLLoaderDataFormat.TEXT);this._parseState=0}t.supportsType=function(e){e=e.toLowerCase();var t=e=="fnt";if(t){console.log("supportsType fnt = "+e)}return e=="fnt"};t.supportsData=function(e){try{var t=l.ParserUtils.toString(e);if(t.indexOf("font")!=-1||t.indexOf("Font")!=-1){console.log("supportsData fnt");return true}return false}catch(a){return false}};t.prototype._iResolveDependency=function(e){if(e.assets.length){this._bitmapFontTable.add_page(e.assets[0]);this._pFinalizeAsset(e.assets[0]);this._parseState=u.PARSE_CHARS}else{this._parseState=u.PARSE_COMPLETE}};t.prototype._iResolveDependencyFailure=function(e){this._parseState=u.PARSE_COMPLETE};t.prototype._pProceedParsing=function(){var e;switch(this._parseState){case u.PARSE_XML:try{this._doc=h.XmlUtils.getChildrenWithTag(h.XmlUtils.strToXml(this._pGetTextData()),"font")[0];var t=h.XmlUtils.getChildrenWithTag(this._doc,"pages")[0];var a=h.XmlUtils.getChildrenWithTag(t,"page");var r=a.length;for(var i=0;i<r;i++){this._imagePath=h.XmlUtils.readAttributeValue(a[i],"file")}var l=h.XmlUtils.getChildrenWithTag(this._doc,"chars")[0];this._chars=h.XmlUtils.getChildrenWithTag(l,"char");this._parseState=u.PARSE_IMAGE;var p=h.XmlUtils.getChildrenWithTag(this._doc,"info")[0];var _=h.XmlUtils.getChildrenWithTag(this._doc,"common")[0];var y=h.XmlUtils.readAttributeValue(p,"face");this._font=s.AssetLibrary.getAsset(y);if(this._font==undefined){this._font=new c.Font;this._font.name=y}var f=h.XmlUtils.readAttributeValue(p,"bold");if(f!="0")y+="_bold";var b=h.XmlUtils.readAttributeValue(p,"italic");if(b!="0")y+="_italic";this._bitmapFontTable=this._font.get_font_table(y,d.BitmapFontTable.assetType);var m=h.XmlUtils.readAttributeValue(p,"size");this._bitmapFontTable._init_size=parseInt(m)}catch(g){return o.ParserBase.PARSING_DONE}break;case u.PARSE_IMAGE:if(this._imagePath){this._pAddDependency(this._imagePath,new n.URLRequest(this._imagePath));this._pPauseAndRetrieveDependencies()}else{return o.ParserBase.PARSING_DONE}break;case u.PARSE_CHARS:var v;var w,B,M,k,D,A,N,P,T;var S;var r=this._chars.length;for(var i=0;i<r;i++){v=this._chars[i];w=parseInt(h.XmlUtils.readAttributeValue(v,"x"));B=parseInt(h.XmlUtils.readAttributeValue(v,"y"));M=parseInt(h.XmlUtils.readAttributeValue(v,"width"));k=parseInt(h.XmlUtils.readAttributeValue(v,"height"));D=parseInt(h.XmlUtils.readAttributeValue(v,"xoffset"));A=parseInt(h.XmlUtils.readAttributeValue(v,"yoffset"));N=parseInt(h.XmlUtils.readAttributeValue(v,"xadvance"));P=parseInt(h.XmlUtils.readAttributeValue(v,"page"));T=parseInt(h.XmlUtils.readAttributeValue(v,"chnl"));S=h.XmlUtils.readAttributeValue(v,"id");this._bitmapFontTable.setChar(S,w,B,M,k,D,A,N,P,T)}this._pFinalizeAsset(this._font,this._font.name);this._parseState=u.PARSE_COMPLETE;break;case u.PARSE_COMPLETE:return o.ParserBase.PARSING_DONE}return o.ParserBase.MORE_TO_PARSE};return t}(o.ParserBase);a.FNTParser=p;var u=function(){function e(){}e.PARSE_XML=0;e.PARSE_IMAGE=1;e.PARSE_CHARS=2;e.PARSE_COMPLETE=3;return e}()},{"awayjs-core/lib/library/AssetLibrary":undefined,"awayjs-core/lib/net/URLLoaderDataFormat":undefined,"awayjs-core/lib/net/URLRequest":undefined,"awayjs-core/lib/parsers/ParserBase":undefined,"awayjs-core/lib/parsers/ParserUtils":undefined,"awayjs-core/lib/utils/XmlUtils":undefined,"awayjs-display/lib/text/BitmapFontTable":undefined,"awayjs-display/lib/text/Font":undefined}],"awayjs-parsers/lib/MD2Parser":[function(e,t,a){"use strict";var r=this&&this.__extends||function(e,t){for(var a in t)if(t.hasOwnProperty(a))e[a]=t[a];function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};var s=e("awayjs-core/lib/attributes/AttributesBuffer");var i=e("awayjs-core/lib/net/URLLoaderDataFormat");var n=e("awayjs-core/lib/net/URLRequest");var o=e("awayjs-core/lib/parsers/ParserBase");var l=e("awayjs-core/lib/parsers/ParserUtils");var h=e("awayjs-display/lib/graphics/Graphics");var d=e("awayjs-display/lib/graphics/TriangleElements");var c=e("awayjs-display/lib/display/DisplayObjectContainer");var p=e("awayjs-display/lib/display/Sprite");var u=e("awayjs-display/lib/managers/DefaultMaterialManager");var _=e("awayjs-renderergl/lib/animators/nodes/VertexClipNode");var y=e("awayjs-renderergl/lib/animators/VertexAnimationSet");var f=e("awayjs-methodmaterials/lib/MethodMaterial");var b=e("awayjs-methodmaterials/lib/MethodMaterialMode");var m=function(e){r(t,e);function t(t,a){if(t===void 0){t="jpg"}if(a===void 0){a=true}e.call(this,i.URLLoaderDataFormat.ARRAY_BUFFER);this._clipNodes=new Object;this._animationSet=new y.VertexAnimationSet;this.materialFinal=false;this.graphicsCreated=false;this._textureType=t;this._ignoreTexturePath=a}t.supportsType=function(e){e=e.toLowerCase();return e=="md2"};t.supportsData=function(e){return l.ParserUtils.toString(e,4)=="IDP2"};t.prototype._iResolveDependency=function(e){if(e.assets.length!=1)return;var t=new f.MethodMaterial(e.assets[0]);if(this.materialMode>=2)t.mode=b.MethodMaterialMode.MULTI_PASS;this._pContent.addChild(this._sprite);t.name=this._sprite.material.name;this._sprite.material=t;this._pFinalizeAsset(t);this._pFinalizeAsset(this._sprite.graphics);this._pFinalizeAsset(this._sprite);this.materialFinal=true};t.prototype._iResolveDependencyFailure=function(e){if(this.materialMode<2){this._sprite.material=u.DefaultMaterialManager.getDefaultMaterial()}else{this._sprite.material=new f.MethodMaterial(u.DefaultMaterialManager.getDefaultImage2D());this._sprite.material.mode=b.MethodMaterialMode.MULTI_PASS}this._pContent.addChild(this._sprite);this._pFinalizeAsset(this._sprite.graphics);this._pFinalizeAsset(this._sprite);this.materialFinal=true};t.prototype._pProceedParsing=function(){if(!this._startedParsing){this._byteData=this._pGetByteData();this._startedParsing=true;this._byteData.position=0}while(this._pHasTime()){if(!this._parsedHeader){this._sprite=new p.Sprite;this._graphics=this._sprite.graphics;if(this.materialMode<2){this._sprite.material=u.DefaultMaterialManager.getDefaultMaterial()}else{this._sprite.material=new f.MethodMaterial(u.DefaultMaterialManager.getDefaultImage2D());this._sprite.material.mode=b.MethodMaterialMode.MULTI_PASS}this.parseHeader();this.parseMaterialNames()}else if(!this._parsedUV){this.parseUV()}else if(!this._parsedFaces){this.parseFaces()}else if(!this._parsedFrames){this.parseFrames()}else if(this.graphicsCreated&&this.materialFinal){return o.ParserBase.PARSING_DONE}else if(!this.graphicsCreated){this.graphicsCreated=true;this._graphics.addGraphic(this._firstElements.clone());this._sprite.name="";if(this.materialFinal){this._pContent.addChild(this._sprite);this._pFinalizeAsset(this._sprite.graphics);this._pFinalizeAsset(this._sprite)}this._pPauseAndRetrieveDependencies()}}return o.ParserBase.MORE_TO_PARSE};t.prototype._pStartParsing=function(t){this._pContent=new c.DisplayObjectContainer;e.prototype._pStartParsing.call(this,t)};t.prototype.parseHeader=function(){this._ident=this._byteData.readInt();this._version=this._byteData.readInt();this._skinWidth=this._byteData.readInt();this._skinHeight=this._byteData.readInt();this._byteData.readInt();this._numSkins=this._byteData.readInt();this._numVertices=this._byteData.readInt();this._numST=this._byteData.readInt();this._numTris=this._byteData.readInt();this._byteData.readInt();this._numFrames=this._byteData.readInt();this._offsetSkins=this._byteData.readInt();this._offsetST=this._byteData.readInt();this._offsetTris=this._byteData.readInt();this._offsetFrames=this._byteData.readInt();this._byteData.readInt();this._offsetEnd=this._byteData.readInt();this._parsedHeader=true};t.prototype.parseMaterialNames=function(){var e;var t;var a;var r;this._materialNames=new Array;this._byteData.position=this._offsetSkins;var s=new RegExp("[^a-zA-Z0-9\\_/.]","g");for(var i=0;i<this._numSkins;++i){t=this._byteData.readUTFBytes(64);t=t.replace(s,"");a=t.lastIndexOf(".");if(this._ignoreTexturePath)r=t.lastIndexOf("/");if(t.toLowerCase().indexOf(".jpg")==-1&&t.toLowerCase().indexOf(".png")==-1){t=t.substring(r+1,a);e=t+"."+this._textureType}else{e=t}this._materialNames[i]=t;if(this.dependencies.length==0)this._pAddDependency(t,new n.URLRequest(e))}if(this._materialNames.length>0)this._sprite.material.name=this._materialNames[0];else this.materialFinal=true};t.prototype.parseUV=function(){var e=0;this._uvs=new Array(this._numST*2);this._byteData.position=this._offsetST;for(var t=0;t<this._numST;t++){this._uvs[e++]=this._byteData.readShort()/this._skinWidth;this._uvs[e++]=this._byteData.readShort()/this._skinHeight}this._parsedUV=true};t.prototype.parseFaces=function(){var e,t,a,r,s,i;var n;this._vertIndices=new Array;this._uvIndices=new Array;this._indices=new Array;this._byteData.position=this._offsetTris;for(n=0;n<this._numTris;n++){e=this._byteData.readUnsignedShort();t=this._byteData.readUnsignedShort();a=this._byteData.readUnsignedShort();r=this._byteData.readUnsignedShort();s=this._byteData.readUnsignedShort();i=this._byteData.readUnsignedShort();this.addIndex(e,r);this.addIndex(t,s);this.addIndex(a,i)}var o=this._uvIndices.length;this._finalUV=new Array(o*2);for(n=0;n<o;++n){this._finalUV[n<<1]=this._uvs[this._uvIndices[n]<<1];this._finalUV[(n<<1)+1]=this._uvs[(this._uvIndices[n]<<1)+1]}this._parsedFaces=true};t.prototype.addIndex=function(e,t){var a=this.findIndex(e,t);if(a==-1){this._indices.push(this._vertIndices.length);this._vertIndices.push(e);this._uvIndices.push(t)}else this._indices.push(a)};t.prototype.findIndex=function(e,t){var a=this._vertIndices.length;for(var r=0;r<a;++r){if(this._vertIndices[r]==e&&this._uvIndices[r]==t)return r}return-1};t.prototype.parseFrames=function(){var e,a,r;var i,n,o;var l;var c;var p=this._vertIndices.length;var u;var y;var f,b,m;var g="";var v=null;this._byteData.position=this._offsetFrames;for(f=0;f<this._numFrames;f++){y=new Array;u=new Array(p*3);e=this._byteData.readFloat();a=this._byteData.readFloat();r=this._byteData.readFloat();i=this._byteData.readFloat();n=this._byteData.readFloat();o=this._byteData.readFloat();g=this.readFrameName();for(b=0;b<this._numVertices;b++,this._byteData.position++)y.push(e*this._byteData.readUnsignedByte()+i,a*this._byteData.readUnsignedByte()+n,r*this._byteData.readUnsignedByte()+o);m=0;for(b=0;b<p;b++){u[m++]=y[this._vertIndices[b]*3];u[m++]=y[this._vertIndices[b]*3+2];u[m++]=y[this._vertIndices[b]*3+1]}c=new d.TriangleElements(new s.AttributesBuffer);if(this._firstElements==null)this._firstElements=c;l=new h.Graphics;l.addGraphic(c);c.setIndices(this._indices);c.setPositions(u);c.setUVs(this._finalUV);c.setNormals(null);c.setTangents(null);c.autoDeriveNormals=false;c.autoDeriveTangents=false;var w=this._clipNodes[g];if(!w){if(v){this._pFinalizeAsset(v);this._animationSet.addAnimation(v)}w=new _.VertexClipNode;w.name=g;w.stitchFinalFrame=true;this._clipNodes[g]=w;v=w}w.addFrame(l,1e3/t.FPS)}if(v){this._pFinalizeAsset(v);this._animationSet.addAnimation(v)}this._pFinalizeAsset(this._animationSet);this._parsedFrames=true};t.prototype.readFrameName=function(){var e="";var t=0;for(var a=0;a<16;a++){var r=this._byteData.readUnsignedByte();if(Math.floor(r)>57&&Math.floor(r)<=122&&t==0)e+=String.fromCharCode(r);if(Math.floor(r)>=48&&Math.floor(r)<=57)t++}return e};t.FPS=6;return t}(o.ParserBase);a.MD2Parser=m},{"awayjs-core/lib/attributes/AttributesBuffer":undefined,"awayjs-core/lib/net/URLLoaderDataFormat":undefined,"awayjs-core/lib/net/URLRequest":undefined,"awayjs-core/lib/parsers/ParserBase":undefined,"awayjs-core/lib/parsers/ParserUtils":undefined,"awayjs-display/lib/display/DisplayObjectContainer":undefined,"awayjs-display/lib/display/Sprite":undefined,"awayjs-display/lib/graphics/Graphics":undefined,"awayjs-display/lib/graphics/TriangleElements":undefined,"awayjs-display/lib/managers/DefaultMaterialManager":undefined,"awayjs-methodmaterials/lib/MethodMaterial":undefined,"awayjs-methodmaterials/lib/MethodMaterialMode":undefined,"awayjs-renderergl/lib/animators/VertexAnimationSet":undefined,"awayjs-renderergl/lib/animators/nodes/VertexClipNode":undefined}],"awayjs-parsers/lib/MD5AnimParser":[function(e,t,a){"use strict";var r=this&&this.__extends||function(e,t){for(var a in t)if(t.hasOwnProperty(a))e[a]=t[a];function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};var s=e("awayjs-core/lib/geom/Quaternion");var i=e("awayjs-core/lib/geom/Vector3D");var n=e("awayjs-core/lib/net/URLLoaderDataFormat");var o=e("awayjs-core/lib/parsers/ParserBase");var l=e("awayjs-renderergl/lib/animators/data/JointPose");var h=e("awayjs-renderergl/lib/animators/data/SkeletonPose");var d=e("awayjs-renderergl/lib/animators/nodes/SkeletonClipNode");var c=function(e){r(t,e);function t(t,a){if(t===void 0){t=null}if(a===void 0){a=0}e.call(this,n.URLLoaderDataFormat.TEXT);this._parseIndex=0;this._line=0;this._charLineIndex=0;this._rotationQuat=new s.Quaternion;var r=new s.Quaternion;var o=new s.Quaternion;r.fromAxisAngle(i.Vector3D.X_AXIS,-Math.PI*.5);o.fromAxisAngle(i.Vector3D.Y_AXIS,-Math.PI*.5);this._rotationQuat.multiply(o,r);if(t){this._rotationQuat.multiply(o,r);r.fromAxisAngle(t,a);this._rotationQuat.multiply(r,this._rotationQuat)}}t.supportsType=function(e){e=e.toLowerCase();return e=="md5anim"};t.supportsData=function(e){return false};t.prototype._pProceedParsing=function(){var e;if(!this._startedParsing){this._textData=this._pGetTextData();this._startedParsing=true}while(this._pHasTime()){e=this.getNextToken();switch(e){case t.COMMENT_TOKEN:this.ignoreLine();break;case"":break;case t.VERSION_TOKEN:this._version=this.getNextInt();if(this._version!=10)throw new Error("Unknown version number encountered!");break;case t.COMMAND_LINE_TOKEN:this.parseCMD();break;case t.NUM_FRAMES_TOKEN:this._numFrames=this.getNextInt();this._bounds=new Array;this._frameData=new Array;break;case t.NUM_JOINTS_TOKEN:this._numJoints=this.getNextInt();this._hierarchy=new Array(this._numJoints);this._baseFrameData=new Array(this._numJoints);break;case t.FRAME_RATE_TOKEN:this._frameRate=this.getNextInt();break;case t.NUM_ANIMATED_COMPONENTS_TOKEN:this._numAnimatedComponents=this.getNextInt();break;case t.HIERARCHY_TOKEN:this.parseHierarchy();break;case t.BOUNDS_TOKEN:this.parseBounds();break;case t.BASE_FRAME_TOKEN:this.parseBaseFrame();break;case t.FRAME_TOKEN:this.parseFrame();break;default:if(!this._reachedEOF)this.sendUnknownKeywordError()}if(this._reachedEOF){this._clip=new d.SkeletonClipNode;this.translateClip();this._pFinalizeAsset(this._clip);return o.ParserBase.PARSING_DONE}}return o.ParserBase.MORE_TO_PARSE};t.prototype.translateClip=function(){for(var e=0;e<this._numFrames;++e)this._clip.addFrame(this.translatePose(this._frameData[e]),1e3/this._frameRate)};t.prototype.translatePose=function(e){var t;var a;var r;var n;var o;var d=new i.Vector3D;var c=new s.Quaternion;var p=e.components;var u=new h.SkeletonPose;var _=u.jointPoses;for(var y=0;y<this._numJoints;++y){o=0;a=new l.JointPose;t=this._hierarchy[y];r=this._baseFrameData[y];n=t.flags;d.x=r.position.x;d.y=r.position.y;d.z=r.position.z;c.x=r.orientation.x;c.y=r.orientation.y;c.z=r.orientation.z;if(n&1)d.x=p[t.startIndex+o++];if(n&2)d.y=p[t.startIndex+o++];if(n&4)d.z=p[t.startIndex+o++];if(n&8)c.x=p[t.startIndex+o++];if(n&16)c.y=p[t.startIndex+o++];if(n&32)c.z=p[t.startIndex+o++];var f=1-c.x*c.x-c.y*c.y-c.z*c.z;c.w=f<0?0:-Math.sqrt(f);if(t.parentIndex<0){a.orientation.multiply(this._rotationQuat,c);a.translation=this._rotationQuat.rotatePoint(d)}else{a.orientation.copyFrom(c);a.translation.x=d.x;a.translation.y=d.y;a.translation.z=d.z}a.orientation.y=-a.orientation.y;a.orientation.z=-a.orientation.z;a.translation.x=-a.translation.x;_[y]=a}return u};t.prototype.parseHierarchy=function(){var e;var a;var r=this.getNextToken();var s=0;if(r!="{")this.sendUnknownKeywordError();do{if(this._reachedEOF)this.sendEOFError();a=new y;a.name=this.parseLiteralstring();a.parentIndex=this.getNextInt();a.flags=this.getNextInt();a.startIndex=this.getNextInt();this._hierarchy[s++]=a;e=this.getNextChar();if(e=="/"){this.putBack();e=this.getNextToken();if(e==t.COMMENT_TOKEN)this.ignoreLine();e=this.getNextChar()}if(e!="}")this.putBack()}while(e!="}")};t.prototype.parseBounds=function(){var e;var a;var r=this.getNextToken();var s=0;if(r!="{")this.sendUnknownKeywordError();do{if(this._reachedEOF)this.sendEOFError();a=new u;a.min=this.parseVector3D();a.max=this.parseVector3D();this._bounds[s++]=a;e=this.getNextChar();if(e=="/"){this.putBack();e=this.getNextToken();if(e==t.COMMENT_TOKEN)this.ignoreLine();e=this.getNextChar()}if(e!="}")this.putBack()}while(e!="}")};t.prototype.parseBaseFrame=function(){var e;var a;var r=this.getNextToken();var s=0;if(r!="{")this.sendUnknownKeywordError();do{if(this._reachedEOF)this.sendEOFError();a=new p;a.position=this.parseVector3D();a.orientation=this.parseQuaternion();this._baseFrameData[s++]=a;e=this.getNextChar();if(e=="/"){this.putBack();e=this.getNextToken();if(e==t.COMMENT_TOKEN)this.ignoreLine();e=this.getNextChar()}if(e!="}")this.putBack()}while(e!="}")};t.prototype.parseFrame=function(){var e;var a;var r;var s;s=this.getNextInt();r=this.getNextToken();if(r!="{")this.sendUnknownKeywordError();do{if(this._reachedEOF)this.sendEOFError();a=new _;a.components=new Array(this._numAnimatedComponents);for(var i=0;i<this._numAnimatedComponents;++i)a.components[i]=this.getNextNumber();this._frameData[s]=a;e=this.getNextChar();if(e=="/"){this.putBack();e=this.getNextToken();if(e==t.COMMENT_TOKEN)this.ignoreLine();e=this.getNextChar()}if(e!="}")this.putBack()}while(e!="}")};t.prototype.putBack=function(){this._parseIndex--;this._charLineIndex--;this._reachedEOF=this._parseIndex>=this._textData.length};t.prototype.getNextToken=function(){var e;var a="";while(!this._reachedEOF){e=this.getNextChar();if(e==" "||e=="\r"||e=="\n"||e=="	"){if(a!=t.COMMENT_TOKEN)this.skipWhiteSpace();if(a!="")return a}else a+=e;if(a==t.COMMENT_TOKEN)return a}return a};t.prototype.skipWhiteSpace=function(){var e;do e=this.getNextChar();while(e=="\n"||e==" "||e=="\r"||e=="	");this.putBack()};t.prototype.ignoreLine=function(){var e;while(!this._reachedEOF&&e!="\n")e=this.getNextChar()};t.prototype.getNextChar=function(){var e=this._textData.charAt(this._parseIndex++);if(e=="\n"){++this._line;this._charLineIndex=0}else if(e!="\r")++this._charLineIndex;if(this._parseIndex==this._textData.length)this._reachedEOF=true;return e};t.prototype.getNextInt=function(){var e=parseInt(this.getNextToken());if(isNaN(e))this.sendParseError("int type");return e};t.prototype.getNextNumber=function(){var e=parseFloat(this.getNextToken());if(isNaN(e))this.sendParseError("float type");return e};t.prototype.parseVector3D=function(){var e=new i.Vector3D;var t=this.getNextToken();if(t!="(")this.sendParseError("(");e.x=this.getNextNumber();e.y=this.getNextNumber();e.z=this.getNextNumber();if(this.getNextToken()!=")")this.sendParseError(")");return e};t.prototype.parseQuaternion=function(){var e=new s.Quaternion;var t=this.getNextToken();if(t!="(")this.sendParseError("(");e.x=this.getNextNumber();e.y=this.getNextNumber();e.z=this.getNextNumber();var a=1-e.x*e.x-e.y*e.y-e.z*e.z;e.w=a<0?0:-Math.sqrt(a);if(this.getNextToken()!=")")this.sendParseError(")");return e};t.prototype.parseCMD=function(){this.parseLiteralstring()};t.prototype.parseLiteralstring=function(){this.skipWhiteSpace();var e=this.getNextChar();var t="";if(e!='"')this.sendParseError('"');do{if(this._reachedEOF)this.sendEOFError();e=this.getNextChar();if(e!='"')t+=e}while(e!='"');return t};t.prototype.sendEOFError=function(){throw new Error("Unexpected end of file")};t.prototype.sendParseError=function(e){throw new Error("Unexpected token at line "+(this._line+1)+", character "+this._charLineIndex+". "+e+" expected, but "+this._textData.charAt(this._parseIndex-1)+" encountered")};t.prototype.sendUnknownKeywordError=function(){throw new Error("Unknown keyword at line "+(this._line+1)+", character "+this._charLineIndex+". ")};t.VERSION_TOKEN="MD5Version";t.COMMAND_LINE_TOKEN="commandline";t.NUM_FRAMES_TOKEN="numFrames";t.NUM_JOINTS_TOKEN="numJoints";t.FRAME_RATE_TOKEN="frameRate";t.NUM_ANIMATED_COMPONENTS_TOKEN="numAnimatedComponents";t.HIERARCHY_TOKEN="hierarchy";t.BOUNDS_TOKEN="bounds";t.BASE_FRAME_TOKEN="baseframe";t.FRAME_TOKEN="frame";t.COMMENT_TOKEN="//";return t}(o.ParserBase);a.MD5AnimParser=c;var p=function(){function e(){}return e}();a.BaseFrameData=p;var u=function(){function e(){}return e}();a.BoundsData=u;var _=function(){function e(){}return e}();a.FrameData=_;var y=function(){function e(){}return e}();a.HierarchyData=y},{"awayjs-core/lib/geom/Quaternion":undefined,"awayjs-core/lib/geom/Vector3D":undefined,"awayjs-core/lib/net/URLLoaderDataFormat":undefined,"awayjs-core/lib/parsers/ParserBase":undefined,"awayjs-renderergl/lib/animators/data/JointPose":undefined,"awayjs-renderergl/lib/animators/data/SkeletonPose":undefined,"awayjs-renderergl/lib/animators/nodes/SkeletonClipNode":undefined}],"awayjs-parsers/lib/MD5MeshParser":[function(e,t,a){"use strict";var r=this&&this.__extends||function(e,t){for(var a in t)if(t.hasOwnProperty(a))e[a]=t[a];function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};var s=e("awayjs-core/lib/attributes/AttributesBuffer");var i=e("awayjs-core/lib/geom/Quaternion");var n=e("awayjs-core/lib/geom/Vector3D");var o=e("awayjs-core/lib/net/URLLoaderDataFormat");var l=e("awayjs-core/lib/parsers/ParserBase");var h=e("awayjs-display/lib/graphics/TriangleElements");var d=e("awayjs-display/lib/display/DisplayObjectContainer");var c=e("awayjs-display/lib/display/Sprite");var p=e("awayjs-renderergl/lib/animators/SkeletonAnimationSet");var u=e("awayjs-renderergl/lib/animators/data/Skeleton");var _=e("awayjs-renderergl/lib/animators/data/SkeletonJoint");var y=function(e){r(t,e);function t(t,a){if(t===void 0){t=null}if(a===void 0){a=0}e.call(this,o.URLLoaderDataFormat.TEXT);this._parseIndex=0;this._line=0;this._charLineIndex=0;this._rotationQuat=new i.Quaternion;this._rotationQuat.fromAxisAngle(n.Vector3D.X_AXIS,-Math.PI*.5);if(t){var r=new i.Quaternion;r.fromAxisAngle(t,a);this._rotationQuat.multiply(this._rotationQuat,r)}}t.supportsType=function(e){e=e.toLowerCase();return e=="md5sprite"};t.supportsData=function(e){return false};t.prototype._pProceedParsing=function(){var e;if(!this._startedParsing){this._textData=this._pGetTextData();this._startedParsing=true}while(this._pHasTime()){e=this.getNextToken();switch(e){case t.COMMENT_TOKEN:this.ignoreLine();break;case t.VERSION_TOKEN:this._version=this.getNextInt();if(this._version!=10)throw new Error("Unknown version number encountered!");break;case t.COMMAND_LINE_TOKEN:this.parseCMD();break;case t.NUM_JOINTS_TOKEN:this._numJoints=this.getNextInt();this._bindPoses=new Array(this._numJoints);break;case t.NUM_MESHES_TOKEN:this._numMeshes=this.getNextInt();break;case t.JOINTS_TOKEN:this.parseJoints();break;case t.MESH_TOKEN:this.parseMesh();break;default:if(!this._reachedEOF)this.sendUnknownKeywordError()}if(this._reachedEOF){this.calculateMaxJointCount();this._animationSet=new p.SkeletonAnimationSet(this._maxJointCount);this._sprite=new c.Sprite;this._graphics=this._sprite.graphics;for(var a=0;a<this._elementsData.length;++a)this._graphics.addGraphic(this.translateElements(this._elementsData[a].positionData,this._elementsData[a].weightData,this._elementsData[a].indices));this._pContent.addChild(this._sprite);this._pFinalizeAsset(this._graphics);this._pFinalizeAsset(this._sprite);this._pFinalizeAsset(this._skeleton);this._pFinalizeAsset(this._animationSet);return l.ParserBase.PARSING_DONE}}return l.ParserBase.MORE_TO_PARSE};t.prototype._pStartParsing=function(t){this._pContent=new d.DisplayObjectContainer;e.prototype._pStartParsing.call(this,t)};t.prototype.calculateMaxJointCount=function(){this._maxJointCount=0;var e=this._elementsData.length;for(var t=0;t<e;++t){var a=this._elementsData[t];var r=a.positionData;var s=r.length;for(var i=0;i<s;++i){var n=this.countZeroWeightJoints(r[i],a.weightData);var o=r[i].countWeight-n;if(o>this._maxJointCount)this._maxJointCount=o}}};t.prototype.countZeroWeightJoints=function(e,t){var a=e.startWeight;var r=e.startWeight+e.countWeight;var s=0;var i;for(var n=a;n<r;++n){i=t[n].bias;if(i==0)++s}return s};t.prototype.parseJoints=function(){var e;var a;var r;var s;var i=0;var n=this.getNextToken();if(n!="{")this.sendUnknownKeywordError();this._skeleton=new u.Skeleton;do{if(this._reachedEOF)this.sendEOFError();a=new _.SkeletonJoint;a.name=this.parseLiteralstring();a.parentIndex=this.getNextInt();r=this.parseVector3D();r=this._rotationQuat.rotatePoint(r);s=this.parseQuaternion();this._bindPoses[i]=s.toMatrix3D();this._bindPoses[i].appendTranslation(r.x,r.y,r.z);var o=this._bindPoses[i].clone();o.invert();a.inverseBindPose=o.rawData;this._skeleton.joints[i++]=a;e=this.getNextChar();if(e=="/"){this.putBack();e=this.getNextToken();if(e==t.COMMENT_TOKEN)this.ignoreLine();e=this.getNextChar()}if(e!="}")this.putBack()}while(e!="}")};t.prototype.putBack=function(){this._parseIndex--;this._charLineIndex--;this._reachedEOF=this._parseIndex>=this._textData.length};t.prototype.parseMesh=function(){var e=this.getNextToken();var a;var r;var s;var i;if(e!="{")this.sendUnknownKeywordError();if(this._shaders==null)this._shaders=new Array;while(a!="}"){a=this.getNextToken();
switch(a){case t.COMMENT_TOKEN:this.ignoreLine();break;case t.MESH_SHADER_TOKEN:this._shaders.push(this.parseLiteralstring());break;case t.MESH_NUM_VERTS_TOKEN:r=new Array(this.getNextInt());break;case t.MESH_NUM_TRIS_TOKEN:i=new Array(this.getNextInt()*3);break;case t.MESH_NUM_WEIGHTS_TOKEN:s=new Array(this.getNextInt());break;case t.MESH_VERT_TOKEN:this.parseVertex(r);break;case t.MESH_TRI_TOKEN:this.parseTri(i);break;case t.MESH_WEIGHT_TOKEN:this.parseJoint(s);break}}if(this._elementsData==null)this._elementsData=new Array;var n=this._elementsData.length;this._elementsData[n]=new m;this._elementsData[n].positionData=r;this._elementsData[n].weightData=s;this._elementsData[n].indices=i};t.prototype.translateElements=function(e,t,a){var r=e.length;var i,n,o;var l;var d;var c;var p;var u=new h.TriangleElements(new s.AttributesBuffer);var _=new Array(r*2);var y=new Array(r*3);var f=new Array(r*this._maxJointCount);var b=new Array(r*this._maxJointCount);var m=0;var g;for(var v=0;v<r;++v){l=e[v];i=l.index*3;n=i+1;o=i+2;y[i]=y[n]=y[o]=0;g=0;for(var w=0;w<l.countWeight;++w){d=t[l.startWeight+w];if(d.bias>0){c=this._bindPoses[d.joint];p=c.transformVector(d.pos);y[i]+=p.x*d.bias;y[n]+=p.y*d.bias;y[o]+=p.z*d.bias;f[m]=d.joint*3;b[m++]=d.bias;++g}}for(w=g;w<this._maxJointCount;++w){f[m]=0;b[m++]=0}i=l.index<<1;_[i++]=l.s;_[i]=l.t}u.jointsPerVertex=this._maxJointCount;u.setIndices(a);u.setPositions(y);u.setUVs(_);u.setJointIndices(f);u.setJointWeights(b);u.setNormals(null);u.setTangents(null);u.autoDeriveTangents=false;u.autoDeriveNormals=false;return u};t.prototype.parseTri=function(e){var t=this.getNextInt()*3;e[t]=this.getNextInt();e[t+1]=this.getNextInt();e[t+2]=this.getNextInt()};t.prototype.parseJoint=function(e){var t=new b;t.index=this.getNextInt();t.joint=this.getNextInt();t.bias=this.getNextNumber();t.pos=this.parseVector3D();e[t.index]=t};t.prototype.parseVertex=function(e){var t=new f;t.index=this.getNextInt();this.parseUV(t);t.startWeight=this.getNextInt();t.countWeight=this.getNextInt();e[t.index]=t};t.prototype.parseUV=function(e){var t=this.getNextToken();if(t!="(")this.sendParseError("(");e.s=this.getNextNumber();e.t=this.getNextNumber();if(this.getNextToken()!=")")this.sendParseError(")")};t.prototype.getNextToken=function(){var e;var a="";while(!this._reachedEOF){e=this.getNextChar();if(e==" "||e=="\r"||e=="\n"||e=="	"){if(a!=t.COMMENT_TOKEN)this.skipWhiteSpace();if(a!="")return a}else a+=e;if(a==t.COMMENT_TOKEN)return a}return a};t.prototype.skipWhiteSpace=function(){var e;do e=this.getNextChar();while(e=="\n"||e==" "||e=="\r"||e=="	");this.putBack()};t.prototype.ignoreLine=function(){var e;while(!this._reachedEOF&&e!="\n")e=this.getNextChar()};t.prototype.getNextChar=function(){var e=this._textData.charAt(this._parseIndex++);if(e=="\n"){++this._line;this._charLineIndex=0}else if(e!="\r")++this._charLineIndex;if(this._parseIndex>=this._textData.length)this._reachedEOF=true;return e};t.prototype.getNextInt=function(){var e=parseInt(this.getNextToken());if(isNaN(e))this.sendParseError("int type");return e};t.prototype.getNextNumber=function(){var e=parseFloat(this.getNextToken());if(isNaN(e))this.sendParseError("float type");return e};t.prototype.parseVector3D=function(){var e=new n.Vector3D;var t=this.getNextToken();if(t!="(")this.sendParseError("(");e.x=-this.getNextNumber();e.y=this.getNextNumber();e.z=this.getNextNumber();if(this.getNextToken()!=")")this.sendParseError(")");return e};t.prototype.parseQuaternion=function(){var e=new i.Quaternion;var t=this.getNextToken();if(t!="(")this.sendParseError("(");e.x=this.getNextNumber();e.y=-this.getNextNumber();e.z=-this.getNextNumber();var a=1-e.x*e.x-e.y*e.y-e.z*e.z;e.w=a<0?0:-Math.sqrt(a);if(this.getNextToken()!=")")this.sendParseError(")");var r=new i.Quaternion;r.multiply(this._rotationQuat,e);return r};t.prototype.parseCMD=function(){this.parseLiteralstring()};t.prototype.parseLiteralstring=function(){this.skipWhiteSpace();var e=this.getNextChar();var t="";if(e!='"')this.sendParseError('"');do{if(this._reachedEOF)this.sendEOFError();e=this.getNextChar();if(e!='"')t+=e}while(e!='"');return t};t.prototype.sendEOFError=function(){throw new Error("Unexpected end of file")};t.prototype.sendParseError=function(e){throw new Error("Unexpected token at line "+(this._line+1)+", character "+this._charLineIndex+". "+e+" expected, but "+this._textData.charAt(this._parseIndex-1)+" encountered")};t.prototype.sendUnknownKeywordError=function(){throw new Error("Unknown keyword at line "+(this._line+1)+", character "+this._charLineIndex+". ")};t.VERSION_TOKEN="MD5Version";t.COMMAND_LINE_TOKEN="commandline";t.NUM_JOINTS_TOKEN="numJoints";t.NUM_MESHES_TOKEN="numMeshes";t.COMMENT_TOKEN="//";t.JOINTS_TOKEN="joints";t.MESH_TOKEN="mesh";t.MESH_SHADER_TOKEN="shader";t.MESH_NUM_VERTS_TOKEN="numverts";t.MESH_VERT_TOKEN="vert";t.MESH_NUM_TRIS_TOKEN="numtris";t.MESH_TRI_TOKEN="tri";t.MESH_NUM_WEIGHTS_TOKEN="numweights";t.MESH_WEIGHT_TOKEN="weight";return t}(l.ParserBase);a.MD5MeshParser=y;var f=function(){function e(){}return e}();a.PositionData=f;var b=function(){function e(){}return e}();a.JointData=b;var m=function(){function e(){}return e}();a.ElementsData=m},{"awayjs-core/lib/attributes/AttributesBuffer":undefined,"awayjs-core/lib/geom/Quaternion":undefined,"awayjs-core/lib/geom/Vector3D":undefined,"awayjs-core/lib/net/URLLoaderDataFormat":undefined,"awayjs-core/lib/parsers/ParserBase":undefined,"awayjs-display/lib/display/DisplayObjectContainer":undefined,"awayjs-display/lib/display/Sprite":undefined,"awayjs-display/lib/graphics/TriangleElements":undefined,"awayjs-renderergl/lib/animators/SkeletonAnimationSet":undefined,"awayjs-renderergl/lib/animators/data/Skeleton":undefined,"awayjs-renderergl/lib/animators/data/SkeletonJoint":undefined}],"awayjs-parsers/lib/Max3DSParser":[function(e,t,a){"use strict";var r=this&&this.__extends||function(e,t){for(var a in t)if(t.hasOwnProperty(a))e[a]=t[a];function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};var s=e("awayjs-core/lib/attributes/AttributesBuffer");var i=e("awayjs-core/lib/image/BitmapImage2D");var n=e("awayjs-core/lib/geom/Matrix3D");var o=e("awayjs-core/lib/geom/Vector3D");var l=e("awayjs-core/lib/net/URLLoaderDataFormat");var h=e("awayjs-core/lib/net/URLRequest");var d=e("awayjs-core/lib/parsers/ParserBase");var c=e("awayjs-core/lib/parsers/ParserUtils");var p=e("awayjs-display/lib/graphics/TriangleElements");var u=e("awayjs-display/lib/display/DisplayObjectContainer");var _=e("awayjs-display/lib/display/Sprite");var y=e("awayjs-display/lib/managers/DefaultMaterialManager");var f=e("awayjs-display/lib/textures/Single2DTexture");var b=e("awayjs-methodmaterials/lib/MethodMaterial");var m=e("awayjs-methodmaterials/lib/MethodMaterialMode");var g=function(e){r(t,e);function t(t){if(t===void 0){t=true}e.call(this,l.URLLoaderDataFormat.ARRAY_BUFFER);this._useSmoothingGroups=t}t.supportsType=function(e){e=e.toLowerCase();return e=="3ds"};t.supportsData=function(e){var t;t=c.ParserUtils.toByteArray(e);if(t){t.position=0;if(t.readShort()==19789)return true}return false};t.prototype._iResolveDependency=function(e){if(e.assets.length==1){var t;t=e.assets[0];if(t.isAsset(i.BitmapImage2D)){var a;a=this._textures[e.id];a.texture=new f.Single2DTexture(t)}}};t.prototype._iResolveDependencyFailure=function(e){};t.prototype._pProceedParsing=function(){if(!this._byteData){this._byteData=this._pGetByteData();this._byteData.position=0;this._textures={};this._materials={};this._unfinalized_objects={}}while(this._pHasTime()){if(this._cur_mat&&this._byteData.position>=this._cur_mat_end)this.finalizeCurrentMaterial();else if(this._cur_obj&&this._byteData.position>=this._cur_obj_end){this._unfinalized_objects[this._cur_obj.name]=this._cur_obj;this._cur_obj_end=Number.MAX_VALUE;this._cur_obj=null}if(this._byteData.getBytesAvailable()>0){var e;var t;var a;e=this._byteData.readUnsignedShort();t=this._byteData.readUnsignedInt();a=this._byteData.position+(t-6);switch(e){case 19789:case 15677:case 45056:continue;case 45055:this._cur_mat_end=a;this._cur_mat=this.parseMaterial();break;case 16384:this._cur_obj_end=a;this._cur_obj=new B;this._cur_obj.name=this.readNulTermstring();this._cur_obj.materials=new Array;this._cur_obj.materialFaces={};break;case 16640:this._cur_obj.type=_.Sprite.assetType;break;case 16656:this.parseVertexList();break;case 16672:this.parseFaceList();break;case 16704:this.parseUVList();break;case 16688:this.parseFaceMaterialList();break;case 16736:this._cur_obj.transform=this.readTransform();break;case 45058:this.parseObjectAnimation(a);break;case 16720:this.parseSmoothingGroups();break;default:this._byteData.position+=t-6;break}if(this.dependencies.length){this._pPauseAndRetrieveDependencies();break}}}if(this._byteData.getBytesAvailable()||this._cur_obj||this._cur_mat){return d.ParserBase.MORE_TO_PARSE}else{var r;for(r in this._unfinalized_objects){var s;s=this.constructObject(this._unfinalized_objects[r]);if(s){this._pContent.addChild(s);this._pFinalizeAsset(s,r)}}return d.ParserBase.PARSING_DONE}};t.prototype._pStartParsing=function(t){this._pContent=new u.DisplayObjectContainer;e.prototype._pStartParsing.call(this,t)};t.prototype.parseMaterial=function(){var e;e=new w;while(this._byteData.position<this._cur_mat_end){var t;var a;var r;t=this._byteData.readUnsignedShort();a=this._byteData.readUnsignedInt();r=this._byteData.position+(a-6);switch(t){case 40960:e.name=this.readNulTermstring();break;case 40976:e.ambientColor=this.readColor();break;case 40992:e.diffuseColor=this.readColor();break;case 41008:e.specularColor=this.readColor();break;case 41089:e.twoSided=true;break;case 41472:e.colorMap=this.parseTexture(r);break;case 41476:e.specularMap=this.parseTexture(r);break;default:this._byteData.position=r;break}}return e};t.prototype.parseTexture=function(e){var t;t=new M;while(this._byteData.position<e){var a;var r;a=this._byteData.readUnsignedShort();r=this._byteData.readUnsignedInt();switch(a){case 41728:t.url=this.readNulTermstring();break;default:this._byteData.position+=r-6;break}}this._textures[t.url]=t;this._pAddDependency(t.url,new h.URLRequest(t.url));return t};t.prototype.parseVertexList=function(){var e;var t;var a;a=this._byteData.readUnsignedShort();this._cur_obj.verts=new Array(a*3);e=0;t=this._cur_obj.verts.length;while(e<t){var r,s,i;r=this._byteData.readFloat();s=this._byteData.readFloat();i=this._byteData.readFloat();this._cur_obj.verts[e++]=r;this._cur_obj.verts[e++]=i;this._cur_obj.verts[e++]=s}};t.prototype.parseFaceList=function(){var e;var t;var a;a=this._byteData.readUnsignedShort();this._cur_obj.indices=new Array(a*3);e=0;t=this._cur_obj.indices.length;while(e<t){var r,s,i;r=this._byteData.readUnsignedShort();s=this._byteData.readUnsignedShort();i=this._byteData.readUnsignedShort();this._cur_obj.indices[e++]=r;this._cur_obj.indices[e++]=i;this._cur_obj.indices[e++]=s;this._byteData.position+=2}this._cur_obj.smoothingGroups=new Array(a)};t.prototype.parseSmoothingGroups=function(){var e=this._cur_obj.indices.length/3;var t=0;while(t<e){this._cur_obj.smoothingGroups[t]=this._byteData.readUnsignedInt();t++}};t.prototype.parseUVList=function(){var e;var t;var a;a=this._byteData.readUnsignedShort();this._cur_obj.uvs=new Array(a*2);e=0;t=this._cur_obj.uvs.length;while(e<t){this._cur_obj.uvs[e++]=this._byteData.readFloat();this._cur_obj.uvs[e++]=1-this._byteData.readFloat()}};t.prototype.parseFaceMaterialList=function(){var e;var t;var a;var r;e=this.readNulTermstring();t=this._byteData.readUnsignedShort();r=new Array(t);a=0;while(a<r.length)r[a++]=this._byteData.readUnsignedShort();this._cur_obj.materials.push(e);this._cur_obj.materialFaces[e]=r};t.prototype.parseObjectAnimation=function(e){var t;var a;var r;var s;var i;r=new o.Vector3D;while(this._byteData.position<e){var n;var l;n=this._byteData.readUnsignedShort();l=this._byteData.readUnsignedInt();switch(n){case 45072:s=this.readNulTermstring();this._byteData.position+=4;i=this._byteData.readShort();break;case 45075:r.x=this._byteData.readFloat();r.z=this._byteData.readFloat();r.y=this._byteData.readFloat();break;default:this._byteData.position+=l-6;break}}if(s!="$$$DUMMY"&&this._unfinalized_objects.hasOwnProperty(s)){t=this._unfinalized_objects[s];a=this.constructObject(t,r);if(a){this._pContent.addChild(a);this._pFinalizeAsset(a,t.name)}delete this._unfinalized_objects[s]}};t.prototype.constructObject=function(e,t){if(t===void 0){t=null}if(e.type==_.Sprite.assetType){var a;var r;var i;var o;var l;var h;var d;var c;if(e.materials.length>1)console.log("The Away3D 3DS parser does not support multiple materials per sprite at this point.");if(!e.indices||e.indices.length==0)return null;d=new Array(e.verts.length/3);c=new Array(e.indices.length/3);this.prepareData(d,c,e);if(this._useSmoothingGroups)this.applySmoothGroups(d,c);e.verts=new Array(d.length*3);for(a=0;a<d.length;a++){e.verts[a*3]=d[a].x;e.verts[a*3+1]=d[a].y;e.verts[a*3+2]=d[a].z}e.indices=new Array(c.length*3);for(a=0;a<c.length;a++){e.indices[a*3]=c[a].a;e.indices[a*3+1]=c[a].b;e.indices[a*3+2]=c[a].c}if(e.uvs){e.uvs=new Array(d.length*2);for(a=0;a<d.length;a++){e.uvs[a*2]=d[a].u;e.uvs[a*2+1]=d[a].v}}if(e.materials.length>0){var u;u=e.materials[0];o=this._materials[u].material}l=new _.Sprite(o);l.transform.matrix3D=new n.Matrix3D(e.transform);i=l.graphics;r=new p.TriangleElements(new s.AttributesBuffer);r.setIndices(e.indices);r.setPositions(e.verts);r.setUVs(e.uvs);i.addGraphic(r);if(t){if(e.transform){h=new n.Matrix3D(e.transform);h.rawData[12]=0;h.rawData[13]=0;h.rawData[14]=0;t=h.transformVector(t)}t.scaleBy(-1);h=new n.Matrix3D;h.appendTranslation(t.x,t.y,t.z);i.applyTransformation(h)}if(e.transform){h=new n.Matrix3D(e.transform);h.invert();i.applyTransformation(h)}this._pFinalizeAsset(i,e.name.concat("_graphics"));return l}return null};t.prototype.prepareData=function(e,t,a){var r;var s;var i;var n=a.verts.length;for(r=0,s=0,i=0;r<n;){var o=new k;o.x=a.verts[r++];o.y=a.verts[r++];o.z=a.verts[r++];if(a.uvs){o.u=a.uvs[s++];o.v=a.uvs[s++]}e[i++]=o}n=a.indices.length;for(r=0,i=0;r<n;){var l=new v;l.a=a.indices[r++];l.b=a.indices[r++];l.c=a.indices[r++];l.smoothGroup=a.smoothingGroups[i]||0;t[i++]=l}};t.prototype.applySmoothGroups=function(e,t){var a;var r;var s;var i;var n;var o=e.length;var l=t.length;var h=new Array(o);for(a=0;a<o;a++)h[a]=new Array;for(a=0;a<l;a++){var d=t[a];for(r=0;r<3;r++){var c=h[r==0?d.a:r==1?d.b:d.c];var p=d.smoothGroup;for(s=c.length-1;s>=0;s--){if((p&c[s])>0){p|=c[s];c.splice(s,1);s=c.length-1}}c.push(p)}}var u=new Array(o);for(a=0;a<o;a++){if((n=h[a].length)<1)continue;var _=new Array(n);u[a]=_;_[0]=a;var y=e[a];for(r=1;r<n;r++){var f=new k;f.x=y.x;f.y=y.y;f.z=y.z;f.u=y.u;f.v=y.v;_[r]=e.length;e.push(f)}}o=e.length;for(a=0;a<l;a++){d=t[a];p=d.smoothGroup;for(r=0;r<3;r++){s=r==0?d.a:r==1?d.b:d.c;c=h[s];n=c.length;_=u[s];for(i=0;i<n;i++){if(p==0&&c[i]==0||(p&c[i])>0){var b=_[i];if(p==0){c.splice(i,1);_.splice(i,1)}if(r==0)d.a=b;else if(r==1)d.b=b;else d.c=b;i=n}}}}};t.prototype.finalizeCurrentMaterial=function(){var e;e=new b.MethodMaterial(this._cur_mat.ambientColor);if(this._cur_mat.colorMap)e.ambientMethod.texture=this._cur_mat.colorMap.texture||y.DefaultMaterialManager.getDefaultTexture();e.diffuseMethod.color=this._cur_mat.diffuseColor;e.specularMethod.color=this._cur_mat.specularColor;if(this.materialMode>=2)e.mode=m.MethodMaterialMode.MULTI_PASS;e.bothSides=this._cur_mat.twoSided;this._pFinalizeAsset(e,this._cur_mat.name);this._materials[this._cur_mat.name]=this._cur_mat;this._cur_mat.material=e;this._cur_mat=null};t.prototype.readNulTermstring=function(){var e;var t="";while((e=this._byteData.readUnsignedByte())>0)t+=String.fromCharCode(e);return t};t.prototype.readTransform=function(){var e=new Float32Array(16);e[0]=this._byteData.readFloat();e[2]=this._byteData.readFloat();e[1]=this._byteData.readFloat();e[3]=0;e[8]=this._byteData.readFloat();e[10]=this._byteData.readFloat();e[9]=this._byteData.readFloat();e[11]=0;e[4]=this._byteData.readFloat();e[6]=this._byteData.readFloat();e[5]=this._byteData.readFloat();e[7]=0;e[12]=this._byteData.readFloat();e[14]=this._byteData.readFloat();e[13]=this._byteData.readFloat();e[15]=1;return e};t.prototype.readColor=function(){var e;var t;var a,r,s;e=this._byteData.readUnsignedShort();t=this._byteData.readUnsignedInt();switch(e){case 16:a=this._byteData.readFloat()*255;r=this._byteData.readFloat()*255;s=this._byteData.readFloat()*255;break;case 17:a=this._byteData.readUnsignedByte();r=this._byteData.readUnsignedByte();s=this._byteData.readUnsignedByte();break;default:this._byteData.position+=t-6;break}return a<<16|r<<8|s};return t}(d.ParserBase);a.Max3DSParser=g;var v=function(){function e(){}return e}();a.FaceVO=v;var w=function(){function e(){}return e}();a.MaterialVO=w;var B=function(){function e(){}return e}();a.ObjectVO=B;var M=function(){function e(){}return e}();a.TextureVO=M;var k=function(){function e(){}return e}();a.VertexVO=k},{"awayjs-core/lib/attributes/AttributesBuffer":undefined,"awayjs-core/lib/geom/Matrix3D":undefined,"awayjs-core/lib/geom/Vector3D":undefined,"awayjs-core/lib/image/BitmapImage2D":undefined,"awayjs-core/lib/net/URLLoaderDataFormat":undefined,"awayjs-core/lib/net/URLRequest":undefined,"awayjs-core/lib/parsers/ParserBase":undefined,"awayjs-core/lib/parsers/ParserUtils":undefined,"awayjs-display/lib/display/DisplayObjectContainer":undefined,"awayjs-display/lib/display/Sprite":undefined,"awayjs-display/lib/graphics/TriangleElements":undefined,"awayjs-display/lib/managers/DefaultMaterialManager":undefined,"awayjs-display/lib/textures/Single2DTexture":undefined,"awayjs-methodmaterials/lib/MethodMaterial":undefined,"awayjs-methodmaterials/lib/MethodMaterialMode":undefined}],"awayjs-parsers/lib/OBJParser":[function(e,t,a){"use strict";var r=this&&this.__extends||function(e,t){for(var a in t)if(t.hasOwnProperty(a))e[a]=t[a];function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)};var s=e("awayjs-core/lib/image/Sampler2D");var i=e("awayjs-core/lib/attributes/AttributesBuffer");var n=e("awayjs-core/lib/image/BitmapImage2D");var o=e("awayjs-core/lib/net/URLLoaderDataFormat");var l=e("awayjs-core/lib/net/URLRequest");var h=e("awayjs-core/lib/parsers/ParserBase");var d=e("awayjs-core/lib/parsers/ParserUtils");var c=e("awayjs-display/lib/graphics/TriangleElements");var p=e("awayjs-display/lib/display/DisplayObjectContainer");var u=e("awayjs-display/lib/display/Sprite");var _=e("awayjs-display/lib/managers/DefaultMaterialManager");var y=e("awayjs-display/lib/textures/Single2DTexture");var f=e("awayjs-methodmaterials/lib/MethodMaterial");var b=e("awayjs-methodmaterials/lib/MethodMaterialMode");var m=e("awayjs-methodmaterials/lib/methods/SpecularBasicMethod");var g=function(e){r(t,e);function t(t){if(t===void 0){t=1}e.call(this,o.URLLoaderDataFormat.TEXT);this._mtlLibLoaded=true;this._activeMaterialID="";this._scale=t}Object.defineProperty(t.prototype,"scale",{set:function(e){this._scale=e},enumerable:true,configurable:true});t.supportsType=function(e){e=e.toLowerCase();return e=="obj"};t.supportsData=function(e){var t=d.ParserUtils.toString(e);var a=false;var r=false;if(t){a=t.indexOf("\nv ")!=-1;r=t.indexOf("\nf ")!=-1}return a&&r};t.prototype._iResolveDependency=function(e){if(e.id=="mtl"){var t=d.ParserUtils.toString(e.data);this.parseMtl(t)}else{var a;if(e.assets.length!=1){return}a=e.assets[0];if(a.isAsset(n.BitmapImage2D)){var r=new k;r.materialID=e.id;r.texture=new y.Single2DTexture(a);this._materialLoaded.push(r);if(this._sprites.length>0){this.applyMaterial(r)}}}};t.prototype._iResolveDependencyFailure=function(e){if(e.id=="mtl"){this._mtlLib=false;this._mtlLibLoaded=false}else{var t=new k;t.materialID=e.id;this._materialLoaded.push(t)}if(this._sprites.length>0)this.applyMaterial(t)};t.prototype._pProceedParsing=function(){var e;var t=String.fromCharCode(10);var a;if(!this._startedParsing){this._textData=this._pGetTextData();this._textData=this._textData.replace(/\\[\r\n]+\s*/gm," ")}if(this._textData.indexOf(t)==-1)t=String.fromCharCode(13);if(!this._startedParsing){this._startedParsing=true;this._vertices=new Array;this._vertexNormals=new Array;this._materialIDs=new Array;this._materialLoaded=new Array;this._sprites=new Array;this._uvs=new Array;this._stringLength=this._textData.length;this._charIndex=this._textData.indexOf(t,0);this._oldIndex=0;this._objects=new Array;this._objectIndex=0}while(this._charIndex<this._stringLength&&this._pHasTime()){this._charIndex=this._textData.indexOf(t,this._oldIndex);if(this._charIndex==-1)this._charIndex=this._stringLength;e=this._textData.substring(this._oldIndex,this._charIndex);e=e.split("\r").join("");e=e.replace("  "," ");a=e.split(" ");this._oldIndex=this._charIndex+1;this.parseLine(a);if(this.parsingPaused){return h.ParserBase.MORE_TO_PARSE}}if(this._charIndex>=this._stringLength){if(this._mtlLib&&!this._mtlLibLoaded){return h.ParserBase.MORE_TO_PARSE}this.translate();this.applyMaterials();return h.ParserBase.PARSING_DONE}return h.ParserBase.MORE_TO_PARSE};t.prototype._pStartParsing=function(t){this._pContent=new p.DisplayObjectContainer;e.prototype._pStartParsing.call(this,t)};t.prototype.parseLine=function(e){switch(e[0]){case"mtllib":this._mtlLib=true;this._mtlLibLoaded=false;this.loadMtl(e[1]);break;case"g":this.createGroup(e);break;case"o":this.createObject(e);break;case"usemtl":if(this._mtlLib){if(!e[1])e[1]="def000";this._materialIDs.push(e[1]);this._activeMaterialID=e[1];if(this._currentGroup)this._currentGroup.materialID=this._activeMaterialID}break;case"v":this.parseVertex(e);break;case"vt":this.parseUV(e);break;case"vn":this.parseVertexNormal(e);break;case"f":this.parseFace(e)}};t.prototype.translate=function(){for(var e=0;e<this._objects.length;++e){var t=this._objects[e].groups;var a=t.length;var r;var s;var i;var n;var o;var l;var h;for(var d=0;d<a;++d){h=new f.MethodMaterial(_.DefaultMaterialManager.getDefaultImage2D());if(this.materialMode>=2)h.mode=b.MethodMaterialMode.MULTI_PASS;n=new u.Sprite(h);i=n.graphics;r=t[d].materialGroups;s=r.length;for(o=0;o<s;++o)this.translateMaterialGroup(r[o],i);if(i.count==0)continue;this._pFinalizeAsset(i);if(this._objects[e].name){n.name=this._objects[e].name}else if(t[d].name){n.name=t[d].name}else{n.name=""}this._sprites.push(n);if(t[d].materialID!="")h.name=t[d].materialID+"~"+n.name;else h.name=this._lastMtlID+"~"+n.name;if(n.graphics.count>1){for(l=1;l<n.graphics.count;++l)n.graphics.getGraphicAt(l).material=h}this._pContent.addChild(n);this._pFinalizeAsset(n)}}};t.prototype.translateMaterialGroup=function(e,t){var a=e.faces;var r;var s=a.length;var n;var o;var l=new Array;var h=new Array;var d=new Array;var p=new Array;this._realIndices=[];this._vertexIndex=0;var u;for(var _=0;_<s;++_){r=a[_];n=r.indexIds.length-1;for(u=1;u<n;++u){this.translateVertexData(r,u,l,h,p,d);this.translateVertexData(r,0,l,h,p,d);this.translateVertexData(r,u+1,l,h,p,d)}}if(l.length>0){o=new c.TriangleElements(new i.AttributesBuffer);o.autoDeriveNormals=d.length?false:true;o.setIndices(p);o.setPositions(l);o.setNormals(d);o.setUVs(h);t.addGraphic(o)}};t.prototype.translateVertexData=function(e,t,a,r,s,i){var n;var o;var l;var h;if(!this._realIndices[e.indexIds[t]]){n=this._vertexIndex;this._realIndices[e.indexIds[t]]=++this._vertexIndex;o=this._vertices[e.vertexIndices[t]-1];a.push(o.x*this._scale,o.y*this._scale,o.z*this._scale);if(e.normalIndices.length>0){l=this._vertexNormals[e.normalIndices[t]-1];i.push(l.x,l.y,l.z)}if(e.uvIndices.length>0){try{h=this._uvs[e.uvIndices[t]-1];r.push(h.u,h.v)}catch(d){switch(t){case 0:r.push(0,1);break;case 1:r.push(.5,0);break;case 2:r.push(1,1)}}}}else{n=this._realIndices[e.indexIds[t]]-1}s.push(n)};t.prototype.createObject=function(e){this._currentGroup=null;this._currentMaterialGroup=null;this._objects.push(this._currentObject=new v);if(e)this._currentObject.name=e[1]};t.prototype.createGroup=function(e){if(!this._currentObject)this.createObject(null);this._currentGroup=new w;this._currentGroup.materialID=this._activeMaterialID;if(e)this._currentGroup.name=e[1];this._currentObject.groups.push(this._currentGroup);this.createMaterialGroup(null)};t.prototype.createMaterialGroup=function(e){this._currentMaterialGroup=new B;if(e)this._currentMaterialGroup.url=e[1];this._currentGroup.materialGroups.push(this._currentMaterialGroup)};t.prototype.parseVertex=function(e){var t,a,r;if(e.length>4){var s=[];var i;for(var n=1;n<e.length;++n){i=parseFloat(e[n]);if(!isNaN(i))s.push(i)}t=s[0];a=s[1];r=-s[2];this._vertices.push(new N(t,a,r))}else{t=parseFloat(e[1]);a=parseFloat(e[2]);r=-parseFloat(e[3]);this._vertices.push(new N(t,a,r))}};t.prototype.parseUV=function(e){if(e.length>3){var t=[];var a;for(var r=1;r<e.length;++r){a=parseFloat(e[r]);if(!isNaN(a))t.push(a)}this._uvs.push(new A(t[0],1-t[1]))}else{this._uvs.push(new A(parseFloat(e[1]),1-parseFloat(e[2])))}};t.prototype.parseVertexNormal=function(e){if(e.length>4){var t=[];var a;for(var r=1;r<e.length;++r){a=parseFloat(e[r]);if(!isNaN(a))t.push(a)}this._vertexNormals.push(new N(t[0],t[1],-t[2]))}else{this._vertexNormals.push(new N(parseFloat(e[1]),parseFloat(e[2]),-parseFloat(e[3])))}};t.prototype.parseFace=function(e){var t=e.length;var a=new D;if(!this._currentGroup){this.createGroup(null)}var r;for(var s=1;s<t;++s){if(e[s]==""){continue}r=e[s].split("/");a.vertexIndices.push(this.parseIndex(parseInt(r[0]),this._vertices.length));if(r[1]&&String(r[1]).length>0)a.uvIndices.push(this.parseIndex(parseInt(r[1]),this._uvs.length));if(r[2]&&String(r[2]).length>0)a.normalIndices.push(this.parseIndex(parseInt(r[2]),this._vertexNormals.length));a.indexIds.push(e[s])}this._currentMaterialGroup.faces.push(a)};t.prototype.parseIndex=function(e,t){if(e<0)return e+t+1;else return e};t.prototype.parseMtl=function(e){var t=e.split("newmtl");var a;var r;var s;var i;var n;var o;var h;var d;var c;var p;var u;var _;for(var y=0;y<t.length;++y){a=t[y].split("\r").join("").split("\n");if(a.length==1)a=t[y].split(String.fromCharCode(13));h=d=c=16777215;p=0;n=false;o=false;u=1;_="";for(s=0;s<a.length;++s){a[s]=a[s].replace(/\s+$/,"");if(a[s].substring(0,1)!="#"&&(s==0||a[s]!="")){r=a[s].split(" ");if(String(r[0]).charCodeAt(0)==9||String(r[0]).charCodeAt(0)==32)r[0]=r[0].substring(1,r[0].length);if(s==0){this._lastMtlID=r.join("");this._lastMtlID=this._lastMtlID==""?"def000":this._lastMtlID}else{switch(r[0]){case"Ka":if(r[1]&&!isNaN(Number(r[1]))&&r[2]&&!isNaN(Number(r[2]))&&r[3]&&!isNaN(Number(r[3])))d=r[1]*255<<16|r[2]*255<<8|r[3]*255;break;case"Ks":if(r[1]&&!isNaN(Number(r[1]))&&r[2]&&!isNaN(Number(r[2]))&&r[3]&&!isNaN(Number(r[3]))){c=r[1]*255<<16|r[2]*255<<8|r[3]*255;n=true}break;case"Ns":if(r[1]&&!isNaN(Number(r[1])))p=Number(r[1])*.001;if(p==0)n=false;break;case"Kd":if(r[1]&&!isNaN(Number(r[1]))&&r[2]&&!isNaN(Number(r[2]))&&r[3]&&!isNaN(Number(r[3]))){h=r[1]*255<<16|r[2]*255<<8|r[3]*255;o=true}break;case"tr":case"d":if(r[1]&&!isNaN(Number(r[1])))u=Number(r[1]);break;case"map_Kd":_=this.parseMapKdString(r);_=_.replace(/\\/g,"/")}}}}if(_!=""){if(n){i=new m.SpecularBasicMethod;i.color=c;i.strength=p;var g=new M;g.alpha=u;g.basicSpecularMethod=i;g.materialID=this._lastMtlID;if(!this._materialSpecularData)this._materialSpecularData=new Array;this._materialSpecularData.push(g)}this._pAddDependency(this._lastMtlID,new l.URLRequest(_))}else if(o&&!isNaN(d)){var v=new k;v.materialID=this._lastMtlID;if(u==0)console.log("Warning: an alpha value of 0 was found in mtl color tag (Tr or d) ref:"+this._lastMtlID+", sprite(es) using it will be invisible!");var w=new f.MethodMaterial(d);if(this.materialMode<2){w.alpha=u}else{w.mode=b.MethodMaterialMode.MULTI_PASS}w.diffuseMethod.color=h;if(n){w.specularMethod.color=c;w.specularMethod.strength=p}v.cm=w;this._materialLoaded.push(v);if(this._sprites.length>0)this.applyMaterial(v)}}this._mtlLibLoaded=true};t.prototype.parseMapKdString=function(e){var t="";var a;var r;for(a=1;a<e.length;){switch(e[a]){case"-blendu":case"-blendv":case"-cc":case"-clamp":case"-texres":a+=2;break;case"-mm":a+=3;break;case"-o":case"-s":case"-t":a+=4;continue;default:r=true;break}if(r)break}for(a;a<e.length;a++){t+=e[a];t+=" "}t=t.replace(/\s+$/,"");return t};t.prototype.loadMtl=function(e){this._pAddDependency("mtl",new l.URLRequest(e),true);this._pPauseAndRetrieveDependencies()};t.prototype.applyMaterial=function(e){var t;var a;var r;var i;var n;for(var o=0;o<this._sprites.length;++o){a=this._sprites[o];t=a.material.name.split("~");if(t[0]==e.materialID){if(e.cm){if(a.material)a.material=null;a.material=e.cm}else if(e.texture){r=a.material;r.ambientMethod.texture=e.texture;r.style.color=e.color;r.alpha=e.alpha;r.style.sampler=new s.Sampler2D(true);if(this.materialMode<2)r.alpha=e.alpha;else r.mode=b.MethodMaterialMode.MULTI_PASS;if(e.specularMethod){r.specularMethod=null;r.specularMethod=e.specularMethod}else if(this._materialSpecularData){for(i=0;i<this._materialSpecularData.length;++i){n=this._materialSpecularData[i];if(n.materialID==e.materialID){r.specularMethod=null;r.specularMethod=n.basicSpecularMethod;r.specularMethod.color=n.color;r.specularMethod.strength=n.alpha;break}}}}a.material.name=t[1]?t[1]:t[0];this._sprites.splice(o,1);--o}}if(e.cm||r)this._pFinalizeAsset(e.cm||r)};t.prototype.applyMaterials=function(){if(this._materialLoaded.length==0)return;for(var e=0;e<this._materialLoaded.length;++e)this.applyMaterial(this._materialLoaded[e])};return t}(h.ParserBase);a.OBJParser=g;var v=function(){function e(){this.groups=new Array}return e}();a.ObjectGroup=v;var w=function(){function e(){this.materialGroups=new Array}return e}();a.Group=w;var B=function(){function e(){this.faces=new Array}return e}();a.MaterialGroup=B;var M=function(){function e(){this.color=16777215;this.alpha=1}return e}();a.SpecularData=M;var k=function(){function e(){this.color=16777215;this.alpha=1}return e}();a.LoadedMaterial=k;var D=function(){function e(){this.vertexIndices=new Array;this.uvIndices=new Array;this.normalIndices=new Array;this.indexIds=new Array}return e}();a.FaceData=D;var A=function(){function e(e,t){if(e===void 0){e=0}if(t===void 0){t=0}this._u=e;this._v=t}Object.defineProperty(e.prototype,"v",{get:function(){return this._v},set:function(e){this._v=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"u",{get:function(){return this._u},set:function(e){this._u=e},enumerable:true,configurable:true});e.prototype.clone=function(){return new e(this._u,this._v)};e.prototype.toString=function(){return this._u+","+this._v};return e}();a.UV=A;var N=function(){function e(e,t,a,r){if(e===void 0){e=0}if(t===void 0){t=0}if(a===void 0){a=0}if(r===void 0){r=0}this._x=e;this._y=t;this._z=a;this._index=r}Object.defineProperty(e.prototype,"index",{get:function(){return this._index},set:function(e){this._index=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e},enumerable:true,configurable:true});Object.defineProperty(e.prototype,"z",{get:function(){return this._z},set:function(e){this._z=e},enumerable:true,configurable:true});e.prototype.clone=function(){return new e(this._x,this._y,this._z)};return e}();a.Vertex=N},{"awayjs-core/lib/attributes/AttributesBuffer":undefined,"awayjs-core/lib/image/BitmapImage2D":undefined,"awayjs-core/lib/image/Sampler2D":undefined,"awayjs-core/lib/net/URLLoaderDataFormat":undefined,"awayjs-core/lib/net/URLRequest":undefined,"awayjs-core/lib/parsers/ParserBase":undefined,"awayjs-core/lib/parsers/ParserUtils":undefined,"awayjs-display/lib/display/DisplayObjectContainer":undefined,"awayjs-display/lib/display/Sprite":undefined,"awayjs-display/lib/graphics/TriangleElements":undefined,"awayjs-display/lib/managers/DefaultMaterialManager":undefined,"awayjs-display/lib/textures/Single2DTexture":undefined,
"awayjs-methodmaterials/lib/MethodMaterial":undefined,"awayjs-methodmaterials/lib/MethodMaterialMode":undefined,"awayjs-methodmaterials/lib/methods/SpecularBasicMethod":undefined}],"awayjs-parsers/lib/Parsers":[function(e,t,a){"use strict";var r=e("awayjs-core/lib/library/Loader");var s=e("./AWDParser");var i=e("./Max3DSParser");var n=e("./MD2Parser");var o=e("./OBJParser");var l=e("./FNTParser");var h=function(){function e(){}e.enableAllBundled=function(){r.Loader.enableParsers(e.ALL_BUNDLED)};e.ALL_BUNDLED=Array(s.AWDParser,i.Max3DSParser,n.MD2Parser,o.OBJParser,l.FNTParser);return e}();a.Parsers=h},{"./AWDParser":"awayjs-parsers/lib/AWDParser","./FNTParser":"awayjs-parsers/lib/FNTParser","./MD2Parser":"awayjs-parsers/lib/MD2Parser","./Max3DSParser":"awayjs-parsers/lib/Max3DSParser","./OBJParser":"awayjs-parsers/lib/OBJParser","awayjs-core/lib/library/Loader":undefined}]},{},[1]);
//# sourceMappingURL=awayjs-parsers.min.js.map
