require=function e(t,s,a){function r(o,n){if(!s[o]){if(!t[o]){var h="function"==typeof require&&require;if(!n&&h)return h(o,!0);if(i)return i(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var d=s[o]={exports:{}};t[o][0].call(d.exports,function(e){var s=t[o][1][e];return r(s?s:e)},d,d.exports,e,t,s,a)}return s[o].exports}for(var i="function"==typeof require&&require,o=0;o<a.length;o++)r(a[o]);return r}({"awayjs-parsers/lib/AWDParser":[function(e,t){var s=this.__extends||function(e,t){function s(){this.constructor=e}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);s.prototype=t.prototype,e.prototype=new s},a=e("awayjs-core/lib/geom/ColorTransform"),r=e("awayjs-core/lib/geom/Matrix3D"),i=e("awayjs-core/lib/geom/Vector3D"),o=e("awayjs-core/lib/net/URLLoaderDataFormat"),n=e("awayjs-core/lib/net/URLRequest"),h=e("awayjs-core/lib/library/AssetType"),l=e("awayjs-core/lib/parsers/ParserBase"),d=e("awayjs-core/lib/parsers/ParserUtils"),p=e("awayjs-core/lib/projections/PerspectiveProjection"),c=e("awayjs-core/lib/projections/OrthographicProjection"),u=e("awayjs-core/lib/projections/OrthographicOffCenterProjection"),_=e("awayjs-core/lib/textures/BitmapCubeTexture"),y=e("awayjs-core/lib/textures/ImageCubeTexture"),b=e("awayjs-core/lib/textures/ImageTexture"),m=e("awayjs-core/lib/utils/ByteArray"),g=e("awayjs-display/lib/containers/DisplayObjectContainer"),f=e("awayjs-display/lib/base/BlendMode"),w=e("awayjs-display/lib/base/Geometry"),v=e("awayjs-display/lib/base/TriangleSubGeometry"),k=e("awayjs-display/lib/entities/DirectionalLight"),N=e("awayjs-display/lib/entities/PointLight"),M=e("awayjs-display/lib/entities/Camera"),T=e("awayjs-display/lib/entities/Mesh"),D=e("awayjs-display/lib/entities/Skybox"),B=e("awayjs-display/lib/materials/lightpickers/StaticLightPicker"),x=e("awayjs-display/lib/materials/shadowmappers/CubeMapShadowMapper"),A=e("awayjs-display/lib/materials/shadowmappers/DirectionalShadowMapper"),S=e("awayjs-display/lib/prefabs/PrefabBase"),I=e("awayjs-display/lib/prefabs/PrimitiveCapsulePrefab"),E=e("awayjs-display/lib/prefabs/PrimitiveConePrefab"),j=e("awayjs-display/lib/prefabs/PrimitiveCubePrefab"),P=e("awayjs-display/lib/prefabs/PrimitiveCylinderPrefab"),U=e("awayjs-display/lib/prefabs/PrimitivePlanePrefab"),O=e("awayjs-display/lib/prefabs/PrimitiveSpherePrefab"),C=e("awayjs-display/lib/prefabs/PrimitiveTorusPrefab"),L=e("awayjs-renderergl/lib/animators/VertexAnimationSet"),F=e("awayjs-renderergl/lib/animators/VertexAnimator"),R=e("awayjs-renderergl/lib/animators/SkeletonAnimationSet"),G=e("awayjs-renderergl/lib/animators/SkeletonAnimator"),V=e("awayjs-renderergl/lib/animators/data/JointPose"),z=e("awayjs-renderergl/lib/animators/data/Skeleton"),K=e("awayjs-renderergl/lib/animators/data/SkeletonPose"),H=e("awayjs-renderergl/lib/animators/data/SkeletonJoint"),W=e("awayjs-renderergl/lib/animators/nodes/SkeletonClipNode"),J=e("awayjs-renderergl/lib/animators/nodes/VertexClipNode"),X=e("awayjs-renderergl/lib/managers/DefaultMaterialManager"),Q=e("awayjs-renderergl/lib/materials/SkyboxMaterial"),Y=e("awayjs-methodmaterials/lib/TriangleMaterialMode"),q=e("awayjs-methodmaterials/lib/TriangleMethodMaterial"),Z=e("awayjs-methodmaterials/lib/methods/AmbientEnvMapMethod"),$=e("awayjs-methodmaterials/lib/methods/DiffuseDepthMethod"),et=e("awayjs-methodmaterials/lib/methods/DiffuseCelMethod"),tt=e("awayjs-methodmaterials/lib/methods/DiffuseGradientMethod"),st=e("awayjs-methodmaterials/lib/methods/DiffuseLightMapMethod"),at=e("awayjs-methodmaterials/lib/methods/DiffuseWrapMethod"),rt=e("awayjs-methodmaterials/lib/methods/EffectAlphaMaskMethod"),it=e("awayjs-methodmaterials/lib/methods/EffectColorMatrixMethod"),ot=e("awayjs-methodmaterials/lib/methods/EffectColorTransformMethod"),nt=e("awayjs-methodmaterials/lib/methods/EffectEnvMapMethod"),ht=e("awayjs-methodmaterials/lib/methods/EffectFogMethod"),lt=e("awayjs-methodmaterials/lib/methods/EffectFresnelEnvMapMethod"),dt=e("awayjs-methodmaterials/lib/methods/EffectLightMapMethod"),pt=e("awayjs-methodmaterials/lib/methods/EffectRimLightMethod"),ct=e("awayjs-methodmaterials/lib/methods/NormalSimpleWaterMethod"),ut=e("awayjs-methodmaterials/lib/methods/ShadowDitheredMethod"),_t=e("awayjs-methodmaterials/lib/methods/ShadowFilteredMethod"),yt=e("awayjs-methodmaterials/lib/methods/SpecularFresnelMethod"),bt=e("awayjs-methodmaterials/lib/methods/ShadowHardMethod"),mt=e("awayjs-methodmaterials/lib/methods/SpecularAnisotropicMethod"),gt=e("awayjs-methodmaterials/lib/methods/SpecularCelMethod"),ft=e("awayjs-methodmaterials/lib/methods/SpecularPhongMethod"),wt=e("awayjs-methodmaterials/lib/methods/ShadowNearMethod"),vt=e("awayjs-methodmaterials/lib/methods/ShadowSoftMethod"),kt=e("awayjs-display/lib/entities/TimeLine"),Nt=e("awayjs-display/lib/entities/timelinedata/TimeLineFrame"),Mt=e("awayjs-display/lib/entities/timelinedata/TimeLineObject"),Tt=e("awayjs-display/lib/entities/timelinedata/FrameCommand"),Dt=e("awayjs-display/lib/entities/timelinedata/CommandPropsDisplayObject"),Bt=function(e){function t(){e.call(this,o.ARRAY_BUFFER),this._debug=!1,this._startedParsing=!1,this._texture_users={},this._parsed_header=!1,this._blocks=new Array,this._blocks[0]=new xt,this._blocks[0].data=null,this.blendModeDic=new Array,this.blendModeDic.push(f.NORMAL),this.blendModeDic.push(f.ADD),this.blendModeDic.push(f.ALPHA),this.blendModeDic.push(f.DARKEN),this.blendModeDic.push(f.DIFFERENCE),this.blendModeDic.push(f.ERASE),this.blendModeDic.push(f.HARDLIGHT),this.blendModeDic.push(f.INVERT),this.blendModeDic.push(f.LAYER),this.blendModeDic.push(f.LIGHTEN),this.blendModeDic.push(f.MULTIPLY),this.blendModeDic.push(f.NORMAL),this.blendModeDic.push(f.OVERLAY),this.blendModeDic.push(f.SCREEN),this.blendModeDic.push(f.SHADER),this.blendModeDic.push(f.OVERLAY),this._depthSizeDic=new Array,this._depthSizeDic.push(256),this._depthSizeDic.push(512),this._depthSizeDic.push(2048),this._depthSizeDic.push(1024),this._version=Array()}return s(t,e),t.supportsType=function(e){return e=e.toLowerCase(),"awd"==e},t.supportsData=function(e){return"AWD"==d.toString(e,3)},t.prototype._iResolveDependency=function(e){if(1==e.assets.length){var t,s,a,r=e.id.split("#"),i=r[0];if(1==r.length&&(t=e.assets[0])){a=this._blocks[e.id],a.data=t,t.resetAssetPath(a.name,null,!0),a.name=t.name,this._pFinalizeAsset(t),this._debug&&(console.log("Successfully loaded Bitmap for texture"),console.log("Parsed texture: Name = "+a.name))}if(r.length>1){s=e.assets[0];var o=s;if(this._cubeTextures[r[1]]=o.htmlImageElement,this._texture_users[i].push(1),this._debug&&console.log("Successfully loaded Bitmap "+this._texture_users[i].length+" / 6 for Cubetexture"),this._texture_users[i].length==this._cubeTextures.length){var n=this._cubeTextures[0],h=this._cubeTextures[1],l=this._cubeTextures[2],d=this._cubeTextures[3],p=this._cubeTextures[4],c=this._cubeTextures[5];t=new y(n,h,l,d,p,c),a=this._blocks[i],a.data=t,t.resetAssetPath(a.name,null,!0),a.name=t.name,this._pFinalizeAsset(t),this._debug&&console.log("Parsed CubeTexture: Name = "+a.name)}}}},t.prototype._iResolveDependencyFailure=function(){},t.prototype._iResolveDependencyName=function(e,t){var s=t.name;if(t){var a=this._blocks[parseInt(e.id)];t.resetAssetPath(a.name,null,!0)}var r=t.name;return t.name=s,r},t.prototype._pProceedParsing=function(){if(this._startedParsing||(this._byteData=this._pGetByteData(),this._startedParsing=!0),!this._parsed_header){switch(this.parseHeader(),this._compression){case t.DEFLATE:case t.LZMA:this._pDieWithError("Compressed AWD formats not yet supported");break;case t.UNCOMPRESSED:this._body=this._byteData}this._parsed_header=!0}if(this._body){for(;this._body.getBytesAvailable()>0&&!this.parsingPaused;)this.parseNextBlock();return 0==this._body.getBytesAvailable()?(this.dispose(),l.PARSING_DONE):l.MORE_TO_PARSE}switch(this._compression){case t.DEFLATE:case t.LZMA:this._debug&&console.log("(!) AWDParser Error: Compressed AWD formats not yet supported (!)")}return l.PARSING_DONE},t.prototype._pStartParsing=function(t){e.prototype._pStartParsing.call(this,t),this._pContent=new g},t.prototype.dispose=function(){for(var e in this._blocks){var t=this._blocks[e];t.dispose()}},t.prototype.parseNextBlock=function(){var e,s,a,r,i,o=!1;this._cur_block_id=this._body.readUnsignedInt(),s=this._body.readUnsignedByte(),a=this._body.readUnsignedByte(),r=this._body.readUnsignedByte(),i=this._body.readUnsignedInt();{var n=St.test(r,St.FLAG4);St.test(r,St.FLAG5)}this._accuracyOnBlocks&&(this._accuracyMatrix=St.test(r,St.FLAG1),this._accuracyGeo=St.test(r,St.FLAG2),this._accuracyProps=St.test(r,St.FLAG3),this._geoNrType=t.FLOAT32,this._accuracyGeo&&(this._geoNrType=t.FLOAT64),this._matrixNrType=t.FLOAT32,this._accuracyMatrix&&(this._matrixNrType=t.FLOAT64),this._propsNrType=t.FLOAT32,this._accuracyProps&&(this._propsNrType=t.FLOAT64));var h=this._body.position+i;if(i>this._body.getBytesAvailable())return this._pDieWithError("AWD2 block length is bigger than the bytes that are available!"),void(this._body.position+=this._body.getBytesAvailable());this._newBlockBytes=new m,this._body.readBytes(this._newBlockBytes,0,i),n&&this._pDieWithError("Compressed AWD formats not yet supported"),this._newBlockBytes.position=0,e=new xt,e.len=this._newBlockBytes.position+i,e.id=this._cur_block_id;var l=this._newBlockBytes.position+i;if(n&&this._pDieWithError("Compressed AWD formats not yet supported"),this._debug&&console.log("AWDBlock:  ID = "+this._cur_block_id+" | TypeID = "+a+" | Compression = "+n+" | Matrix-Precision = "+this._accuracyMatrix+" | Geometry-Precision = "+this._accuracyGeo+" | Properties-Precision = "+this._accuracyProps),this._blocks[this._cur_block_id]=e,3==this._version[0]&&0==this._version[1])switch(a){case 2:case 131:this.parseShape2D(this._cur_block_id),o=!0;break;case 3:case 132:this.parseShape2DFill(this._cur_block_id),o=!0;break;case 4:case 133:this.parseTimeLine(this._cur_block_id),o=!0}else if(2==this._version[0]&&1==this._version[1])switch(a){case 11:this.parsePrimitves(this._cur_block_id),o=!0;break;case 31:this.parseSkyboxInstance(this._cur_block_id),o=!0;break;case 41:this.parseLight(this._cur_block_id),o=!0;break;case 42:this.parseCamera(this._cur_block_id),o=!0;break;case 51:this.parseLightPicker(this._cur_block_id),o=!0;break;case 81:this.parseMaterial_v1(this._cur_block_id),o=!0;break;case 83:this.parseCubeTexture(this._cur_block_id),o=!0;break;case 91:this.parseSharedMethodBlock(this._cur_block_id),o=!0;break;case 92:this.parseShadowMethodBlock(this._cur_block_id),o=!0;break;case 111:this.parseMeshPoseAnimation(this._cur_block_id,!0),o=!0;break;case 112:this.parseMeshPoseAnimation(this._cur_block_id),o=!0;break;case 113:this.parseVertexAnimationSet(this._cur_block_id),o=!0;break;case 122:this.parseAnimatorSet(this._cur_block_id),o=!0;break;case 253:this.parseCommand(this._cur_block_id),o=!0}if(0==o)switch(a){case 1:this.parseTriangleGeometrieBlock(this._cur_block_id);break;case 22:this.parseContainer(this._cur_block_id);break;case 23:this.parseMeshInstance(this._cur_block_id);break;case 81:this.parseMaterial(this._cur_block_id);break;case 82:this.parseTexture(this._cur_block_id);break;case 101:this.parseSkeleton(this._cur_block_id);break;case 102:this.parseSkeletonPose(this._cur_block_id);break;case 103:this.parseSkeletonAnimation(this._cur_block_id);break;case 121:case 254:this.parseNameSpace(this._cur_block_id);break;case 255:this.parseMetaData(this._cur_block_id);break;default:this._debug&&console.log("AWDBlock:   Unknown BlockType  (BlockID = "+this._cur_block_id+") - Skip "+i+" bytes"),this._newBlockBytes.position+=i}var d=0;if(this._newBlockBytes.position==l){if(this._debug&&e.errorMessages)for(;d<e.errorMessages.length;)console.log("        (!) Error: "+e.errorMessages[d]+" (!)"),d++;this._debug&&console.log("\n")}else if(this._debug&&(console.log("  (!)(!)(!) Error while reading AWDBlock ID "+this._cur_block_id+" = skip to next block"),e.errorMessages))for(;d<e.errorMessages.length;)console.log("        (!) Error: "+e.errorMessages[d]+" (!)"),d++;this._body.position=h,this._newBlockBytes=null},t.prototype.parseShape2D=function(e){for(var t=new w,s=this.parseVarStr(),a=this._newBlockBytes.readUnsignedShort(),r=(this.parseProperties({1:this._geoNrType,2:this._geoNrType}),0);a>r;){var i,o,n;i=this._newBlockBytes.readUnsignedInt(),o=this._newBlockBytes.position+i;for(var h=(this.parseProperties({1:this._geoNrType,2:this._geoNrType}),new Array),l=0;this._newBlockBytes.position<o;){var d,p,c,u,_=0;p=this._newBlockBytes.readUnsignedByte(),d=this._newBlockBytes.readUnsignedByte(),c=this._newBlockBytes.readUnsignedInt(),u=this._newBlockBytes.position+c;var y,b,m,g,f,k,N,M,T,D;if(1==p){var B=new Array,x=new Array,A=new Array;for(new Array;this._newBlockBytes.position<u;)y=this.readNumber(this._accuracyGeo),b=this.readNumber(this._accuracyGeo),m=-.1*r,g=this.readNumber(this._accuracyGeo),T=this.readNumber(this._accuracyGeo),D=this.readNumber(this._accuracyGeo),f=this.readNumber(this._accuracyGeo),k=this.readNumber(this._accuracyGeo),N=this.readNumber(this._accuracyGeo),M=this.readNumber(this._accuracyGeo),x[_]=0,A[_]=0,B[_++]=y,x[_]=0,A[_]=0,B[_++]=b,A[_]=1,B[_++]=m}else if(2==p)for(;this._newBlockBytes.position<u;){var S=this._newBlockBytes.readUnsignedShort();h[l++]=S}else if(3==p)for(;this._newBlockBytes.position<u;){var S=this._newBlockBytes.readUnsignedShort();h[l++]=S}else if(4==p)for(;this._newBlockBytes.position<u;){var S=this._newBlockBytes.readUnsignedShort();h[l++]=S}else if(5==p)for(;this._newBlockBytes.position<u;){var S=this._newBlockBytes.readUnsignedShort();h[l++]=S}else this._newBlockBytes.position=u}this.parseUserAttributes(),n=new v(!0),n.autoDeriveNormals=!1,n.autoDeriveTangents=!0,n.updateIndices(h),n.updatePositions(B),n.updateUVs(x),n.updateVertexNormals(A),t.addSubGeometry(n),r++}this.parseUserAttributes(),this._pFinalizeAsset(t,s),this._blocks[e].data=t,this._debug&&console.log("Parsed a TriangleGeometry: Name = "+s+"| Id = "+n.id)},t.prototype.parseShape2DFill=function(e){var s=this.parseVarStr(),a=this._newBlockBytes.readUnsignedByte(),r=this.parseProperties({1:t.UINT32});switch(a){case 0:var i=new q(r.get(1,13421772));i.bothSides=!0,this._pFinalizeAsset(i,s),this._blocks[e].data=i;break;case 1:console.log("Parsed a bitmap FILL: Name = "+s);break;case 2:console.log("Parsed a linear gradient FILL: Name = "+s);break;case 3:console.log("Parsed a radial gradient FILL: Name = "+s);break;default:console.log("Parsed a unknown fillstyle: Name = "+s)}this.parseUserAttributes()},t.prototype.parseTimeLine=function(e){var t,s,a,o=new kt,n=this.parseVarStr(),l=!!this._newBlockBytes.readUnsignedByte(),d=this._newBlockBytes.readUnsignedByte(),p=this._newBlockBytes.readUnsignedShort();this._debug&&console.log("Parsed a TIMELINE: Name = "+n+"| isScene = "+l+"| sceneID = "+d+"| numFrames = "+p);var c=0;for(t=0;p>t;t++){var u=new Nt,_="frame = "+t,y=this._newBlockBytes.readUnsignedInt();u.setFrameTime(c,y),c+=y;var b=this._newBlockBytes.readUnsignedShort();for(s=0;b>s;s++){var m=this._newBlockBytes.readUnsignedByte(),g=this.parseVarStr();u.addLabel(g,m),_+="\n     label = "+g+" - labelType = "+m}var f=this._newBlockBytes.readUnsignedShort(),w="\n      Commands "+f;for(s=0;f>s;s++){var v,k,N=this._newBlockBytes.readUnsignedShort();switch(N){case 1:case 2:var M=new Dt,D=!!this._newBlockBytes.readByte(),B=!!this._newBlockBytes.readByte(),x=!!this._newBlockBytes.readByte(),A=!!this._newBlockBytes.readByte(),S=(!!this._newBlockBytes.readByte(),!!this._newBlockBytes.readByte()),I=!!this._newBlockBytes.readByte(),E=!!this._newBlockBytes.readByte();if(v=this._newBlockBytes.readUnsignedInt(),D?(k=this._newBlockBytes.readUnsignedInt(),w+="\n      - Add new Resource = "+k+" as object_id = "+v):w+="\n      - Update object_id = "+v,B){var j=[],P=new r,U=!1;if(U)P=this.parseMatrix3D();else{for(a=0;6>a;a++)j.push(this._newBlockBytes.readFloat());P.position=new i(j[4],j[5],0)}M.setDisplaymatrix(P),w+="\n                transformArray = "+j}if(x){var O=[];for(a=0;20>a;a++)O.push(this._newBlockBytes.readFloat());w+="\n                colorMatrix = "+O}if(A){var C=this._newBlockBytes.readUnsignedInt();w+="\n                Depth = "+C}if(S){var L=this._newBlockBytes.readUnsignedByte();w+="\n                BlendMode = "+L}if(I){var F=this._newBlockBytes.readUnsignedInt();w+="\n                ClipDepth = "+F}if(E){var R=Boolean(this._newBlockBytes.readByte());w+="\n                Visibitily = "+R}var G=this._newBlockBytes.readUnsignedShort();w+="\n                number of fills = "+G;var V=[];for(a=0;G>a;a++)V.push(this._newBlockBytes.readUnsignedInt()),w+="\n                    id of fill = "+V[a];var z=this.parseVarStr();if(z.length&&(M.setInstancename(z),w+="\n                instanceName = "+z),D){var K=this.getAssetByID(k,[h.GEOMETRY]);if(K[0]){var H=K[1],W=new T(H);for(a=0;G>a;a++){var J=this.getAssetByID(V[a],[h.MATERIAL]);J[0]&&W.subMeshes.length>a&&(W.subMeshes[a].material=J[1])}var X=new Mt(W,v,new Dt);o.addTimeLineObject(X);var Q=new Tt(X);Q.commandProps=M,u.addCommand(Q)}else{var K=this.getAssetByID(k,[h.TIMELINE]);if(K[0]){var Y=new Mt(K[1],v,new Dt);o.addTimeLineObject(Y);var q=new Tt(Y);q.commandProps=M,u.addCommand(q)}}}else{var Z=o.getTimeLineObjectByID(v),$=new Tt(Z);u.addCommand($)}break;case 3:v=this._newBlockBytes.readUnsignedInt();var Z=o.getTimeLineObjectByID(v),$=new Tt(Z);$.activateObj=!1,u.addCommand($),w+="\n       - Remove object with ID: "+v;break;case 4:v=this._newBlockBytes.readUnsignedInt(),k=this._newBlockBytes.readUnsignedInt(),w+="\n      - Add new Sound AWD-ID = "+k.toString()+" as object_id = "+v.toString();break;default:w+="\n       - Unknown Command Type = "+N}}var et=this._newBlockBytes.readUnsignedInt();if(et>0){var tt=this._newBlockBytes.readUTFBytes(et);u.addToScript(tt),_+="\nframe-code = "+tt}_+=w,this._newBlockBytes.readUnsignedInt(),o.addFrame(u)}this._pFinalizeAsset(o,n),this._blocks[e].data=o,this.parseProperties(null),this.parseUserAttributes()},t.prototype.parseTriangleGeometrieBlock=function(e){for(var t=new w,s=this.parseVarStr(),a=this._newBlockBytes.readUnsignedShort(),r=this.parseProperties({1:this._geoNrType,2:this._geoNrType}),i=r.get(1,1),o=r.get(2,1),n=0;a>n;){var h,l,d,p,c;h=this._newBlockBytes.readUnsignedInt(),l=this._newBlockBytes.position+h;for(var u=this.parseProperties({1:this._geoNrType,2:this._geoNrType});this._newBlockBytes.position<l;){var _,y,b,m,g=0;y=this._newBlockBytes.readUnsignedByte(),_=this._newBlockBytes.readUnsignedByte(),b=this._newBlockBytes.readUnsignedInt(),m=this._newBlockBytes.position+b;var f,k,N;if(1==y)for(var M=new Array;this._newBlockBytes.position<m;)f=this.readNumber(this._accuracyGeo),k=this.readNumber(this._accuracyGeo),N=this.readNumber(this._accuracyGeo),M[g++]=f,M[g++]=k,M[g++]=N;else if(2==y)for(var T=new Array;this._newBlockBytes.position<m;)T[g++]=this._newBlockBytes.readUnsignedShort();else if(3==y)for(var D=new Array;this._newBlockBytes.position<m;)D[g++]=this.readNumber(this._accuracyGeo);else if(4==y)for(var B=new Array;this._newBlockBytes.position<m;)B[g++]=this.readNumber(this._accuracyGeo);else if(6==y)for(p=Array();this._newBlockBytes.position<m;)p[g++]=3*this._newBlockBytes.readUnsignedShort();else if(7==y)for(c=new Array;this._newBlockBytes.position<m;)c[g++]=this.readNumber(this._accuracyGeo);else this._newBlockBytes.position=m}this.parseUserAttributes(),d=new v(!0),c&&(d.jointsPerVertex=c.length/(M.length/3)),B&&(d.autoDeriveNormals=!1),D&&(d.autoDeriveUVs=!1),d.updateIndices(T),d.updatePositions(M),d.updateVertexNormals(B),d.updateUVs(D),d.updateVertexTangents(null),d.updateJointWeights(c),d.updateJointIndices(p);var x=u.get(1,1),A=u.get(2,1),S=!1;(i!=x||o!=A)&&(S=!0,x=i/x,A=o/A),S&&d.scaleUV(x,A),t.addSubGeometry(d),n++}(1!=i||1!=o)&&t.scaleUV(i,o),this.parseUserAttributes(),this._pFinalizeAsset(t,s),this._blocks[e].data=t,this._debug&&console.log("Parsed a TriangleGeometry: Name = "+s+"| Id = "+d.id)},t.prototype.parsePrimitves=function(e){var s,a,r,i;s=this.parseVarStr(),r=this._newBlockBytes.readUnsignedByte(),i=this.parseProperties({101:this._geoNrType,102:this._geoNrType,103:this._geoNrType,110:this._geoNrType,111:this._geoNrType,301:t.UINT16,302:t.UINT16,303:t.UINT16,701:t.BOOL,702:t.BOOL,703:t.BOOL,704:t.BOOL});var o=["Unsupported Type-ID","PrimitivePlanePrefab","PrimitiveCubePrefab","PrimitiveSpherePrefab","PrimitiveCylinderPrefab","PrimitivesConePrefab","PrimitivesCapsulePrefab","PrimitivesTorusPrefab"];switch(r){case 1:a=new U(i.get(101,100),i.get(102,100),i.get(301,1),i.get(302,1),i.get(701,!0),i.get(702,!1));break;case 2:a=new j(i.get(101,100),i.get(102,100),i.get(103,100),i.get(301,1),i.get(302,1),i.get(303,1),i.get(701,!0));break;case 3:a=new O(i.get(101,50),i.get(301,16),i.get(302,12),i.get(701,!0));break;case 4:a=new P(i.get(101,50),i.get(102,50),i.get(103,100),i.get(301,16),i.get(302,1),!0,!0,!0),i.get(701,!0)||(a.topClosed=!1),i.get(702,!0)||(a.bottomClosed=!1),i.get(703,!0)||(a.yUp=!1);break;case 5:a=new E(i.get(101,50),i.get(102,100),i.get(301,16),i.get(302,1),i.get(701,!0),i.get(702,!0));break;case 6:a=new I(i.get(101,50),i.get(102,100),i.get(301,16),i.get(302,15),i.get(701,!0));break;case 7:a=new C(i.get(101,50),i.get(102,50),i.get(301,16),i.get(302,8),i.get(701,!0));break;default:a=new S,console.log("ERROR: UNSUPPORTED PREFAB_TYPE")}1!=i.get(110,1)||1!=i.get(111,1),this.parseUserAttributes(),a.name=s,this._pFinalizeAsset(a,s),this._blocks[e].data=a,this._debug&&((0>r||r>7)&&(r=0),console.log("Parsed a Primivite: Name = "+s+"| type = "+o[r]))},t.prototype.parseContainer=function(e){var s,a,r,o;a=this._newBlockBytes.readUnsignedInt(),r=this.parseMatrix3D(),s=this.parseVarStr();var n="Root (TopLevel)";o=new g,o.transform.matrix3D=r;var l=this.getAssetByID(a,[h.CONTAINER,h.LIGHT,h.MESH]);if(l[0]){{l[1].addChild(o)}n=l[1].name}else a>0?this._blocks[e].addError("Could not find a parent for this ObjectContainer3D"):this._pContent.addChild(o);if(2==this._version[0]&&1==this._version[1]){var d=this.parseProperties({1:this._matrixNrType,2:this._matrixNrType,3:this._matrixNrType,4:t.UINT8});o.pivot=new i(d.get(1,0),d.get(2,0),d.get(3,0))}else this.parseProperties(null);o.extra=this.parseUserAttributes(),this._pFinalizeAsset(o,s),this._blocks[e].data=o,this._debug&&console.log("Parsed a Container: Name = '"+s+"' | Parent-Name = "+n)},t.prototype.parseMeshInstance=function(e){var s,a,r,o=this._newBlockBytes.readUnsignedInt(),n=this.parseMatrix3D(),l=this.parseVarStr(),d="Root (TopLevel)",p=this._newBlockBytes.readUnsignedInt(),c=this.getAssetByID(p,[h.GEOMETRY]);c[0]?r=c[1]:(this._blocks[e].addError("Could not find a Geometry for this Mesh. A empty Geometry is created!"),r=new w),this._blocks[e].geoID=p;var u=new Array;s=this._newBlockBytes.readUnsignedShort();var _=new Array;a=0;for(var y;s>a;){var b;b=this._newBlockBytes.readUnsignedInt(),y=this.getAssetByID(b,[h.MATERIAL]),!y[0]&&b>0&&this._blocks[e].addError("Could not find Material Nr "+a+" (ID = "+b+" ) for this Mesh");var m=y[1];u.push(m),_.push(m.name),a++}var g=new T(r,null);g.transform.matrix3D=n;var f=this.getAssetByID(o,[h.CONTAINER,h.LIGHT,h.MESH]);if(f[0]){var v=f[1];v.addChild(g),d=v.name}else o>0?this._blocks[e].addError("Could not find a parent for this Mesh"):this._pContent.addChild(g);if(u.length>=1&&1==g.subMeshes.length)g.material=u[0];else if(u.length>1){var k;for(k=0;k<g.subMeshes.length;k++)g.subMeshes[k].material=u[Math.min(u.length-1,k)]}if(2==this._version[0]&&1==this._version[1]){var N=this.parseProperties({1:this._matrixNrType,2:this._matrixNrType,3:this._matrixNrType,4:t.UINT8,5:t.BOOL});g.pivot=new i(N.get(1,0),N.get(2,0),N.get(3,0)),g.castsShadows=N.get(5,!0)}else this.parseProperties(null);g.extra=this.parseUserAttributes(),this._pFinalizeAsset(g,l),this._blocks[e].data=g,this._debug&&console.log("Parsed a Mesh: Name = '"+l+"' | Parent-Name = "+d+"| Geometry-Name = "+r.name+" | SubMeshes = "+g.subMeshes.length+" | Mat-Names = "+_.toString())},t.prototype.parseSkyboxInstance=function(e){var t=this.parseVarStr(),s=this._newBlockBytes.readUnsignedInt(),a=this.getAssetByID(s,[h.TEXTURE],"CubeTexture");a[0]||0==s||this._blocks[e].addError("Could not find the Cubetexture (ID = "+s+" ) for this Skybox");var r=new D(new Q(a[1]));this.parseProperties(null),r.extra=this.parseUserAttributes(),this._pFinalizeAsset(r,t),this._blocks[e].data=r,this._debug&&console.log("Parsed a Skybox: Name = '"+t+"' | CubeTexture-Name = "+a[1].name)},t.prototype.parseLight=function(e){var s,a,r=this._newBlockBytes.readUnsignedInt(),i=this.parseMatrix3D(),o=this.parseVarStr(),n=this._newBlockBytes.readUnsignedByte(),l=this.parseProperties({1:this._propsNrType,2:this._propsNrType,3:t.COLOR,4:this._propsNrType,5:this._propsNrType,6:t.BOOL,7:t.COLOR,8:this._propsNrType,9:t.UINT8,10:t.UINT8,11:this._propsNrType,12:t.UINT16,21:this._matrixNrType,22:this._matrixNrType,23:this._matrixNrType}),d=l.get(9,0),p="Root (TopLevel)",c=["Unsupported LightType","PointLight","DirectionalLight"],u=["No ShadowMapper","DirectionalShadowMapper","NearDirectionalShadowMapper","CascadeShadowMapper","CubeMapShadowMapper"];if(1==n&&(s=new N,s.radius=l.get(1,9e4),s.fallOff=l.get(2,1e5),d>0&&4==d&&(a=new x),s.transform.matrix3D=i),2==n&&(s=new k(l.get(21,0),l.get(22,-1),l.get(23,1)),d>0&&1==d&&(a=new A)),s.color=l.get(3,16777215),s.specular=l.get(4,1),s.diffuse=l.get(5,1),s.ambientColor=l.get(7,16777215),s.ambient=l.get(8,0),a&&(a instanceof x?1!=l.get(10,1)&&(a.depthMapSize=this._depthSizeDic[l.get(10,1)]):2!=l.get(10,2)&&(a.depthMapSize=this._depthSizeDic[l.get(10,2)]),s.shadowMapper=a,s.castsShadows=!0),0!=r){var _=this.getAssetByID(r,[h.CONTAINER,h.LIGHT,h.MESH]);_[0]?(_[1].addChild(s),p=_[1].name):this._blocks[e].addError("Could not find a parent for this Light")}else this._pContent.addChild(s);this.parseUserAttributes(),this._pFinalizeAsset(s,o),this._blocks[e].data=s,this._debug&&console.log("Parsed a Light: Name = '"+o+"' | Type = "+c[n]+" | Parent-Name = "+p+" | ShadowMapper-Type = "+u[d])},t.prototype.parseCamera=function(e){var s,a=this._newBlockBytes.readUnsignedInt(),r=this.parseMatrix3D(),o=this.parseVarStr(),n="Root (TopLevel)";this._newBlockBytes.readUnsignedByte(),this._newBlockBytes.readShort();var l=this._newBlockBytes.readShort(),d=this.parseProperties({101:this._propsNrType,102:this._propsNrType,103:this._propsNrType,104:this._propsNrType});switch(l){case 5001:s=new p(d.get(101,60));break;case 5002:s=new c(d.get(101,500));break;case 5003:s=new u(d.get(101,-400),d.get(102,400),d.get(103,-300),d.get(104,300));break;default:return void console.log("unsupportedLenstype")}var _=new M(s);_.transform.matrix3D=r;var y=this.getAssetByID(a,[h.CONTAINER,h.LIGHT,h.MESH]);if(y[0]){var b=y[1];b.addChild(_),n=b.name}else a>0?this._blocks[e].addError("Could not find a parent for this Camera"):this._pContent.addChild(_);_.name=o,d=this.parseProperties({1:this._matrixNrType,2:this._matrixNrType,3:this._matrixNrType,4:t.UINT8}),_.pivot=new i(d.get(1,0),d.get(2,0),d.get(3,0)),_.extra=this.parseUserAttributes(),this._pFinalizeAsset(_,o),this._blocks[e].data=_,this._debug&&console.log("Parsed a Camera: Name = '"+o+"' | Projectiontype = "+s+" | Parent-Name = "+n)},t.prototype.parseLightPicker=function(e){var t,s=this.parseVarStr(),a=this._newBlockBytes.readUnsignedShort(),r=new Array,i=0,o=0,n=new Array;for(i=0;a>i;i++)o=this._newBlockBytes.readUnsignedInt(),t=this.getAssetByID(o,[h.LIGHT]),t[0]?(r.push(t[1]),n.push(t[1].name)):this._blocks[e].addError("Could not find a Light Nr "+i+" (ID = "+o+" ) for this LightPicker");if(0==r.length)return this._blocks[e].addError("Could not create this LightPicker, cause no Light was found."),void this.parseUserAttributes();var l=new B(r);l.name=s,this.parseUserAttributes(),this._pFinalizeAsset(l,s),this._blocks[e].data=l,this._debug&&console.log("Parsed a StaticLightPicker: Name = '"+s+"' | Texture-Name = "+n.toString())},t.prototype.parseMaterial=function(e){var s,a,r,i,o,n,l,d;for(s=this.parseVarStr(),a=this._newBlockBytes.readUnsignedByte(),n=this._newBlockBytes.readUnsignedByte(),r=this.parseProperties({1:t.INT32,2:t.BADDR,10:this._propsNrType,11:t.BOOL,12:this._propsNrType,13:t.BOOL}),l=0;n>l;){var p;p=this._newBlockBytes.readUnsignedShort(),this.parseProperties(null),this.parseUserAttributes(),l+=1}var c="";if(o=this.parseUserAttributes(),1===a){c+="Parsed a ColorMaterial(SinglePass): Name = '"+s+"' | ";var u;u=r.get(1,16777215),this.materialMode<2?i=new q(u,r.get(10,1)):(i=new q(u),i.materialMode=Y.MULTI_PASS)}else if(2===a){var _=r.get(2,0);d=this.getAssetByID(_,[h.TEXTURE]),!d[0]&&_>0&&this._blocks[e].addError("Could not find the DiffsueTexture (ID = "+_+" ) for this Material"),i=new q(d[1]),this.materialMode<2?(i.alphaBlending=r.get(11,!1),i.alpha=r.get(10,1),c+="Parsed a TriangleMethodMaterial(SinglePass): Name = '"+s+"' | Texture-Name = "+i.name):(i.materialMode=Y.MULTI_PASS,c+="Parsed a TriangleMethodMaterial(MultiPass): Name = '"+s+"' | Texture-Name = "+i.name)}i.extra=o,i.alphaThreshold=r.get(12,0),i.repeat=r.get(13,!1),this._pFinalizeAsset(i,s),this._blocks[e].data=i,this._debug&&console.log(c)},t.prototype.parseMaterial_v1=function(e){var s,a,r,i,o=this.parseVarStr(),n=this._newBlockBytes.readUnsignedByte(),l=this._newBlockBytes.readUnsignedByte(),d=this.parseProperties({1:t.UINT32,2:t.BADDR,3:t.BADDR,4:t.UINT8,5:t.BOOL,6:t.BOOL,7:t.BOOL,8:t.BOOL,9:t.UINT8,10:this._propsNrType,11:t.BOOL,12:this._propsNrType,13:t.BOOL,15:this._propsNrType,16:t.UINT32,17:t.BADDR,18:this._propsNrType,19:this._propsNrType,20:t.UINT32,21:t.BADDR,22:t.BADDR}),p=d.get(4,0),c="";if(p>=2)return void this._blocks[e].addError("Material-spezialType '"+p+"' is not supported, can only be 0:singlePass, 1:MultiPass !");if(1==this.materialMode?p=0:2==this.materialMode&&(p=1),2>p){if(1==n){var u=d.get(1,13421772);1==p?(s=new q(u),s.materialMode=Y.MULTI_PASS,c+="Parsed a ColorMaterial(MultiPass): Name = '"+o+"' | "):(s=new q(u,d.get(10,1)),s.alphaBlending=d.get(11,!1),c+="Parsed a ColorMaterial(SinglePass): Name = '"+o+"' | ")}else if(2==n){var _=d.get(2,0);i=this.getAssetByID(_,[h.TEXTURE]),!i[0]&&_>0&&this._blocks[e].addError("Could not find the AmbientTexture (ID = "+_+" ) for this TriangleMethodMaterial");var y=i[1];s=new q(y),1==p?(s.materialMode=Y.MULTI_PASS,c+="Parsed a TriangleMethodMaterial(MultiPass): Name = '"+o+"' | Texture-Name = "+y.name):(s.alpha=d.get(10,1),s.alphaBlending=d.get(11,!1),c+="Parsed a TriangleMethodMaterial(SinglePass): Name = '"+o+"' | Texture-Name = "+y.name)}var b,m=d.get(17,0);i=this.getAssetByID(m,[h.TEXTURE]),i[0]||0==m||this._blocks[e].addError("Could not find the DiffuseTexture (ID = "+m+" ) for this TriangleMethodMaterial"),i[0]&&(b=i[1]),b&&(s.diffuseTexture=b,c+=" | DiffuseTexture-Name = "+b.name);var g=d.get(3,0);i=this.getAssetByID(g,[h.TEXTURE]),i[0]||0==g||this._blocks[e].addError("Could not find the NormalTexture (ID = "+g+" ) for this TriangleMethodMaterial"),i[0]&&(a=i[1],c+=" | NormalTexture-Name = "+a.name);var f=d.get(21,0);i=this.getAssetByID(f,[h.TEXTURE]),i[0]||0==f||this._blocks[e].addError("Could not find the SpecularTexture (ID = "+f+" ) for this TriangleMethodMaterial"),i[0]&&(r=i[1],c+=" | SpecularTexture-Name = "+r.name);var w=d.get(22,0);i=this.getAssetByID(w,[h.LIGHT_PICKER]),!i[0]&&w?this._blocks[e].addError("Could not find the LightPicker (ID = "+w+" ) for this TriangleMethodMaterial"):s.lightPicker=i[1],s.smooth=d.get(5,!0),s.mipmap=d.get(6,!0),s.bothSides=d.get(7,!1),s.alphaPremultiplied=d.get(8,!1),s.blendMode=this.blendModeDic[d.get(9,0)],s.repeat=d.get(13,!1),a&&(s.normalMap=a),r&&(s.specularMap=r),s.alphaThreshold=d.get(12,0),s.ambient=d.get(15,1),s.diffuseColor=d.get(16,16777215),s.specular=d.get(18,1),s.gloss=d.get(19,50),s.specularColor=d.get(20,16777215);for(var v,k=0;l>k;){var N;switch(N=this._newBlockBytes.readUnsignedShort(),d=this.parseProperties({1:t.BADDR,2:t.BADDR,3:t.BADDR,101:this._propsNrType,102:this._propsNrType,103:this._propsNrType,201:t.UINT32,202:t.UINT32,301:t.UINT16,302:t.UINT16,401:t.UINT8,402:t.UINT8,601:t.COLOR,602:t.COLOR,701:t.BOOL,702:t.BOOL,801:t.MTX4x4}),N){case 999:v=d.get(1,0),i=this.getAssetByID(v,[h.EFFECTS_METHOD]),i[0]?(s.addEffectMethod(i[1]),c+=" | EffectMethod-Name = "+i[1].name):this._blocks[e].addError("Could not find the EffectMethod (ID = "+v+" ) for this Material");
break;case 998:v=d.get(1,0),i=this.getAssetByID(v,[h.SHADOW_MAP_METHOD]),i[0]?(s.shadowMethod=i[1],c+=" | ShadowMethod-Name = "+i[1].name):this._blocks[e].addError("Could not find the ShadowMethod (ID = "+v+" ) for this Material");break;case 1:v=d.get(1,0),i=this.getAssetByID(v,[h.TEXTURE],"CubeTexture"),i[0]||this._blocks[e].addError("Could not find the EnvMap (ID = "+v+" ) for this EnvMapAmbientMethodMaterial"),s.ambientMethod=new Z(i[1]),c+=" | AmbientEnvMapMethod | EnvMap-Name ="+i[1].name;break;case 51:s.diffuseMethod=new $,c+=" | DiffuseDepthMethod";break;case 52:v=d.get(1,0),i=this.getAssetByID(v,[h.TEXTURE]),i[0]||this._blocks[e].addError("Could not find the GradientDiffuseTexture (ID = "+v+" ) for this GradientDiffuseMethod"),s.diffuseMethod=new tt(i[1]),c+=" | DiffuseGradientMethod | GradientDiffuseTexture-Name ="+i[1].name;break;case 53:s.diffuseMethod=new at(d.get(101,5)),c+=" | DiffuseWrapMethod";break;case 54:v=d.get(1,0),i=this.getAssetByID(v,[h.TEXTURE]),i[0]||this._blocks[e].addError("Could not find the LightMap (ID = "+v+" ) for this LightMapDiffuseMethod"),s.diffuseMethod=new st(i[1],this.blendModeDic[d.get(401,10)],!1,s.diffuseMethod),c+=" | DiffuseLightMapMethod | LightMapTexture-Name ="+i[1].name;break;case 55:s.diffuseMethod=new et(d.get(401,3),s.diffuseMethod),s.diffuseMethod.smoothness=d.get(101,.1),c+=" | DiffuseCelMethod";break;case 56:break;case 101:s.specularMethod=new mt,c+=" | SpecularAnisotropicMethod";break;case 102:s.specularMethod=new ft,c+=" | SpecularPhongMethod";break;case 103:s.specularMethod=new gt(d.get(101,.5),s.specularMethod),s.specularMethod.smoothness=d.get(102,.1),c+=" | SpecularCelMethod";break;case 104:s.specularMethod=new yt(d.get(701,!0),s.specularMethod),s.specularMethod.fresnelPower=d.get(101,5),s.specularMethod.normalReflectance=d.get(102,.1),c+=" | SpecularFresnelMethod";break;case 151:break;case 152:v=d.get(1,0),i=this.getAssetByID(v,[h.TEXTURE]),i[0]||this._blocks[e].addError("Could not find the SecoundNormalMap (ID = "+v+" ) for this SimpleWaterNormalMethod"),s.normalMap||this._blocks[e].addError("Could not find a normal Map on this Material to use with this SimpleWaterNormalMethod"),s.normalMap=i[1],s.normalMethod=new ct(s.normalMap,i[1]),c+=" | NormalSimpleWaterMethod | Second-NormalTexture-Name = "+i[1].name}this.parseUserAttributes(),k+=1}}s.extra=this.parseUserAttributes(),this._pFinalizeAsset(s,o),this._blocks[e].data=s,this._debug&&console.log(c)},t.prototype.parseTexture=function(e){var t;this._blocks[e].name=this.parseVarStr();var s,a=this._newBlockBytes.readUnsignedByte();if(this._texture_users[this._cur_block_id.toString()]=[],0==a){s=this._newBlockBytes.readUnsignedInt();var r;r=this._newBlockBytes.readUTFBytes(s),this._pAddDependency(this._cur_block_id.toString(),new n(r),!1,null,!0)}else{s=this._newBlockBytes.readUnsignedInt();var i;i=new m,this._newBlockBytes.readBytes(i,0,s),this._pAddDependency(this._cur_block_id.toString(),null,!1,d.byteArrayToImage(i),!0)}if(this.parseProperties(null),this._blocks[e].extras=this.parseUserAttributes(),this._pPauseAndRetrieveDependencies(),this._blocks[e].data=t,this._debug){var o=["external","embed"];console.log("Start parsing a "+o[a]+" Bitmap for Texture")}},t.prototype.parseCubeTexture=function(e){var t,s,a;this._cubeTextures=new Array,this._texture_users[this._cur_block_id.toString()]=[];var r=this._newBlockBytes.readUnsignedByte();for(this._blocks[e].name=this.parseVarStr(),a=0;6>a;a++)if(this._texture_users[this._cur_block_id.toString()]=[],this._cubeTextures.push(null),0==r){t=this._newBlockBytes.readUnsignedInt();var i;i=this._newBlockBytes.readUTFBytes(t),this._pAddDependency(this._cur_block_id.toString()+"#"+a,new n(i),!1,null,!0)}else{t=this._newBlockBytes.readUnsignedInt();var o;o=new m,this._newBlockBytes.readBytes(o,0,t),this._pAddDependency(this._cur_block_id.toString()+"#"+a,null,!1,d.byteArrayToImage(o),!0)}if(this.parseProperties(null),this._blocks[e].extras=this.parseUserAttributes(),this._pPauseAndRetrieveDependencies(),this._blocks[e].data=s,this._debug){var h=["external","embed"];console.log("Start parsing 6 "+h[r]+" Bitmaps for CubeTexture")}},t.prototype.parseSharedMethodBlock=function(e){var t;this._blocks[e].name=this.parseVarStr(),t=this.parseSharedMethodList(e),this.parseUserAttributes(),this._blocks[e].data=t,this._pFinalizeAsset(t,this._blocks[e].name),this._blocks[e].data=t,this._debug&&console.log("Parsed a EffectMethod: Name = "+t.name+" Type = "+t)},t.prototype.parseShadowMethodBlock=function(e){var t,s;this._blocks[e].name=this.parseVarStr(),s=this._newBlockBytes.readUnsignedInt();var a=this.getAssetByID(s,[h.LIGHT]);return a[0]?(t=this.parseShadowMethodList(a[1],e),void(t&&(this.parseUserAttributes(),this._pFinalizeAsset(t,this._blocks[e].name),this._blocks[e].data=t,this._debug&&console.log("Parsed a ShadowMapMethodMethod: Name = "+t.name+" | Type = "+t+" | Light-Name = ",a[1].name)))):void this._blocks[e].addError("Could not find the TargetLight (ID = "+s+" ) for this ShadowMethod - ShadowMethod not created")},t.prototype.parseCommand=function(e){var s,a,r=(1==this._newBlockBytes.readUnsignedByte(),this._newBlockBytes.readUnsignedInt()),o=this.parseMatrix3D(),n=this.parseVarStr(),l=this.getAssetByID(r,[h.CONTAINER,h.LIGHT,h.MESH]);l[0]&&(s=l[1]);var d=(this._newBlockBytes.readShort(),this._newBlockBytes.readShort()),p=this.parseProperties({1:t.BADDR});switch(d){case 1:var c=p.get(1,0),u=this.getAssetByID(c,[h.LIGHT,h.TEXTURE_PROJECTOR]);if(!u[0]&&0!=c)return void this._blocks[e].addError("Could not find the light (ID = "+c+" ( for this CommandBock!");a=u[1],s&&s.addChild(a),a.transform.matrix3D=o}a&&(p=this.parseProperties({1:this._matrixNrType,2:this._matrixNrType,3:this._matrixNrType,4:t.UINT8}),a.pivot=new i(p.get(1,0),p.get(2,0),p.get(3,0)),a.extra=this.parseUserAttributes()),this._blocks[e].data=a,this._debug&&console.log("Parsed a CommandBlock: Name = '"+n)},t.prototype.parseMetaData=function(){var e=this.parseProperties({1:t.UINT32,2:t.AWDSTRING,3:t.AWDSTRING,4:t.AWDSTRING,5:t.AWDSTRING});this._debug&&(console.log("Parsed a MetaDataBlock: TimeStamp         = "+e.get(1,0)),console.log("                        EncoderName       = "+e.get(2,"unknown")),console.log("                        EncoderVersion    = "+e.get(3,"unknown")),console.log("                        GeneratorName     = "+e.get(4,"unknown")),console.log("                        GeneratorVersion  = "+e.get(5,"unknown")))},t.prototype.parseNameSpace=function(){var e=this._newBlockBytes.readUnsignedByte(),t=this.parseVarStr();this._debug&&console.log("Parsed a NameSpaceBlock: ID = "+e+" | String = "+t)},t.prototype.parseShadowMethodList=function(e,s){var a,r,i,o=this._newBlockBytes.readUnsignedShort(),n=this.parseProperties({1:t.BADDR,2:t.BADDR,3:t.BADDR,101:this._propsNrType,102:this._propsNrType,103:this._propsNrType,201:t.UINT32,202:t.UINT32,301:t.UINT16,302:t.UINT16,401:t.UINT8,402:t.UINT8,601:t.COLOR,602:t.COLOR,701:t.BOOL,702:t.BOOL,801:t.MTX4x4});switch(o){case 1002:if(r=n.get(1,0),i=this.getAssetByID(r,[h.SHADOW_MAP_METHOD]),!i[0])return this._blocks[s].addError("Could not find the ShadowBaseMethod (ID = "+r+" ) for this ShadowNearMethod - ShadowMethod not created"),a;a=new wt(i[1]);break;case 1101:a=new _t(e),a.alpha=n.get(101,1),a.epsilon=n.get(102,.002);break;case 1102:a=new ut(e,n.get(201,5)),a.alpha=n.get(101,1),a.epsilon=n.get(102,.002),a.range=n.get(103,1);break;case 1103:a=new vt(e,n.get(201,5)),a.alpha=n.get(101,1),a.epsilon=n.get(102,.002),a.range=n.get(103,1);break;case 1104:a=new bt(e),a.alpha=n.get(101,1),a.epsilon=n.get(102,.002)}return this.parseUserAttributes(),a},t.prototype.parseSkeleton=function(e){var t=this.parseVarStr(),s=this._newBlockBytes.readUnsignedShort(),a=new z;this.parseProperties(null);for(var r=0;s>r;){var i,o;this._newBlockBytes.readUnsignedShort(),i=new H,i.parentIndex=this._newBlockBytes.readUnsignedShort()-1,i.name=this.parseVarStr(),o=this.parseMatrix3D(),i.inverseBindPose=o.rawData,this.parseProperties(null),this.parseUserAttributes(),a.joints.push(i),r++}this.parseUserAttributes(),this._pFinalizeAsset(a,t),this._blocks[e].data=a,this._debug&&console.log("Parsed a Skeleton: Name = "+a.name+" | Number of Joints = "+r)},t.prototype.parseSkeletonPose=function(e){var t=this.parseVarStr(),s=this._newBlockBytes.readUnsignedShort();this.parseProperties(null);for(var a=new K,i=0;s>i;){var o,n;if(o=new V,n=this._newBlockBytes.readUnsignedByte(),1==n){var h=this.parseMatrix43RawData(),l=new r(h);o.orientation.fromMatrix(l),o.translation.copyFrom(l.position),a.jointPoses[i]=o}i++}this.parseUserAttributes(),this._pFinalizeAsset(a,t),this._blocks[e].data=a,this._debug&&console.log("Parsed a SkeletonPose: Name = "+a.name+" | Number of Joints = "+i)},t.prototype.parseSkeletonAnimation=function(e){var t,s,a=this.parseVarStr(),r=new W,i=this._newBlockBytes.readUnsignedShort();this.parseProperties(null);for(var o,n=0;i>n;)s=this._newBlockBytes.readUnsignedInt(),t=this._newBlockBytes.readUnsignedShort(),o=this.getAssetByID(s,[h.SKELETON_POSE]),o[0]?r.addFrame(this._blocks[s].data,t):this._blocks[e].addError("Could not find the SkeletonPose Frame # "+n+" (ID = "+s+" ) for this SkeletonClipNode"),n++;return 0==r.frames.length?void this._blocks[e].addError("Could not this SkeletonClipNode, because no Frames where set."):(this.parseUserAttributes(),this._pFinalizeAsset(r,a),this._blocks[e].data=r,void(this._debug&&console.log("Parsed a SkeletonClipNode: Name = "+r.name+" | Number of Frames = "+r.frames.length)))},t.prototype.parseMeshPoseAnimation=function(e,s){void 0===s&&(s=!1);var a,r,i,o,n,l,d,p,c,u,_,y,b,m,g=1,f=0,k=new J,N=0,M=0,T=new Array,D=this.parseVarStr(),B=this._newBlockBytes.readUnsignedInt(),x=this.getAssetByID(B,[h.GEOMETRY]);if(!x[0])return void this._blocks[e].addError("Could not find the target-Geometry-Object "+B+" ) for this VertexClipNode");var A=this.getUVForVertexAnimation(B);for(s||(g=this._newBlockBytes.readUnsignedShort()),a=this._newBlockBytes.readUnsignedShort(),N=this._newBlockBytes.readUnsignedShort(),M=0;N>M;)T.push(this._newBlockBytes.readUnsignedShort()),M++;for(m=this.parseProperties({1:t.BOOL,2:t.BOOL}),k.looping=m.get(1,!0),k.stitchFinalFrame=m.get(2,!1),r=0;g>r;){for(o=this._newBlockBytes.readUnsignedShort(),u=new w,i=0;a>i;)for(M=0,p=this._newBlockBytes.readUnsignedInt(),c=this._newBlockBytes.position+p;N>M;){if(1==T[M]){for(y=x[1].subGeometries[i].indices,b=new Array,f=0;this._newBlockBytes.position<c;)n=this.readNumber(this._accuracyGeo),l=this.readNumber(this._accuracyGeo),d=this.readNumber(this._accuracyGeo),b[f++]=n,b[f++]=l,b[f++]=d;_=new v(!0),_.updateIndices(y),_.updatePositions(b),_.updateUVs(A[i]),_.updateVertexNormals(null),_.updateVertexTangents(null),_.autoDeriveNormals=!1,_.autoDeriveTangents=!1,i++,u.addSubGeometry(_)}else this._newBlockBytes.position=c;M++}k.addFrame(u,o),r++}this.parseUserAttributes(),this._pFinalizeAsset(k,D),this._blocks[e].data=k,this._debug&&console.log("Parsed a VertexClipNode: Name = "+k.name+" | Target-Geometry-Name = "+x[1].name+" | Number of Frames = "+k.frames.length)},t.prototype.parseVertexAnimationSet=function(e){for(var s,a=this.parseVarStr(),r=this._newBlockBytes.readUnsignedShort(),i=this.parseProperties({1:t.UINT16}),o=0,n=new Array,l=new Array;r>o;){s=this._newBlockBytes.readUnsignedInt();var d=this.getAssetByID(s,[h.ANIMATION_NODE]);d[0]?(d[1]instanceof J&&l.push(d[1]),d[1]instanceof W&&n.push(d[1])):this._blocks[e].addError("Could not find the AnimationClipNode Nr "+o+" ( "+s+" ) for this AnimationSet"),o++}if(0==l.length&&0==n.length)return void this._blocks[e].addError("Could not create this AnimationSet, because it contains no animations");if(this.parseUserAttributes(),l.length>0){for(var p=new L,c=0;c<l.length;c++)p.addAnimation(l[c]);this._pFinalizeAsset(p,a),this._blocks[e].data=p,this._debug&&console.log("Parsed a VertexAnimationSet: Name = "+a+" | Animations = "+p.animations.length+" | Animation-Names = "+p.animationNames.toString())}else if(n.length>0){d=this.getAssetByID(s,[h.ANIMATION_NODE]);for(var u=new R(i.get(1,4)),c=0;c<n.length;c++)u.addAnimation(n[c]);this._pFinalizeAsset(u,a),this._blocks[e].data=u,this._debug&&console.log("Parsed a SkeletonAnimationSet: Name = "+a+" | Animations = "+u.animations.length+" | Animation-Names = "+u.animationNames.toString())}},t.prototype.parseAnimatorSet=function(e){var s,a,r=this.parseVarStr(),i=this._newBlockBytes.readUnsignedShort(),o=this.parseProperties({1:t.BADDR});s=this._newBlockBytes.readUnsignedInt();for(var n=this._newBlockBytes.readUnsignedShort(),l=new Array,d=0;n>d;d++)l.push(this._newBlockBytes.readUnsignedInt());this._newBlockBytes.readUnsignedShort(),1==this._newBlockBytes.readUnsignedByte();this.parseUserAttributes(),this.parseUserAttributes();var p,c=new Array;for(d=0;d<l.length;d++)p=this.getAssetByID(l[d],[h.MESH]),p[0]&&c.push(p[1]);if(p=this.getAssetByID(s,[h.ANIMATION_SET]),!p[0])return void this._blocks[e].addError("Could not find the AnimationSet ( "+s+" ) for this Animator");a=p[1];var u;if(1==i){if(p=this.getAssetByID(o.get(1,0),[h.SKELETON]),!p[0])return void this._blocks[e].addError("Could not find the Skeleton ( "+o.get(1,0)+" ) for this Animator");u=new G(a,p[1])}else 2==i&&(u=new F(a));for(this._pFinalizeAsset(u,r),this._blocks[e].data=u,d=0;d<c.length;d++)1==i&&(c[d].animator=u),2==i&&(c[d].animator=u);this._debug&&console.log("Parsed a Animator: Name = "+r)},t.prototype.parseSharedMethodList=function(e){var s,r,i,o=this._newBlockBytes.readUnsignedShort(),n=this.parseProperties({1:t.BADDR,2:t.BADDR,3:t.BADDR,101:this._propsNrType,102:this._propsNrType,103:this._propsNrType,104:this._propsNrType,105:this._propsNrType,106:this._propsNrType,107:this._propsNrType,201:t.UINT32,202:t.UINT32,301:t.UINT16,302:t.UINT16,401:t.UINT8,402:t.UINT8,601:t.COLOR,602:t.COLOR,701:t.BOOL,702:t.BOOL});switch(o){case 401:s=new it(n.get(101,new Array(0,0,0,1,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)));break;case 402:s=new ot;var l=n.get(601,0);s.colorTransform=new a(n.get(102,1),n.get(103,1),n.get(104,1),n.get(101,1),l>>16&255,l>>8&255,255&l,l>>24&255);break;case 403:r=n.get(1,0),console.log("ENV MAP",r),i=this.getAssetByID(r,[h.TEXTURE],"CubeTexture"),i[0]||this._blocks[e].addError("Could not find the EnvMap (ID = "+r+" ) for this EnvMapMethod"),s=new nt(i[1],n.get(101,1)),r=n.get(2,0),r>0&&(i=this.getAssetByID(r,[h.TEXTURE]),i[0]||this._blocks[e].addError("Could not find the Mask-texture (ID = "+r+" ) for this EnvMapMethod"));break;case 404:r=n.get(1,0),i=this.getAssetByID(r,[h.TEXTURE]),i[0]||this._blocks[e].addError("Could not find the LightMap (ID = "+r+" ) for this LightMapMethod"),s=new dt(i[1],this.blendModeDic[n.get(401,10)]);break;case 406:s=new pt(n.get(601,16777215),n.get(101,.4),n.get(101,2));break;case 407:r=n.get(1,0),i=this.getAssetByID(r,[h.TEXTURE]),i[0]||this._blocks[e].addError("Could not find the Alpha-texture (ID = "+r+" ) for this AlphaMaskMethod"),s=new rt(i[1],n.get(701,!1));break;case 410:r=n.get(1,0),i=this.getAssetByID(r,[h.TEXTURE],"CubeTexture"),i[0]||this._blocks[e].addError("Could not find the EnvMap (ID = "+r+" ) for this FresnelEnvMapMethod"),s=new lt(i[1],n.get(101,1));break;case 411:s=new ht(n.get(101,0),n.get(102,1e3),n.get(601,8421504))}return this.parseUserAttributes(),s},t.prototype.parseUserAttributes=function(){var e,s,a;if(s=this._newBlockBytes.readUnsignedInt(),s>0){var r;for(e={},r=this._newBlockBytes.position+s;this._newBlockBytes.position<r;){var i,o,n,h,l;if(i=this._newBlockBytes.readUnsignedByte(),o=this.parseVarStr(),n=this._newBlockBytes.readUnsignedByte(),h=this._newBlockBytes.readUnsignedInt(),this._newBlockBytes.position+h>r)return console.log("           Error in reading attribute # "+a+" = skipped to end of attribute-list"),this._newBlockBytes.position=r,e;switch(n){case t.AWDSTRING:l=this._newBlockBytes.readUTFBytes(h);break;case t.INT8:l=this._newBlockBytes.readByte();break;case t.INT16:l=this._newBlockBytes.readShort();break;case t.INT32:l=this._newBlockBytes.readInt();break;case t.BOOL:case t.UINT8:l=this._newBlockBytes.readUnsignedByte();break;case t.UINT16:l=this._newBlockBytes.readUnsignedShort();break;case t.UINT32:case t.BADDR:l=this._newBlockBytes.readUnsignedInt();break;case t.FLOAT32:l=this._newBlockBytes.readFloat();break;case t.FLOAT64:l=this._newBlockBytes.readDouble();break;default:l="unimplemented attribute type "+n,this._newBlockBytes.position+=h}this._debug&&console.log("attribute = name: "+o+"  / value = "+l),e[o]=l,a+=1}}return e},t.prototype.parseProperties=function(e){var t,s,a=0,r=new At;if(s=this._newBlockBytes.readUnsignedInt(),t=this._newBlockBytes.position+s,e)for(;this._newBlockBytes.position<t;){var i,o,n;if(o=this._newBlockBytes.readUnsignedShort(),i=this._newBlockBytes.readUnsignedInt(),this._newBlockBytes.position+i>t)return console.log("           Error in reading property # "+a+" = skipped to end of propertie-list"),this._newBlockBytes.position=t,r;e.hasOwnProperty(o.toString())?(n=e[o],r.set(o,this.parseAttrValue(n,i))):this._newBlockBytes.position+=i,a+=1}else this._newBlockBytes.position=t;return r},t.prototype.parseAttrValue=function(e,s){var a,r;switch(e){case t.BOOL:case t.INT8:a=1,r=this._newBlockBytes.readByte;break;case t.INT16:a=2,r=this._newBlockBytes.readShort;break;case t.INT32:a=4,r=this._newBlockBytes.readInt;break;case t.UINT8:a=1,r=this._newBlockBytes.readUnsignedByte;break;case t.UINT16:a=2,r=this._newBlockBytes.readUnsignedShort;break;case t.UINT32:case t.COLOR:case t.BADDR:a=4,r=this._newBlockBytes.readUnsignedInt;break;case t.FLOAT32:a=4,r=this._newBlockBytes.readFloat;break;case t.FLOAT64:a=8,r=this._newBlockBytes.readDouble;break;case t.AWDSTRING:return this._newBlockBytes.readUTFBytes(s);case t.VECTOR2x1:case t.VECTOR3x1:case t.VECTOR4x1:case t.MTX3x2:case t.MTX3x3:case t.MTX4x3:case t.MTX4x4:a=8,r=this._newBlockBytes.readDouble}if(s>a){for(var i=[],o=0,n=s/a;n>o;)i.push(r.apply(this._newBlockBytes)),o++;return i}var h=r.apply(this._newBlockBytes);return h},t.prototype.parseHeader=function(){var e,s;this._byteData.position=3,this._version[0]=this._byteData.readUnsignedByte(),this._version[1]=this._byteData.readUnsignedByte(),e=this._byteData.readUnsignedShort(),this._streaming=St.test(e,St.FLAG1),2==this._version[0]&&1==this._version[1]&&(this._accuracyMatrix=St.test(e,St.FLAG2),this._accuracyGeo=St.test(e,St.FLAG3),this._accuracyProps=St.test(e,St.FLAG4)),this._geoNrType=t.FLOAT32,this._accuracyGeo&&(this._geoNrType=t.FLOAT64),this._matrixNrType=t.FLOAT32,this._accuracyMatrix&&(this._matrixNrType=t.FLOAT64),this._propsNrType=t.FLOAT32,this._accuracyProps&&(this._propsNrType=t.FLOAT64),this._compression=this._byteData.readUnsignedByte(),this._debug&&(console.log("Import AWDFile of version = "+this._version[0]+" - "+this._version[1]),console.log("Global Settings = Compression = "+this._compression+" | Streaming = "+this._streaming+" | Matrix-Precision = "+this._accuracyMatrix+" | Geometry-Precision = "+this._accuracyGeo+" | Properties-Precision = "+this._accuracyProps)),s=this._byteData.readUnsignedInt(),this._streaming||s==this._byteData.getBytesAvailable()||this._pDieWithError("AWD2 body length does not match header integrity field")},t.prototype.getUVForVertexAnimation=function(e){if(this._blocks[e].data instanceof T&&(e=this._blocks[e].geoID),this._blocks[e].uvsForVertexAnimation)return this._blocks[e].uvsForVertexAnimation;var t,s,a,r,i,o,n,h=this._blocks[e].data,l=0;for(this._blocks[e].uvsForVertexAnimation=new Array;l<h.subGeometries.length;){for(o=new Array,n=h.subGeometries[l],r=n.numVertices,t=n.uvs,s=n.getStride(v.UV_DATA),a=n.getOffset(v.UV_DATA),i=0;r>i;i++)o.push(t[a+i*s+0]),o.push(t[a+i*s+1]);this._blocks[e].uvsForVertexAnimation.push(o),l++}return this._blocks[e].uvsForVertexAnimation},t.prototype.parseVarStr=function(){var e=this._newBlockBytes.readUnsignedShort();return this._newBlockBytes.readUTFBytes(e)},t.prototype.getAssetByID=function(e,t,s){void 0===s&&(s="SingleTexture");var a=new Array,r=0;if(e>0&&this._blocks[e]&&this._blocks[e].data)for(;r<t.length;){var i=this._blocks[e].data;if(i.assetType==t[r]){if(t[r]==h.TEXTURE&&"CubeTexture"==s&&this._blocks[e].data instanceof y)return a.push(!0),a.push(this._blocks[e].data),a;if(t[r]!=h.TEXTURE||"SingleTexture"!=s)return a.push(!0),a.push(this._blocks[e].data),a;if(this._blocks[e].data instanceof b)return a.push(!0),a.push(this._blocks[e].data),a}if(t[r]==h.GEOMETRY&&i.assetType==h.MESH){var o=this._blocks[e].data;return a.push(!0),a.push(o.geometry),a}r++}return a.push(!1),a.push(this.getDefaultAsset(t[0],s)),a},t.prototype.getDefaultAsset=function(e,t){switch(!0){case e==h.TEXTURE:if("CubeTexture"==t)return this.getDefaultCubeTexture();if("SingleTexture"==t)return this.getDefaultTexture();break;case e==h.MATERIAL:return this.getDefaultMaterial()}return null},t.prototype.getDefaultMaterial=function(){return this._defaultBitmapMaterial||(this._defaultBitmapMaterial=X.getDefaultMaterial()),this._defaultBitmapMaterial},t.prototype.getDefaultTexture=function(){return this._defaultTexture||(this._defaultTexture=X.getDefaultTexture()),this._defaultTexture},t.prototype.getDefaultCubeTexture=function(){if(!this._defaultCubeTexture){var e=X.createCheckeredBitmapData();this._defaultCubeTexture=new _(e,e,e,e,e,e),this._defaultCubeTexture.name="defaultCubeTexture"}return this._defaultCubeTexture},t.prototype.readNumber=function(e){return void 0===e&&(e=!1),e?this._newBlockBytes.readDouble():this._newBlockBytes.readFloat()},t.prototype.parseMatrix3D=function(){return new r(this.parseMatrix43RawData())},t.prototype.parseMatrix32RawData=function(){var e,t=new Array(6);for(e=0;6>e;e++)t[e]=this._newBlockBytes.readFloat();return t},t.prototype.parseMatrix43RawData=function(){var e=new Array(16);return e[0]=this.readNumber(this._accuracyMatrix),e[1]=this.readNumber(this._accuracyMatrix),e[2]=this.readNumber(this._accuracyMatrix),e[3]=0,e[4]=this.readNumber(this._accuracyMatrix),e[5]=this.readNumber(this._accuracyMatrix),e[6]=this.readNumber(this._accuracyMatrix),e[7]=0,e[8]=this.readNumber(this._accuracyMatrix),e[9]=this.readNumber(this._accuracyMatrix),e[10]=this.readNumber(this._accuracyMatrix),e[11]=0,e[12]=this.readNumber(this._accuracyMatrix),e[13]=this.readNumber(this._accuracyMatrix),e[14]=this.readNumber(this._accuracyMatrix),e[15]=1,isNaN(e[0])&&(e[0]=1,e[1]=0,e[2]=0,e[4]=0,e[5]=1,e[6]=0,e[8]=0,e[9]=0,e[10]=1,e[12]=0,e[13]=0,e[14]=0),e},t.COMPRESSIONMODE_LZMA="lzma",t.UNCOMPRESSED=0,t.DEFLATE=1,t.LZMA=2,t.INT8=1,t.INT16=2,t.INT32=3,t.UINT8=4,t.UINT16=5,t.UINT32=6,t.FLOAT32=7,t.FLOAT64=8,t.BOOL=21,t.COLOR=22,t.BADDR=23,t.AWDSTRING=31,t.AWDBYTEARRAY=32,t.VECTOR2x1=41,t.VECTOR3x1=42,t.VECTOR4x1=43,t.MTX3x2=44,t.MTX3x3=45,t.MTX4x3=46,t.MTX4x4=47,t}(l),xt=function(){function e(){}return e.prototype.dispose=function(){this.id=null,this.bytes=null,this.errorMessages=null,this.uvsForVertexAnimation=null},e.prototype.addError=function(e){this.errorMessages||(this.errorMessages=new Array),this.errorMessages.push(e)},e}(),At=function(){function e(){}return e.prototype.set=function(e,t){this[e.toString()]=t},e.prototype.get=function(e,t){return this.hasOwnProperty(e.toString())?this[e.toString()]:t},e}(),St=function(){function e(){}return e.test=function(e,t){return(e&t)==t},e.FLAG1=1,e.FLAG2=2,e.FLAG3=4,e.FLAG4=8,e.FLAG5=16,e.FLAG6=32,e.FLAG7=64,e.FLAG8=128,e.FLAG9=256,e.FLAG10=512,e.FLAG11=1024,e.FLAG12=2048,e.FLAG13=4096,e.FLAG14=8192,e.FLAG15=16384,e.FLAG16=32768,e}();t.exports=Bt},{"awayjs-core/lib/geom/ColorTransform":void 0,"awayjs-core/lib/geom/Matrix3D":void 0,"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-core/lib/library/AssetType":void 0,"awayjs-core/lib/net/URLLoaderDataFormat":void 0,"awayjs-core/lib/net/URLRequest":void 0,"awayjs-core/lib/parsers/ParserBase":void 0,"awayjs-core/lib/parsers/ParserUtils":void 0,"awayjs-core/lib/projections/OrthographicOffCenterProjection":void 0,"awayjs-core/lib/projections/OrthographicProjection":void 0,"awayjs-core/lib/projections/PerspectiveProjection":void 0,"awayjs-core/lib/textures/BitmapCubeTexture":void 0,"awayjs-core/lib/textures/ImageCubeTexture":void 0,"awayjs-core/lib/textures/ImageTexture":void 0,"awayjs-core/lib/utils/ByteArray":void 0,"awayjs-display/lib/base/BlendMode":void 0,"awayjs-display/lib/base/Geometry":void 0,"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-display/lib/containers/DisplayObjectContainer":void 0,"awayjs-display/lib/entities/Camera":void 0,"awayjs-display/lib/entities/DirectionalLight":void 0,"awayjs-display/lib/entities/Mesh":void 0,"awayjs-display/lib/entities/PointLight":void 0,"awayjs-display/lib/entities/Skybox":void 0,"awayjs-display/lib/entities/TimeLine":void 0,"awayjs-display/lib/entities/timelinedata/CommandPropsDisplayObject":void 0,"awayjs-display/lib/entities/timelinedata/FrameCommand":void 0,"awayjs-display/lib/entities/timelinedata/TimeLineFrame":void 0,"awayjs-display/lib/entities/timelinedata/TimeLineObject":void 0,"awayjs-display/lib/materials/lightpickers/StaticLightPicker":void 0,"awayjs-display/lib/materials/shadowmappers/CubeMapShadowMapper":void 0,"awayjs-display/lib/materials/shadowmappers/DirectionalShadowMapper":void 0,"awayjs-display/lib/prefabs/PrefabBase":void 0,"awayjs-display/lib/prefabs/PrimitiveCapsulePrefab":void 0,"awayjs-display/lib/prefabs/PrimitiveConePrefab":void 0,"awayjs-display/lib/prefabs/PrimitiveCubePrefab":void 0,"awayjs-display/lib/prefabs/PrimitiveCylinderPrefab":void 0,"awayjs-display/lib/prefabs/PrimitivePlanePrefab":void 0,"awayjs-display/lib/prefabs/PrimitiveSpherePrefab":void 0,"awayjs-display/lib/prefabs/PrimitiveTorusPrefab":void 0,"awayjs-methodmaterials/lib/TriangleMaterialMode":void 0,"awayjs-methodmaterials/lib/TriangleMethodMaterial":void 0,"awayjs-methodmaterials/lib/methods/AmbientEnvMapMethod":void 0,"awayjs-methodmaterials/lib/methods/DiffuseCelMethod":void 0,"awayjs-methodmaterials/lib/methods/DiffuseDepthMethod":void 0,"awayjs-methodmaterials/lib/methods/DiffuseGradientMethod":void 0,"awayjs-methodmaterials/lib/methods/DiffuseLightMapMethod":void 0,"awayjs-methodmaterials/lib/methods/DiffuseWrapMethod":void 0,"awayjs-methodmaterials/lib/methods/EffectAlphaMaskMethod":void 0,"awayjs-methodmaterials/lib/methods/EffectColorMatrixMethod":void 0,"awayjs-methodmaterials/lib/methods/EffectColorTransformMethod":void 0,"awayjs-methodmaterials/lib/methods/EffectEnvMapMethod":void 0,"awayjs-methodmaterials/lib/methods/EffectFogMethod":void 0,"awayjs-methodmaterials/lib/methods/EffectFresnelEnvMapMethod":void 0,"awayjs-methodmaterials/lib/methods/EffectLightMapMethod":void 0,"awayjs-methodmaterials/lib/methods/EffectRimLightMethod":void 0,"awayjs-methodmaterials/lib/methods/NormalSimpleWaterMethod":void 0,"awayjs-methodmaterials/lib/methods/ShadowDitheredMethod":void 0,"awayjs-methodmaterials/lib/methods/ShadowFilteredMethod":void 0,"awayjs-methodmaterials/lib/methods/ShadowHardMethod":void 0,"awayjs-methodmaterials/lib/methods/ShadowNearMethod":void 0,"awayjs-methodmaterials/lib/methods/ShadowSoftMethod":void 0,"awayjs-methodmaterials/lib/methods/SpecularAnisotropicMethod":void 0,"awayjs-methodmaterials/lib/methods/SpecularCelMethod":void 0,"awayjs-methodmaterials/lib/methods/SpecularFresnelMethod":void 0,"awayjs-methodmaterials/lib/methods/SpecularPhongMethod":void 0,"awayjs-renderergl/lib/animators/SkeletonAnimationSet":void 0,"awayjs-renderergl/lib/animators/SkeletonAnimator":void 0,"awayjs-renderergl/lib/animators/VertexAnimationSet":void 0,"awayjs-renderergl/lib/animators/VertexAnimator":void 0,"awayjs-renderergl/lib/animators/data/JointPose":void 0,"awayjs-renderergl/lib/animators/data/Skeleton":void 0,"awayjs-renderergl/lib/animators/data/SkeletonJoint":void 0,"awayjs-renderergl/lib/animators/data/SkeletonPose":void 0,"awayjs-renderergl/lib/animators/nodes/SkeletonClipNode":void 0,"awayjs-renderergl/lib/animators/nodes/VertexClipNode":void 0,"awayjs-renderergl/lib/managers/DefaultMaterialManager":void 0,"awayjs-renderergl/lib/materials/SkyboxMaterial":void 0}],"awayjs-parsers/lib/MD2Parser":[function(e,t){var s=this.__extends||function(e,t){function s(){this.constructor=e}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);s.prototype=t.prototype,e.prototype=new s},a=e("awayjs-core/lib/net/URLLoaderDataFormat"),r=e("awayjs-core/lib/net/URLRequest"),i=e("awayjs-core/lib/parsers/ParserBase"),o=e("awayjs-core/lib/parsers/ParserUtils"),n=e("awayjs-display/lib/containers/DisplayObjectContainer"),h=e("awayjs-display/lib/base/Geometry"),l=e("awayjs-display/lib/base/TriangleSubGeometry"),d=e("awayjs-display/lib/entities/Mesh"),p=e("awayjs-renderergl/lib/animators/nodes/VertexClipNode"),c=e("awayjs-renderergl/lib/animators/VertexAnimationSet"),u=e("awayjs-renderergl/lib/managers/DefaultMaterialManager"),_=e("awayjs-methodmaterials/lib/TriangleMethodMaterial"),y=e("awayjs-methodmaterials/lib/TriangleMaterialMode"),b=function(e){function t(t,s){void 0===t&&(t="jpg"),void 0===s&&(s=!0),e.call(this,a.ARRAY_BUFFER),this._clipNodes=new Object,this._animationSet=new c,this.materialFinal=!1,this.geoCreated=!1,this._textureType=t,this._ignoreTexturePath=s}return s(t,e),t.supportsType=function(e){return e=e.toLowerCase(),"md2"==e},t.supportsData=function(e){return"IDP2"==o.toString(e,4)},t.prototype._iResolveDependency=function(e){if(1==e.assets.length){var t=e.assets[0];if(t){var s=new _(t);this.materialMode>=2&&(s.materialMode=y.MULTI_PASS),this._pContent.addChild(this._mesh),s.name=this._mesh.material.name,this._mesh.material=s,this._pFinalizeAsset(s),this._pFinalizeAsset(this._mesh.geometry),this._pFinalizeAsset(this._mesh)}this.materialFinal=!0}},t.prototype._iResolveDependencyFailure=function(){this.materialMode<2?this._mesh.material=u.getDefaultMaterial():(this._mesh.material=new _(u.getDefaultTexture()),this._mesh.material.materialMode=y.MULTI_PASS),this._pContent.addChild(this._mesh),this._pFinalizeAsset(this._mesh.geometry),this._pFinalizeAsset(this._mesh),this.materialFinal=!0},t.prototype._pProceedParsing=function(){for(this._startedParsing||(this._byteData=this._pGetByteData(),this._startedParsing=!0,this._byteData.position=0);this._pHasTime();)if(this._parsedHeader)if(this._parsedUV)if(this._parsedFaces)if(this._parsedFrames){if(this.geoCreated&&this.materialFinal)return i.PARSING_DONE;this.geoCreated||(this.geoCreated=!0,this._geometry.addSubGeometry(this._firstSubGeom.clone()),this._mesh.name="",this.materialFinal&&(this._pContent.addChild(this._mesh),this._pFinalizeAsset(this._mesh.geometry),this._pFinalizeAsset(this._mesh)),this._pPauseAndRetrieveDependencies())}else this.parseFrames();else this.parseFaces();else this.parseUV();else this._geometry=new h,this._mesh=new d(this._geometry,null),this.materialMode<2?this._mesh.material=u.getDefaultMaterial():(this._mesh.material=new _(u.getDefaultTexture()),this._mesh.material.materialMode=y.MULTI_PASS),this.parseHeader(),this.parseMaterialNames();return i.MORE_TO_PARSE},t.prototype._pStartParsing=function(t){e.prototype._pStartParsing.call(this,t),this._pContent=new n},t.prototype.parseHeader=function(){this._ident=this._byteData.readInt(),this._version=this._byteData.readInt(),this._skinWidth=this._byteData.readInt(),this._skinHeight=this._byteData.readInt(),this._byteData.readInt(),this._numSkins=this._byteData.readInt(),this._numVertices=this._byteData.readInt(),this._numST=this._byteData.readInt(),this._numTris=this._byteData.readInt(),this._byteData.readInt(),this._numFrames=this._byteData.readInt(),this._offsetSkins=this._byteData.readInt(),this._offsetST=this._byteData.readInt(),this._offsetTris=this._byteData.readInt(),this._offsetFrames=this._byteData.readInt(),this._byteData.readInt(),this._offsetEnd=this._byteData.readInt(),this._parsedHeader=!0},t.prototype.parseMaterialNames=function(){var e,t,s,a;this._materialNames=new Array,this._byteData.position=this._offsetSkins;for(var i=new RegExp("[^a-zA-Z0-9\\_/.]","g"),o=0;o<this._numSkins;++o)t=this._byteData.readUTFBytes(64),t=t.replace(i,""),s=t.lastIndexOf("."),this._ignoreTexturePath&&(a=t.lastIndexOf("/")),-1==t.toLowerCase().indexOf(".jpg")&&-1==t.toLowerCase().indexOf(".png")?(t=t.substring(a+1,s),e=t+"."+this._textureType):e=t,this._materialNames[o]=t,0==this.dependencies.length&&this._pAddDependency(t,new r(e));
this._materialNames.length>0?this._mesh.material.name=this._materialNames[0]:this.materialFinal=!0},t.prototype.parseUV=function(){var e=0;this._uvs=new Array(2*this._numST),this._byteData.position=this._offsetST;for(var t=0;t<this._numST;t++)this._uvs[e++]=this._byteData.readShort()/this._skinWidth,this._uvs[e++]=this._byteData.readShort()/this._skinHeight;this._parsedUV=!0},t.prototype.parseFaces=function(){var e,t,s,a,r,i,o;for(this._vertIndices=new Array,this._uvIndices=new Array,this._indices=new Array,this._byteData.position=this._offsetTris,o=0;o<this._numTris;o++)e=this._byteData.readUnsignedShort(),t=this._byteData.readUnsignedShort(),s=this._byteData.readUnsignedShort(),a=this._byteData.readUnsignedShort(),r=this._byteData.readUnsignedShort(),i=this._byteData.readUnsignedShort(),this.addIndex(e,a),this.addIndex(t,r),this.addIndex(s,i);var n=this._uvIndices.length;for(this._finalUV=new Array(2*n),o=0;n>o;++o)this._finalUV[o<<1]=this._uvs[this._uvIndices[o]<<1],this._finalUV[(o<<1)+1]=this._uvs[(this._uvIndices[o]<<1)+1];this._parsedFaces=!0},t.prototype.addIndex=function(e,t){var s=this.findIndex(e,t);-1==s?(this._indices.push(this._vertIndices.length),this._vertIndices.push(e),this._uvIndices.push(t)):this._indices.push(s)},t.prototype.findIndex=function(e,t){for(var s=this._vertIndices.length,a=0;s>a;++a)if(this._vertIndices[a]==e&&this._uvIndices[a]==t)return a;return-1},t.prototype.parseFrames=function(){var e,s,a,r,i,o,n,d,c,u,_,y,b,m=this._vertIndices.length,g="",f=null;for(this._byteData.position=this._offsetFrames,_=0;_<this._numFrames;_++){for(u=new Array,c=new Array(3*m),e=this._byteData.readFloat(),s=this._byteData.readFloat(),a=this._byteData.readFloat(),r=this._byteData.readFloat(),i=this._byteData.readFloat(),o=this._byteData.readFloat(),g=this.readFrameName(),y=0;y<this._numVertices;y++,this._byteData.position++)u.push(e*this._byteData.readUnsignedByte()+r,s*this._byteData.readUnsignedByte()+i,a*this._byteData.readUnsignedByte()+o);for(b=0,y=0;m>y;y++)c[b++]=u[3*this._vertIndices[y]],c[b++]=u[3*this._vertIndices[y]+2],c[b++]=u[3*this._vertIndices[y]+1];d=new l(!0),null==this._firstSubGeom&&(this._firstSubGeom=d),n=new h,n.addSubGeometry(d),d.updateIndices(this._indices),d.updatePositions(c),d.updateUVs(this._finalUV),d.vertexNormals,d.vertexTangents,d.autoDeriveNormals=!1,d.autoDeriveTangents=!1;var w=this._clipNodes[g];w||(f&&(this._pFinalizeAsset(f),this._animationSet.addAnimation(f)),w=new p,w.name=g,w.stitchFinalFrame=!0,this._clipNodes[g]=w,f=w),w.addFrame(n,1e3/t.FPS)}f&&(this._pFinalizeAsset(f),this._animationSet.addAnimation(f)),this._pFinalizeAsset(this._animationSet),this._parsedFrames=!0},t.prototype.readFrameName=function(){for(var e="",t=0,s=0;16>s;s++){var a=this._byteData.readUnsignedByte();Math.floor(a)>57&&Math.floor(a)<=122&&0==t&&(e+=String.fromCharCode(a)),Math.floor(a)>=48&&Math.floor(a)<=57&&t++}return e},t.FPS=6,t}(i);t.exports=b},{"awayjs-core/lib/net/URLLoaderDataFormat":void 0,"awayjs-core/lib/net/URLRequest":void 0,"awayjs-core/lib/parsers/ParserBase":void 0,"awayjs-core/lib/parsers/ParserUtils":void 0,"awayjs-display/lib/base/Geometry":void 0,"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-display/lib/containers/DisplayObjectContainer":void 0,"awayjs-display/lib/entities/Mesh":void 0,"awayjs-methodmaterials/lib/TriangleMaterialMode":void 0,"awayjs-methodmaterials/lib/TriangleMethodMaterial":void 0,"awayjs-renderergl/lib/animators/VertexAnimationSet":void 0,"awayjs-renderergl/lib/animators/nodes/VertexClipNode":void 0,"awayjs-renderergl/lib/managers/DefaultMaterialManager":void 0}],"awayjs-parsers/lib/MD5AnimParser":[function(e,t){var s=this.__extends||function(e,t){function s(){this.constructor=e}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);s.prototype=t.prototype,e.prototype=new s},a=e("awayjs-core/lib/geom/Quaternion"),r=e("awayjs-core/lib/geom/Vector3D"),i=e("awayjs-core/lib/net/URLLoaderDataFormat"),o=e("awayjs-core/lib/parsers/ParserBase"),n=e("awayjs-renderergl/lib/animators/data/JointPose"),h=e("awayjs-renderergl/lib/animators/data/SkeletonPose"),l=e("awayjs-renderergl/lib/animators/nodes/SkeletonClipNode"),d=function(e){function t(t,s){void 0===t&&(t=null),void 0===s&&(s=0),e.call(this,i.TEXT),this._parseIndex=0,this._line=0,this._charLineIndex=0,this._rotationQuat=new a;var o=new a,n=new a;o.fromAxisAngle(r.X_AXIS,.5*-Math.PI),n.fromAxisAngle(r.Y_AXIS,.5*-Math.PI),this._rotationQuat.multiply(n,o),t&&(this._rotationQuat.multiply(n,o),o.fromAxisAngle(t,s),this._rotationQuat.multiply(o,this._rotationQuat))}return s(t,e),t.supportsType=function(e){return e=e.toLowerCase(),"md5anim"==e},t.supportsData=function(){return!1},t.prototype._pProceedParsing=function(){var e;for(this._startedParsing||(this._textData=this._pGetTextData(),this._startedParsing=!0);this._pHasTime();){switch(e=this.getNextToken()){case t.COMMENT_TOKEN:this.ignoreLine();break;case"":break;case t.VERSION_TOKEN:if(this._version=this.getNextInt(),10!=this._version)throw new Error("Unknown version number encountered!");break;case t.COMMAND_LINE_TOKEN:this.parseCMD();break;case t.NUM_FRAMES_TOKEN:this._numFrames=this.getNextInt(),this._bounds=new Array,this._frameData=new Array;break;case t.NUM_JOINTS_TOKEN:this._numJoints=this.getNextInt(),this._hierarchy=new Array(this._numJoints),this._baseFrameData=new Array(this._numJoints);break;case t.FRAME_RATE_TOKEN:this._frameRate=this.getNextInt();break;case t.NUM_ANIMATED_COMPONENTS_TOKEN:this._numAnimatedComponents=this.getNextInt();break;case t.HIERARCHY_TOKEN:this.parseHierarchy();break;case t.BOUNDS_TOKEN:this.parseBounds();break;case t.BASE_FRAME_TOKEN:this.parseBaseFrame();break;case t.FRAME_TOKEN:this.parseFrame();break;default:this._reachedEOF||this.sendUnknownKeywordError()}if(this._reachedEOF)return this._clip=new l,this.translateClip(),this._pFinalizeAsset(this._clip),o.PARSING_DONE}return o.MORE_TO_PARSE},t.prototype.translateClip=function(){for(var e=0;e<this._numFrames;++e)this._clip.addFrame(this.translatePose(this._frameData[e]),1e3/this._frameRate)},t.prototype.translatePose=function(e){for(var t,s,i,o,l,d=new r,p=new a,c=e.components,u=new h,_=u.jointPoses,y=0;y<this._numJoints;++y){l=0,s=new n,t=this._hierarchy[y],i=this._baseFrameData[y],o=t.flags,d.x=i.position.x,d.y=i.position.y,d.z=i.position.z,p.x=i.orientation.x,p.y=i.orientation.y,p.z=i.orientation.z,1&o&&(d.x=c[t.startIndex+l++]),2&o&&(d.y=c[t.startIndex+l++]),4&o&&(d.z=c[t.startIndex+l++]),8&o&&(p.x=c[t.startIndex+l++]),16&o&&(p.y=c[t.startIndex+l++]),32&o&&(p.z=c[t.startIndex+l++]);var b=1-p.x*p.x-p.y*p.y-p.z*p.z;p.w=0>b?0:-Math.sqrt(b),t.parentIndex<0?(s.orientation.multiply(this._rotationQuat,p),s.translation=this._rotationQuat.rotatePoint(d)):(s.orientation.copyFrom(p),s.translation.x=d.x,s.translation.y=d.y,s.translation.z=d.z),s.orientation.y=-s.orientation.y,s.orientation.z=-s.orientation.z,s.translation.x=-s.translation.x,_[y]=s}return u},t.prototype.parseHierarchy=function(){var e,s,a=this.getNextToken(),r=0;"{"!=a&&this.sendUnknownKeywordError();do this._reachedEOF&&this.sendEOFError(),s=new _,s.name=this.parseLiteralstring(),s.parentIndex=this.getNextInt(),s.flags=this.getNextInt(),s.startIndex=this.getNextInt(),this._hierarchy[r++]=s,e=this.getNextChar(),"/"==e&&(this.putBack(),e=this.getNextToken(),e==t.COMMENT_TOKEN&&this.ignoreLine(),e=this.getNextChar()),"}"!=e&&this.putBack();while("}"!=e)},t.prototype.parseBounds=function(){var e,s,a=this.getNextToken(),r=0;"{"!=a&&this.sendUnknownKeywordError();do this._reachedEOF&&this.sendEOFError(),s=new c,s.min=this.parseVector3D(),s.max=this.parseVector3D(),this._bounds[r++]=s,e=this.getNextChar(),"/"==e&&(this.putBack(),e=this.getNextToken(),e==t.COMMENT_TOKEN&&this.ignoreLine(),e=this.getNextChar()),"}"!=e&&this.putBack();while("}"!=e)},t.prototype.parseBaseFrame=function(){var e,s,a=this.getNextToken(),r=0;"{"!=a&&this.sendUnknownKeywordError();do this._reachedEOF&&this.sendEOFError(),s=new p,s.position=this.parseVector3D(),s.orientation=this.parseQuaternion(),this._baseFrameData[r++]=s,e=this.getNextChar(),"/"==e&&(this.putBack(),e=this.getNextToken(),e==t.COMMENT_TOKEN&&this.ignoreLine(),e=this.getNextChar()),"}"!=e&&this.putBack();while("}"!=e)},t.prototype.parseFrame=function(){var e,s,a,r;r=this.getNextInt(),a=this.getNextToken(),"{"!=a&&this.sendUnknownKeywordError();do{this._reachedEOF&&this.sendEOFError(),s=new u,s.components=new Array(this._numAnimatedComponents);for(var i=0;i<this._numAnimatedComponents;++i)s.components[i]=this.getNextNumber();this._frameData[r]=s,e=this.getNextChar(),"/"==e&&(this.putBack(),e=this.getNextToken(),e==t.COMMENT_TOKEN&&this.ignoreLine(),e=this.getNextChar()),"}"!=e&&this.putBack()}while("}"!=e)},t.prototype.putBack=function(){this._parseIndex--,this._charLineIndex--,this._reachedEOF=this._parseIndex>=this._textData.length},t.prototype.getNextToken=function(){for(var e,s="";!this._reachedEOF;){if(e=this.getNextChar()," "==e||"\r"==e||"\n"==e||"	"==e){if(s!=t.COMMENT_TOKEN&&this.skipWhiteSpace(),""!=s)return s}else s+=e;if(s==t.COMMENT_TOKEN)return s}return s},t.prototype.skipWhiteSpace=function(){var e;do e=this.getNextChar();while("\n"==e||" "==e||"\r"==e||"	"==e);this.putBack()},t.prototype.ignoreLine=function(){for(var e;!this._reachedEOF&&"\n"!=e;)e=this.getNextChar()},t.prototype.getNextChar=function(){var e=this._textData.charAt(this._parseIndex++);return"\n"==e?(++this._line,this._charLineIndex=0):"\r"!=e&&++this._charLineIndex,this._parseIndex==this._textData.length&&(this._reachedEOF=!0),e},t.prototype.getNextInt=function(){var e=parseInt(this.getNextToken());return isNaN(e)&&this.sendParseError("int type"),e},t.prototype.getNextNumber=function(){var e=parseFloat(this.getNextToken());return isNaN(e)&&this.sendParseError("float type"),e},t.prototype.parseVector3D=function(){var e=new r,t=this.getNextToken();return"("!=t&&this.sendParseError("("),e.x=this.getNextNumber(),e.y=this.getNextNumber(),e.z=this.getNextNumber(),")"!=this.getNextToken()&&this.sendParseError(")"),e},t.prototype.parseQuaternion=function(){var e=new a,t=this.getNextToken();"("!=t&&this.sendParseError("("),e.x=this.getNextNumber(),e.y=this.getNextNumber(),e.z=this.getNextNumber();var s=1-e.x*e.x-e.y*e.y-e.z*e.z;return e.w=0>s?0:-Math.sqrt(s),")"!=this.getNextToken()&&this.sendParseError(")"),e},t.prototype.parseCMD=function(){this.parseLiteralstring()},t.prototype.parseLiteralstring=function(){this.skipWhiteSpace();var e=this.getNextChar(),t="";'"'!=e&&this.sendParseError('"');do this._reachedEOF&&this.sendEOFError(),e=this.getNextChar(),'"'!=e&&(t+=e);while('"'!=e);return t},t.prototype.sendEOFError=function(){throw new Error("Unexpected end of file")},t.prototype.sendParseError=function(e){throw new Error("Unexpected token at line "+(this._line+1)+", character "+this._charLineIndex+". "+e+" expected, but "+this._textData.charAt(this._parseIndex-1)+" encountered")},t.prototype.sendUnknownKeywordError=function(){throw new Error("Unknown keyword at line "+(this._line+1)+", character "+this._charLineIndex+". ")},t.VERSION_TOKEN="MD5Version",t.COMMAND_LINE_TOKEN="commandline",t.NUM_FRAMES_TOKEN="numFrames",t.NUM_JOINTS_TOKEN="numJoints",t.FRAME_RATE_TOKEN="frameRate",t.NUM_ANIMATED_COMPONENTS_TOKEN="numAnimatedComponents",t.HIERARCHY_TOKEN="hierarchy",t.BOUNDS_TOKEN="bounds",t.BASE_FRAME_TOKEN="baseframe",t.FRAME_TOKEN="frame",t.COMMENT_TOKEN="//",t}(o),p=function(){function e(){}return e}(),c=function(){function e(){}return e}(),u=function(){function e(){}return e}(),_=function(){function e(){}return e}();t.exports=d},{"awayjs-core/lib/geom/Quaternion":void 0,"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-core/lib/net/URLLoaderDataFormat":void 0,"awayjs-core/lib/parsers/ParserBase":void 0,"awayjs-renderergl/lib/animators/data/JointPose":void 0,"awayjs-renderergl/lib/animators/data/SkeletonPose":void 0,"awayjs-renderergl/lib/animators/nodes/SkeletonClipNode":void 0}],"awayjs-parsers/lib/MD5MeshParser":[function(e,t){var s=this.__extends||function(e,t){function s(){this.constructor=e}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);s.prototype=t.prototype,e.prototype=new s},a=e("awayjs-core/lib/geom/Quaternion"),r=e("awayjs-core/lib/geom/Vector3D"),i=e("awayjs-core/lib/net/URLLoaderDataFormat"),o=e("awayjs-core/lib/parsers/ParserBase"),n=e("awayjs-display/lib/containers/DisplayObjectContainer"),h=e("awayjs-display/lib/base/Geometry"),l=e("awayjs-display/lib/base/TriangleSubGeometry"),d=e("awayjs-display/lib/entities/Mesh"),p=e("awayjs-renderergl/lib/animators/SkeletonAnimationSet"),c=e("awayjs-renderergl/lib/animators/data/Skeleton"),u=e("awayjs-renderergl/lib/animators/data/SkeletonJoint"),_=function(e){function t(t,s){if(void 0===t&&(t=null),void 0===s&&(s=0),e.call(this,i.TEXT),this._parseIndex=0,this._line=0,this._charLineIndex=0,this._rotationQuat=new a,this._rotationQuat.fromAxisAngle(r.X_AXIS,.5*-Math.PI),t){var o=new a;o.fromAxisAngle(t,s),this._rotationQuat.multiply(this._rotationQuat,o)}}return s(t,e),t.supportsType=function(e){return e=e.toLowerCase(),"md5mesh"==e},t.supportsData=function(){return!1},t.prototype._pProceedParsing=function(){var e;for(this._startedParsing||(this._textData=this._pGetTextData(),this._startedParsing=!0);this._pHasTime();){switch(e=this.getNextToken()){case t.COMMENT_TOKEN:this.ignoreLine();break;case t.VERSION_TOKEN:if(this._version=this.getNextInt(),10!=this._version)throw new Error("Unknown version number encountered!");break;case t.COMMAND_LINE_TOKEN:this.parseCMD();break;case t.NUM_JOINTS_TOKEN:this._numJoints=this.getNextInt(),this._bindPoses=new Array(this._numJoints);break;case t.NUM_MESHES_TOKEN:this._numMeshes=this.getNextInt();break;case t.JOINTS_TOKEN:this.parseJoints();break;case t.MESH_TOKEN:this.parseMesh();break;default:this._reachedEOF||this.sendUnknownKeywordError()}if(this._reachedEOF){this.calculateMaxJointCount(),this._animationSet=new p(this._maxJointCount),this._mesh=new d(new h,null),this._geometry=this._mesh.geometry;for(var s=0;s<this._meshData.length;++s)this._geometry.addSubGeometry(this.translateGeom(this._meshData[s].vertexData,this._meshData[s].weightData,this._meshData[s].indices));return this._pContent.addChild(this._mesh),this._pFinalizeAsset(this._geometry),this._pFinalizeAsset(this._mesh),this._pFinalizeAsset(this._skeleton),this._pFinalizeAsset(this._animationSet),o.PARSING_DONE}}return o.MORE_TO_PARSE},t.prototype._pStartParsing=function(t){e.prototype._pStartParsing.call(this,t),this._pContent=new n},t.prototype.calculateMaxJointCount=function(){this._maxJointCount=0;for(var e=this._meshData.length,t=0;e>t;++t)for(var s=this._meshData[t],a=s.vertexData,r=a.length,i=0;r>i;++i){var o=this.countZeroWeightJoints(a[i],s.weightData),n=a[i].countWeight-o;n>this._maxJointCount&&(this._maxJointCount=n)}},t.prototype.countZeroWeightJoints=function(e,t){for(var s,a=e.startWeight,r=e.startWeight+e.countWeight,i=0,o=a;r>o;++o)s=t[o].bias,0==s&&++i;return i},t.prototype.parseJoints=function(){var e,s,a,r,i=0,o=this.getNextToken();"{"!=o&&this.sendUnknownKeywordError(),this._skeleton=new c;do{this._reachedEOF&&this.sendEOFError(),s=new u,s.name=this.parseLiteralstring(),s.parentIndex=this.getNextInt(),a=this.parseVector3D(),a=this._rotationQuat.rotatePoint(a),r=this.parseQuaternion(),this._bindPoses[i]=r.toMatrix3D(),this._bindPoses[i].appendTranslation(a.x,a.y,a.z);var n=this._bindPoses[i].clone();n.invert(),s.inverseBindPose=n.rawData,this._skeleton.joints[i++]=s,e=this.getNextChar(),"/"==e&&(this.putBack(),e=this.getNextToken(),e==t.COMMENT_TOKEN&&this.ignoreLine(),e=this.getNextChar()),"}"!=e&&this.putBack()}while("}"!=e)},t.prototype.putBack=function(){this._parseIndex--,this._charLineIndex--,this._reachedEOF=this._parseIndex>=this._textData.length},t.prototype.parseMesh=function(){var e,s,a,r,i=this.getNextToken();for("{"!=i&&this.sendUnknownKeywordError(),null==this._shaders&&(this._shaders=new Array);"}"!=e;)switch(e=this.getNextToken()){case t.COMMENT_TOKEN:this.ignoreLine();break;case t.MESH_SHADER_TOKEN:this._shaders.push(this.parseLiteralstring());break;case t.MESH_NUM_VERTS_TOKEN:s=new Array(this.getNextInt());break;case t.MESH_NUM_TRIS_TOKEN:r=new Array(3*this.getNextInt());break;case t.MESH_NUM_WEIGHTS_TOKEN:a=new Array(this.getNextInt());break;case t.MESH_VERT_TOKEN:this.parseVertex(s);break;case t.MESH_TRI_TOKEN:this.parseTri(r);break;case t.MESH_WEIGHT_TOKEN:this.parseJoint(a)}null==this._meshData&&(this._meshData=new Array);var o=this._meshData.length;this._meshData[o]=new m,this._meshData[o].vertexData=s,this._meshData[o].weightData=a,this._meshData[o].indices=r},t.prototype.translateGeom=function(e,t,s){for(var a,r,i,o,n,h,d,p,c=e.length,u=new l(!0),_=new Array(2*c),y=new Array(3*c),b=new Array(c*this._maxJointCount),m=new Array(c*this._maxJointCount),g=0,f=0;c>f;++f){o=e[f],a=3*o.index,r=a+1,i=a+2,y[a]=y[r]=y[i]=0,p=0;for(var w=0;w<o.countWeight;++w)n=t[o.startWeight+w],n.bias>0&&(h=this._bindPoses[n.joint],d=h.transformVector(n.pos),y[a]+=d.x*n.bias,y[r]+=d.y*n.bias,y[i]+=d.z*n.bias,b[g]=3*n.joint,m[g++]=n.bias,++p);for(w=p;w<this._maxJointCount;++w)b[g]=0,m[g++]=0;a=o.index<<1,_[a++]=o.s,_[a]=o.t}return u.jointsPerVertex=this._maxJointCount,u.updateIndices(s),u.updatePositions(y),u.updateUVs(_),u.updateJointIndices(b),u.updateJointWeights(m),u.vertexNormals,u.vertexTangents,u.autoDeriveTangents=!1,u.autoDeriveNormals=!1,u},t.prototype.parseTri=function(e){var t=3*this.getNextInt();e[t]=this.getNextInt(),e[t+1]=this.getNextInt(),e[t+2]=this.getNextInt()},t.prototype.parseJoint=function(e){var t=new b;t.index=this.getNextInt(),t.joint=this.getNextInt(),t.bias=this.getNextNumber(),t.pos=this.parseVector3D(),e[t.index]=t},t.prototype.parseVertex=function(e){var t=new y;t.index=this.getNextInt(),this.parseUV(t),t.startWeight=this.getNextInt(),t.countWeight=this.getNextInt(),e[t.index]=t},t.prototype.parseUV=function(e){var t=this.getNextToken();"("!=t&&this.sendParseError("("),e.s=this.getNextNumber(),e.t=this.getNextNumber(),")"!=this.getNextToken()&&this.sendParseError(")")},t.prototype.getNextToken=function(){for(var e,s="";!this._reachedEOF;){if(e=this.getNextChar()," "==e||"\r"==e||"\n"==e||"	"==e){if(s!=t.COMMENT_TOKEN&&this.skipWhiteSpace(),""!=s)return s}else s+=e;if(s==t.COMMENT_TOKEN)return s}return s},t.prototype.skipWhiteSpace=function(){var e;do e=this.getNextChar();while("\n"==e||" "==e||"\r"==e||"	"==e);this.putBack()},t.prototype.ignoreLine=function(){for(var e;!this._reachedEOF&&"\n"!=e;)e=this.getNextChar()},t.prototype.getNextChar=function(){var e=this._textData.charAt(this._parseIndex++);return"\n"==e?(++this._line,this._charLineIndex=0):"\r"!=e&&++this._charLineIndex,this._parseIndex>=this._textData.length&&(this._reachedEOF=!0),e},t.prototype.getNextInt=function(){var e=parseInt(this.getNextToken());return isNaN(e)&&this.sendParseError("int type"),e},t.prototype.getNextNumber=function(){var e=parseFloat(this.getNextToken());return isNaN(e)&&this.sendParseError("float type"),e},t.prototype.parseVector3D=function(){var e=new r,t=this.getNextToken();return"("!=t&&this.sendParseError("("),e.x=-this.getNextNumber(),e.y=this.getNextNumber(),e.z=this.getNextNumber(),")"!=this.getNextToken()&&this.sendParseError(")"),e},t.prototype.parseQuaternion=function(){var e=new a,t=this.getNextToken();"("!=t&&this.sendParseError("("),e.x=this.getNextNumber(),e.y=-this.getNextNumber(),e.z=-this.getNextNumber();var s=1-e.x*e.x-e.y*e.y-e.z*e.z;e.w=0>s?0:-Math.sqrt(s),")"!=this.getNextToken()&&this.sendParseError(")");var r=new a;return r.multiply(this._rotationQuat,e),r},t.prototype.parseCMD=function(){this.parseLiteralstring()},t.prototype.parseLiteralstring=function(){this.skipWhiteSpace();var e=this.getNextChar(),t="";'"'!=e&&this.sendParseError('"');do this._reachedEOF&&this.sendEOFError(),e=this.getNextChar(),'"'!=e&&(t+=e);while('"'!=e);return t},t.prototype.sendEOFError=function(){throw new Error("Unexpected end of file")},t.prototype.sendParseError=function(e){throw new Error("Unexpected token at line "+(this._line+1)+", character "+this._charLineIndex+". "+e+" expected, but "+this._textData.charAt(this._parseIndex-1)+" encountered")},t.prototype.sendUnknownKeywordError=function(){throw new Error("Unknown keyword at line "+(this._line+1)+", character "+this._charLineIndex+". ")},t.VERSION_TOKEN="MD5Version",t.COMMAND_LINE_TOKEN="commandline",t.NUM_JOINTS_TOKEN="numJoints",t.NUM_MESHES_TOKEN="numMeshes",t.COMMENT_TOKEN="//",t.JOINTS_TOKEN="joints",t.MESH_TOKEN="mesh",t.MESH_SHADER_TOKEN="shader",t.MESH_NUM_VERTS_TOKEN="numverts",t.MESH_VERT_TOKEN="vert",t.MESH_NUM_TRIS_TOKEN="numtris",t.MESH_TRI_TOKEN="tri",t.MESH_NUM_WEIGHTS_TOKEN="numweights",t.MESH_WEIGHT_TOKEN="weight",t}(o),y=function(){function e(){}return e}(),b=function(){function e(){}return e}(),m=function(){function e(){}return e}();t.exports=_},{"awayjs-core/lib/geom/Quaternion":void 0,"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-core/lib/net/URLLoaderDataFormat":void 0,"awayjs-core/lib/parsers/ParserBase":void 0,"awayjs-display/lib/base/Geometry":void 0,"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-display/lib/containers/DisplayObjectContainer":void 0,"awayjs-display/lib/entities/Mesh":void 0,"awayjs-renderergl/lib/animators/SkeletonAnimationSet":void 0,"awayjs-renderergl/lib/animators/data/Skeleton":void 0,"awayjs-renderergl/lib/animators/data/SkeletonJoint":void 0}],"awayjs-parsers/lib/Max3DSParser":[function(e,t){var s=this.__extends||function(e,t){function s(){this.constructor=e}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);s.prototype=t.prototype,e.prototype=new s},a=e("awayjs-core/lib/geom/Matrix3D"),r=e("awayjs-core/lib/geom/Vector3D"),i=e("awayjs-core/lib/library/AssetType"),o=e("awayjs-core/lib/net/URLLoaderDataFormat"),n=e("awayjs-core/lib/net/URLRequest"),h=e("awayjs-core/lib/parsers/ParserBase"),l=e("awayjs-core/lib/parsers/ParserUtils"),d=e("awayjs-display/lib/containers/DisplayObjectContainer"),p=e("awayjs-display/lib/base/Geometry"),c=e("awayjs-display/lib/base/TriangleSubGeometry"),u=e("awayjs-display/lib/entities/Mesh"),_=e("awayjs-renderergl/lib/managers/DefaultMaterialManager"),y=e("awayjs-methodmaterials/lib/TriangleMethodMaterial"),b=e("awayjs-methodmaterials/lib/TriangleMaterialMode"),m=function(e){function t(t){void 0===t&&(t=!0),e.call(this,o.ARRAY_BUFFER),this._useSmoothingGroups=t}return s(t,e),t.supportsType=function(e){return e=e.toLowerCase(),"3ds"==e},t.supportsData=function(e){var t;return t=l.toByteArray(e),t&&(t.position=0,19789==t.readShort())?!0:!1},t.prototype._iResolveDependency=function(e){if(1==e.assets.length){var t;if(t=e.assets[0],t.assetType==i.TEXTURE){var s;s=this._textures[e.id],s.texture=t}}},t.prototype._iResolveDependencyFailure=function(){},t.prototype._pProceedParsing=function(){for(this._byteData||(this._byteData=this._pGetByteData(),this._byteData.position=0,this._textures={},this._materials={},this._unfinalized_objects={});this._pHasTime();)if(this._cur_mat&&this._byteData.position>=this._cur_mat_end?this.finalizeCurrentMaterial():this._cur_obj&&this._byteData.position>=this._cur_obj_end&&(this._unfinalized_objects[this._cur_obj.name]=this._cur_obj,this._cur_obj_end=Number.MAX_VALUE,this._cur_obj=null),this._byteData.getBytesAvailable()>0){var e,t,s;switch(e=this._byteData.readUnsignedShort(),t=this._byteData.readUnsignedInt(),s=this._byteData.position+(t-6),e){case 19789:case 15677:case 45056:continue;case 45055:this._cur_mat_end=s,this._cur_mat=this.parseMaterial();break;case 16384:this._cur_obj_end=s,this._cur_obj=new w,this._cur_obj.name=this.readNulTermstring(),this._cur_obj.materials=new Array,this._cur_obj.materialFaces={};break;case 16640:this._cur_obj.type=i.MESH;break;case 16656:this.parseVertexList();break;case 16672:this.parseFaceList();break;case 16704:this.parseUVList();break;case 16688:this.parseFaceMaterialList();break;case 16736:this._cur_obj.transform=this.readTransform();break;case 45058:this.parseObjectAnimation(s);break;case 16720:this.parseSmoothingGroups();break;default:this._byteData.position+=t-6}if(this.dependencies.length){this._pPauseAndRetrieveDependencies();break}}if(this._byteData.getBytesAvailable()||this._cur_obj||this._cur_mat)return h.MORE_TO_PARSE;var a;for(a in this._unfinalized_objects){var r;r=this.constructObject(this._unfinalized_objects[a]),r&&(this._pContent.addChild(r),this._pFinalizeAsset(r,a))}return h.PARSING_DONE},t.prototype._pStartParsing=function(t){e.prototype._pStartParsing.call(this,t),this._pContent=new d},t.prototype.parseMaterial=function(){var e;for(e=new f;this._byteData.position<this._cur_mat_end;){var t,s,a;switch(t=this._byteData.readUnsignedShort(),s=this._byteData.readUnsignedInt(),a=this._byteData.position+(s-6),t){case 40960:e.name=this.readNulTermstring();break;case 40976:e.ambientColor=this.readColor();break;case 40992:e.diffuseColor=this.readColor();break;case 41008:e.specularColor=this.readColor();break;case 41089:e.twoSided=!0;break;case 41472:e.colorMap=this.parseTexture(a);break;case 41476:e.specularMap=this.parseTexture(a);break;default:this._byteData.position=a}}return e},t.prototype.parseTexture=function(e){var t;for(t=new v;this._byteData.position<e;){var s,a;switch(s=this._byteData.readUnsignedShort(),a=this._byteData.readUnsignedInt(),s){case 41728:t.url=this.readNulTermstring();break;default:this._byteData.position+=a-6}}return this._textures[t.url]=t,this._pAddDependency(t.url,new n(t.url)),t},t.prototype.parseVertexList=function(){var e,t,s;for(s=this._byteData.readUnsignedShort(),this._cur_obj.verts=new Array(3*s),e=0,t=this._cur_obj.verts.length;t>e;){var a,r,i;a=this._byteData.readFloat(),r=this._byteData.readFloat(),i=this._byteData.readFloat(),this._cur_obj.verts[e++]=a,this._cur_obj.verts[e++]=i,this._cur_obj.verts[e++]=r}},t.prototype.parseFaceList=function(){var e,t,s;for(s=this._byteData.readUnsignedShort(),this._cur_obj.indices=new Array(3*s),e=0,t=this._cur_obj.indices.length;t>e;){var a,r,i;a=this._byteData.readUnsignedShort(),r=this._byteData.readUnsignedShort(),i=this._byteData.readUnsignedShort(),this._cur_obj.indices[e++]=a,this._cur_obj.indices[e++]=i,this._cur_obj.indices[e++]=r,this._byteData.position+=2}this._cur_obj.smoothingGroups=new Array(s)},t.prototype.parseSmoothingGroups=function(){for(var e=this._cur_obj.indices.length/3,t=0;e>t;)this._cur_obj.smoothingGroups[t]=this._byteData.readUnsignedInt(),t++},t.prototype.parseUVList=function(){var e,t,s;for(s=this._byteData.readUnsignedShort(),this._cur_obj.uvs=new Array(2*s),e=0,t=this._cur_obj.uvs.length;t>e;)this._cur_obj.uvs[e++]=this._byteData.readFloat(),this._cur_obj.uvs[e++]=1-this._byteData.readFloat()},t.prototype.parseFaceMaterialList=function(){var e,t,s,a;for(e=this.readNulTermstring(),t=this._byteData.readUnsignedShort(),a=new Array(t),s=0;s<a.length;)a[s++]=this._byteData.readUnsignedShort();this._cur_obj.materials.push(e),this._cur_obj.materialFaces[e]=a},t.prototype.parseObjectAnimation=function(e){var t,s,a,i,o;for(a=new r;this._byteData.position<e;){var n,h;switch(n=this._byteData.readUnsignedShort(),h=this._byteData.readUnsignedInt(),n){case 45072:i=this.readNulTermstring(),this._byteData.position+=4,o=this._byteData.readShort();break;case 45075:a.x=this._byteData.readFloat(),a.z=this._byteData.readFloat(),a.y=this._byteData.readFloat();break;default:this._byteData.position+=h-6}}"$$$DUMMY"!=i&&this._unfinalized_objects.hasOwnProperty(i)&&(t=this._unfinalized_objects[i],s=this.constructObject(t,a),s&&(this._pContent.addChild(s),this._pFinalizeAsset(s,t.name)),delete this._unfinalized_objects[i])},t.prototype.constructObject=function(e,t){if(void 0===t&&(t=null),e.type==i.MESH){var s,r,o,n,h,l,d,_;if(e.materials.length>1&&console.log("The Away3D 3DS parser does not support multiple materials per mesh at this point."),!e.indices||0==e.indices.length)return null;for(d=new Array(e.verts.length/3),_=new Array(e.indices.length/3),this.prepareData(d,_,e),this._useSmoothingGroups&&this.applySmoothGroups(d,_),e.verts=new Array(3*d.length),s=0;s<d.length;s++)e.verts[3*s]=d[s].x,e.verts[3*s+1]=d[s].y,e.verts[3*s+2]=d[s].z;for(e.indices=new Array(3*_.length),s=0;s<_.length;s++)e.indices[3*s]=_[s].a,e.indices[3*s+1]=_[s].b,e.indices[3*s+2]=_[s].c;if(e.uvs)for(e.uvs=new Array(2*d.length),s=0;s<d.length;s++)e.uvs[2*s]=d[s].u,e.uvs[2*s+1]=d[s].v;if(o=new p,r=new c(!0),r.updateIndices(e.indices),r.updatePositions(e.verts),r.updateUVs(e.uvs),o.addSubGeometry(r),e.materials.length>0){var y;y=e.materials[0],n=this._materials[y].material}if(t){if(e.transform){var b=e.transform.concat();b[12]=0,b[13]=0,b[14]=0,l=new a(b),t=l.transformVector(t)}t.scaleBy(-1),l=new a,l.appendTranslation(t.x,t.y,t.z),o.applyTransformation(l)}return e.transform&&(l=new a(e.transform),l.invert(),o.applyTransformation(l)),this._pFinalizeAsset(o,e.name.concat("_geom")),h=new u(o,n),h.transform.matrix3D=new a(e.transform),h}return null},t.prototype.prepareData=function(e,t,s){var a,r,i,o=s.verts.length;for(a=0,r=0,i=0;o>a;){var n=new k;n.x=s.verts[a++],n.y=s.verts[a++],n.z=s.verts[a++],s.uvs&&(n.u=s.uvs[r++],n.v=s.uvs[r++]),e[i++]=n}for(o=s.indices.length,a=0,i=0;o>a;){var h=new g;h.a=s.indices[a++],h.b=s.indices[a++],h.c=s.indices[a++],h.smoothGroup=s.smoothingGroups[i]||0,t[i++]=h}},t.prototype.applySmoothGroups=function(e,t){var s,a,r,i,o,n=e.length,h=t.length,l=new Array(n);for(s=0;n>s;s++)l[s]=new Array;for(s=0;h>s;s++){var d=t[s];for(a=0;3>a;a++){var p=l[0==a?d.a:1==a?d.b:d.c],c=d.smoothGroup;for(r=p.length-1;r>=0;r--)(c&p[r])>0&&(c|=p[r],p.splice(r,1),r=p.length-1);p.push(c)}}var u=new Array(n);for(s=0;n>s;s++)if(!((o=l[s].length)<1)){var _=new Array(o);u[s]=_,_[0]=s;var y=e[s];for(a=1;o>a;a++){var b=new k;b.x=y.x,b.y=y.y,b.z=y.z,b.u=y.u,b.v=y.v,_[a]=e.length,e.push(b)}}for(n=e.length,s=0;h>s;s++)for(d=t[s],c=d.smoothGroup,a=0;3>a;a++)for(r=0==a?d.a:1==a?d.b:d.c,p=l[r],o=p.length,_=u[r],i=0;o>i;i++)if(0==c&&0==p[i]||(c&p[i])>0){var m=_[i];0==c&&(p.splice(i,1),_.splice(i,1)),0==a?d.a=m:1==a?d.b=m:d.c=m,i=o}},t.prototype.finalizeCurrentMaterial=function(){var e;e=new y(this._cur_mat.colorMap?this._cur_mat.colorMap.texture||_.getDefaultTexture():this._cur_mat.ambientColor),e.diffuseColor=this._cur_mat.diffuseColor,e.specularColor=this._cur_mat.specularColor,this.materialMode>=2&&(e.materialMode=b.MULTI_PASS),e.bothSides=this._cur_mat.twoSided,this._pFinalizeAsset(e,this._cur_mat.name),this._materials[this._cur_mat.name]=this._cur_mat,this._cur_mat.material=e,this._cur_mat=null},t.prototype.readNulTermstring=function(){for(var e,t="";(e=this._byteData.readUnsignedByte())>0;)t+=String.fromCharCode(e);return t},t.prototype.readTransform=function(){var e;return e=new Array(16),e[0]=this._byteData.readFloat(),e[2]=this._byteData.readFloat(),e[1]=this._byteData.readFloat(),e[3]=0,e[8]=this._byteData.readFloat(),e[10]=this._byteData.readFloat(),e[9]=this._byteData.readFloat(),e[11]=0,e[4]=this._byteData.readFloat(),e[6]=this._byteData.readFloat(),e[5]=this._byteData.readFloat(),e[7]=0,e[12]=this._byteData.readFloat(),e[14]=this._byteData.readFloat(),e[13]=this._byteData.readFloat(),e[15]=1,e},t.prototype.readColor=function(){var e,t,s,a,r;switch(e=this._byteData.readUnsignedShort(),t=this._byteData.readUnsignedInt(),e){case 16:s=255*this._byteData.readFloat(),a=255*this._byteData.readFloat(),r=255*this._byteData.readFloat();break;case 17:s=this._byteData.readUnsignedByte(),a=this._byteData.readUnsignedByte(),r=this._byteData.readUnsignedByte();break;default:this._byteData.position+=t-6}return s<<16|a<<8|r},t}(h),g=function(){function e(){}return e}(),f=function(){function e(){}return e}(),w=function(){function e(){}return e}(),v=function(){function e(){}return e}(),k=function(){function e(){}return e}();t.exports=m},{"awayjs-core/lib/geom/Matrix3D":void 0,"awayjs-core/lib/geom/Vector3D":void 0,"awayjs-core/lib/library/AssetType":void 0,"awayjs-core/lib/net/URLLoaderDataFormat":void 0,"awayjs-core/lib/net/URLRequest":void 0,"awayjs-core/lib/parsers/ParserBase":void 0,"awayjs-core/lib/parsers/ParserUtils":void 0,"awayjs-display/lib/base/Geometry":void 0,"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-display/lib/containers/DisplayObjectContainer":void 0,"awayjs-display/lib/entities/Mesh":void 0,"awayjs-methodmaterials/lib/TriangleMaterialMode":void 0,"awayjs-methodmaterials/lib/TriangleMethodMaterial":void 0,"awayjs-renderergl/lib/managers/DefaultMaterialManager":void 0}],"awayjs-parsers/lib/OBJParser":[function(e,t){var s=this.__extends||function(e,t){function s(){this.constructor=e
}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);s.prototype=t.prototype,e.prototype=new s},a=e("awayjs-core/lib/library/AssetType"),r=e("awayjs-core/lib/net/URLLoaderDataFormat"),i=e("awayjs-core/lib/net/URLRequest"),o=e("awayjs-core/lib/parsers/ParserBase"),n=e("awayjs-core/lib/parsers/ParserUtils"),h=e("awayjs-display/lib/containers/DisplayObjectContainer"),l=e("awayjs-display/lib/base/TriangleSubGeometry"),d=e("awayjs-display/lib/base/Geometry"),p=e("awayjs-display/lib/entities/Mesh"),c=e("awayjs-renderergl/lib/managers/DefaultMaterialManager"),u=e("awayjs-methodmaterials/lib/TriangleMethodMaterial"),_=e("awayjs-methodmaterials/lib/TriangleMaterialMode"),y=e("awayjs-methodmaterials/lib/methods/SpecularBasicMethod"),b=function(e){function t(t){void 0===t&&(t=1),e.call(this,r.TEXT),this._mtlLibLoaded=!0,this._activeMaterialID="",this._scale=t}return s(t,e),Object.defineProperty(t.prototype,"scale",{set:function(e){this._scale=e},enumerable:!0,configurable:!0}),t.supportsType=function(e){return e=e.toLowerCase(),"obj"==e},t.supportsData=function(e){var t=n.toString(e),s=!1,a=!1;return t&&(s=-1!=t.indexOf("\nv "),a=-1!=t.indexOf("\nf ")),s&&a},t.prototype._iResolveDependency=function(e){if("mtl"==e.id){var t=n.toString(e.data);this.parseMtl(t)}else{var s;if(1!=e.assets.length)return;if(s=e.assets[0],s.assetType==a.TEXTURE){var r=new v;r.materialID=e.id,r.texture=s,this._materialLoaded.push(r),this._meshes.length>0&&this.applyMaterial(r)}}},t.prototype._iResolveDependencyFailure=function(e){if("mtl"==e.id)this._mtlLib=!1,this._mtlLibLoaded=!1;else{var t=new v;t.materialID=e.id,this._materialLoaded.push(t)}this._meshes.length>0&&this.applyMaterial(t)},t.prototype._pProceedParsing=function(){var e,t,s=String.fromCharCode(10);for(this._startedParsing||(this._textData=this._pGetTextData(),this._textData=this._textData.replace(/\\[\r\n]+\s*/gm," ")),-1==this._textData.indexOf(s)&&(s=String.fromCharCode(13)),this._startedParsing||(this._startedParsing=!0,this._vertices=new Array,this._vertexNormals=new Array,this._materialIDs=new Array,this._materialLoaded=new Array,this._meshes=new Array,this._uvs=new Array,this._stringLength=this._textData.length,this._charIndex=this._textData.indexOf(s,0),this._oldIndex=0,this._objects=new Array,this._objectIndex=0);this._charIndex<this._stringLength&&this._pHasTime();)if(this._charIndex=this._textData.indexOf(s,this._oldIndex),-1==this._charIndex&&(this._charIndex=this._stringLength),e=this._textData.substring(this._oldIndex,this._charIndex),e=e.split("\r").join(""),e=e.replace("  "," "),t=e.split(" "),this._oldIndex=this._charIndex+1,this.parseLine(t),this.parsingPaused)return o.MORE_TO_PARSE;return this._charIndex>=this._stringLength?this._mtlLib&&!this._mtlLibLoaded?o.MORE_TO_PARSE:(this.translate(),this.applyMaterials(),o.PARSING_DONE):o.MORE_TO_PARSE},t.prototype._pStartParsing=function(t){e.prototype._pStartParsing.call(this,t),this._pContent=new h},t.prototype.parseLine=function(e){switch(e[0]){case"mtllib":this._mtlLib=!0,this._mtlLibLoaded=!1,this.loadMtl(e[1]);break;case"g":this.createGroup(e);break;case"o":this.createObject(e);break;case"usemtl":this._mtlLib&&(e[1]||(e[1]="def000"),this._materialIDs.push(e[1]),this._activeMaterialID=e[1],this._currentGroup&&(this._currentGroup.materialID=this._activeMaterialID));break;case"v":this.parseVertex(e);break;case"vt":this.parseUV(e);break;case"vn":this.parseVertexNormal(e);break;case"f":this.parseFace(e)}},t.prototype.translate=function(){for(var e=0;e<this._objects.length;++e)for(var t,s,a,r,i,o,n,h=this._objects[e].groups,l=h.length,y=0;l>y;++y){for(a=new d,t=h[y].materialGroups,s=t.length,i=0;s>i;++i)this.translateMaterialGroup(t[i],a);if(0!=a.subGeometries.length){if(this._pFinalizeAsset(a),n=new u(c.getDefaultTexture()),this.materialMode>=2&&(n.materialMode=_.MULTI_PASS),r=new p(a,n),r.name=this._objects[e].name?this._objects[e].name:h[y].name?h[y].name:"",this._meshes.push(r),n.name=""!=h[y].materialID?h[y].materialID+"~"+r.name:this._lastMtlID+"~"+r.name,r.subMeshes.length>1)for(o=1;o<r.subMeshes.length;++o)r.subMeshes[o].material=n;this._pContent.addChild(r),this._pFinalizeAsset(r)}}},t.prototype.translateMaterialGroup=function(e,t){var s,a,r,i=e.faces,o=i.length,n=new Array,h=new Array,d=new Array,p=new Array;this._realIndices=[],this._vertexIndex=0;for(var c,u=0;o>u;++u)for(s=i[u],a=s.indexIds.length-1,c=1;a>c;++c)this.translateVertexData(s,c,n,h,p,d),this.translateVertexData(s,0,n,h,p,d),this.translateVertexData(s,c+1,n,h,p,d);n.length>0&&(r=new l(!0),r.autoDeriveNormals=d.length?!1:!0,r.updateIndices(p),r.updatePositions(n),r.updateVertexNormals(d),r.updateUVs(h),t.addSubGeometry(r))},t.prototype.translateVertexData=function(e,t,s,a,r,i){var o,n,h,l;if(this._realIndices[e.indexIds[t]])o=this._realIndices[e.indexIds[t]]-1;else if(o=this._vertexIndex,this._realIndices[e.indexIds[t]]=++this._vertexIndex,n=this._vertices[e.vertexIndices[t]-1],s.push(n.x*this._scale,n.y*this._scale,n.z*this._scale),e.normalIndices.length>0&&(h=this._vertexNormals[e.normalIndices[t]-1],i.push(h.x,h.y,h.z)),e.uvIndices.length>0)try{l=this._uvs[e.uvIndices[t]-1],a.push(l.u,l.v)}catch(d){switch(t){case 0:a.push(0,1);break;case 1:a.push(.5,0);break;case 2:a.push(1,1)}}r.push(o)},t.prototype.createObject=function(e){this._currentGroup=null,this._currentMaterialGroup=null,this._objects.push(this._currentObject=new m),e&&(this._currentObject.name=e[1])},t.prototype.createGroup=function(e){this._currentObject||this.createObject(null),this._currentGroup=new g,this._currentGroup.materialID=this._activeMaterialID,e&&(this._currentGroup.name=e[1]),this._currentObject.groups.push(this._currentGroup),this.createMaterialGroup(null)},t.prototype.createMaterialGroup=function(e){this._currentMaterialGroup=new f,e&&(this._currentMaterialGroup.url=e[1]),this._currentGroup.materialGroups.push(this._currentMaterialGroup)},t.prototype.parseVertex=function(e){var t,s,a;if(e.length>4){for(var r,i=[],o=1;o<e.length;++o)r=parseFloat(e[o]),isNaN(r)||i.push(r);t=i[0],s=i[1],a=-i[2],this._vertices.push(new M(t,s,a))}else t=parseFloat(e[1]),s=parseFloat(e[2]),a=-parseFloat(e[3]),this._vertices.push(new M(t,s,a))},t.prototype.parseUV=function(e){if(e.length>3){for(var t,s=[],a=1;a<e.length;++a)t=parseFloat(e[a]),isNaN(t)||s.push(t);this._uvs.push(new N(s[0],1-s[1]))}else this._uvs.push(new N(parseFloat(e[1]),1-parseFloat(e[2])))},t.prototype.parseVertexNormal=function(e){if(e.length>4){for(var t,s=[],a=1;a<e.length;++a)t=parseFloat(e[a]),isNaN(t)||s.push(t);this._vertexNormals.push(new M(s[0],s[1],-s[2]))}else this._vertexNormals.push(new M(parseFloat(e[1]),parseFloat(e[2]),-parseFloat(e[3])))},t.prototype.parseFace=function(e){var t=e.length,s=new k;this._currentGroup||this.createGroup(null);for(var a,r=1;t>r;++r)""!=e[r]&&(a=e[r].split("/"),s.vertexIndices.push(this.parseIndex(parseInt(a[0]),this._vertices.length)),a[1]&&String(a[1]).length>0&&s.uvIndices.push(this.parseIndex(parseInt(a[1]),this._uvs.length)),a[2]&&String(a[2]).length>0&&s.normalIndices.push(this.parseIndex(parseInt(a[2]),this._vertexNormals.length)),s.indexIds.push(e[r]));this._currentMaterialGroup.faces.push(s)},t.prototype.parseIndex=function(e,t){return 0>e?e+t+1:e},t.prototype.parseMtl=function(e){for(var t,s,a,r,o,n,h,l,d,p,c,b,m=e.split("newmtl"),g=0;g<m.length;++g){for(t=m[g].split("\r").join("").split("\n"),1==t.length&&(t=m[g].split(String.fromCharCode(13))),h=l=d=16777215,p=0,o=!1,n=!1,c=1,b="",a=0;a<t.length;++a)if(t[a]=t[a].replace(/\s+$/,""),"#"!=t[a].substring(0,1)&&(0==a||""!=t[a]))if(s=t[a].split(" "),(9==String(s[0]).charCodeAt(0)||32==String(s[0]).charCodeAt(0))&&(s[0]=s[0].substring(1,s[0].length)),0==a)this._lastMtlID=s.join(""),this._lastMtlID=""==this._lastMtlID?"def000":this._lastMtlID;else switch(s[0]){case"Ka":s[1]&&!isNaN(Number(s[1]))&&s[2]&&!isNaN(Number(s[2]))&&s[3]&&!isNaN(Number(s[3]))&&(l=255*s[1]<<16|255*s[2]<<8|255*s[3]);break;case"Ks":s[1]&&!isNaN(Number(s[1]))&&s[2]&&!isNaN(Number(s[2]))&&s[3]&&!isNaN(Number(s[3]))&&(d=255*s[1]<<16|255*s[2]<<8|255*s[3],o=!0);break;case"Ns":s[1]&&!isNaN(Number(s[1]))&&(p=.001*Number(s[1])),0==p&&(o=!1);break;case"Kd":s[1]&&!isNaN(Number(s[1]))&&s[2]&&!isNaN(Number(s[2]))&&s[3]&&!isNaN(Number(s[3]))&&(h=255*s[1]<<16|255*s[2]<<8|255*s[3],n=!0);break;case"tr":case"d":s[1]&&!isNaN(Number(s[1]))&&(c=Number(s[1]));break;case"map_Kd":b=this.parseMapKdString(s),b=b.replace(/\\/g,"/")}if(""!=b){if(o){r=new y,r.specularColor=d,r.specular=p;var f=new w;f.alpha=c,f.basicSpecularMethod=r,f.materialID=this._lastMtlID,this._materialSpecularData||(this._materialSpecularData=new Array),this._materialSpecularData.push(f)}this._pAddDependency(this._lastMtlID,new i(b))}else if(n&&!isNaN(l)){var k=new v;k.materialID=this._lastMtlID,0==c&&console.log("Warning: an alpha value of 0 was found in mtl color tag (Tr or d) ref:"+this._lastMtlID+", mesh(es) using it will be invisible!");var N;if(this.materialMode<2){N=new u(l);var M=N;M.alpha=c,M.diffuseColor=h,M.repeat=!0,o&&(M.specularColor=d,M.specular=p)}else{N=new u(l),N.materialMode=_.MULTI_PASS;var T=N;T.diffuseColor=h,T.repeat=!0,o&&(T.specularColor=d,T.specular=p)}k.cm=N,this._materialLoaded.push(k),this._meshes.length>0&&this.applyMaterial(k)}}this._mtlLibLoaded=!0},t.prototype.parseMapKdString=function(e){var t,s,a="";for(t=1;t<e.length;){switch(e[t]){case"-blendu":case"-blendv":case"-cc":case"-clamp":case"-texres":t+=2;break;case"-mm":t+=3;break;case"-o":case"-s":case"-t":t+=4;continue;default:s=!0}if(s)break}for(t;t<e.length;t++)a+=e[t],a+=" ";return a=a.replace(/\s+$/,"")},t.prototype.loadMtl=function(e){this._pAddDependency("mtl",new i(e),!0),this._pPauseAndRetrieveDependencies()},t.prototype.applyMaterial=function(e){for(var t,s,a,r,i,o=0;o<this._meshes.length;++o)if(s=this._meshes[o],t=s.material.name.split("~"),t[0]==e.materialID){if(e.cm)s.material&&(s.material=null),s.material=e.cm;else if(e.texture)if(this.materialMode<2){if(a=s.material,a.texture=e.texture,a.color=e.color,a.alpha=e.alpha,a.repeat=!0,e.specularMethod)a.specularMethod=null,a.specularMethod=e.specularMethod;else if(this._materialSpecularData)for(r=0;r<this._materialSpecularData.length;++r)if(i=this._materialSpecularData[r],i.materialID==e.materialID){a.specularMethod=null,a.specularMethod=i.basicSpecularMethod,a.color=i.color,a.alpha=i.alpha;break}}else if(a=s.material,a.materialMode=_.MULTI_PASS,a.texture=e.texture,a.color=e.color,a.repeat=!0,e.specularMethod)a.specularMethod=null,a.specularMethod=e.specularMethod;else if(this._materialSpecularData)for(r=0;r<this._materialSpecularData.length;++r)if(i=this._materialSpecularData[r],i.materialID==e.materialID){a.specularMethod=null,a.specularMethod=i.basicSpecularMethod,a.color=i.color;break}s.material.name=t[1]?t[1]:t[0],this._meshes.splice(o,1),--o}(e.cm||a)&&this._pFinalizeAsset(e.cm||a)},t.prototype.applyMaterials=function(){if(0!=this._materialLoaded.length)for(var e=0;e<this._materialLoaded.length;++e)this.applyMaterial(this._materialLoaded[e])},t}(o),m=function(){function e(){this.groups=new Array}return e}(),g=function(){function e(){this.materialGroups=new Array}return e}(),f=function(){function e(){this.faces=new Array}return e}(),w=function(){function e(){this.color=16777215,this.alpha=1}return e}(),v=function(){function e(){this.color=16777215,this.alpha=1}return e}(),k=function(){function e(){this.vertexIndices=new Array,this.uvIndices=new Array,this.normalIndices=new Array,this.indexIds=new Array}return e}(),N=function(){function e(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this._u=e,this._v=t}return Object.defineProperty(e.prototype,"v",{get:function(){return this._v},set:function(e){this._v=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"u",{get:function(){return this._u},set:function(e){this._u=e},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this._u,this._v)},e.prototype.toString=function(){return this._u+","+this._v},e}(),M=function(){function e(e,t,s,a){void 0===e&&(e=0),void 0===t&&(t=0),void 0===s&&(s=0),void 0===a&&(a=0),this._x=e,this._y=t,this._z=s,this._index=a}return Object.defineProperty(e.prototype,"index",{get:function(){return this._index},set:function(e){this._index=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"z",{get:function(){return this._z},set:function(e){this._z=e},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this._x,this._y,this._z)},e}();t.exports=b},{"awayjs-core/lib/library/AssetType":void 0,"awayjs-core/lib/net/URLLoaderDataFormat":void 0,"awayjs-core/lib/net/URLRequest":void 0,"awayjs-core/lib/parsers/ParserBase":void 0,"awayjs-core/lib/parsers/ParserUtils":void 0,"awayjs-display/lib/base/Geometry":void 0,"awayjs-display/lib/base/TriangleSubGeometry":void 0,"awayjs-display/lib/containers/DisplayObjectContainer":void 0,"awayjs-display/lib/entities/Mesh":void 0,"awayjs-methodmaterials/lib/TriangleMaterialMode":void 0,"awayjs-methodmaterials/lib/TriangleMethodMaterial":void 0,"awayjs-methodmaterials/lib/methods/SpecularBasicMethod":void 0,"awayjs-renderergl/lib/managers/DefaultMaterialManager":void 0}],"awayjs-parsers/lib/Parsers":[function(e,t){var s=e("awayjs-core/lib/library/AssetLoader"),a=e("awayjs-parsers/lib/AWDParser"),r=e("awayjs-parsers/lib/Max3DSParser"),i=e("awayjs-parsers/lib/MD2Parser"),o=e("awayjs-parsers/lib/OBJParser"),n=function(){function e(){}return e.enableAllBundled=function(){s.enableParsers(e.ALL_BUNDLED)},e.ALL_BUNDLED=Array(a,r,i,o),e}();t.exports=n},{"awayjs-core/lib/library/AssetLoader":void 0,"awayjs-parsers/lib/AWDParser":void 0,"awayjs-parsers/lib/MD2Parser":void 0,"awayjs-parsers/lib/Max3DSParser":void 0,"awayjs-parsers/lib/OBJParser":void 0}]},{},[]);
//# sourceMappingURL=awayjs-parsers.min.js.map