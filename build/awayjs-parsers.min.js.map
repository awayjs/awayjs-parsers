{
  "version": 3,
  "sources": [
    "node_modules/browserify/node_modules/browser-pack/_prelude.js",
    "awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase.ts",
    "awayjs-parsers.js",
    "awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParsers.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/AnimatorAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/AudioAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/BillboardAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/BitmapTextureAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/BlockNameSpaceAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/CameraAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/CommandAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/CubeTextureAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/DisplayObjectContainerAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/GeometryAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/LightAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/LightPickerAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/MaterialAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/MeshAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/MetadataAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/MovieClipAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/PrefabAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/ShadowMethodAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/SharedMethodAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/SkeletonAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/SkeletonAnimClipAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/SkeletonPoseAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/SkyboxAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/TesselatedFontAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/TextfieldAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/TextformatAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/VertexAnimClipAWDParser.ts",
    "awayjs-parsers/lib/AWD3BlockParsers/VertexAnimationSetAWDParser.ts",
    "awayjs-parsers/lib/AWD3ParserUtils/AWD3FileData.ts",
    "awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils.ts",
    "awayjs-parsers/lib/AWD3ParserUtils/AWDBitFlags.ts",
    "awayjs-parsers/lib/AWD3ParserUtils/AWDBlock.ts",
    "awayjs-parsers/lib/AWD3ParserUtils/AWDProperties.ts",
    "awayjs-parsers/lib/AWD3Parser.ts",
    "awayjs-parsers/lib/AWDParser.ts",
    "awayjs-parsers/lib/MD2Parser.ts",
    "awayjs-parsers/lib/MD5AnimParser.ts",
    "awayjs-parsers/lib/MD5MeshParser.ts",
    "awayjs-parsers/lib/Max3DSParser.ts",
    "awayjs-parsers/lib/OBJParser.ts",
    "awayjs-parsers/lib/Parsers.ts"
  ],
  "names": [
    "require",
    "e",
    "t",
    "n",
    "r",
    "s",
    "o",
    "u",
    "a",
    "i",
    "f",
    "Error",
    "code",
    "l",
    "exports",
    "call",
    "length",
    "awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase",
    "module",
    "AbstractMethodError",
    "AWDAssetParserBase",
    "Object",
    "defineProperty",
    "prototype",
    "get",
    "this",
    "_awd_file_data",
    "set",
    "awd_file_data",
    "enumerable",
    "configurable",
    "parseFromBytes",
    "awayjs-core/lib/errors/AbstractMethodError",
    "undefined",
    "awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParsers",
    "GeometryAWDParser",
    "PrefabAWDParser",
    "DisplayObjectContainerAWDParser",
    "MeshAWDParser",
    "BillboardAWDParser",
    "BitmapTextureAWDParser",
    "CameraAWDParser",
    "CubeTextureAWDParser",
    "LightAWDParser",
    "LightPickerAWDParser",
    "MaterialAWDParser",
    "MovieClipAWDParser",
    "ShadowMethodAWDParser",
    "SharedMethodAWDParser",
    "SkeletonAnimClipAWDParser",
    "SkeletonAWDParser",
    "SkeletonPoseAWDParser",
    "SkyboxAWDParser",
    "TesselatedFontAWDParser",
    "TextfieldAWDParser",
    "TextformatAWDParser",
    "VertexAnimClipAWDParser",
    "CommandAWDParser",
    "MetadataAWDParser",
    "BlockNameSpaceAWDParser",
    "AnimatorAWDParser",
    "AudioAWDParser",
    "AWDBlockParsers",
    "_supported_asset_blocks",
    "_all_block_parsers",
    "Array",
    "add_block_parser",
    "block_parser",
    "block_types",
    "push",
    "init_parser",
    "file_data",
    "parseAsset",
    "type",
    "this_parser",
    "awayjs-parsers/lib/AWD3BlockParsers/AnimatorAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/AudioAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/BillboardAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/BitmapTextureAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/BlockNameSpaceAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/CameraAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/CommandAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/CubeTextureAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/DisplayObjectContainerAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/GeometryAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/LightAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/LightPickerAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/MaterialAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/MeshAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/MetadataAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/MovieClipAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/PrefabAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/ShadowMethodAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/SharedMethodAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/SkeletonAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/SkeletonAnimClipAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/SkeletonPoseAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/SkyboxAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/TesselatedFontAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/TextfieldAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/TextformatAWDParser",
    "awayjs-parsers/lib/AWD3BlockParsers/VertexAnimClipAWDParser",
    "__extends",
    "d",
    "b",
    "p",
    "hasOwnProperty",
    "__",
    "constructor",
    "AWDBlockParserBase",
    "VertexAnimator",
    "SkeletonAnimator",
    "AWD3Utils",
    "_super",
    "animSetBlockAdress",
    "targetAnimationSet",
    "cur_block",
    "name",
    "parseVarStr",
    "newBlockBytes",
    "readUnsignedShort",
    "props",
    "parseProperties",
    1,
    "BADDR",
    "readUnsignedInt",
    "targetMeshLength",
    "meshAdresses",
    "activeState",
    "autoplay",
    "readUnsignedByte",
    "parseUserAttributes",
    "returnedArray",
    "targetMeshes",
    "targetMesh",
    "getAssetByID",
    "thisAnimator",
    "skeleton",
    "animator",
    "data",
    "debug",
    "console",
    "log",
    "awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils",
    "awayjs-renderergl/lib/animators/SkeletonAnimator",
    "awayjs-renderergl/lib/animators/VertexAnimator",
    "ByteArray",
    "data_len",
    "url",
    "readUTFBytes",
    "dependencies_urls",
    "readBytes",
    "dependencies_data",
    "state",
    "BLOCKSTATE_LOAD_DEPENDENICES",
    "audioStylesNames",
    "awayjs-core/lib/utils/ByteArray",
    "Billboard",
    "BasicMaterial",
    "data_id",
    "mat",
    "bothSides",
    "billboard",
    "extra",
    "awayjs-display/lib/entities/Billboard",
    "awayjs-display/lib/materials/BasicMaterial",
    "asset",
    "textureStylesNames",
    "BLOCKSTATE_NO_ASSET",
    "id",
    "nameSpaceString",
    "Camera",
    "PerspectiveProjection",
    "OrthographicProjection",
    "OrthographicOffCenterProjection",
    "Vector3D",
    "CameraAWD3Parser",
    "par_id",
    "mtx",
    "parseMatrix3D",
    "parentName",
    "projection",
    "readShort",
    "projectiontype",
    101,
    "propsNrType",
    102,
    103,
    104,
    "camera",
    "transform",
    "matrix3D",
    "parent",
    "addChild",
    "matrixNrType",
    2,
    3,
    4,
    "UINT8",
    "pivot",
    "awayjs-core/lib/geom/Vector3D",
    "awayjs-core/lib/projections/OrthographicOffCenterProjection",
    "awayjs-core/lib/projections/OrthographicProjection",
    "awayjs-core/lib/projections/PerspectiveProjection",
    "awayjs-display/lib/entities/Camera",
    "hasBlocks",
    "parentObject",
    "targetObject",
    "numCommands",
    "typeCommand",
    "targetID",
    "DisplayObjectContainer",
    "ctr",
    "major_version",
    "minor_version",
    "awayjs-display/lib/containers/DisplayObjectContainer",
    "Geometry",
    "CurveSubGeometry",
    "TriangleSubGeometry",
    "geom",
    "num_subs",
    "geoNrType",
    "geoScaleU",
    "geoScaleV",
    "subs_parsed",
    "is_curve_geom",
    "sm_len",
    "sm_end",
    "w_indices",
    "weights",
    "position",
    "subProps",
    "idx",
    "str_ftype",
    "str_type",
    "str_len",
    "str_end",
    "x",
    "y",
    "z",
    "verts",
    "readNumber",
    "accuracyGeo",
    "indices",
    "uvs",
    "normals",
    "idx_pos",
    "idx_curves",
    "idx_uvs",
    "positions",
    "curveData",
    "curve_sub_geom",
    "updateIndices",
    "updatePositions",
    "updateCurves",
    "updateUVs",
    "addSubGeometry",
    "triangle_sub_geom",
    "jointsPerVertex",
    "autoDeriveNormals",
    "autoDeriveUVs",
    "autoDeriveTangents",
    "updateVertexNormals",
    "updateVertexTangents",
    "updateJointWeights",
    "updateJointIndices",
    "scaleU",
    "scaleV",
    "setSubUVs",
    "scaleUV",
    "awayjs-core/lib/data/CurveSubGeometry",
    "awayjs-core/lib/data/Geometry",
    "awayjs-core/lib/data/TriangleSubGeometry",
    "CubeMapShadowMapper",
    "DirectionalShadowMapper",
    "DirectionalLight",
    "PointLight",
    "light",
    "newShadowMapper",
    "lightType",
    "COLOR",
    5,
    6,
    "BOOL",
    7,
    8,
    9,
    10,
    11,
    12,
    "UINT16",
    21,
    22,
    23,
    "shadowMapperType",
    "lightTypes",
    "shadowMapperTypes",
    "radius",
    "fallOff",
    "color",
    "specular",
    "diffuse",
    "ambientColor",
    "ambient",
    "depthMapSize",
    "getDepthSizeFromEnum",
    "shadowMapper",
    "castsShadows",
    "awayjs-display/lib/entities/DirectionalLight",
    "awayjs-display/lib/entities/PointLight",
    "awayjs-display/lib/materials/shadowmappers/CubeMapShadowMapper",
    "awayjs-display/lib/materials/shadowmappers/DirectionalShadowMapper",
    "StaticLightPicker",
    "numLights",
    "lightsArray",
    "k",
    "lightID",
    "returnedArrayLight",
    "lightsArrayNames",
    "lightPicker",
    "toString",
    "awayjs-display/lib/materials/lightpickers/StaticLightPicker",
    "MethodMaterialMode",
    "MethodMaterial",
    "CurveMaterial",
    "DefaultMaterialManager",
    "AmbientEnvMapMethod",
    "DiffuseDepthMethod",
    "DiffuseCelMethod",
    "DiffuseGradientMethod",
    "DiffuseLightMapMethod",
    "DiffuseWrapMethod",
    "NormalSimpleWaterMethod",
    "SpecularFresnelMethod",
    "SpecularAnisotropicMethod",
    "SpecularCelMethod",
    "SpecularPhongMethod",
    "attributes",
    "finalize",
    "num_methods",
    "methods_parsed",
    "normalTexture",
    "specTexture",
    "INT32",
    13,
    "method_type",
    "debugString",
    "tex_addr",
    "texture",
    "getDefaultTexture",
    "alphaThreshold",
    "repeat",
    "UINT32",
    15,
    16,
    17,
    18,
    19,
    20,
    "spezialType",
    "mode",
    "MULTI_PASS",
    "alphaBlending",
    "diftexture",
    "alpha",
    "diffuseTex_addr",
    "diffuseTexture",
    "normalTex_addr",
    "specTex_addr",
    "lightPickerAddr",
    "smooth",
    "mipmap",
    "alphaPremultiplied",
    "blendMode",
    "getBlendModeStringFromEnum",
    "normalMap",
    "specularMap",
    "diffuseColor",
    "gloss",
    "specularColor",
    201,
    202,
    301,
    302,
    401,
    402,
    601,
    602,
    701,
    702,
    801,
    "MTX4x4",
    "fx_method",
    "addEffectMethod",
    "shadow_method",
    "shadowMethod",
    "cubeTex",
    "getDefaultCubeTexture",
    "ambientMethod",
    "diffuseMethod",
    "thisTex",
    "smoothness",
    "specularMethod",
    "fresnelPower",
    "normalReflectance",
    "normalMethod",
    "curve_mat",
    "preserveAlpha",
    "awayjs-display/lib/managers/DefaultMaterialManager",
    "awayjs-display/lib/materials/CurveMaterial",
    "awayjs-methodmaterials/lib/MethodMaterial",
    "awayjs-methodmaterials/lib/MethodMaterialMode",
    "awayjs-methodmaterials/lib/methods/AmbientEnvMapMethod",
    "awayjs-methodmaterials/lib/methods/DiffuseCelMethod",
    "awayjs-methodmaterials/lib/methods/DiffuseDepthMethod",
    "awayjs-methodmaterials/lib/methods/DiffuseGradientMethod",
    "awayjs-methodmaterials/lib/methods/DiffuseLightMapMethod",
    "awayjs-methodmaterials/lib/methods/DiffuseWrapMethod",
    "awayjs-methodmaterials/lib/methods/NormalSimpleWaterMethod",
    "awayjs-methodmaterials/lib/methods/SpecularAnisotropicMethod",
    "awayjs-methodmaterials/lib/methods/SpecularCelMethod",
    "awayjs-methodmaterials/lib/methods/SpecularFresnelMethod",
    "awayjs-methodmaterials/lib/methods/SpecularPhongMethod",
    "Mesh",
    "num_materials",
    "materials_parsed",
    "geoID",
    "materials",
    "materialNames",
    "mat_id",
    "m",
    "mesh",
    "subMeshes",
    "material",
    "Math",
    "min",
    "awayjs-display/lib/entities/Mesh",
    "AWDSTRING",
    "AWDBitFlags",
    "ColorTransform",
    "Matrix3D",
    "TimelineKeyFrame",
    "AddChildAtDepthCommand",
    "ApplyAS2DepthsCommand",
    "ExecuteScriptCommand",
    "RemoveChildrenAtDepthCommand",
    "SetInstanceNameCommand",
    "UpdatePropertyCommand",
    "SetMaskCommand",
    "TextField",
    "AS2SceneGraphFactory",
    "factory",
    "j",
    "c",
    "new_mc",
    "createMovieClip",
    "isScene",
    "sceneID",
    "fps",
    "readFloat",
    "ms_per_frame",
    "num_instances",
    "num_all_display_instances",
    "num_potential_childs",
    "resourceID",
    "cmd_asset",
    "registerPotentialChild",
    "num_potential_childs_multi_instanced",
    "num_potential_sounds",
    "numFrames",
    "totalDuration",
    "frameDuration",
    "numLabels",
    "objectID",
    "target_depth",
    "number_of_obj",
    "commandType",
    "frame",
    "label",
    "hasDepthChanges",
    "setFrameTime",
    "remove_depths",
    "addConstructCommand",
    "potChild",
    "getPotentialChild",
    "isAsset",
    "props_flag",
    "test",
    "FLAG1",
    "thisMatrix",
    "FLAG2",
    "rawData",
    "FLAG3",
    "thisColorTransform",
    "FLAG4",
    "redMultiplier",
    "greenMultiplier",
    "blueMultiplier",
    "alphaMultiplier",
    "redOffset",
    "greenOffset",
    "blueOffset",
    "alphaOffset",
    "FLAG5",
    "blendmode_int",
    "blendmode_string",
    "FLAG6",
    "readByte",
    "FLAG7",
    "instanceName",
    "FLAG8",
    "mask_id_nums",
    "mask_ids",
    "mi_cnt",
    "length_code",
    "frame_code",
    "addFrame",
    "awayjs-core/lib/geom/ColorTransform",
    "awayjs-core/lib/geom/Matrix3D",
    "awayjs-display/lib/entities/TextField",
    "awayjs-parsers/lib/AWD3ParserUtils/AWDBitFlags",
    "awayjs-player/lib/factories/AS2SceneGraphFactory",
    "awayjs-player/lib/timeline/TimelineKeyFrame",
    "awayjs-player/lib/timeline/commands/AddChildAtDepthCommand",
    "awayjs-player/lib/timeline/commands/ApplyAS2DepthsCommand",
    "awayjs-player/lib/timeline/commands/ExecuteScriptCommand",
    "awayjs-player/lib/timeline/commands/RemoveChildrenAtDepthCommand",
    "awayjs-player/lib/timeline/commands/SetInstanceNameCommand",
    "awayjs-player/lib/timeline/commands/SetMaskCommand",
    "awayjs-player/lib/timeline/commands/UpdatePropertyCommand",
    "PrefabBase",
    "PrimitiveCapsulePrefab",
    "PrimitiveConePrefab",
    "PrimitiveCubePrefab",
    "PrimitiveCylinderPrefab",
    "PrimitivePlanePrefab",
    "PrimitiveSpherePrefab",
    "PrimitiveTorusPrefab",
    "prefab",
    "primType",
    "bsm",
    110,
    111,
    303,
    703,
    704,
    "primitiveTypes",
    "topClosed",
    "bottomClosed",
    "yUp",
    "awayjs-display/lib/prefabs/PrefabBase",
    "awayjs-display/lib/prefabs/PrimitiveCapsulePrefab",
    "awayjs-display/lib/prefabs/PrimitiveConePrefab",
    "awayjs-display/lib/prefabs/PrimitiveCubePrefab",
    "awayjs-display/lib/prefabs/PrimitiveCylinderPrefab",
    "awayjs-display/lib/prefabs/PrimitivePlanePrefab",
    "awayjs-display/lib/prefabs/PrimitiveSpherePrefab",
    "awayjs-display/lib/prefabs/PrimitiveTorusPrefab",
    "ShadowDitheredMethod",
    "ShadowFilteredMethod",
    "ShadowHardMethod",
    "ShadowNearMethod",
    "ShadowSoftMethod",
    "shadowLightID",
    "parseShadowMethodList",
    "methodType",
    "shadow_meth",
    "epsilon",
    "range",
    "awayjs-methodmaterials/lib/methods/ShadowDitheredMethod",
    "awayjs-methodmaterials/lib/methods/ShadowFilteredMethod",
    "awayjs-methodmaterials/lib/methods/ShadowHardMethod",
    "awayjs-methodmaterials/lib/methods/ShadowNearMethod",
    "awayjs-methodmaterials/lib/methods/ShadowSoftMethod",
    "EffectColorMatrixMethod",
    "EffectColorTransformMethod",
    "EffectFogMethod",
    "EffectRimLightMethod",
    "parseSharedMethodList",
    "effectMethodReturn",
    105,
    106,
    107,
    "offCol",
    "colorTransform",
    "awayjs-methodmaterials/lib/methods/EffectColorMatrixMethod",
    "awayjs-methodmaterials/lib/methods/EffectColorTransformMethod",
    "awayjs-methodmaterials/lib/methods/EffectFogMethod",
    "awayjs-methodmaterials/lib/methods/EffectRimLightMethod",
    "Skeleton",
    "SkeletonJoint",
    "num_joints",
    "joints_parsed",
    "joint",
    "ibp",
    "parentIndex",
    "inverseBindPose",
    "joints",
    "awayjs-renderergl/lib/animators/data/Skeleton",
    "awayjs-renderergl/lib/animators/data/SkeletonJoint",
    "SkeletonClipNode",
    "frame_dur",
    "pose_addr",
    "clip",
    "num_frames",
    "frames_parsed",
    "skel_pose",
    "getBlockByID",
    "frames",
    "awayjs-renderergl/lib/animators/nodes/SkeletonClipNode",
    "SkeletonPose",
    "JointPose",
    "pose",
    "joint_pose",
    "has_transform",
    "mtx_data",
    "parseMatrix43RawData",
    "orientation",
    "fromMatrix",
    "translation",
    "copyFrom",
    "jointPoses",
    "awayjs-renderergl/lib/animators/data/JointPose",
    "awayjs-renderergl/lib/animators/data/SkeletonPose",
    "Skybox",
    "cubeTexAddr",
    "cube_tex",
    "new_skybox",
    "awayjs-display/lib/entities/Skybox",
    "Font",
    "new_font",
    "font_style_cnt",
    "font_style_name",
    "new_font_style",
    "get_font_table",
    "set_font_em_size",
    "font_style_char_cnt",
    "font_style_char",
    "set_subgeo_for_char",
    "awayjs-display/lib/text/Font",
    "TextFormat",
    "newTextField",
    "createTextField",
    "text_field_type",
    "displayAsPassword",
    "width",
    "height",
    "num_paragraphs",
    "complete_text",
    "text_format",
    "paracnt",
    "num_textruns",
    "textrun_cnt",
    "format_id",
    "textFormat",
    "txt_length",
    "this_txt",
    "text",
    "selectable",
    "border",
    "awayjs-display/lib/text/TextFormat",
    "newTextFormat",
    "font_id",
    "font",
    "font_name",
    "font_table",
    "font_style",
    "num_uv_values",
    "uv_values",
    "uvcnt",
    "uv_value",
    "format_props",
    "size",
    "letterSpacing",
    "kerning",
    "indent",
    "leftMargin",
    "rightMargin",
    "VertexClipNode",
    "poseOnly",
    "num_submeshes",
    "subMeshParsed",
    "geometry",
    "subGeom",
    "num_Streams",
    "streamsParsed",
    "streamtypes",
    "thisGeo",
    "geoAdress",
    "getUVForVertexAnimation",
    "looping",
    "stitchFinalFrame",
    "subGeometries",
    "awayjs-renderergl/lib/animators/nodes/VertexClipNode",
    "awayjs-parsers/lib/AWD3BlockParsers/VertexAnimationSetAWDParser",
    "VertexAnimationSet",
    "SkeletonAnimationSet",
    "VertexAnimationSetAWDParser",
    "poseBlockAdress",
    "outputString",
    "skeletonFrames",
    "vertexFrames",
    "animNode",
    "newVertexAnimationSet",
    "addAnimation",
    "animations",
    "animationNames",
    "newSkeletonAnimationSet",
    "awayjs-renderergl/lib/animators/SkeletonAnimationSet",
    "awayjs-renderergl/lib/animators/VertexAnimationSet",
    "awayjs-parsers/lib/AWD3ParserUtils/AWD3FileData",
    "BlendMode",
    "BitmapCubeTexture",
    "TextureBase",
    "MaterialBase",
    "AWDProperties",
    "AWDBlock",
    "AWD3FileData",
    "_debug",
    "_accuracyOnBlocks",
    "_blocks",
    "blendModeDic",
    "NORMAL",
    "ADD",
    "ALPHA",
    "DARKEN",
    "DIFFERENCE",
    "ERASE",
    "HARDLIGHT",
    "INVERT",
    "LAYER",
    "LIGHTEN",
    "MULTIPLY",
    "OVERLAY",
    "SCREEN",
    "SHADER",
    "_depthSizeDic",
    "depthSize",
    "blendmode",
    "dispose",
    "_accuracyMatrix",
    "new_accuracyMatrix",
    "_accuracyProps",
    "new_accuracyProps",
    "_accuracyGeo",
    "new_accuracyGeo",
    "_matrixNrType",
    "newmatrixNrType",
    "_propsNrType",
    "new_props_nr",
    "_geoNrType",
    "new_geoNrType",
    "_newBlockBytes",
    "new_newBlockBytes",
    "create_new_block",
    "new_block",
    "_cur_block",
    "block_cnt",
    "list_len",
    "attibuteCnt",
    "list_end",
    "ns_id",
    "attr_key",
    "attr_type",
    "attr_len",
    "attr_val",
    "INT8",
    "INT16",
    "readInt",
    "FLOAT32",
    "FLOAT64",
    "readDouble",
    "expected",
    "propertyCnt",
    "len",
    "key",
    "parseAttrValue",
    "elem_len",
    "read_func",
    "VECTOR2x1",
    "VECTOR3x1",
    "VECTOR4x1",
    "MTX3x2",
    "MTX3x3",
    "MTX4x3",
    "list",
    "num_read",
    "num_elems",
    "apply",
    "val",
    "meshID",
    "uvsForVertexAnimation",
    "geoCnt",
    "ud",
    "uStride",
    "uOffs",
    "numPoints",
    "newUvs",
    "sub_geom",
    "numVertices",
    "getStride",
    "UV_DATA",
    "getOffset",
    "assetID",
    "getDefaultAsset",
    "assetType",
    "extraTypeInfo",
    "getDefaultMaterial",
    "_defaultCubeTexture",
    "defaultBitmap",
    "createCheckeredBitmapData",
    "precision",
    "parseMatrix32RawData",
    "mtx_raw",
    "isNaN",
    "awayjs-core/lib/data/BlendMode",
    "awayjs-core/lib/textures/BitmapCubeTexture",
    "awayjs-core/lib/textures/TextureBase",
    "awayjs-display/lib/materials/MaterialBase",
    "awayjs-parsers/lib/AWD3ParserUtils/AWDBlock",
    "awayjs-parsers/lib/AWD3ParserUtils/AWDProperties",
    "BLOCKSTATE_FINALIZE",
    "BLOCKSTATE_INVALID",
    "COMPRESSIONMODE_LZMA",
    "UNCOMPRESSED",
    "DEFLATE",
    "LZMA",
    "AWDBYTEARRAY",
    "flags",
    "testFlag",
    "FLAG9",
    "FLAG10",
    "FLAG11",
    "FLAG12",
    "FLAG13",
    "FLAG14",
    "FLAG15",
    "FLAG16",
    "this_id",
    "this_type",
    "loaded_dependencies",
    "loaded_dependencies_cnt",
    "bytes",
    "errorMessages",
    "addError",
    "errorMsg",
    "value",
    "fallback",
    "awayjs-parsers/lib/AWD3Parser",
    "URLLoaderDataFormat",
    "URLRequest",
    "ParserBase",
    "ParserUtils",
    "ImageCubeTexture",
    "AWDAssetParsers",
    "AWD3Parser",
    "ARRAY_BUFFER",
    "_startedParsing",
    "_parsed_header",
    "total_time",
    "geom_time",
    "timeline_time",
    "_block_parser",
    "_awd_data",
    "supportsType",
    "extension",
    "toLowerCase",
    "supportsData",
    "_iResolveDependency",
    "resourceDependency",
    "assets",
    "this_block",
    "parseInt",
    "testure_asset",
    "_pFinalizeAsset",
    "sub_id",
    "posX",
    "negX",
    "posY",
    "negY",
    "posZ",
    "negZ",
    "cube_tex_asset",
    "_iResolveDependencyFailure",
    "_iResolveDependencyName",
    "oldName",
    "block",
    "resetAssetPath",
    "newName",
    "_pProceedParsing",
    "_byteData",
    "_pGetByteData",
    "parseHeader",
    "_compression",
    "_pDieWithError",
    "_body",
    "getBytesAvailable",
    "parsingPaused",
    "parseNextBlock",
    "PARSING_DONE",
    "MORE_TO_PARSE",
    "_pStartParsing",
    "frameLimit",
    "_pContent",
    "block_id",
    "ns",
    "block_type",
    "blockCompression",
    "blockCompressionLZMA",
    "accuracyOnBlocks",
    "accuracyMatrix",
    "accuracyProps",
    "blockEndAll",
    "time_start",
    "performance",
    "now",
    "_pAddDependency",
    "byteArrayToImage",
    "_pPauseAndRetrieveDependencies",
    "time_end",
    "thisTime",
    "body_len",
    "_streaming",
    "awayjs-core/lib/net/URLLoaderDataFormat",
    "awayjs-core/lib/net/URLRequest",
    "awayjs-core/lib/parsers/ParserBase",
    "awayjs-core/lib/parsers/ParserUtils",
    "awayjs-core/lib/textures/ImageCubeTexture",
    "awayjs-parsers/lib/AWDParser",
    "ImageTexture",
    "AnimationNodeBase",
    "LightBase",
    "LightPickerBase",
    "AnimationSetBase",
    "EffectAlphaMaskMethod",
    "EffectEnvMapMethod",
    "EffectFresnelEnvMapMethod",
    "EffectLightMapMethod",
    "EffectMethodBase",
    "ShadowMapMethodBase",
    "AWDParser",
    "_texture_users",
    "_version",
    "isCubeTextureArray",
    "split",
    "ressourceID",
    "thisBitmapTexture",
    "users",
    "tx",
    "_cubeTextures",
    "htmlImageElement",
    "assetData",
    "isParsed",
    "_cur_block_id",
    "BitFlags",
    "blockEndBlock",
    "parseMeshLibraryBlock",
    "parseBillBoardLibraryBlock",
    "parseAudioBlock",
    "parseTimeLine",
    "paresTextField",
    "parseTesselatedFont",
    "parseTextFormat",
    "parsePrimitves",
    "parseSkyboxInstance",
    "parseLight",
    "parseCamera",
    "parseLightPicker",
    "parseMaterial_v1",
    "parseCubeTexture",
    "parseSharedMethodBlock",
    "parseShadowMethodBlock",
    "parseMeshPoseAnimation",
    "parseVertexAnimationSet",
    "parseAnimatorSet",
    "parseCommand",
    "parseTriangleGeometrieBlock",
    "parseContainer",
    "parseMeshInstance",
    "parseMaterial",
    "parseTexture",
    "parseSkeleton",
    "parseSkeletonPose",
    "parseSkeletonAnimation",
    "parseNameSpace",
    "parseMetaData",
    "msgCnt",
    "blockID",
    "returnArrayFont",
    "returnedArrayMaterial",
    "textFormatArray",
    "returnedArrayGeometry",
    "extras",
    "timeLineContainer",
    "obj",
    "returnedArrayParent",
    "objC",
    "returnedArrayCubeTex",
    "lightPick",
    "materialMode",
    "returnedArrayTarget",
    "assetTypesToGet",
    "returnArray",
    "typeCnt",
    "iasset",
    "awayjs-core/lib/textures/ImageTexture",
    "awayjs-display/lib/animators/nodes/AnimationNodeBase",
    "awayjs-display/lib/base/LightBase",
    "awayjs-display/lib/materials/lightpickers/LightPickerBase",
    "awayjs-methodmaterials/lib/methods/EffectAlphaMaskMethod",
    "awayjs-methodmaterials/lib/methods/EffectEnvMapMethod",
    "awayjs-methodmaterials/lib/methods/EffectFresnelEnvMapMethod",
    "awayjs-methodmaterials/lib/methods/EffectLightMapMethod",
    "awayjs-methodmaterials/lib/methods/EffectMethodBase",
    "awayjs-methodmaterials/lib/methods/ShadowMapMethodBase",
    "awayjs-renderergl/lib/animators/AnimationSetBase",
    "awayjs-parsers/lib/MD2Parser",
    "MD2Parser",
    "textureType",
    "ignoreTexturePath",
    "_clipNodes",
    "_animationSet",
    "materialFinal",
    "geoCreated",
    "_textureType",
    "_ignoreTexturePath",
    "_mesh",
    "_pHasTime",
    "_parsedHeader",
    "_geometry",
    "parseMaterialNames",
    "_parsedUV",
    "parseUV",
    "_parsedFaces",
    "parseFaces",
    "_parsedFrames",
    "parseFrames",
    "_firstSubGeom",
    "clone",
    "_ident",
    "_skinWidth",
    "_skinHeight",
    "_numSkins",
    "_numVertices",
    "_numST",
    "_numTris",
    "_numFrames",
    "_offsetSkins",
    "_offsetST",
    "_offsetTris",
    "_offsetFrames",
    "_offsetEnd",
    "extIndex",
    "slashIndex",
    "_materialNames",
    "regExp",
    "RegExp",
    "replace",
    "lastIndexOf",
    "indexOf",
    "substring",
    "dependencies",
    "_uvs",
    "ta",
    "tb",
    "tc",
    "_vertIndices",
    "_uvIndices",
    "_indices",
    "addIndex",
    "_finalUV",
    "vertexIndex",
    "uvIndex",
    "index",
    "findIndex",
    "sx",
    "sy",
    "sz",
    "ty",
    "tz",
    "vertLen",
    "fvertices",
    "tvertices",
    "prevClip",
    "readFrameName",
    "vertexNormals",
    "vertexTangents",
    "FPS",
    "ch",
    "floor",
    "String",
    "fromCharCode",
    "awayjs-parsers/lib/MD5AnimParser",
    "Quaternion",
    "MD5AnimParser",
    "additionalRotationAxis",
    "additionalRotationRadians",
    "TEXT",
    "_parseIndex",
    "_line",
    "_charLineIndex",
    "_rotationQuat",
    "t1",
    "t2",
    "fromAxisAngle",
    "X_AXIS",
    "PI",
    "Y_AXIS",
    "multiply",
    "token",
    "_textData",
    "_pGetTextData",
    "getNextToken",
    "COMMENT_TOKEN",
    "ignoreLine",
    "VERSION_TOKEN",
    "getNextInt",
    "COMMAND_LINE_TOKEN",
    "parseCMD",
    "NUM_FRAMES_TOKEN",
    "_bounds",
    "_frameData",
    "NUM_JOINTS_TOKEN",
    "_numJoints",
    "_hierarchy",
    "_baseFrameData",
    "FRAME_RATE_TOKEN",
    "_frameRate",
    "NUM_ANIMATED_COMPONENTS_TOKEN",
    "_numAnimatedComponents",
    "HIERARCHY_TOKEN",
    "parseHierarchy",
    "BOUNDS_TOKEN",
    "parseBounds",
    "BASE_FRAME_TOKEN",
    "parseBaseFrame",
    "FRAME_TOKEN",
    "parseFrame",
    "_reachedEOF",
    "sendUnknownKeywordError",
    "_clip",
    "translateClip",
    "translatePose",
    "frameData",
    "hierarchy",
    "base",
    "translate",
    "components",
    "skelPose",
    "startIndex",
    "w",
    "sqrt",
    "rotatePoint",
    "sendEOFError",
    "HierarchyData",
    "parseLiteralstring",
    "getNextChar",
    "putBack",
    "BoundsData",
    "parseVector3D",
    "max",
    "BaseFrameData",
    "parseQuaternion",
    "frameIndex",
    "FrameData",
    "getNextNumber",
    "skipWhiteSpace",
    "charAt",
    "sendParseError",
    "parseFloat",
    "vec",
    "quat",
    "str",
    "awayjs-core/lib/geom/Quaternion",
    "awayjs-parsers/lib/MD5MeshParser",
    "MD5MeshParser",
    "_bindPoses",
    "NUM_MESHES_TOKEN",
    "_numMeshes",
    "JOINTS_TOKEN",
    "parseJoints",
    "MESH_TOKEN",
    "parseMesh",
    "calculateMaxJointCount",
    "_maxJointCount",
    "_meshData",
    "translateGeom",
    "vertexData",
    "weightData",
    "_skeleton",
    "numMeshData",
    "meshData",
    "numVerts",
    "zeroWeights",
    "countZeroWeightJoints",
    "totalJoints",
    "countWeight",
    "vertex",
    "start",
    "startWeight",
    "end",
    "count",
    "weight",
    "bias",
    "pos",
    "toMatrix3D",
    "appendTranslation",
    "inv",
    "invert",
    "_shaders",
    "MESH_SHADER_TOKEN",
    "MESH_NUM_VERTS_TOKEN",
    "MESH_NUM_TRIS_TOKEN",
    "MESH_NUM_WEIGHTS_TOKEN",
    "MESH_VERT_TOKEN",
    "parseVertex",
    "MESH_TRI_TOKEN",
    "parseTri",
    "MESH_WEIGHT_TOKEN",
    "parseJoint",
    "MeshData",
    "v1",
    "v2",
    "v3",
    "bindPose",
    "vertices",
    "jointIndices",
    "jointWeights",
    "nonZeroWeights",
    "transformVector",
    "JointData",
    "VertexData",
    "rotQuat",
    "awayjs-parsers/lib/Max3DSParser",
    "Max3DSParser",
    "useSmoothingGroups",
    "_useSmoothingGroups",
    "ba",
    "toByteArray",
    "tex",
    "_textures",
    "_materials",
    "_unfinalized_objects",
    "_cur_mat",
    "_cur_mat_end",
    "finalizeCurrentMaterial",
    "_cur_obj",
    "_cur_obj_end",
    "Number",
    "MAX_VALUE",
    "cid",
    "ObjectVO",
    "readNulTermstring",
    "materialFaces",
    "parseVertexList",
    "parseFaceList",
    "parseUVList",
    "parseFaceMaterialList",
    "readTransform",
    "parseObjectAnimation",
    "parseSmoothingGroups",
    "constructObject",
    "MaterialVO",
    "readColor",
    "twoSided",
    "colorMap",
    "TextureVO",
    "i0",
    "i1",
    "i2",
    "smoothingGroups",
    "faces",
    "vo",
    "hier",
    "sub",
    "prepareData",
    "applySmoothGroups",
    "v",
    "mname",
    "dat",
    "concat",
    "scaleBy",
    "applyTransformation",
    "VertexVO",
    "FaceVO",
    "smoothGroup",
    "numFaces",
    "vGroups",
    "face",
    "groups",
    "group",
    "splice",
    "vClones",
    "clones",
    "v0",
    "chr",
    "g",
    "awayjs-parsers/lib/OBJParser",
    "SpecularBasicMethod",
    "OBJParser",
    "scale",
    "_mtlLibLoaded",
    "_activeMaterialID",
    "_scale",
    "content",
    "hasV",
    "hasF",
    "parseMtl",
    "lm",
    "LoadedMaterial",
    "materialID",
    "_materialLoaded",
    "_meshes",
    "applyMaterial",
    "_mtlLib",
    "line",
    "creturn",
    "trunk",
    "_vertices",
    "_vertexNormals",
    "_materialIDs",
    "_stringLength",
    "_charIndex",
    "_oldIndex",
    "_objects",
    "_objectIndex",
    "join",
    "parseLine",
    "applyMaterials",
    "loadMtl",
    "createGroup",
    "createObject",
    "_currentGroup",
    "parseVertexNormal",
    "parseFace",
    "objIndex",
    "numGroups",
    "materialGroups",
    "numMaterialGroups",
    "sm",
    "bmMaterial",
    "translateMaterialGroup",
    "_lastMtlID",
    "materialGroup",
    "_realIndices",
    "_vertexIndex",
    "indexIds",
    "translateVertexData",
    "vertexNormal",
    "uv",
    "vertexIndices",
    "normalIndices",
    "uvIndices",
    "_currentMaterialGroup",
    "_currentObject",
    "ObjectGroup",
    "Group",
    "createMaterialGroup",
    "MaterialGroup",
    "nTrunk",
    "Vertex",
    "UV",
    "FaceData",
    "parseIndex",
    "materialDefinitions",
    "lines",
    "basicSpecularMethod",
    "useSpecular",
    "useColor",
    "mapkd",
    "charCodeAt",
    "parseMapKdString",
    "specularData",
    "SpecularData",
    "_materialSpecularData",
    "cm",
    "colorMat",
    "colorMultiMat",
    "breakflag",
    "mtlurl",
    "decomposeID",
    "tm",
    "_u",
    "_v",
    "_x",
    "_y",
    "_z",
    "_index",
    "ind",
    "awayjs-methodmaterials/lib/methods/SpecularBasicMethod",
    "awayjs-parsers/lib/Parsers",
    "AssetLoader",
    "Parsers",
    "enableAllBundled",
    "enableParsers",
    "ALL_BUNDLED",
    "awayjs-core/lib/library/AssetLoader"
  ],
  "mappings": "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",
  "file": "awayjs-parsers.min.js",
  "sourcesContent": [
    "(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})",
    "\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDProperties\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\nimport AWD3FileData\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3FileData\");\r\n\r\n\r\nclass AWDAssetParserBase\r\n{\r\n\r\n\tprivate _awd_file_data:AWD3FileData;\r\n\tconstructor()\r\n\t{\r\n\t}\r\n\r\n\r\n\tpublic get awd_file_data():AWD3FileData\r\n\t{\r\n\t\treturn this._awd_file_data;\r\n\t}\r\n\tpublic set awd_file_data(awd_file_data:AWD3FileData)\r\n\t{\r\n\t\tthis._awd_file_data=awd_file_data;\r\n\t}\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\t\tthrow new AbstractMethodError();\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport = AWDAssetParserBase;\r\n\r\n",
    null,
    "\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\n\r\nimport AWDAssetParserBase\t\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWD3FileData \t\t\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3FileData\");\r\n\r\nimport GeometryAWDParser \t\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/GeometryAWDParser\");\r\nimport PrefabAWDParser \t\t\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/PrefabAWDParser\");\r\nimport DisplayObjectContainerAWDParser \t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/DisplayObjectContainerAWDParser\");\r\nimport MeshAWDParser \t\t\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/MeshAWDParser\");\r\nimport BillboardAWDParser \t\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/BillboardAWDParser\");\r\nimport BitmapTextureAWDParser \t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/BitmapTextureAWDParser\");\r\nimport CameraAWDParser \t\t\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/CameraAWDParser\");\r\nimport CubeTextureAWDParser \t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/CubeTextureAWDParser\");\r\nimport LightAWDParser \t\t\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/LightAWDParser\");\r\nimport LightPickerAWDParser \t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/LightPickerAWDParser\");\r\nimport MaterialAWDParser \t\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/MaterialAWDParser\");\r\nimport MovieClipAWDParser \t\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/MovieClipAWDParser\");\r\nimport ShadowMethodAWDParser \t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/ShadowMethodAWDParser\");\r\nimport SharedMethodAWDParser \t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/SharedMethodAWDParser\");\r\nimport SkeletonAnimClipAWDParser \t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/SkeletonAnimClipAWDParser\");\r\nimport SkeletonAWDParser \t\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/SkeletonAWDParser\");\r\nimport SkeletonPoseAWDParser \t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/SkeletonPoseAWDParser\");\r\nimport SkyboxAWDParser \t\t\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/SkyboxAWDParser\");\r\nimport TesselatedFontAWDParser \t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/TesselatedFontAWDParser\");\r\nimport TextfieldAWDParser \t\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/TextfieldAWDParser\");\r\nimport TextformatAWDParser \t\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/TextformatAWDParser\");\r\nimport VertexAnimationSetAWDParser \t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/VertexAnimationSetAWDParser\");\r\nimport VertexAnimClipAWDParser \t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/VertexAnimClipAWDParser\");\r\nimport CommandAWDParser \t\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/CommandAWDParser\");\r\nimport MetadataAWDParser \t\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/MetadataAWDParser\");\r\nimport BlockNameSpaceAWDParser \t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/BlockNameSpaceAWDParser\");\r\nimport AnimatorAWDParser \t\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AnimatorAWDParser\");\r\nimport AudioAWDParser \t\t\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AudioAWDParser\");\r\n\r\n\r\n\r\nclass AWDBlockParsers\r\n{\r\n\r\n\tprivate _supported_asset_blocks:Object = {};\r\n\tprivate _all_block_parsers:Array<AWDAssetParserBase>;\r\n\tconstructor()\r\n\t{\r\n\t\tthis._all_block_parsers=new Array<AWDAssetParserBase>();\r\n\r\n\t\tthis.add_block_parser(new GeometryAWDParser(), [1]);\r\n\t\tthis.add_block_parser(new PrefabAWDParser(), [11]);\r\n\t\tthis.add_block_parser(new DisplayObjectContainerAWDParser(), [22]);\r\n\t\tthis.add_block_parser(new MeshAWDParser(), [23, 24]);\r\n\r\n\t\tthis.add_block_parser(new BillboardAWDParser(), [25]);\r\n\t\tthis.add_block_parser(new SkyboxAWDParser(), [31]);\r\n\t\tthis.add_block_parser(new LightAWDParser(), [41]);\r\n\t\tthis.add_block_parser(new CameraAWDParser(), [42]);\r\n\t\t//this.add_block_parser(new TextureprojectorAWDParser(), [43]);\r\n\t\tthis.add_block_parser(new AudioAWDParser(), [44]);\r\n\t\tthis.add_block_parser(new LightPickerAWDParser(), [51]);\r\n\t\tthis.add_block_parser(new MaterialAWDParser(), [81]);\r\n\t\tthis.add_block_parser(new BitmapTextureAWDParser(), [82]);\r\n\t\tthis.add_block_parser(new CubeTextureAWDParser(), [83]);\r\n\t\tthis.add_block_parser(new SharedMethodAWDParser(), [91]);\r\n\t\tthis.add_block_parser(new ShadowMethodAWDParser(), [92]);\r\n\t\tthis.add_block_parser(new SkeletonAWDParser(), [101]);\r\n\t\tthis.add_block_parser(new SkeletonPoseAWDParser(), [102]);\r\n\t\tthis.add_block_parser(new SkeletonAnimClipAWDParser(), [103]);\r\n\t\tthis.add_block_parser(new SharedMethodAWDParser(), [111, 112]);\r\n\t\tthis.add_block_parser(new VertexAnimClipAWDParser(), [113]);\r\n\t\t//this.add_block_parser(new UVAnimationClipAWDParser(), [121]);\r\n\t\tthis.add_block_parser(new AnimatorAWDParser(), [122]);\r\n\t\tthis.add_block_parser(new MovieClipAWDParser(), [133]);\r\n\t\tthis.add_block_parser(new TextfieldAWDParser(), [134]);\r\n\t\tthis.add_block_parser(new TesselatedFontAWDParser(), [135]);\r\n\t\tthis.add_block_parser(new TextformatAWDParser(), [136]);\r\n\r\n\r\n\t\tthis.add_block_parser(new CommandAWDParser(), [253]);\r\n\t\tthis.add_block_parser(new MetadataAWDParser(), [254]);\r\n\t\tthis.add_block_parser(new BlockNameSpaceAWDParser(), [255]);\r\n\r\n\r\n\t}\r\n\r\n\tpublic add_block_parser(block_parser:AWDAssetParserBase, block_types:Array<number>):void\r\n\t{\r\n\t\tfor(var i:number=0; i<block_types.length;i++){\r\n\t\t\tthis._supported_asset_blocks[block_types[i]]  = block_parser;\r\n\t\t}\r\n\t\tthis._all_block_parsers.push(block_parser);\r\n\r\n\t}\r\n\r\n\tpublic init_parser(file_data:AWD3FileData):void\r\n\t{\r\n\t\tfor(var i:number=0; i<this._all_block_parsers.length;i++){\r\n\t\t\tthis._all_block_parsers[i].awd_file_data=file_data;\r\n\t\t}\r\n\r\n\t}\r\n\tpublic parseAsset(type:number):boolean\r\n\t{\r\n\r\n\t\tvar this_parser:AWDAssetParserBase=this._supported_asset_blocks[type];\r\n\t\tif(this_parser!=undefined){\r\n\t\t\tthis_parser.parseFromBytes();\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n}\r\n\r\nexport = AWDBlockParsers;",
    "/**\r\n * Created by 80prozent on 4/18/2015.\r\n */\r\n\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDBlockParserBase\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\n\r\nimport Mesh\t\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Mesh\");\r\nimport AnimationSetBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimationSetBase\");\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport VertexAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/VertexAnimationSet\");\r\nimport VertexAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/VertexAnimator\");\r\nimport SkeletonAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/SkeletonAnimationSet\");\r\nimport SkeletonAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/SkeletonAnimator\");\r\nimport Skeleton\t\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/Skeleton\");\r\nimport AWD3Utils\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\nclass AnimatorAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\t\tvar animSetBlockAdress:number; /*int*/\r\n\t\tvar targetAnimationSet:AnimationSetBase;\r\n\t\tthis.awd_file_data.cur_block.name = this.awd_file_data.parseVarStr();\r\n\t\tvar type:number /*uint*/ = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\r\n\t\tvar props:AWDProperties = this.awd_file_data.parseProperties({1:AWD3Utils.BADDR});\r\n\r\n\t\tanimSetBlockAdress = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\tvar targetMeshLength:number /*uint*/ = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\tvar meshAdresses:Array<number> /*uint*/ = new Array<number>() /*uint*/;\r\n\t\tfor (var i:number /*int*/ = 0; i < targetMeshLength; i++)\r\n\t\t\tmeshAdresses.push(this.awd_file_data.newBlockBytes.readUnsignedInt());\r\n\r\n\t\tvar activeState:number /*uint*/ = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\tvar autoplay:boolean = ( this.awd_file_data.newBlockBytes.readUnsignedByte() == 1 );\r\n\t\tthis.awd_file_data.parseUserAttributes();\r\n\t\tthis.awd_file_data.parseUserAttributes();\r\n\r\n\t\tvar returnedArray:Array<any>;\r\n\t\tvar targetMeshes:Array<Mesh> = new Array<Mesh>();\r\n\r\n\t\tfor (i = 0; i < meshAdresses.length; i++) {\r\n\t\t\tvar targetMesh:Mesh = <Mesh>this.awd_file_data.getAssetByID(meshAdresses[i]);\r\n\t\t\tif (targetMesh!=undefined)\r\n\t\t\t\ttargetMeshes.push(targetMesh);\r\n\t\t}\r\n\t\tvar targetAnimationSet:AnimationSetBase = <AnimationSetBase>this.awd_file_data.getAssetByID(animSetBlockAdress);\r\n\t\tif (targetAnimationSet==undefined) {\r\n\t\t\t//this.awd_file_data._blocks[blockID].addError(\"Could not find the AnimationSet ( \" + animSetBlockAdress + \" ) for this.awd_file_data Animator\");\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\t\tvar thisAnimator:AnimatorBase;\r\n\t\tif (type == 1) {\r\n\r\n\t\t\tvar skeleton:Skeleton = <Skeleton>this.awd_file_data.getAssetByID(props.get(1, 0));\r\n\t\t\tif (skeleton==undefined) {\r\n\t\t\t\t//this.awd_file_data._blocks[blockID].addError(\"Could not find the Skeleton ( \" + props.get(1, 0) + \" ) for this.awd_file_data Animator\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthisAnimator = new SkeletonAnimator(<SkeletonAnimationSet> targetAnimationSet, <Skeleton> returnedArray[1]);\r\n\r\n\t\t} else if (type == 2)\r\n\t\t\tthisAnimator = new VertexAnimator(<VertexAnimationSet> targetAnimationSet);\r\n\r\n\t\tfor (i = 0; i < targetMeshes.length; i++) {\r\n\t\t\tif (type == 1)\r\n\t\t\t\ttargetMeshes[i].animator = (<SkeletonAnimator> thisAnimator);\r\n\t\t\tif (type == 2)\r\n\t\t\t\ttargetMeshes[i].animator = (<VertexAnimator> thisAnimator);\r\n\t\t}\r\n\t\tthis.awd_file_data.cur_block.data = thisAnimator;\r\n\t\tif (this.awd_file_data.debug)\r\n\t\t\tconsole.log(\"Parsed a Animator: Name = \" + this.awd_file_data.cur_block.name);\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport = AnimatorAWDParser;",
    "\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDBlockParserBase\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\nimport AWD3Utils\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\n\r\nclass AudioAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\r\n\t\tthis.awd_file_data.cur_block.name = this.awd_file_data.parseVarStr();\r\n\r\n\t\tvar type:number = this.awd_file_data.newBlockBytes.readUnsignedByte();\r\n\t\tvar data_len:number;\r\n\r\n\t\t//this.awd_file_data._texture_users[this.awd_file_data._cur_block_id.toString()] = [];\r\n\r\n\t\t// External\r\n\t\tif (type == 0) {\r\n\t\t\tdata_len = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t\tvar url:string;\r\n\t\t\turl = this.awd_file_data.newBlockBytes.readUTFBytes(data_len);\r\n\t\t\tthis.awd_file_data.cur_block.dependencies_urls.push(url);\r\n\t\t\t//this.awd_file_data._pAddDependency(this.awd_file_data.cur_block.id.toString(), new URLRequest(url), false, null, true);\r\n\r\n\t\t} else {\r\n\t\t\tdata_len = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\r\n\t\t\tvar data:ByteArray;\r\n\t\t\tdata = new ByteArray();\r\n\t\t\tthis.awd_file_data.newBlockBytes.readBytes(data, 0, data_len);\r\n\t\t\tthis.awd_file_data.cur_block.dependencies_data.push(data);\r\n\r\n\t\t\t//\r\n\t\t\t// AWD3Parserutils - Fix for FireFox Bug: https://bugzilla.mozilla.org/show_bug.cgi?id=715075 .\r\n\t\t\t//\r\n\t\t\t// Converting data to image here instead of parser - fix FireFox bug where image width / height is 0 when created from data\r\n\t\t\t// This gives the browser time to initialise image width / height.\r\n\r\n\t\t\t//this.awd_file_data._pAddDependency(this.awd_file_data._cur_block_id.toString(), null, false, ParserUtils.byteArrayToImage(data), true);\r\n\t\t\t//this.awd_file_data._pAddDependency(this.awd_file_data._cur_block_id.toString(), null, false, data, true);\r\n\r\n\t\t}\r\n\t\tthis.awd_file_data.cur_block.state=AWD3Utils.BLOCKSTATE_LOAD_DEPENDENICES;\r\n\t\t// Ignore for now\r\n\t\tthis.awd_file_data.parseProperties(null);\r\n\t\tthis.awd_file_data.parseUserAttributes();\r\n\t\t//this.awd_file_data._pPauseAndRetrieveDependencies();\r\n\r\n\t\tif (this.awd_file_data.debug) {\r\n\t\t\tvar audioStylesNames:Array<string> = [\"external\", \"embed\"]\r\n\t\t\tconsole.log(\"Start parsing a \" + audioStylesNames[type] + \" AudioFile\");\r\n\t\t}\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport = AudioAWDParser;",
    "\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDBlockParserBase\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\n\r\n\r\nimport MaterialBase\t\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\r\nimport Billboard\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Billboard\");\r\nimport BasicMaterial\t\t\t\t\t= require(\"awayjs-display/lib/materials/BasicMaterial\");\r\n\r\nclass BillboardAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\t\tthis.awd_file_data.cur_block.name = this.awd_file_data.parseVarStr();\r\n\r\n\t\tvar data_id:number = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\tvar mat:MaterialBase= <MaterialBase> this.awd_file_data.getAssetByID(data_id);\r\n\r\n\t\tif (mat==undefined) {\r\n\t\t\tmat = new BasicMaterial();\r\n\t\t}\r\n\t\tmat.bothSides=true;\r\n\t\tvar billboard:Billboard = new Billboard(mat);\r\n\t\tthis.awd_file_data.cur_block.data = billboard;\r\n\t\t// todo: optional matrix etc can be put in properties.\r\n\t\tthis.awd_file_data.parseProperties(null);\r\n\r\n\t\tbillboard.extra = this.awd_file_data.parseUserAttributes();\r\n\r\n\r\n\t\tif (this.awd_file_data.debug) {\r\n\t\t\tconsole.log(\"Parsed a Library-Billboard: Name = '\" + billboard.name + \"| Material-Name = \" + mat.name);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport = BillboardAWDParser;",
    "\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDBlockParserBase\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\nimport AWD3Utils\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\nimport Texture2DBase\t\t\t\t\t= require(\"awayjs-core/lib/textures/Texture2DBase\");\r\n\r\nclass BitmapTextureAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\r\n\t\tvar asset:Texture2DBase;\r\n\r\n\t\tthis.awd_file_data.cur_block.name = this.awd_file_data.parseVarStr();\r\n\r\n\t\tvar type:number = this.awd_file_data.newBlockBytes.readUnsignedByte();\r\n\t\tvar data_len:number;\r\n\r\n\t\t//this.awd_file_data._texture_users[this.awd_file_data._cur_block_id.toString()] = [];\r\n\r\n\t\t// External\r\n\t\tif (type == 0) {\r\n\t\t\tdata_len = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t\tvar url:string;\r\n\t\t\turl = this.awd_file_data.newBlockBytes.readUTFBytes(data_len);\r\n\t\t\tthis.awd_file_data.cur_block.dependencies_urls.push(url);\r\n\r\n\t\t} else {\r\n\t\t\tdata_len = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\r\n\t\t\tvar data:ByteArray;\r\n\t\t\tdata = new ByteArray();\r\n\t\t\tthis.awd_file_data.newBlockBytes.readBytes(data, 0, data_len);\r\n\t\t\tthis.awd_file_data.cur_block.dependencies_data.push(data);\r\n\r\n\t\t\t//\r\n\t\t\t// AWD3Parserutils - Fix for FireFox Bug: https://bugzilla.mozilla.org/show_bug.cgi?id=715075 .\r\n\t\t\t//\r\n\t\t\t// Converting data to image here instead of parser - fix FireFox bug where image width / height is 0 when created from data\r\n\t\t\t// This gives the browser time to initialise image width / height.\r\n\r\n\t\t\t//this.awd_file_data._pAddDependency(this.awd_file_data._cur_block_id.toString(), null, false, data, true);\r\n\r\n\t\t}\r\n\t\tthis.awd_file_data.cur_block.state=AWD3Utils.BLOCKSTATE_LOAD_DEPENDENICES;\r\n\t\t// Ignore for now\r\n\t\tthis.awd_file_data.parseProperties(null);\r\n\t\tthis.awd_file_data.parseUserAttributes();\r\n\r\n\t\tif (this.awd_file_data.debug) {\r\n\t\t\tvar textureStylesNames:Array<string> = [\"external\", \"embed\"]\r\n\t\t\tconsole.log(\"Start parsing a \" + textureStylesNames[type] + \" Bitmap for Texture\");\r\n\t\t}\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport = BitmapTextureAWDParser;",
    "\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDBlockParserBase\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\nimport AWD3Utils\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\nclass BlockNameSpaceAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\t\tthis.awd_file_data.cur_block.state=AWD3Utils.BLOCKSTATE_NO_ASSET;\r\n\t\tvar id:number = this.awd_file_data.newBlockBytes.readUnsignedByte();\r\n\t\tvar nameSpaceString:string = this.awd_file_data.parseVarStr();\r\n\t\tif (this.awd_file_data.debug)\r\n\t\t\tconsole.log(\"Parsed a NameSpaceBlock: ID = \" + id + \" | String = \" + nameSpaceString);\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport = BlockNameSpaceAWDParser;",
    "\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDBlockParserBase\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\nimport AWD3Parser\t\t\t\t= require(\"awayjs-parsers/lib/AWD3Parser\");\r\n\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\nimport ProjectionBase\t\t\t\t\t= require(\"awayjs-core/lib/projections/ProjectionBase\");\r\nimport PerspectiveProjection\t\t\t= require(\"awayjs-core/lib/projections/PerspectiveProjection\");\r\nimport OrthographicProjection\t\t\t= require(\"awayjs-core/lib/projections/OrthographicProjection\");\r\nimport OrthographicOffCenterProjection\t= require(\"awayjs-core/lib/projections/OrthographicOffCenterProjection\");\r\nimport DisplayObjectContainer\t\t\t= require(\"awayjs-display/lib/containers/DisplayObjectContainer\");\r\nimport Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\nimport AWD3Utils\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\nclass CameraAWD3Parser extends AWDBlockParserBase\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void {\r\n\t\tvar par_id:number = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\tvar mtx:Matrix3D = this.awd_file_data.parseMatrix3D();\r\n\t\tthis.awd_file_data.cur_block.name = this.awd_file_data.parseVarStr();\r\n\t\tvar parentName:string = \"Root (TopLevel)\";\r\n\t\tvar projection:ProjectionBase;\r\n\r\n\t\tthis.awd_file_data.newBlockBytes.readUnsignedByte(); //set as active camera\r\n\t\tthis.awd_file_data.newBlockBytes.readShort(); //lengthof lenses - not used yet\r\n\r\n\t\tvar projectiontype:number = this.awd_file_data.newBlockBytes.readShort();\r\n\t\tvar props:AWDProperties = this.awd_file_data.parseProperties({\r\n\t\t\t101: this.awd_file_data.propsNrType,\r\n\t\t\t102: this.awd_file_data.propsNrType,\r\n\t\t\t103: this.awd_file_data.propsNrType,\r\n\t\t\t104: this.awd_file_data.propsNrType\r\n\t\t});\r\n\r\n\t\tswitch (projectiontype) {\r\n\t\t\tcase 5001:\r\n\t\t\t\tprojection = new PerspectiveProjection(props.get(101, 60));\r\n\t\t\t\tbreak;\r\n\t\t\tcase 5002:\r\n\t\t\t\tprojection = new OrthographicProjection(props.get(101, 500));\r\n\t\t\t\tbreak;\r\n\t\t\tcase 5003:\r\n\t\t\t\tprojection = new OrthographicOffCenterProjection(props.get(101, -400), props.get(102, 400), props.get(103, -300), props.get(104, 300));\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tconsole.log(\"unsupportedLenstype\");\r\n\t\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar camera:Camera = new Camera(projection);\r\n\t\tcamera.transform.matrix3D = mtx;\r\n\t\tif (par_id > 0) {\r\n\t\t\tvar parent:DisplayObjectContainer = <DisplayObjectContainer>this.awd_file_data.getAssetByID(par_id);\r\n\t\t\tif (parent != undefined) {\r\n\t\t\t\tparent.addChild(camera);\r\n\t\t\t\tparentName = parent.name;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tcamera.name = name;\r\n\t\tprops = this.awd_file_data.parseProperties({1:this.awd_file_data.matrixNrType, 2:this.awd_file_data.matrixNrType, 3:this.awd_file_data.matrixNrType, 4:AWD3Utils.UINT8});\r\n\t\tcamera.pivot = new Vector3D(props.get(1, 0), props.get(2, 0), props.get(3, 0));\r\n\t\tcamera.extra = this.awd_file_data.parseUserAttributes();\r\n\t\tthis.awd_file_data.cur_block.data = camera;\r\n\r\n\t\tif (this.awd_file_data.debug) {\r\n\t\t\tconsole.log(\"Parsed a Camera: Name = '\" + camera.name + \"' | Projectiontype = \" + projection + \" | Parent-Name = \" + parentName);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport = CameraAWD3Parser;",
    "\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDBlockParserBase\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\nimport DisplayObject\t\t\t\t\t= require(\"awayjs-display/lib/base/DisplayObject\");\r\nimport DisplayObjectContainer\t= require(\"awayjs-display/lib/containers/DisplayObjectContainer\");\r\nimport Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AWD3Utils\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\nclass CommandAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\t\tthis.awd_file_data.cur_block.state=AWD3Utils.BLOCKSTATE_NO_ASSET;\r\n\t\tvar hasBlocks:boolean = ( this.awd_file_data.newBlockBytes.readUnsignedByte() == 1 );\r\n\t\tvar par_id:number = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\tvar mtx:Matrix3D = this.awd_file_data.parseMatrix3D();\r\n\t\tvar name:string = this.awd_file_data.parseVarStr();\r\n\r\n\t\tvar parentObject:DisplayObjectContainer;\r\n\t\tvar targetObject:DisplayObject;\r\n\r\n\t\tif(par_id>0)\r\n\t\t\tparentObject = <DisplayObjectContainer>this.awd_file_data.getAssetByID(par_id); //for no only light is requested!!!!\r\n\r\n\t\tvar numCommands:number = this.awd_file_data.newBlockBytes.readShort();\r\n\t\tvar typeCommand:number = this.awd_file_data.newBlockBytes.readShort();\r\n\r\n\t\tvar props:AWDProperties = this.awd_file_data.parseProperties({1:AWD3Utils.BADDR});\r\n\r\n\t\tswitch (typeCommand) {\r\n\t\t\tcase 1:\r\n\r\n\t\t\t\tvar targetID:number = props.get(1, 0);\r\n\t\t\t\t//var returnedArrayTarget:Array<any> = this.getAssetByID(targetID, [LightBase.assetType, TextureProjector.assetType]); //for no only light is requested!!!!\r\n\t\t\t\ttargetObject = <DisplayObject>this.awd_file_data.getAssetByID(targetID); //for no only light is requested!!!!\r\n\t\t\t\tif(targetObject==undefined){\r\n\t\t\t\t\t//this._awd_data._blocks[blockID].addError(\"Could not find the light (ID = \" + targetID + \" ( for this CommandBock!\");\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (parentObject) {\r\n\t\t\t\t\tparentObject.addChild(targetObject);\r\n\t\t\t\t}\r\n\t\t\t\ttargetObject.transform.matrix3D = mtx;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tif (targetObject) {\r\n\t\t\tprops = this.awd_file_data.parseProperties({1:this.awd_file_data.matrixNrType, 2:this.awd_file_data.matrixNrType, 3:this.awd_file_data.matrixNrType, 4:AWD3Utils.UINT8});\r\n\r\n\t\t\ttargetObject.pivot = new Vector3D(props.get(1, 0), props.get(2, 0), props.get(3, 0));\r\n\t\t\ttargetObject.extra = this.awd_file_data.parseUserAttributes();\r\n\r\n\t\t}\r\n\t\t//this._awd_data._blocks[blockID].data = targetObject\r\n\r\n\t\tif (this.awd_file_data.debug) {\r\n\t\t\tconsole.log(\"Parsed a CommandBlock: Name = '\" + name);\r\n\t\t}\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport = CommandAWDParser;",
    "\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDBlockParserBase\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\nimport AWD3Utils\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\nimport URLRequest\t\t\t\t\t\t= require(\"awayjs-core/lib/net/URLRequest\");\r\nimport CubeTextureBase\t\t\t\t\t= require(\"awayjs-core/lib/textures/CubeTextureBase\");\r\nimport ParserUtils\t\t\t\t\t\t= require(\"awayjs-core/lib/parsers/ParserUtils\");\r\n\r\nclass CubeTextureAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\t\tvar data_len:number;\r\n\t\tvar i:number;\r\n\r\n\t\t//this.awd_file_data._cubeTextures = new Array<any>();\r\n\t\t//this.awd_file_data._texture_users[ this.awd_file_data._cur_block_id.toString() ] = [];\r\n\r\n\t\tvar type:number = this.awd_file_data.newBlockBytes.readUnsignedByte();\r\n\r\n\t\t//this.awd_file_data._blocks[blockID].name =\r\n\r\n\t\tthis.awd_file_data.cur_block.name = this.awd_file_data.parseVarStr();\r\n\r\n\t\tfor (i = 0; i < 6; i++) {\r\n\t\t\t//this.awd_file_data.texture_users[this.awd_file_data.cur_block_id.toString()] = [];\r\n\t\t\t//this.awd_file_data.cubeTextures.push(null);\r\n\r\n\t\t\t// External\r\n\t\t\tif (type == 0) {\r\n\t\t\t\tdata_len = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t\t\tvar url:string;\r\n\t\t\t\turl = this.awd_file_data.newBlockBytes.readUTFBytes(data_len);\r\n\r\n\t\t\t\tthis.awd_file_data.cur_block.dependencies_urls.push(url);\r\n\t\t\t\t//this.awd_file_data._pAddDependency(this.awd_file_data.cur_block_id.toString() + \"#\" + i, new URLRequest(url), false, null, true);\r\n\t\t\t} else {\r\n\r\n\t\t\t\tdata_len = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t\t\tvar data:ByteArray;\r\n\t\t\t\tdata = new ByteArray();\r\n\r\n\t\t\t\tthis.awd_file_data.newBlockBytes.readBytes(data, 0, data_len);\r\n\r\n\t\t\t\tthis.awd_file_data.cur_block.dependencies_data.push(data);\r\n\t\t\t\t//this.awd_file_data._pAddDependency(this.awd_file_data.cur_block_id.toString() + \"#\" + i, null, false, ParserUtils.byteArrayToImage(data), true);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.awd_file_data.cur_block.state=AWD3Utils.BLOCKSTATE_LOAD_DEPENDENICES;\r\n\t\t// Ignore for now\r\n\t\tthis.awd_file_data.parseProperties(null);\r\n\t\tthis.awd_file_data.parseUserAttributes();\r\n\t\t//this.awd_file_data._pPauseAndRetrieveDependencies();\r\n\t\t//this.awd_file_data._blocks[blockID].data = asset;\r\n\r\n\t\tif (this.awd_file_data.debug) {\r\n\t\t\tvar textureStylesNames:Array<string> = [\"external\", \"embed\"]\r\n\t\t\tconsole.log(\"Start parsing 6 \" + textureStylesNames[type] + \" Bitmaps for CubeTexture\");\r\n\t\t}\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport = CubeTextureAWDParser;",
    "\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport Matrix3D\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Vector3D\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport AWDProperties\t\t\t= require(\"../AWD3ParserUtils/AWDProperties\");\r\n\r\nimport DisplayObjectContainer\t= require(\"awayjs-display/lib/containers/DisplayObjectContainer\");\r\nimport DisplayObject\t\t\t= require(\"awayjs-display/lib/base/DisplayObject\");\r\nimport AWDBlockParserBase\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWD3Utils\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\n\r\nclass DisplayObjectContainerAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\r\n\t\tvar par_id:number;\r\n\t\tvar mtx:Matrix3D;\r\n\t\tvar ctr:DisplayObjectContainer;\r\n\t\tvar parent:DisplayObjectContainer;\r\n\r\n\t\tctr = new DisplayObjectContainer();\r\n\t\tpar_id = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\tmtx = this.awd_file_data.parseMatrix3D();\r\n\t\tthis.awd_file_data.cur_block.name = this.awd_file_data.parseVarStr();\r\n\r\n\t\tvar parentName:string = \"Root (TopLevel)\";\r\n\t\tctr.transform.matrix3D = mtx;\r\n\r\n\r\n\t\tif (par_id > 0) {\r\n\t\t\tvar parent:DisplayObjectContainer = <DisplayObjectContainer>this.awd_file_data.getAssetByID(par_id);\r\n\t\t\tif (parent != undefined) {\r\n\t\t\t\tparent.addChild(ctr);\r\n\t\t\t\tparentName = parent.name;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// in AWD version 2.1 we read the Container properties\r\n\t\tif ((this.awd_file_data.major_version > 2)||((this.awd_file_data.major_version >= 2) && (this.awd_file_data.minor_version == 1))) {\r\n\t\t\tvar props:AWDProperties = this.awd_file_data.parseProperties({1:this.awd_file_data.matrixNrType, 2:this.awd_file_data.matrixNrType, 3:this.awd_file_data.matrixNrType, 4:AWD3Utils.UINT8});\r\n\t\t\tctr.pivot = new Vector3D(props.get(1, 0), props.get(2, 0), props.get(3, 0));\r\n\t\t}\r\n\t\t// in other versions we do not read the Container properties\r\n\t\telse {\r\n\t\t\tthis.awd_file_data.parseProperties(null);\r\n\t\t}\r\n\r\n\t\t// the extraProperties should only be set for AWD2.1-Files, but is read for both versions\r\n\t\tctr.extra = this.awd_file_data.parseUserAttributes();\r\n\t\tthis.awd_file_data.cur_block.data=ctr;\r\n\t\tif (this.awd_file_data.debug) {\r\n\t\t\tconsole.log(\"Parsed a Container: Name = '\" + ctr.name + \"' | Parent-Name = \" + parentName);\r\n\t\t}\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport = DisplayObjectContainerAWDParser;",
    "\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDBlockParserBase\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\n\r\nimport Geometry\t\t\t\t\t\t\t= require(\"awayjs-core/lib/data/Geometry\");\r\nimport SubGeometryBase\t\t\t\t\t= require(\"awayjs-core/lib/data/SubGeometryBase\");\r\nimport CurveSubGeometry\t\t\t\t\t= require(\"awayjs-core/lib/data/CurveSubGeometry\");\r\nimport TriangleSubGeometry\t\t\t\t= require(\"awayjs-core/lib/data/TriangleSubGeometry\");\r\n\r\nclass GeometryAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\t\tvar geom:Geometry = new Geometry();\r\n\r\n\t\t// Read name and sub count\r\n\t\tthis.awd_file_data.cur_block.name = this.awd_file_data.parseVarStr();\r\n\t\tvar num_subs:number = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\r\n\t\t// Read optional properties\r\n\t\tvar props:AWDProperties = this.awd_file_data.parseProperties({1:this.awd_file_data.geoNrType, 2:this.awd_file_data.geoNrType});\r\n\t\tvar geoScaleU:number = props.get(1, 1);\r\n\t\tvar geoScaleV:number = props.get(2, 1);\r\n\r\n\t\t// Loop through sub meshes\r\n\t\tvar subs_parsed:number = 0;\r\n\t\twhile (subs_parsed < num_subs) {\r\n\t\t\tvar is_curve_geom:boolean=false;\r\n\t\t\tvar i:number;\r\n\t\t\tvar sm_len:number, sm_end:number;\r\n\t\t\tvar w_indices:Array<number>;\r\n\t\t\tvar weights:Array<number>;\r\n\r\n\t\t\tsm_len = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t\tsm_end = this.awd_file_data.newBlockBytes.position + sm_len;\r\n\r\n\t\t\tvar subProps:AWDProperties = this.awd_file_data.parseProperties({1:this.awd_file_data.geoNrType, 2:this.awd_file_data.geoNrType});\r\n\t\t\t// Loop through data streams\r\n\t\t\twhile (this.awd_file_data.newBlockBytes.position < sm_end) {\r\n\t\t\t\tvar idx:number = 0;\r\n\t\t\t\tvar str_ftype:number, str_type:number, str_len:number, str_end:number;\r\n\r\n\t\t\t\t// Type, field type, length\r\n\t\t\t\tstr_type = this.awd_file_data.newBlockBytes.readUnsignedByte();\r\n\t\t\t\tstr_ftype = this.awd_file_data.newBlockBytes.readUnsignedByte();\r\n\t\t\t\tstr_len = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t\t\tstr_end = this.awd_file_data.newBlockBytes.position + str_len;\r\n\r\n\t\t\t\tvar x:number, y:number, z:number;\r\n\r\n\t\t\t\tif (str_type == 1) {//vertex 3d positions\r\n\t\t\t\t\tvar verts:Array<number> = new Array<number>();\r\n\r\n\t\t\t\t\twhile (this.awd_file_data.newBlockBytes.position < str_end) {\r\n\r\n\t\t\t\t\t\tx = this.awd_file_data.readNumber(this.awd_file_data.accuracyGeo);\r\n\t\t\t\t\t\ty = this.awd_file_data.readNumber(this.awd_file_data.accuracyGeo);\r\n\t\t\t\t\t\tz = this.awd_file_data.readNumber(this.awd_file_data.accuracyGeo);\r\n\r\n\t\t\t\t\t\tverts[idx++] = x;\r\n\t\t\t\t\t\tverts[idx++] = y;\r\n\t\t\t\t\t\tverts[idx++] = z;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (str_type == 2) {//face indicies positions\r\n\t\t\t\t\tvar indices:Array<number> = new Array<number>();\r\n\r\n\t\t\t\t\twhile (this.awd_file_data.newBlockBytes.position < str_end) {\r\n\t\t\t\t\t\tindices[idx++] = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else if (str_type == 3) {\r\n\t\t\t\t\tvar uvs:Array<number> = new Array<number>();\r\n\t\t\t\t\twhile (this.awd_file_data.newBlockBytes.position < str_end) {\r\n\t\t\t\t\t\tuvs[idx++] = this.awd_file_data.readNumber(this.awd_file_data.accuracyGeo);\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (str_type == 4) {\r\n\r\n\t\t\t\t\tvar normals:Array<number> = new Array<number>();\r\n\r\n\t\t\t\t\twhile (this.awd_file_data.newBlockBytes.position < str_end) {\r\n\t\t\t\t\t\tnormals[idx++] = this.awd_file_data.readNumber(this.awd_file_data.accuracyGeo);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else if (str_type == 6) {\r\n\t\t\t\t\tw_indices = Array<number>();\r\n\r\n\t\t\t\t\twhile (this.awd_file_data.newBlockBytes.position < str_end) {\r\n\t\t\t\t\t\tw_indices[idx++] = this.awd_file_data.newBlockBytes.readUnsignedShort()*3;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else if (str_type == 7) {\r\n\r\n\t\t\t\t\tweights = new Array<number>();\r\n\r\n\t\t\t\t\twhile (this.awd_file_data.newBlockBytes.position < str_end) {\r\n\t\t\t\t\t\tweights[idx++] = this.awd_file_data.readNumber(this.awd_file_data.accuracyGeo);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (str_type == 8) {// 2d-positions - not used yet.\r\n\t\t\t\t\tthis.awd_file_data.newBlockBytes.position = str_end;\r\n\t\t\t\t} else if (str_type == 9) {// combined vertex3D stream 13 x float32\r\n\t\t\t\t\tthis.awd_file_data.newBlockBytes.position = str_end;\r\n\t\t\t\t} else if (str_type == 10) {// combined vertex2D stream 5 x float32\r\n\t\t\t\t\tis_curve_geom=true;\r\n\t\t\t\t\tvar idx_pos:number = 0;\r\n\t\t\t\t\tvar idx_curves:number = 0;\r\n\t\t\t\t\tvar idx_uvs:number = 0;\r\n\r\n\t\t\t\t\tvar positions:Array<number> = new Array<number>();\r\n\t\t\t\t\tvar curveData:Array<number> = new Array<number>();\r\n\t\t\t\t\tvar uvs:Array<number> = new Array<number>();\r\n\r\n\t\t\t\t\twhile (this.awd_file_data.newBlockBytes.position < str_end) {\r\n\r\n\t\t\t\t\t\tpositions[idx_pos++] = this.awd_file_data.readNumber(this.awd_file_data.accuracyGeo);// x\r\n\t\t\t\t\t\tpositions[idx_pos++] = this.awd_file_data.readNumber(this.awd_file_data.accuracyGeo);// y\r\n\t\t\t\t\t\tpositions[idx_pos++] =  this.awd_file_data.readNumber(this.awd_file_data.accuracyGeo);// type\r\n\r\n\t\t\t\t\t\tcurveData[idx_curves++] = this.awd_file_data.readNumber(this.awd_file_data.accuracyGeo);// curve value 1\r\n\t\t\t\t\t\tcurveData[idx_curves++] = this.awd_file_data.readNumber(this.awd_file_data.accuracyGeo);// curve value 2\r\n\r\n\t\t\t\t\t\tuvs[idx_uvs++] = this.awd_file_data.readNumber(this.awd_file_data.accuracyGeo);// curve value 1\r\n\t\t\t\t\t\tuvs[idx_uvs++] = this.awd_file_data.readNumber(this.awd_file_data.accuracyGeo);// curve value 1\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis.awd_file_data.newBlockBytes.position = str_end;\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.awd_file_data.parseUserAttributes(); // Ignore sub-mesh attributes for now\r\n\t\t\tif(is_curve_geom){\r\n\t\t\t\tvar curve_sub_geom:CurveSubGeometry = new CurveSubGeometry(true);\r\n\t\t\t\tcurve_sub_geom.updateIndices(indices);\r\n\t\t\t\tcurve_sub_geom.updatePositions(positions);\r\n\t\t\t\tcurve_sub_geom.updateCurves(curveData);\r\n\t\t\t\tcurve_sub_geom.updateUVs(uvs);\r\n\t\t\t\tgeom.addSubGeometry(curve_sub_geom);\r\n\t\t\t\tif (this.awd_file_data.debug)\r\n\t\t\t\t\tconsole.log(\"Parsed a CurveSubGeometry\");\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tvar triangle_sub_geom = new TriangleSubGeometry(true);\r\n\t\t\t\tif (weights)\r\n\t\t\t\t\ttriangle_sub_geom.jointsPerVertex = weights.length / (verts.length / 3);\r\n\t\t\t\tif (normals)\r\n\t\t\t\t\ttriangle_sub_geom.autoDeriveNormals = false;\r\n\t\t\t\tif (uvs)\r\n\t\t\t\t\ttriangle_sub_geom.autoDeriveUVs = false;\r\n\t\t\t\t//triangle_sub_geom.autoDeriveNormals = false;\r\n\t\t\t\tif (true) {\r\n\t\t\t\t\ttriangle_sub_geom.autoDeriveTangents = true;\r\n\t\t\t\t}\r\n\t\t\t\ttriangle_sub_geom.updateIndices(indices);\r\n\t\t\t\ttriangle_sub_geom.updatePositions(verts);\r\n\t\t\t\ttriangle_sub_geom.updateVertexNormals(normals);\r\n\t\t\t\ttriangle_sub_geom.updateUVs(uvs);\r\n\t\t\t\ttriangle_sub_geom.updateVertexTangents(null);\r\n\t\t\t\ttriangle_sub_geom.updateJointWeights(weights);\r\n\t\t\t\ttriangle_sub_geom.updateJointIndices(w_indices);\r\n\r\n\t\t\t\tvar scaleU:number = subProps.get(1, 1);\r\n\t\t\t\tvar scaleV:number = subProps.get(2, 1);\r\n\t\t\t\tvar setSubUVs:boolean = false; //this should remain false atm, because in AwayBuilder the uv is only scaled by the geometry\r\n\r\n\t\t\t\tif ((geoScaleU != scaleU) || (geoScaleV != scaleV)) {\r\n\t\t\t\t\tsetSubUVs = true;\r\n\t\t\t\t\tscaleU = geoScaleU / scaleU;\r\n\t\t\t\t\tscaleV = geoScaleV / scaleV;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (setSubUVs)\r\n\t\t\t\t\ttriangle_sub_geom.scaleUV(scaleU, scaleV);\r\n\t\t\t\tgeom.addSubGeometry(triangle_sub_geom);\r\n\t\t\t\tif (this.awd_file_data.debug)\r\n\t\t\t\t\tconsole.log(\"Parsed a TriangleSubGeometry\");\r\n\t\t\t}\r\n\r\n\r\n\t\t\t// TODO: Somehow map in-sub to out-sub indices to enable look-up\r\n\t\t\t// when creating meshes (and their material assignments.)\r\n\r\n\t\t\tsubs_parsed++;\r\n\t\t}\r\n\t\tif ((geoScaleU != 1) || (geoScaleV != 1))\r\n\t\t\tgeom.scaleUV(geoScaleU, geoScaleV);\r\n\t\tthis.awd_file_data.parseUserAttributes();\r\n\t\tthis.awd_file_data.cur_block.data=geom;\r\n\t\tif (this.awd_file_data.debug) {\r\n\t\t\tconsole.log(\"Parsed a TriangleGeometry: Name = \" + name);\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\nexport = GeometryAWDParser;",
    "\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDBlockParserBase\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\n\r\nimport Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport DisplayObjectContainer\t\t\t= require(\"awayjs-display/lib/containers/DisplayObjectContainer\");\r\nimport DisplayObject\t\t\t\t\t= require(\"awayjs-display/lib/base/DisplayObject\");\r\nimport CubeMapShadowMapper\t\t\t\t= require(\"awayjs-display/lib/materials/shadowmappers/CubeMapShadowMapper\");\r\nimport DirectionalShadowMapper\t\t\t= require(\"awayjs-display/lib/materials/shadowmappers/DirectionalShadowMapper\");\r\nimport ShadowMapperBase\t\t\t\t\t= require(\"awayjs-display/lib/materials/shadowmappers/ShadowMapperBase\");\r\n\r\nimport LightBase\t\t\t\t\t\t= require(\"awayjs-display/lib/base/LightBase\");\r\nimport DirectionalLight\t\t\t\t\t= require(\"awayjs-display/lib/entities/DirectionalLight\");\r\nimport PointLight\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/PointLight\");\r\nimport AWD3Utils\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\nclass LightAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\t\r\n\t\tvar light:LightBase;\r\n\t\tvar newShadowMapper:ShadowMapperBase;\r\n\r\n\t\tvar par_id:number = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\tvar mtx:Matrix3D = this.awd_file_data.parseMatrix3D();\r\n\t\tthis.awd_file_data.cur_block.name = this.awd_file_data.parseVarStr();\r\n\t\tvar lightType:number = this.awd_file_data.newBlockBytes.readUnsignedByte();\r\n\t\tvar props:AWDProperties = this.awd_file_data.parseProperties({1:this.awd_file_data.propsNrType, 2:this.awd_file_data.propsNrType, 3:AWD3Utils.COLOR, 4:this.awd_file_data.propsNrType, 5:this.awd_file_data.propsNrType, 6:AWD3Utils.BOOL, 7:AWD3Utils.COLOR, 8:this.awd_file_data.propsNrType, 9:AWD3Utils.UINT8, 10:AWD3Utils.UINT8, 11:this.awd_file_data.propsNrType, 12:AWD3Utils.UINT16, 21:this.awd_file_data.matrixNrType, 22:this.awd_file_data.matrixNrType, 23:this.awd_file_data.matrixNrType});\r\n\t\tvar shadowMapperType:number = props.get(9, 0);\r\n\t\tvar parentName:string = \"Root (TopLevel)\";\r\n\t\tvar lightTypes:Array<string> = [\"Unsupported LightType\", \"PointLight\", \"DirectionalLight\"];\r\n\t\tvar shadowMapperTypes:Array<string> = [\"No ShadowMapper\", \"DirectionalShadowMapper\", \"NearDirectionalShadowMapper\", \"CascadeShadowMapper\", \"CubeMapShadowMapper\"];\r\n\r\n\t\tif (lightType == 1) {\r\n\t\t\tlight = new PointLight();\r\n\r\n\t\t\t(<PointLight> light).radius = props.get(1, 90000);\r\n\t\t\t(<PointLight> light).fallOff = props.get(2, 100000);\r\n\r\n\t\t\tif (shadowMapperType > 0) {\r\n\t\t\t\tif (shadowMapperType == 4) {\r\n\t\t\t\t\tnewShadowMapper = new CubeMapShadowMapper();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tlight.transform.matrix3D = mtx;\r\n\r\n\t\t}\r\n\r\n\t\tif (lightType == 2) {\r\n\r\n\t\t\tlight = new DirectionalLight(props.get(21, 0), props.get(22, -1), props.get(23, 1));\r\n\r\n\t\t\tif (shadowMapperType > 0) {\r\n\t\t\t\tif (shadowMapperType == 1) {\r\n\t\t\t\t\tnewShadowMapper = new DirectionalShadowMapper();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//if (shadowMapperType == 2)\r\n\t\t\t\t//  newShadowMapper = new NearDirectionalShadowMapper(props.get(11, 0.5));\r\n\t\t\t\t//if (shadowMapperType == 3)\r\n\t\t\t\t//   newShadowMapper = new CascadeShadowMapper(props.get(12, 3));\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\tlight.name=name;\r\n\t\tlight.color = props.get(3, 0xffffff);\r\n\t\tlight.specular = props.get(4, 1.0);\r\n\t\tlight.diffuse = props.get(5, 1.0);\r\n\t\tlight.ambientColor = props.get(7, 0xffffff);\r\n\t\tlight.ambient = props.get(8, 0.0);\r\n\r\n\t\t// if a shadowMapper has been created, adjust the depthMapSize if needed, assign to light and set castShadows to true\r\n\t\tif (newShadowMapper) {\r\n\t\t\tif (newShadowMapper instanceof CubeMapShadowMapper) {\r\n\t\t\t\tif (props.get(10, 1) != 1) {\r\n\t\t\t\t\tnewShadowMapper.depthMapSize = this.awd_file_data.getDepthSizeFromEnum(props.get(10, 1));\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (props.get(10, 2) != 2) {\r\n\t\t\t\t\tnewShadowMapper.depthMapSize = this.awd_file_data.getDepthSizeFromEnum(props.get(10, 2));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tlight.shadowMapper = newShadowMapper;\r\n\t\t\tlight.castsShadows = true;\r\n\t\t}\r\n\r\n\t\tif (par_id != 0) {\r\n\r\n\t\t\tvar parent:DisplayObjectContainer = <DisplayObjectContainer>this.awd_file_data.getAssetByID(par_id)\r\n\r\n\t\t\tif (parent!=undefined){\r\n\t\t\t\tparent.addChild(light);\r\n\t\t\t\tparentName = parent.name;\r\n\t\t\t} else {\r\n\t\t\t\t//this.awd_file_data._blocks[blockID].addError(\"Could not find a parent for this.awd_file_data Light\");\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t//add to the content property\r\n\t\t\t//(<DisplayObjectContainer> this.awd_file_data._pContent).addChild(light);\r\n\t\t}\r\n\r\n\t\tthis.awd_file_data.parseUserAttributes();\r\n\t\tthis.awd_file_data.cur_block.data = light;\r\n\r\n\r\n\t\tif (this.awd_file_data.debug)\r\n\t\t\tconsole.log(\"Parsed a Light: Name = '\" + this.awd_file_data.cur_block.name + \"' | Type = \" + lightTypes[lightType] + \" | Parent-Name = \" + parentName + \" | ShadowMapper-Type = \" + shadowMapperTypes[shadowMapperType]);\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport = LightAWDParser;",
    "\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDBlockParserBase\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\n\r\nimport LightPickerBase\t\t\t\t\t= require(\"awayjs-display/lib/materials/lightpickers/LightPickerBase\");\r\nimport StaticLightPicker\t\t\t\t= require(\"awayjs-display/lib/materials/lightpickers/StaticLightPicker\");\r\nimport LightBase\t\t\t\t\t\t= require(\"awayjs-display/lib/base/LightBase\");\r\n\r\nclass LightPickerAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\t\tthis.awd_file_data.cur_block.name = this.awd_file_data.parseVarStr();\r\n\t\tvar numLights:number = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\tvar lightsArray:Array<LightBase> = new Array<LightBase>();\r\n\t\tvar k:number = 0;\r\n\t\tvar lightID:number = 0;\r\n\r\n\t\tvar returnedArrayLight:Array<any>;\r\n\t\tvar lightsArrayNames:Array<string> = new Array<string>();\r\n\r\n\t\tfor (k = 0; k < numLights; k++) {\r\n\t\t\tlightID = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t\tvar light:LightBase = <LightBase>this.awd_file_data.getAssetByID(lightID)\r\n\r\n\t\t\tif (light!=undefined) {\r\n\t\t\t\tlightsArray.push(<LightBase> light);\r\n\t\t\t\tlightsArrayNames.push(( <LightBase> light).name);\r\n\r\n\t\t\t} else {\r\n\t\t\t\t//this.awd_file_data._blocks[blockID].addError(\"Could not find a Light Nr \" + k + \" (ID = \" + lightID + \" ) for this.awd_file_data LightPicker\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (lightsArray.length == 0) {\r\n\t\t\t//this.awd_file_data._blocks[blockID].addError(\"Could not create this.awd_file_data LightPicker, cause no Light was found.\");\r\n\t\t\tthis.awd_file_data.parseUserAttributes();\r\n\t\t\treturn undefined; //return without any more parsing for this.awd_file_data block\r\n\t\t}\r\n\r\n\t\tvar lightPicker:LightPickerBase = new StaticLightPicker(lightsArray);\r\n\t\tthis.awd_file_data.cur_block.data = lightPicker;\r\n\r\n\t\tthis.awd_file_data.parseUserAttributes();\r\n\t\tif (this.awd_file_data.debug) {\r\n\t\t\tconsole.log(\"Parsed a StaticLightPicker: Name = '\" + this.awd_file_data.cur_block.name + \"' | Texture-Name = \" + lightsArrayNames.toString());\r\n\t\t}\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport = LightPickerAWDParser;",
    "\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDBlockParserBase\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\n\r\nimport MaterialBase\t\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\r\nimport MethodMaterialMode\t\t\t\t= require(\"awayjs-methodmaterials/lib/MethodMaterialMode\");\r\nimport MethodMaterial\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/MethodMaterial\");\r\nimport TextureBase\t\t\t\t\t\t= require(\"awayjs-core/lib/textures/TextureBase\");\r\nimport Texture2DBase\t\t\t\t\t= require(\"awayjs-core/lib/textures/Texture2DBase\");\r\nimport LightPickerBase\t\t\t\t\t= require(\"awayjs-display/lib/materials/lightpickers/LightPickerBase\");\r\n\r\nimport CurveMaterial\t\t\t\t\t= require(\"awayjs-display/lib/materials/CurveMaterial\")\r\nimport BasicMaterial\t\t\t\t\t= require(\"awayjs-display/lib/materials/BasicMaterial\");\r\n\r\nimport DefaultMaterialManager\t\t\t= require(\"awayjs-display/lib/managers/DefaultMaterialManager\");\r\nimport CubeTextureBase\t\t\t\t\t= require(\"awayjs-core/lib/textures/CubeTextureBase\");\r\n\r\nimport EffectMethodBase\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectMethodBase\");\r\nimport AmbientEnvMapMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/AmbientEnvMapMethod\");\r\nimport DiffuseDepthMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/DiffuseDepthMethod\");\r\nimport DiffuseCelMethod\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/DiffuseCelMethod\");\r\nimport DiffuseGradientMethod\t\t\t= require(\"awayjs-methodmaterials/lib/methods/DiffuseGradientMethod\");\r\nimport DiffuseLightMapMethod\t\t\t= require(\"awayjs-methodmaterials/lib/methods/DiffuseLightMapMethod\");\r\nimport DiffuseWrapMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/DiffuseWrapMethod\");\r\nimport NormalSimpleWaterMethod\t\t\t= require(\"awayjs-methodmaterials/lib/methods/NormalSimpleWaterMethod\");\r\nimport SpecularFresnelMethod\t\t\t= require(\"awayjs-methodmaterials/lib/methods/SpecularFresnelMethod\");\r\nimport SpecularAnisotropicMethod\t\t= require(\"awayjs-methodmaterials/lib/methods/SpecularAnisotropicMethod\");\r\nimport SpecularCelMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/SpecularCelMethod\");\r\nimport SpecularPhongMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/SpecularPhongMethod\");\r\nimport ShadowMapMethodBase\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadowMapMethodBase\");\r\nimport ShadowMethodBase\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadowMethodBase\");\r\nimport AWD3Utils\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\nclass MaterialAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\t\t// version 2.0\r\n\t\t////blockLength = block.len;\r\n\t\tvar name:string;\r\n\t\tvar type:number;\r\n\t\tvar props:AWDProperties;\r\n\t\tvar mat:MethodMaterial;\r\n\t\tvar attributes:Object;\r\n\t\tvar finalize:boolean;\r\n\t\tvar num_methods:number;\r\n\t\tvar methods_parsed:number;\r\n\t\tvar returnedArray:Array<any>;\r\n\t\tvar mat:MethodMaterial;\r\n\t\tvar normalTexture:Texture2DBase;\r\n\t\tvar specTexture:Texture2DBase;\r\n\t\tvar returnedArray:Array<any>;\r\n\r\n\t\tthis.awd_file_data.cur_block.name = this.awd_file_data.parseVarStr();\r\n\t\ttype = this.awd_file_data.newBlockBytes.readUnsignedByte();\r\n\t\tnum_methods = this.awd_file_data.newBlockBytes.readUnsignedByte();\r\n\r\n\t\tif((this.awd_file_data.major_version==2)&&(this.awd_file_data.major_version==0)) {\r\n\r\n\t\t\t// Read material numerical properties\r\n\t\t\t// (1=color, 2=bitmap url, 10=alpha, 11=alpha_blending, 12=alpha_threshold, 13=repeat)\r\n\t\t\tprops = this.awd_file_data.parseProperties({\r\n\t\t\t\t1: AWD3Utils.INT32,\r\n\t\t\t\t2: AWD3Utils.BADDR,\r\n\t\t\t\t10: this.awd_file_data.propsNrType,\r\n\t\t\t\t11: AWD3Utils.BOOL,\r\n\t\t\t\t12: this.awd_file_data.propsNrType,\r\n\t\t\t\t13: AWD3Utils.BOOL\r\n\t\t\t});\r\n\t\t\tmethods_parsed = 0;\r\n\t\t\twhile (methods_parsed < num_methods) {\r\n\t\t\t\tvar method_type:number;\r\n\r\n\t\t\t\tmethod_type = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\t\t\tthis.awd_file_data.parseProperties(null);\r\n\t\t\t\tthis.awd_file_data.parseUserAttributes();\r\n\t\t\t\tmethods_parsed += 1;\r\n\t\t\t}\r\n\t\t\tvar debugString:string = \"\";\r\n\t\t\tattributes = this.awd_file_data.parseUserAttributes();\r\n\t\t\tif (type === 1) { // Color material\r\n\t\t\t\tdebugString += \"Parsed a ColorMaterial(SinglePass): Name = '\" + name + \"' | \";\r\n\t\t\t\tvar color:number;\r\n\t\t\t\tcolor = props.get(1, 0xffffff);\r\n\t\t\t\t/*if (this.awd_file_data.materialMode < 2) {\r\n\t\t\t\t\tmat = new MethodMaterial(color, props.get(10, 1.0));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmat = new MethodMaterial(color);\r\n\t\t\t\t\tmat.mode = MethodMaterialMode.MULTI_PASS;\r\n\t\t\t\t}*/\r\n\t\t\t} else if (type === 2) {\r\n\t\t\t\tvar tex_addr:number = props.get(2, 0);\r\n\t\t\t\tvar texture:TextureBase=undefined;\r\n\t\t\t\tif (tex_addr > 0) {\r\n\t\t\t\t\tvar texture:TextureBase = <TextureBase> this.awd_file_data.getAssetByID(tex_addr);\r\n\t\t\t\t}\r\n\t\t\t\tif (texture==undefined) {\r\n\t\t\t\t\ttexture= DefaultMaterialManager.getDefaultTexture();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmat = new MethodMaterial(<Texture2DBase>texture);\r\n\t\t\t\t/*\r\n\t\t\t\tif (this.awd_file_data.materialMode < 2) {\r\n\t\t\t\t\tmat.alphaBlending = props.get(11, false);\r\n\t\t\t\t\tmat.alpha = props.get(10, 1.0);\r\n\t\t\t\t\tdebugString += \"Parsed a MethodMaterial(SinglePass): Name = '\" + name + \"' | Texture-Name = \" + mat.name;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmat.mode = MethodMaterialMode.MULTI_PASS;\r\n\t\t\t\t\tdebugString += \"Parsed a MethodMaterial(MultiPass): Name = '\" + name + \"' | Texture-Name = \" + mat.name;\r\n\t\t\t\t}\r\n\t\t\t\t*/\r\n\t\t\t}\r\n\r\n\t\t\tmat.extra = attributes;\r\n\t\t\tmat.alphaThreshold = props.get(12, 0.0);\r\n\t\t\tmat.repeat = props.get(13, false);\r\n\t\t\tmat.name=name;\r\n\t\t\tif (this.awd_file_data.debug) {\r\n\t\t\t\tconsole.log(debugString);\r\n\r\n\t\t\t}\r\n\t\t\tthis.awd_file_data.cur_block.data=mat;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// version 2.1+\r\n\r\n\t\tvar props:AWDProperties = this.awd_file_data.parseProperties({1:AWD3Utils.UINT32, 2:AWD3Utils.BADDR, 3:AWD3Utils.BADDR, 4:AWD3Utils.UINT8, 5:AWD3Utils.BOOL, 6:AWD3Utils.BOOL, 7:AWD3Utils.BOOL, 8:AWD3Utils.BOOL, 9:AWD3Utils.UINT8, 10:this.awd_file_data.propsNrType, 11:AWD3Utils.BOOL, 12:this.awd_file_data.propsNrType, 13:AWD3Utils.BOOL, 15:this.awd_file_data.propsNrType, 16:AWD3Utils.UINT32, 17:AWD3Utils.BADDR, 18:this.awd_file_data.propsNrType, 19:this.awd_file_data.propsNrType, 20:AWD3Utils.UINT32, 21:AWD3Utils.BADDR, 22:AWD3Utils.BADDR});\r\n\t\tvar spezialType:number = props.get(4, 0);\r\n\t\tvar debugString:string = \"Parsed Material \";\r\n\r\n\t\tif (spezialType >= 2) {//this.awd_file_data is no supported material\r\n\t\t\t//this.awd_file_data._blocks[blockID].addError(\"Material-spezialType '\" + spezialType + \"' is not supported, can only be 0:singlePass, 1:MultiPass !\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (type <= 2) {// Color material\r\n\t\t\t/*\r\n\t\t\tif (this.awd_file_data.materialMode == 1)\r\n\t\t\t\tspezialType = 0;\r\n\t\t\telse if (this.awd_file_data.materialMode == 2)\r\n\t\t\t\tspezialType = 1;\r\n\t\t\t\t*/\r\n\r\n\t\t\tif (spezialType < 2) {//this.awd_file_data is SinglePass or MultiPass\r\n\r\n\t\t\t\tif (type == 1) {// Color material\r\n\t\t\t\t\tvar color:number = props.get(1, 0xcccccc);//TODO temporarily swapped so that diffuse color goes to ambient\r\n\r\n\t\t\t\t\tif (spezialType == 1) {//\tMultiPassMaterial\r\n\t\t\t\t\t\tmat = new MethodMaterial(color);\r\n\t\t\t\t\t\tmat.mode = MethodMaterialMode.MULTI_PASS;\r\n\t\t\t\t\t\tdebugString += \"Parsed a ColorMaterial(MultiPass): Name = '\" + name + \"' | \";\r\n\r\n\t\t\t\t\t} else { //\tSinglePassMaterial\r\n\t\t\t\t\t\tmat = new MethodMaterial(color, props.get(10, 1.0));\r\n\t\t\t\t\t\tmat.alphaBlending = props.get(11, false);\r\n\t\t\t\t\t\tdebugString += \"Parsed a ColorMaterial(SinglePass): Name = '\" + name + \"' | \";\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else if (type == 2) {// texture material\r\n\t\t\t\t\tvar tex_addr:number = props.get(2, 0);//TODO temporarily swapped so that diffuse texture goes to ambient\r\n\t\t\t\t\tvar diftexture:TextureBase=undefined;\r\n\t\t\t\t\tif (tex_addr > 0) {\r\n\t\t\t\t\t\tdiftexture = <TextureBase> this.awd_file_data.getAssetByID(tex_addr);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (diftexture==undefined) {\r\n\t\t\t\t\t\tdiftexture= DefaultMaterialManager.getDefaultTexture();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tmat = new MethodMaterial(<Texture2DBase>diftexture);\r\n\r\n\t\t\t\t\tif (spezialType == 1) {// MultiPassMaterial\r\n\t\t\t\t\t\tmat.mode = MethodMaterialMode.MULTI_PASS;\r\n\r\n\t\t\t\t\t\tdebugString += \"Parsed a MethodMaterial(MultiPass): Name = '\" + this.awd_file_data.cur_block.name + \"' | Texture-Name = \" + diftexture.name;\r\n\t\t\t\t\t} else {//\tSinglePassMaterial\r\n\t\t\t\t\t\tmat.alpha = props.get(10, 1.0);\r\n\t\t\t\t\t\tmat.alphaBlending = props.get(11, false);\r\n\r\n\t\t\t\t\t\tdebugString += \"Parsed a MethodMaterial(SinglePass): Name = '\" + this.awd_file_data.cur_block.name + \"' | Texture-Name = \" + diftexture.name;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\r\n\t\t\t\tvar diffuseTex_addr:number = props.get(17, 0);\r\n\r\n\t\t\t\tdiffuseTexture=undefined;\r\n\t\t\t\tif (diffuseTex_addr > 0) {\r\n\t\t\t\t\tdiffuseTexture = <Texture2DBase> this.awd_file_data.getAssetByID(diffuseTex_addr);\r\n\t\t\t\t}\r\n\t\t\t\tif (diffuseTexture) {\r\n\t\t\t\t\tmat.diffuseTexture = <Texture2DBase>diffuseTexture;\r\n\t\t\t\t\tdebugString += \" | DiffuseTexture-Name = \" + diffuseTexture.name;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar normalTex_addr:number = props.get(3, 0);\r\n\r\n\r\n\t\t\t\tnormalTexture = undefined;\r\n\t\t\t\tif (normalTex_addr > 0) {\r\n\t\t\t\t\tnormalTexture = <Texture2DBase> this.awd_file_data.getAssetByID(normalTex_addr);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar specTex_addr:number = props.get(21, 0);\r\n\t\t\t\tspecTexture=undefined;\r\n\t\t\t\tif (specTex_addr > 0) {\r\n\t\t\t\t\tspecTexture = <Texture2DBase> this.awd_file_data.getAssetByID(specTex_addr);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar lightPickerAddr:number = props.get(22, 0);\r\n\t\t\t\tif(lightPickerAddr>0) {\r\n\t\t\t\t\tmat.lightPicker = <LightPickerBase> this.awd_file_data.getAssetByID(lightPickerAddr);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmat.smooth = props.get(5, true);\r\n\t\t\t\tmat.mipmap = props.get(6, true);\r\n\t\t\t\tmat.bothSides = props.get(7, false);\r\n\t\t\t\tmat.alphaPremultiplied = props.get(8, false);\r\n\t\t\t\tmat.blendMode = this.awd_file_data.getBlendModeStringFromEnum(props.get(9, 0));\r\n\t\t\t\tmat.repeat = props.get(13, false);\r\n\r\n\t\t\t\tif (normalTexture)\r\n\t\t\t\t\tmat.normalMap = normalTexture;\r\n\r\n\t\t\t\tif (specTexture)\r\n\t\t\t\t\tmat.specularMap = specTexture;\r\n\r\n\t\t\t\tmat.alphaThreshold = props.get(12, 0.0);\r\n\t\t\t\tmat.ambient = props.get(15, 1.0);\r\n\t\t\t\tmat.diffuseColor = props.get(16, 0xffffff);\r\n\t\t\t\tmat.specular = props.get(18, 1.0);\r\n\t\t\t\tmat.gloss = props.get(19, 50);\r\n\t\t\t\tmat.specularColor = props.get(20, 0xffffff);\r\n\r\n\t\t\t\tvar methods_parsed:number = 0;\r\n\t\t\t\tvar targetID:number;\r\n\r\n\t\t\t\twhile (methods_parsed < num_methods) {\r\n\t\t\t\t\tvar method_type:number;\r\n\t\t\t\t\tmethod_type = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\r\n\t\t\t\t\tprops = this.awd_file_data.parseProperties({\r\n\t\t\t\t\t\t1: AWD3Utils.BADDR,\r\n\t\t\t\t\t\t2: AWD3Utils.BADDR,\r\n\t\t\t\t\t\t3: AWD3Utils.BADDR,\r\n\t\t\t\t\t\t101: this.awd_file_data.propsNrType,\r\n\t\t\t\t\t\t102: this.awd_file_data.propsNrType,\r\n\t\t\t\t\t\t103: this.awd_file_data.propsNrType,\r\n\t\t\t\t\t\t201: AWD3Utils.UINT32,\r\n\t\t\t\t\t\t202: AWD3Utils.UINT32,\r\n\t\t\t\t\t\t301: AWD3Utils.UINT16,\r\n\t\t\t\t\t\t302: AWD3Utils.UINT16,\r\n\t\t\t\t\t\t401: AWD3Utils.UINT8,\r\n\t\t\t\t\t\t402: AWD3Utils.UINT8,\r\n\t\t\t\t\t\t601: AWD3Utils.COLOR,\r\n\t\t\t\t\t\t602: AWD3Utils.COLOR,\r\n\t\t\t\t\t\t701: AWD3Utils.BOOL,\r\n\t\t\t\t\t\t702: AWD3Utils.BOOL,\r\n\t\t\t\t\t\t801: AWD3Utils.MTX4x4\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tswitch (method_type) {\r\n\t\t\t\t\t\tcase 999: //wrapper-Methods that will load a previous parsed EffectMethod\r\n\r\n\t\t\t\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t\t\t\t\tif (targetID>0) {\r\n\t\t\t\t\t\t\t\tvar fx_method:EffectMethodBase = <EffectMethodBase>this.awd_file_data.getAssetByID(targetID);\r\n\t\t\t\t\t\t\t\tmat.addEffectMethod(fx_method);\r\n\t\t\t\t\t\t\t\tdebugString += \" | EffectMethod-Name = \" + (<EffectMethodBase> fx_method).name;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase 998: //wrapper-Methods that will load a previous parsed ShadowMapMethod\r\n\r\n\t\t\t\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t\t\t\t\tif (targetID>0) {\r\n\t\t\t\t\t\t\t\tvar shadow_method:ShadowMethodBase = <ShadowMethodBase>this.awd_file_data.getAssetByID(targetID);\r\n\t\t\t\t\t\t\t\tmat.shadowMethod=shadow_method;\r\n\t\t\t\t\t\t\t\tdebugString += \" | EffectMethod-Name = \" + (<ShadowMethodBase> shadow_method).name;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase 1: //EnvMapAmbientMethod\r\n\t\t\t\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t\t\t\t\tvar cubeTex:CubeTextureBase=undefined;\r\n\t\t\t\t\t\t\tif (targetID>0) {\r\n\t\t\t\t\t\t\t\tcubeTex = <CubeTextureBase>this.awd_file_data.getAssetByID(targetID);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif(cubeTex==undefined){\r\n\t\t\t\t\t\t\t\tcubeTex=<CubeTextureBase>this.awd_file_data.getDefaultCubeTexture();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t//if (!returnedArray[0])\r\n\t\t\t\t\t\t\t\t//this.awd_file_data._blocks[blockID].addError(\"Could not find the EnvMap (ID = \" + targetID + \" ) for this.awd_file_data EnvMapAmbientMethodMaterial\");\r\n\t\t\t\t\t\t\tmat.ambientMethod = new AmbientEnvMapMethod(cubeTex);\r\n\t\t\t\t\t\t\tdebugString += \" | AmbientEnvMapMethod | EnvMap-Name =\" + (<CubeTextureBase> cubeTex).name;\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase 51: //DepthDiffuseMethod\r\n\t\t\t\t\t\t\tmat.diffuseMethod = new DiffuseDepthMethod();\r\n\t\t\t\t\t\t\tdebugString += \" | DiffuseDepthMethod\";\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 52: //GradientDiffuseMethod\r\n\t\t\t\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t\t\t\t\tvar thisTex:TextureBase=undefined;\r\n\t\t\t\t\t\t\tif (targetID>0) {\r\n\t\t\t\t\t\t\t\tthisTex = <TextureBase>this.awd_file_data.getAssetByID(targetID);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif(thisTex==undefined){\r\n\t\t\t\t\t\t\t\tthisTex=DefaultMaterialManager.getDefaultTexture();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t//if (!returnedArray[0])\r\n\t\t\t\t\t\t\t\t//this.awd_file_data._blocks[blockID].addError(\"Could not find the GradientDiffuseTexture (ID = \" + targetID + \" ) for this.awd_file_data GradientDiffuseMethod\");\r\n\t\t\t\t\t\t\tmat.diffuseMethod = new DiffuseGradientMethod(<Texture2DBase>thisTex);\r\n\t\t\t\t\t\t\tdebugString += \" | DiffuseGradientMethod | GradientDiffuseTexture-Name =\" + (<Texture2DBase>thisTex).name;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 53: //WrapDiffuseMethod\r\n\t\t\t\t\t\t\tmat.diffuseMethod = new DiffuseWrapMethod(props.get(101, 5));\r\n\t\t\t\t\t\t\tdebugString += \" | DiffuseWrapMethod\";\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 54: //LightMapDiffuseMethod\r\n\t\t\t\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t\t\t\t\tvar thisTex:TextureBase=undefined;\r\n\t\t\t\t\t\t\tif (targetID>0) {\r\n\t\t\t\t\t\t\t\tthisTex = <TextureBase>this.awd_file_data.getAssetByID(targetID);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif(thisTex==undefined){\r\n\t\t\t\t\t\t\t\tthisTex=DefaultMaterialManager.getDefaultTexture();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t//if (!returnedArray[0])\r\n\t\t\t\t\t\t\t\t//this.awd_file_data._blocks[blockID].addError(\"Could not find the LightMap (ID = \" + targetID + \" ) for this.awd_file_data LightMapDiffuseMethod\");\r\n\t\t\t\t\t\t\tmat.diffuseMethod = new DiffuseLightMapMethod(<Texture2DBase>thisTex, this.awd_file_data.getBlendModeStringFromEnum(props.get(401, 10)), false, mat.diffuseMethod);\r\n\t\t\t\t\t\t\tdebugString += \" | DiffuseLightMapMethod | LightMapTexture-Name =\" + (<Texture2DBase> thisTex).name;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 55: //CelDiffuseMethod\r\n\t\t\t\t\t\t\tmat.diffuseMethod = new DiffuseCelMethod(props.get(401, 3), mat.diffuseMethod);\r\n\t\t\t\t\t\t\t(<DiffuseCelMethod> mat.diffuseMethod).smoothness = props.get(101, 0.1);\r\n\t\t\t\t\t\t\tdebugString += \" | DiffuseCelMethod\";\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 56: //SubSurfaceScatteringMethod\r\n\t\t\t\t\t\t\t//\t\t\t\t\t\t\tmat.diffuseMethod = new DiffuseSubSurfaceMethod(); //depthMapSize and depthMapOffset ?\r\n\t\t\t\t\t\t\t//\t\t\t\t\t\t\t(<DiffuseSubSurfaceMethod> mat.diffuseMethod).scattering = props.get(101, 0.2);\r\n\t\t\t\t\t\t\t//\t\t\t\t\t\t\t(<DiffuseSubSurfaceMethod> mat.diffuseMethod).translucency = props.get(102, 1);\r\n\t\t\t\t\t\t\t//\t\t\t\t\t\t\t(<DiffuseSubSurfaceMethod> mat.diffuseMethod).scatterColor = props.get(601, 0xffffff);\r\n\t\t\t\t\t\t\t//\t\t\t\t\t\t\tdebugString += \" | DiffuseSubSurfaceMethod\";\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase 101: //AnisotropicSpecularMethod\r\n\t\t\t\t\t\t\tmat.specularMethod = new SpecularAnisotropicMethod();\r\n\t\t\t\t\t\t\tdebugString += \" | SpecularAnisotropicMethod\";\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 102: //SpecularPhongMethod\r\n\t\t\t\t\t\t\tmat.specularMethod = new SpecularPhongMethod();\r\n\t\t\t\t\t\t\tdebugString += \" | SpecularPhongMethod\";\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 103: //CellSpecularMethod\r\n\t\t\t\t\t\t\tmat.specularMethod = new SpecularCelMethod(props.get(101, 0.5), mat.specularMethod);\r\n\t\t\t\t\t\t\t(<SpecularCelMethod> mat.specularMethod).smoothness = props.get(102, 0.1);\r\n\t\t\t\t\t\t\tdebugString += \" | SpecularCelMethod\";\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 104: //SpecularFresnelMethod\r\n\t\t\t\t\t\t\tmat.specularMethod = new SpecularFresnelMethod(props.get(701, true), mat.specularMethod);\r\n\t\t\t\t\t\t\t(<SpecularFresnelMethod> mat.specularMethod).fresnelPower = props.get(101, 5);\r\n\t\t\t\t\t\t\t(<SpecularFresnelMethod> mat.specularMethod).normalReflectance = props.get(102, 0.1);\r\n\t\t\t\t\t\t\tdebugString += \" | SpecularFresnelMethod\";\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 151://HeightMapNormalMethod - thios is not implemented for now, but might appear later\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 152: //SimpleWaterNormalMethod\r\n\t\t\t\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t\t\t\t\tvar thisTex:TextureBase=undefined;\r\n\t\t\t\t\t\t\tif (targetID>0) {\r\n\t\t\t\t\t\t\t\tthisTex = <TextureBase>this.awd_file_data.getAssetByID(targetID);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif(thisTex==undefined){\r\n\t\t\t\t\t\t\t\tthisTex=DefaultMaterialManager.getDefaultTexture();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t//if (!returnedArray[0])\r\n\t\t\t\t\t\t\t//\tthis.awd_file_data._blocks[blockID].addError(\"Could not find the SecoundNormalMap (ID = \" + targetID + \" ) for this.awd_file_data SimpleWaterNormalMethod\");\r\n\t\t\t\t\t\t\t//if (!mat.normalMap)\r\n\t\t\t\t\t\t\t//\tthis.awd_file_data._blocks[blockID].addError(\"Could not find a normal Map on this.awd_file_data Material to use with this.awd_file_data SimpleWaterNormalMethod\");\r\n\t\t\t\t\t\t\tif(mat.normalMap==undefined)\r\n\t\t\t\t\t\t\t\tmat.normalMap = <Texture2DBase>thisTex;\r\n\t\t\t\t\t\t\tmat.normalMethod = new NormalSimpleWaterMethod(<Texture2DBase>mat.normalMap, <Texture2DBase>thisTex);\r\n\t\t\t\t\t\t\tdebugString += \" | NormalSimpleWaterMethod | Second-NormalTexture-Name = \" + (<Texture2DBase> thisTex).name;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.awd_file_data.parseUserAttributes();\r\n\t\t\t\t\tmethods_parsed += 1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t// todo: we should not need this.awd_file_data anymore (if using texture-atlas)\r\n\t\telse if ((type>=3)&&(type<=7)){\r\n\t\t\t// if this.awd_file_data is a curve material, we create it, finalize it, assign it to block-cache and return and return.\r\n\t\t\tvar color:number = props.get(1, 0xcccccc);\r\n\t\t\tdebugString+=color;\r\n\r\n\t\t\tvar diffuseTex_addr:number = props.get(2, 0);\r\n\r\n\t\t\tvar diffuseTexture:TextureBase=undefined;\r\n\t\t\tif (diffuseTex_addr>0) {\r\n\t\t\t\tdiffuseTexture = <TextureBase>this.awd_file_data.getAssetByID(diffuseTex_addr);\r\n\t\t\t}\r\n\t\t\tif(diffuseTex_addr==undefined){\r\n\t\t\t\tdiffuseTexture=DefaultMaterialManager.getDefaultTexture();\r\n\t\t\t}\r\n\r\n\t\t\tvar curve_mat:CurveMaterial = new CurveMaterial(<Texture2DBase>diffuseTexture);\r\n\t\t\t//debugString+= \" alpha = \"+props.get(10, 1.0)+\" \";\r\n\t\t\tdebugString+= \" texture = \"+diffuseTex_addr+\" \";\r\n\t\t\tcurve_mat.bothSides = true;\r\n\t\t\tcurve_mat.preserveAlpha = true;\r\n\t\t\tcurve_mat.alphaBlending = true;\r\n\t\t\tcurve_mat.extra = this.awd_file_data.parseUserAttributes();\r\n\t\t\tif (this.awd_file_data.debug)\r\n\t\t\t\tconsole.log(debugString);\r\n\t\t\tthis.awd_file_data.cur_block.data=curve_mat;\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\t\tmat.extra = this.awd_file_data.parseUserAttributes();\r\n\t\tthis.awd_file_data.cur_block.data=mat;\r\n\t\tif (this.awd_file_data.debug) {\r\n\t\t\tconsole.log(debugString);\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\nexport = MaterialAWDParser;",
    "/**\r\n * Created by 80prozent on 4/18/2015.\r\n */\r\n\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDBlockParserBase\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\n\r\nimport Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Mesh\t\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Mesh\");\r\n\r\nimport DisplayObjectContainer\t\t\t= require(\"awayjs-display/lib/containers/DisplayObjectContainer\");\r\nimport DisplayObject\t\t\t\t\t= require(\"awayjs-display/lib/base/DisplayObject\");\r\nimport MaterialBase\t\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\r\nimport Geometry\t\t\t\t\t\t\t= require(\"awayjs-core/lib/data/Geometry\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\nimport AWD3Utils\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\nclass MeshAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\t\tvar num_materials:number;\r\n\t\tvar materials_parsed:number;\r\n\t\tif(this.awd_file_data.cur_block.type==23) {\r\n\t\t\tvar par_id:number = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t\tvar mtx:Matrix3D = this.awd_file_data.parseMatrix3D();\r\n\t\t}\r\n\t\tthis.awd_file_data.cur_block.name = this.awd_file_data.parseVarStr();\r\n\t\tvar parentName:string = \"Root (TopLevel)\";\r\n\t\tvar data_id:number = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\tvar geom:Geometry = <Geometry>this.awd_file_data.getAssetByID(data_id)\r\n\r\n\t\tif (geom==undefined) {\r\n\t\t\tgeom = new Geometry();\r\n\t\t}\r\n\r\n\t\tthis.awd_file_data.cur_block.geoID = data_id;\r\n\t\tvar materials:Array<MaterialBase> = new Array<MaterialBase>();\r\n\t\tnum_materials = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\r\n\t\tvar materialNames:Array<string> = new Array<string>();\r\n\t\tmaterials_parsed = 0;\r\n\r\n\r\n\t\twhile (materials_parsed < num_materials) {\r\n\t\t\tvar mat_id:number;\r\n\t\t\tmat_id = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t\tvar m:MaterialBase = <MaterialBase> this.awd_file_data.getAssetByID(mat_id);\r\n\t\t\tif(m!=undefined) {\r\n\t\t\t\tmaterials.push(m);\r\n\t\t\t\tmaterialNames.push(m.name);\r\n\t\t\t}\r\n\t\t\tmaterials_parsed++;\r\n\t\t}\r\n\r\n\t\tvar mesh:Mesh = new Mesh(geom, null);\r\n\r\n\t\tif(this.awd_file_data.cur_block.type==23) {\r\n\r\n\t\t\tmesh.transform.matrix3D = mtx;\r\n\t\t\tif(par_id>0) {\r\n\t\t\t\tvar parent:DisplayObjectContainer = <DisplayObjectContainer>this.awd_file_data.getAssetByID(par_id)\r\n\r\n\t\t\t\tif (parent != undefined) {\r\n\t\t\t\t\tparent.addChild(mesh);\r\n\t\t\t\t\tparentName = parent.name;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (materials.length >= 1 && mesh.subMeshes.length == 1) {\r\n\t\t\tmesh.material = materials[0];\r\n\t\t} else if (materials.length > 1) {\r\n\t\t\tvar i:number;\r\n\r\n\t\t\t// Assign each sub-mesh in the mesh a material from the list. If more sub-meshes\r\n\t\t\t// than materials, repeat the last material for all remaining sub-meshes.\r\n\t\t\tfor (i = 0; i < mesh.subMeshes.length; i++) {\r\n\t\t\t\tmesh.subMeshes[i].material = materials[Math.min(materials.length - 1, i)];\r\n\t\t\t}\r\n\t\t}\r\n\t\tif ((this.awd_file_data.major_version > 2)||((this.awd_file_data.major_version >= 2) && (this.awd_file_data.minor_version == 1))) {\r\n\t\t\tvar props:AWDProperties = this.awd_file_data.parseProperties({1:this.awd_file_data.matrixNrType, 2:this.awd_file_data.matrixNrType, 3:this.awd_file_data.matrixNrType, 4:AWD3Utils.UINT8, 5:AWD3Utils.BOOL});\r\n\t\t\tmesh.pivot = new Vector3D(<number>props.get(1, 0), <number>props.get(2, 0), <number> props.get(3, 0));\r\n\t\t\tmesh.castsShadows = props.get(5, true);\r\n\t\t} else {\r\n\t\t\tthis.awd_file_data.parseProperties(null);\r\n\t\t}\r\n\r\n\t\tmesh.extra = this.awd_file_data.parseUserAttributes();\r\n\t\tthis.awd_file_data.cur_block.data = mesh;\r\n\t\tif (this.awd_file_data.debug) {\r\n\t\t\tconsole.log(\"Parsed a Mesh: Name = '\" + name + \"' | Parent-Name = \" + parentName + \"| Geometry-Name = \" + geom.name + \" | SubMeshes = \" + mesh.subMeshes.length + \" | Mat-Names = \" + materialNames.toString());\r\n\t\t}\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport = MeshAWDParser;",
    "\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDBlockParserBase\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\n\r\nimport AWD3Utils\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\nclass MetadataAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\t\tthis.awd_file_data.cur_block.state=AWD3Utils.BLOCKSTATE_NO_ASSET;\r\n\t\tvar props:AWDProperties = this.awd_file_data.parseProperties({1:AWD3Utils.UINT32, 2:AWD3Utils.AWDSTRING, 3:AWD3Utils.AWDSTRING, 4:AWD3Utils.AWDSTRING, 5:AWD3Utils.AWDSTRING});\r\n\r\n\t\tif (this.awd_file_data.debug) {\r\n\t\t\tconsole.log(\"Parsed a MetaDataBlock: TimeStamp         = \" + props.get(1, 0));\r\n\t\t\tconsole.log(\"                        EncoderName       = \" + props.get(2, \"unknown\"));\r\n\t\t\tconsole.log(\"                        EncoderVersion    = \" + props.get(3, \"unknown\"));\r\n\t\t\tconsole.log(\"                        GeneratorName     = \" + props.get(4, \"unknown\"));\r\n\t\t\tconsole.log(\"                        GeneratorVersion  = \" + props.get(5, \"unknown\"));\r\n\t\t}\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport = MetadataAWDParser;",
    "\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDBlockParserBase\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDBitFlags\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDBitFlags\");\r\nimport DisplayObject\t\t\t\t\t= require(\"awayjs-display/lib/base/DisplayObject\");\r\n\r\nimport ColorTransform\t\t\t\t\t= require(\"awayjs-core/lib/geom/ColorTransform\");\r\nimport Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\n\r\nimport MovieClip \t\t\t\t\t= require(\"awayjs-player/lib/display/MovieClip\");\r\nimport TimelineKeyFrame \t\t\t= require(\"awayjs-player/lib/timeline/TimelineKeyFrame\");\r\nimport AddChildCommand \t\t\t\t= require(\"awayjs-player/lib/timeline/commands/AddChildCommand\");\r\nimport AddChildAtDepthCommand\t\t= require(\"awayjs-player/lib/timeline/commands/AddChildAtDepthCommand\");\r\nimport ApplyAS2DepthsCommand\t\t= require(\"awayjs-player/lib/timeline/commands/ApplyAS2DepthsCommand\");\r\nimport ExecuteScriptCommand \t\t= require(\"awayjs-player/lib/timeline/commands/ExecuteScriptCommand\");\r\nimport RemoveChildCommand \t\t\t= require(\"awayjs-player/lib/timeline/commands/RemoveChildCommand\");\r\nimport RemoveChildrenAtDepthCommand\t= require(\"awayjs-player/lib/timeline/commands/RemoveChildrenAtDepthCommand\");\r\nimport SetInstanceNameCommand \t\t= require(\"awayjs-player/lib/timeline/commands/SetInstanceNameCommand\");\r\nimport UpdatePropertyCommand \t\t= require(\"awayjs-player/lib/timeline/commands/UpdatePropertyCommand\");\r\nimport SetMaskCommand \t\t        = require(\"awayjs-player/lib/timeline/commands/SetMaskCommand\");\r\n\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\n\r\nimport TextField\t\t\t\t\t= require(\"awayjs-display/lib/entities/TextField\");\r\n\r\nimport AS2SceneGraphFactory \t\t= require(\"awayjs-player/lib/factories/AS2SceneGraphFactory\");\r\n\r\nclass MovieClipAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\tprivate factory:AS2SceneGraphFactory;\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t\tthis.factory = new AS2SceneGraphFactory();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\r\n\t\tvar i:number;\r\n\t\tvar j:number;\r\n\t\tvar c:number;\r\n\t\tvar new_mc = this.factory.createMovieClip();\r\n\t\tthis.awd_file_data.cur_block.name = this.awd_file_data.parseVarStr();\r\n\t\tvar isScene = !!this.awd_file_data.newBlockBytes.readUnsignedByte();\r\n\t\tvar sceneID = this.awd_file_data.newBlockBytes.readUnsignedByte();\r\n\t\tvar fps:number = this.awd_file_data.newBlockBytes.readFloat();\r\n\t\t//console.log(\"fps = \"+fps);\r\n\t\t//new_mc.fps=fps;\r\n\t\tvar ms_per_frame = 1000 / fps;\r\n\t\tvar num_instances:number=0;\r\n\t\tvar num_all_display_instances:number=0;\r\n\r\n\r\n\t\t// register list of potential childs\r\n\t\t// a potential child can be reused on a timeline (added / removed / added)\r\n\t\t// However, for each potential child, we need to register the max-number of instances that a frame contains\r\n\t\t// we parse 2 lists of potential-childs:\r\n\t\t// -\tthe first list contains potential-childs that are only ever instanced once per frame.\r\n\t\t// -\tthe second list contains potential-childs that are instanced multiple times on some frames.\r\n\r\n\t\t// on registering a child, the child gets a incremental-id assigned. This is the id, that the commands are using to access the childs.\r\n\t\t// hence we need to be careful to register all objects in correct order.\r\n\r\n\t\tvar num_potential_childs:number = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\tfor (i = 0; i < num_potential_childs; i++) {\r\n\t\t\tresourceID = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t\tvar cmd_asset:DisplayObject = <DisplayObject>this.awd_file_data.getAssetByID(resourceID);\r\n\t\t\tif (cmd_asset != null) {\r\n\t\t\t\tnew_mc.registerPotentialChild(cmd_asset);\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\t//todo: register a default display object on timeline, so we do not mess up the incremental obj-id\r\n\t\t\t\t//new_mc.registerPotentialChild(cmd_asset);\r\n\t\t\t\tconsole.log(\"ERROR when collecting objects for timeline\");\r\n\t\t\t}\r\n\t\t}\r\n\t\tnum_all_display_instances+=num_potential_childs;\r\n\t\tvar num_potential_childs_multi_instanced = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\tnum_potential_childs+=num_potential_childs_multi_instanced;\r\n\t\tfor (i = 0; i < num_potential_childs_multi_instanced; i++) {\r\n\t\t\tresourceID = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t\tnum_instances = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\t\tnum_all_display_instances+=num_instances;\r\n\t\t\tvar cmd_asset:DisplayObject = <DisplayObject>this.awd_file_data.getAssetByID(resourceID);\r\n\t\t\tif (cmd_asset != null) {\r\n\t\t\t\tfor (j = 0; j < num_instances; j++) {\r\n\t\t\t\t\tnew_mc.registerPotentialChild(cmd_asset);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tfor (j = 0; j < num_instances; j++) {\r\n\t\t\t\t\t//todo: register a default display object on timeline, so we do not mess up the incremental obj-id\r\n\t\t\t\t\t//new_mc.registerPotentialChild(cmd_asset);\r\n\t\t\t\t\tconsole.log(\"ERROR when collecting objects for timeline\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t//console.log(\"Parsed \"+num_potential_childs+\" potential childs. They will be used by \"+num_all_display_instances+\" instances.\");\r\n\r\n\t\t// register list of potential sounds\r\n\t\t// a potential child can be reused on a timeline (added / removed / added)\r\n\t\tvar num_potential_sounds = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\tfor (i = 0; i < num_potential_sounds; i++) {\r\n\t\t\tresourceID = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t\tvar cmd_asset:DisplayObject = <DisplayObject>this.awd_file_data.getAssetByID(resourceID);\r\n\t\t\tif (cmd_asset != null) {\r\n\t\t\t\t//todo: register sound objects on movieclip\r\n\t\t\t\tconsole.log(\"ERROR when collecting objects for timeline\");\r\n\t\t\t\t//new_mc.registerPotentialChild(cmd_asset);\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\t//todo: this.awd_file_data is a error that might break complete timeline, because all sound obj-id shift\r\n\t\t\t}\r\n\t\t}\r\n\t\t//console.log(\"Parsed \"+num_potential_sounds+\" potential sounds\");\r\n\r\n\t\tvar numFrames = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\r\n\t\t//console.log(\"numFrames \"+numFrames);\r\n\r\n\t\tvar totalDuration:number;\r\n\t\tvar frameDuration:number;\r\n\t\tvar numLabels:number;\r\n\t\tvar numCommands:number;\r\n\t\tvar objectID:number;\r\n\t\tvar target_depth:number;\r\n\t\tvar resourceID:number;\r\n\t\tvar number_of_obj:number;\r\n\t\tvar commandType:number;\r\n\t\tvar frame:TimelineKeyFrame;\r\n\t\tvar label:string;\r\n\t\tvar hasDepthChanges:boolean;\r\n\t\ttotalDuration=0;\r\n\t\tfor (i = 0; i < numFrames; i++) {\r\n\t\t\tframe = new TimelineKeyFrame();\r\n\t\t\t// todo: remove the ms_per_frame to set the duration in frames\r\n\t\t\tframeDuration = this.awd_file_data.newBlockBytes.readUnsignedInt()*ms_per_frame;\r\n\t\t\tframe.setFrameTime(totalDuration, frameDuration);\r\n\t\t\ttotalDuration += frameDuration;\r\n\t\t\t//console.log(\"duration = \" + frameDuration);\r\n\r\n\t\t\tnumLabels = this.awd_file_data.newBlockBytes.readUnsignedByte();\r\n\t\t\tfor (j = 0; j < numLabels; j++) {\r\n\t\t\t\tlabel = this.awd_file_data.parseVarStr();\r\n\t\t\t\t//console.log(\"label \"+label);\r\n\t\t\t}\r\n\r\n\t\t\tnumCommands = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\t\t//console.log(\"numCommands \"+numCommands);\r\n\t\t\t//traceString += \"\\n      Commands \" + numCommands;\r\n\t\t\thasDepthChanges = false;\r\n\t\t\tfor (j = 0; j < numCommands; j++) {\r\n\t\t\t\tcommandType = this.awd_file_data.newBlockBytes.readUnsignedByte();\r\n\r\n\t\t\t\t// 1 = remove a number of objects by depth\r\n\t\t\t\t// 2 = add a object by child-id at specific depth\r\n\t\t\t\t// 3 = update a object by child-id\r\n\t\t\t\t// 4 = add / update sound - (not finished)\r\n\r\n\t\t\t\tswitch (commandType) {\r\n\r\n\t\t\t\t\tcase 1:// remove a number of objects at specific depth\r\n\t\t\t\t\t\tnumber_of_obj = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\t\t\t\t\t//console.log(\"number_of_obj \", number_of_obj);\r\n\t\t\t\t\t\tvar remove_depths:Array<number>=new Array<number>();\r\n\t\t\t\t\t\tfor (c = 0; c < number_of_obj; c++) {\r\n\t\t\t\t\t\t\t// Remove Object Command\r\n\t\t\t\t\t\t\ttarget_depth = this.awd_file_data.newBlockBytes.readShort();\r\n\t\t\t\t\t\t\tremove_depths.push(target_depth);\r\n\t\t\t\t\t\t\t//console.log(\"\\n       - Remove object at depth: \" + target_depth);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tframe.addConstructCommand(new RemoveChildrenAtDepthCommand(remove_depths));\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 2:// add a of object by child-id at specific depth\r\n\t\t\t\t\tcase 3:// update a object by child-id\r\n\t\t\t\t\t\tobjectID = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\t\t\t\t\t//console.log(\"add / update objectID \", objectID);\r\n\t\t\t\t\t\tif (commandType == 2) {\r\n\t\t\t\t\t\t\thasDepthChanges=true;\r\n\t\t\t\t\t\t\ttarget_depth = this.awd_file_data.newBlockBytes.readShort();\r\n\t\t\t\t\t\t\t//console.log(\"target_depth \", target_depth);\r\n\t\t\t\t\t\t\tvar potChild = new_mc.getPotentialChild(objectID);\r\n\t\t\t\t\t\t\tif (potChild != undefined) {\r\n\t\t\t\t\t\t\t\tframe.addConstructCommand(new AddChildAtDepthCommand(objectID, target_depth));\r\n\t\t\t\t\t\t\t\t// if the object is a tetfield, we set the textfield-name as instancename\r\n\t\t\t\t\t\t\t\tif(potChild.isAsset(TextField)) {\r\n\t\t\t\t\t\t\t\t\tframe.addConstructCommand(new SetInstanceNameCommand(objectID, potChild.name));\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\t\tconsole.log(\"ERROR: could not find the objectID \", objectID);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvar props_flag = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\t\t\t\t\t/*\tProps_flags\r\n\t\t\t\t\t\t 1: read display matrix - 6 x float,\r\n\t\t\t\t\t\t 2: read display matrix - read another UINT8-bitflag that determinates what matrix components to parse\r\n\t\t\t\t\t\t 3: read color matrix - 4 x float, 4 x uint16\r\n\t\t\t\t\t\t 4: read color matrix - read another UINT8-bitflag that determinates what matrix components to parse\r\n\t\t\t\t\t\t 5: blendmode - uint8\r\n\t\t\t\t\t\t 6: visible - boolean\r\n\t\t\t\t\t\t 7: AWD3Parser.UINT8\r\n\t\t\t\t\t\t });*/\r\n\t\t\t\t\t\t// read display matrix\r\n\t\t\t\t\t\tif (AWDBitFlags.test(props_flag, AWDBitFlags.FLAG1)) {\r\n\t\t\t\t\t\t\tvar thisMatrix = new Matrix3D();\r\n\t\t\t\t\t\t\tif (AWDBitFlags.test(props_flag, AWDBitFlags.FLAG2)) {\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tthisMatrix.rawData[0] = this.awd_file_data.newBlockBytes.readFloat();\r\n\t\t\t\t\t\t\t\tthisMatrix.rawData[1] = this.awd_file_data.newBlockBytes.readFloat();\r\n\t\t\t\t\t\t\t\tthisMatrix.rawData[4] = this.awd_file_data.newBlockBytes.readFloat();\r\n\t\t\t\t\t\t\t\tthisMatrix.rawData[5] = this.awd_file_data.newBlockBytes.readFloat();\r\n\t\t\t\t\t\t\t\tthisMatrix.position = new Vector3D(this.awd_file_data.newBlockBytes.readFloat(), this.awd_file_data.newBlockBytes.readFloat(), 0);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tframe.addConstructCommand(new UpdatePropertyCommand(objectID, \"_iMatrix3D\", thisMatrix));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// read colortransforms\r\n\t\t\t\t\t\tif (AWDBitFlags.test(props_flag, AWDBitFlags.FLAG3)) {\r\n\t\t\t\t\t\t\tvar thisColorTransform = new ColorTransform();\r\n\t\t\t\t\t\t\tif (AWDBitFlags.test(props_flag, AWDBitFlags.FLAG4)) {\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tthisColorTransform.redMultiplier = this.awd_file_data.newBlockBytes.readFloat();\r\n\t\t\t\t\t\t\t\tthisColorTransform.greenMultiplier = this.awd_file_data.newBlockBytes.readFloat();\r\n\t\t\t\t\t\t\t\tthisColorTransform.blueMultiplier = this.awd_file_data.newBlockBytes.readFloat();\r\n\t\t\t\t\t\t\t\tthisColorTransform.alphaMultiplier = this.awd_file_data.newBlockBytes.readFloat();\r\n\t\t\t\t\t\t\t\tthisColorTransform.redOffset = this.awd_file_data.newBlockBytes.readShort();\r\n\t\t\t\t\t\t\t\tthisColorTransform.greenOffset = this.awd_file_data.newBlockBytes.readShort();\r\n\t\t\t\t\t\t\t\tthisColorTransform.blueOffset = this.awd_file_data.newBlockBytes.readShort();\r\n\t\t\t\t\t\t\t\tthisColorTransform.alphaOffset = this.awd_file_data.newBlockBytes.readShort();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (AWDBitFlags.test(props_flag, AWDBitFlags.FLAG5)) {\r\n\t\t\t\t\t\t\tvar blendmode_int = this.awd_file_data.newBlockBytes.readUnsignedByte();\r\n\t\t\t\t\t\t\tvar blendmode_string = this.awd_file_data.getBlendModeStringFromEnum(blendmode_int);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (AWDBitFlags.test(props_flag, AWDBitFlags.FLAG6)) {\r\n\t\t\t\t\t\t\tframe.addConstructCommand(new UpdatePropertyCommand(objectID, \"visible\", this.awd_file_data.newBlockBytes.readByte()));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (AWDBitFlags.test(props_flag, AWDBitFlags.FLAG7)) {\r\n\t\t\t\t\t\t\tvar instanceName = this.awd_file_data.parseVarStr();\r\n\t\t\t\t\t\t\tif (instanceName.length) {\r\n\t\t\t\t\t\t\t\tframe.addConstructCommand(new SetInstanceNameCommand(objectID, instanceName));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (AWDBitFlags.test(props_flag, AWDBitFlags.FLAG8)) {\r\n\t\t\t\t\t\t\tvar mask_id_nums = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\t\t\t\t\t\tvar mask_ids = new Array();\r\n\t\t\t\t\t\t\tfor (var mi_cnt = 0; mi_cnt < mask_id_nums; mi_cnt++) {\r\n\t\t\t\t\t\t\t\tmask_ids.push(this.awd_file_data.newBlockBytes.readShort());\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (mask_ids.length > 0) {\r\n\t\t\t\t\t\t\t\tif ((mask_ids.length == 1) && (mask_ids[0] == -1)) {\r\n\t\t\t\t\t\t\t\t\t// TODO: this.awd_file_data object is used as mask\r\n\t\t\t\t\t\t\t\t\tframe.addConstructCommand(new UpdatePropertyCommand(objectID, \"_iMaskID\", objectID));\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\tframe.addConstructCommand(new SetMaskCommand(objectID, mask_ids));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 4:\r\n\r\n\t\t\t\t\t\t// Add Sound Command\r\n\t\t\t\t\t\t// TODO: create CommandPropsSound and check which asset to use\r\n\t\t\t\t\t\tobjectID = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t\t\t\t\tresourceID = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t\t\t\t\t// TODO: implement sound in timeline\r\n\t\t\t\t\t\t//commandString += \"\\n      - Add new Sound AWD-ID = \" + resourceID.toString() + \" as object_id = \" + objectID.toString();\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tdefault:\r\n\r\n\t\t\t\t\t\t//commandString += \"\\n       - Unknown Command Type = \" + commandType;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (hasDepthChanges) {\r\n\t\t\t\t// only want to do this.awd_file_data once after all children's depth values are updated\r\n\t\t\t\tframe.addConstructCommand(new ApplyAS2DepthsCommand());\r\n\t\t\t\thasDepthChanges = false;\r\n\t\t\t}\r\n\r\n\t\t\tvar length_code = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t\tif (length_code > 0) {\r\n\t\t\t\t// TODO: Script should probably not be attached to keyframes?\r\n\t\t\t\tvar frame_code = this.awd_file_data.newBlockBytes.readUTFBytes(length_code);\r\n\t\t\t\tframe.addConstructCommand(new ExecuteScriptCommand(frame_code));\r\n\t\t\t\t//traceString += \"\\nframe-code = \" + frame_code;\r\n\t\t\t}\r\n\t\t\t//traceString += commandString;\r\n\t\t\t//trace(\"length_code = \"+length_code+\" frame_code = \"+frame_code);\r\n\t\t\tthis.awd_file_data.newBlockBytes.readUnsignedInt();// user attributes - skip for now\r\n\t\t\t//console.log(traceString);\r\n\t\t\tnew_mc.addFrame(frame);\r\n\r\n\t\t}\r\n\t\tthis.awd_file_data.parseProperties(null);\r\n\t\tthis.awd_file_data.parseUserAttributes();\r\n\t\tthis.awd_file_data.cur_block.data = new_mc;\r\n\t\tif (this.awd_file_data.debug)\r\n\t\t\tconsole.log(\"Parsed a TIMELINE: Name = \" + name + \"| isScene = \" + isScene + \"| sceneID = \" + sceneID + \"| numFrames = \" + numFrames);\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport = MovieClipAWDParser;",
    "\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDBlockParserBase\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\nimport AWD3Utils\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\nimport PrefabBase\t\t\t\t\t\t= require(\"awayjs-display/lib/prefabs/PrefabBase\");\r\nimport PrimitiveCapsulePrefab\t\t\t= require(\"awayjs-display/lib/prefabs/PrimitiveCapsulePrefab\");\r\nimport PrimitiveConePrefab\t\t\t\t= require(\"awayjs-display/lib/prefabs/PrimitiveConePrefab\");\r\nimport PrimitiveCubePrefab\t\t\t\t= require(\"awayjs-display/lib/prefabs/PrimitiveCubePrefab\");\r\nimport PrimitiveCylinderPrefab\t\t\t= require(\"awayjs-display/lib/prefabs/PrimitiveCylinderPrefab\");\r\nimport PrimitivePlanePrefab\t\t\t\t= require(\"awayjs-display/lib/prefabs/PrimitivePlanePrefab\");\r\nimport PrimitiveSpherePrefab\t\t\t= require(\"awayjs-display/lib/prefabs/PrimitiveSpherePrefab\");\r\nimport PrimitiveTorusPrefab\t\t\t\t= require(\"awayjs-display/lib/prefabs/PrimitiveTorusPrefab\");\r\nimport Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\n\r\nclass PrefabAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\t\tvar name:string;\r\n\t\tvar prefab:PrefabBase;\r\n\t\tvar primType:number;\r\n\t\tvar subs_parsed:number;\r\n\t\tvar props:AWDProperties;\r\n\t\tvar bsm:Matrix3D;\r\n\r\n\t\t// Read name and sub count\r\n\t\tthis.awd_file_data.cur_block.name = this.awd_file_data.parseVarStr();\r\n\t\tprimType = this.awd_file_data.newBlockBytes.readUnsignedByte();\r\n\t\tprops = this.awd_file_data.parseProperties({101:this.awd_file_data.geoNrType, 102:this.awd_file_data.geoNrType, 103:this.awd_file_data.geoNrType, 110:this.awd_file_data.geoNrType, 111:this.awd_file_data.geoNrType, 301:AWD3Utils.UINT16, 302:AWD3Utils.UINT16, 303:AWD3Utils.UINT16, 701:AWD3Utils.BOOL, 702:AWD3Utils.BOOL, 703:AWD3Utils.BOOL, 704:AWD3Utils.BOOL});\r\n\r\n\t\tvar primitiveTypes:Array<string> = [\"Unsupported Type-ID\", \"PrimitivePlanePrefab\", \"PrimitiveCubePrefab\", \"PrimitiveSpherePrefab\", \"PrimitiveCylinderPrefab\", \"PrimitivesConePrefab\", \"PrimitivesCapsulePrefab\", \"PrimitivesTorusPrefab\"]\r\n\r\n\t\tswitch (primType) {\r\n\t\t\t// to do, not all properties are set on all primitives\r\n\r\n\t\t\tcase 1:\r\n\t\t\t\tprefab = new PrimitivePlanePrefab(props.get(101, 100), props.get(102, 100), props.get(301, 1), props.get(302, 1), props.get(701, true), props.get(702, false));\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 2:\r\n\t\t\t\tprefab = new PrimitiveCubePrefab(props.get(101, 100), props.get(102, 100), props.get(103, 100), props.get(301, 1), props.get(302, 1), props.get(303, 1), props.get(701, true));\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 3:\r\n\t\t\t\tprefab = new PrimitiveSpherePrefab(props.get(101, 50), props.get(301, 16), props.get(302, 12), props.get(701, true));\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 4:\r\n\t\t\t\tprefab = new PrimitiveCylinderPrefab(props.get(101, 50), props.get(102, 50), props.get(103, 100), props.get(301, 16), props.get(302, 1), true, true, true); // bool701, bool702, bool703, bool704);\r\n\t\t\t\tif (!props.get(701, true))\r\n\t\t\t\t\t(<PrimitiveCylinderPrefab>prefab).topClosed = false;\r\n\t\t\t\tif (!props.get(702, true))\r\n\t\t\t\t\t(<PrimitiveCylinderPrefab>prefab).bottomClosed = false;\r\n\t\t\t\tif (!props.get(703, true))\r\n\t\t\t\t\t(<PrimitiveCylinderPrefab>prefab).yUp = false;\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 5:\r\n\t\t\t\tprefab = new PrimitiveConePrefab(props.get(101, 50), props.get(102, 100), props.get(301, 16), props.get(302, 1), props.get(701, true), props.get(702, true));\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 6:\r\n\t\t\t\tprefab = new PrimitiveCapsulePrefab(props.get(101, 50), props.get(102, 100), props.get(301, 16), props.get(302, 15), props.get(701, true));\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 7:\r\n\t\t\t\tprefab = new PrimitiveTorusPrefab(props.get(101, 50), props.get(102, 50), props.get(301, 16), props.get(302, 8), props.get(701, true));\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\t\t\t\tprefab = new PrefabBase();\r\n\t\t\t\tconsole.log(\"ERROR: UNSUPPORTED PREFAB_TYPE\");\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tif ((props.get(110, 1) != 1) || (props.get(111, 1) != 1)) {\r\n\t\t\t//geom.subGeometries;\r\n\t\t\t//geom.scaleUV(props.get(110, 1), props.get(111, 1)); //TODO add back scaling to prefabs\r\n\t\t}\r\n\r\n\t\tthis.awd_file_data.parseUserAttributes();\r\n\t\tthis.awd_file_data.cur_block.data = prefab;\r\n\r\n\t\tif (this.awd_file_data.debug) {\r\n\t\t\tif ((primType < 0) || (primType > 7)) {\r\n\t\t\t\tprimType = 0;\r\n\t\t\t}\r\n\t\t\tconsole.log(\"Parsed a Primivite: Name = \" + this.awd_file_data.cur_block.name + \"| type = \" + primitiveTypes[primType]);\r\n\t\t}\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport = PrefabAWDParser;",
    "\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDBlockParserBase\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\nimport AWD3Utils\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\nimport LightBase\t\t\t\t\t\t= require(\"awayjs-display/lib/base/LightBase\");\r\nimport DirectionalLight\t\t\t\t\t= require(\"awayjs-display/lib/entities/DirectionalLight\");\r\nimport PointLight\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/PointLight\");\r\n\r\nimport ShadowMapMethodBase\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadowMapMethodBase\");\r\nimport ShadowMethodBase\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadowMethodBase\");\r\nimport ShadowDitheredMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadowDitheredMethod\");\r\nimport ShadowFilteredMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadowFilteredMethod\");\r\nimport ShadowHardMethod\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadowHardMethod\");\r\nimport ShadowNearMethod\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadowNearMethod\");\r\nimport ShadowSoftMethod\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadowSoftMethod\");\r\n\r\nclass ShadowMethodAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\t\tvar type:number;\r\n\t\tvar data_len:number;\r\n\t\tvar asset:ShadowMethodBase;\r\n\t\tvar shadowLightID:number;\r\n\t\tvar name:string = this.awd_file_data.parseVarStr();\r\n\r\n\t\tshadowLightID = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\tvar light:LightBase=<LightBase> this.awd_file_data.getAssetByID(shadowLightID);\r\n\r\n\t\tif (light==undefined) {\r\n\t\t\t//this.awd_file_data._blocks[blockID].addError(\"Could not find the TargetLight (ID = \" + shadowLightID + \" ) for this.awd_file_data ShadowMethod - ShadowMethod not created\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tasset = this.parseShadowMethodList(light);\r\n\r\n\t\tif (!asset)\r\n\t\t\treturn;\r\n\t\tasset.name=name;\r\n\t\tthis.awd_file_data.parseUserAttributes(); // Ignore for now\r\n\r\n\t\tif (this.awd_file_data.debug) {\r\n\t\t\tconsole.log(\"Parsed a ShadowMapMethodMethod: Name = \" + asset.name + \" | Type = \" + asset + \" | Light-Name = \", light.name);\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t// this.awd_file_data functions reads and creates a ShadowMethodMethod\r\n\tprivate parseShadowMethodList(light:LightBase):ShadowMethodBase\r\n\t{\r\n\r\n\t\tvar methodType:number = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\tvar shadowMethod:ShadowMethodBase;\r\n\t\tvar props:AWDProperties = this.awd_file_data.parseProperties({1:AWD3Utils.BADDR, 2:AWD3Utils.BADDR, 3:AWD3Utils.BADDR, 101:this.awd_file_data.propsNrType, 102:this.awd_file_data.propsNrType, 103:this.awd_file_data.propsNrType, 201:AWD3Utils.UINT32, 202:AWD3Utils.UINT32, 301:AWD3Utils.UINT16, 302:AWD3Utils.UINT16, 401:AWD3Utils.UINT8, 402:AWD3Utils.UINT8, 601:AWD3Utils.COLOR, 602:AWD3Utils.COLOR, 701:AWD3Utils.BOOL, 702:AWD3Utils.BOOL, 801:AWD3Utils.MTX4x4});\r\n\r\n\t\tvar targetID:number;\r\n\t\tvar returnedArray:Array<any>\r\n\t\tswitch (methodType) {\r\n\t\t\t//\t\t\t\tcase 1001: //CascadeShadowMapMethod\r\n\t\t\t//\t\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t//\t\t\t\t\treturnedArray = getAssetByID(targetID, [ShadowMapMethodBase.assetType]);\r\n\t\t\t//\t\t\t\t\tif (!returnedArray[0]) {\r\n\t\t\t//\t\t\t\t\t\t_blocks[blockID].addError(\"Could not find the ShadowBaseMethod (ID = \" + targetID + \" ) for this.awd_file_data CascadeShadowMapMethod - ShadowMethod not created\");\r\n\t\t\t//\t\t\t\t\t\treturn shadowMethod;\r\n\t\t\t//\t\t\t\t\t}\r\n\t\t\t//\t\t\t\t\tshadowMethod = new CascadeShadowMapMethod(returnedArray[1]);\r\n\t\t\t//\t\t\t\t\tbreak;\r\n\t\t\tcase 1002: //ShadowNearMethod\r\n\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t\tvar shadow_meth:ShadowMapMethodBase = <ShadowMapMethodBase>this.awd_file_data.getAssetByID(targetID);\r\n\t\t\t\tif (shadow_meth==undefined) {\r\n\t\t\t\t\t//this.awd_file_data._blocks[blockID].addError(\"Could not find the ShadowBaseMethod (ID = \" + targetID + \" ) for this.awd_file_data ShadowNearMethod - ShadowMethod not created\");\r\n\t\t\t\t\treturn shadowMethod;\r\n\t\t\t\t}\r\n\t\t\t\tshadowMethod = new ShadowNearMethod(<ShadowMethodBase> shadow_meth);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 1101: //ShadowFilteredMethod\r\n\r\n\t\t\t\tshadowMethod = new ShadowFilteredMethod(<DirectionalLight> light);\r\n\t\t\t\t(<ShadowFilteredMethod> shadowMethod).alpha = props.get(101, 1);\r\n\t\t\t\t(<ShadowFilteredMethod> shadowMethod).epsilon = props.get(102, 0.002);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 1102: //ShadowDitheredMethod\r\n\r\n\r\n\t\t\t\tshadowMethod = new ShadowDitheredMethod(<DirectionalLight> light, <number> props.get(201, 5));\r\n\t\t\t\t(<ShadowDitheredMethod> shadowMethod).alpha = props.get(101, 1);\r\n\t\t\t\t(<ShadowDitheredMethod> shadowMethod).epsilon = props.get(102, 0.002);\r\n\t\t\t\t(<ShadowDitheredMethod> shadowMethod).range = props.get(103, 1);\r\n\r\n\t\t\t\tbreak;\r\n\t\t\tcase 1103: //ShadowSoftMethod\r\n\r\n\t\t\t\tshadowMethod = new ShadowSoftMethod(<DirectionalLight> light, <number> props.get(201, 5));\r\n\t\t\t\t(<ShadowSoftMethod> shadowMethod).alpha = props.get(101, 1);\r\n\t\t\t\t(<ShadowSoftMethod> shadowMethod).epsilon = props.get(102, 0.002);\r\n\t\t\t\t(<ShadowSoftMethod> shadowMethod).range = props.get(103, 1);\r\n\r\n\t\t\t\tbreak;\r\n\t\t\tcase 1104: //ShadowHardMethod\r\n\t\t\t\tshadowMethod = new ShadowHardMethod(light);\r\n\t\t\t\t(<ShadowHardMethod> shadowMethod).alpha = props.get(101, 1);\r\n\t\t\t\t(<ShadowHardMethod> shadowMethod).epsilon = props.get(102, 0.002);\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\t\tthis.awd_file_data.parseUserAttributes();\r\n\t\treturn shadowMethod;\r\n\t}\r\n}\r\n\r\nexport = ShadowMethodAWDParser;",
    "\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDBlockParserBase\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\nimport AWD3Utils\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\nimport ColorTransform\t\t\t\t\t= require(\"awayjs-core/lib/geom/ColorTransform\");\r\nimport TextureBase\t\t\t\t\t\t= require(\"awayjs-core/lib/textures/TextureBase\");\r\nimport CubeTextureBase\t\t\t\t\t= require(\"awayjs-core/lib/textures/CubeTextureBase\");\r\n\r\nimport EffectMethodBase\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectMethodBase\");\r\nimport EffectColorMatrixMethod\t\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectColorMatrixMethod\");\r\nimport EffectColorTransformMethod\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectColorTransformMethod\");\r\nimport EffectEnvMapMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectEnvMapMethod\");\r\nimport EffectAlphaMaskMethod\t\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectAlphaMaskMethod\");\r\nimport EffectFogMethod\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectFogMethod\");\r\nimport EffectFresnelEnvMapMethod\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectFresnelEnvMapMethod\");\r\nimport EffectLightMapMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectLightMapMethod\");\r\nimport EffectRimLightMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectRimLightMethod\");\r\n\r\nclass SharedMethodAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\r\n\t\tvar asset:EffectMethodBase;\r\n\r\n\t\tvar name:string = this.awd_file_data.parseVarStr();\r\n\t\tasset = this.parseSharedMethodList();\r\n\t\tasset.name=name;\r\n\t\tthis.awd_file_data.parseUserAttributes();\r\n\r\n\t\tif (this.awd_file_data.debug) {\r\n\t\t\tconsole.log(\"Parsed a EffectMethod: Name = \" + asset.name + \" Type = \" + asset);\r\n\t\t}\r\n\t}\r\n\r\n\t// this.awd_file_data functions reads and creates a EffectMethod\r\n\tprivate parseSharedMethodList():EffectMethodBase\r\n\t{\r\n\r\n\t\tvar methodType:number = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\tvar effectMethodReturn:EffectMethodBase;\r\n\r\n\t\tvar props:AWDProperties = this.awd_file_data.parseProperties({1:AWD3Utils.BADDR, 2:AWD3Utils.BADDR, 3:AWD3Utils.BADDR, 101:this.awd_file_data.propsNrType, 102:this.awd_file_data.propsNrType, 103:this.awd_file_data.propsNrType, 104:this.awd_file_data.propsNrType, 105:this.awd_file_data.propsNrType, 106:this.awd_file_data.propsNrType, 107:this.awd_file_data.propsNrType, 201:AWD3Utils.UINT32, 202:AWD3Utils.UINT32, 301:AWD3Utils.UINT16, 302:AWD3Utils.UINT16, 401:AWD3Utils.UINT8, 402:AWD3Utils.UINT8, 601:AWD3Utils.COLOR, 602:AWD3Utils.COLOR, 701:AWD3Utils.BOOL, 702:AWD3Utils.BOOL});\r\n\t\tvar targetID:number;\r\n\t\tvar returnedArray:Array<any>;\r\n\r\n\t\tswitch (methodType) {\r\n\t\t\t// Effect Methods\r\n\t\t\tcase 401: //ColorMatrix\r\n\t\t\t\teffectMethodReturn = new EffectColorMatrixMethod(props.get(101, new Array(0, 0, 0, 1, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1)));\r\n\t\t\t\tbreak;\r\n\t\t\tcase 402: //ColorTransform\r\n\t\t\t\teffectMethodReturn = new EffectColorTransformMethod();\r\n\t\t\t\tvar offCol:number /*uint*/ = props.get(601, 0x00000000);\r\n\t\t\t\t(<EffectColorTransformMethod> effectMethodReturn).colorTransform = new ColorTransform(props.get(102, 1), props.get(103, 1), props.get(104, 1), props.get(101, 1), ((offCol >> 16) & 0xFF), ((offCol >> 8) & 0xFF), (offCol & 0xFF), ((offCol >> 24) & 0xFF));\r\n\t\t\t\tbreak;\r\n\t\t\tcase 403: //EnvMap\r\n\r\n\t\t\t\t/*\r\n\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t\tconsole.log('ENV MAP', targetID);\r\n\r\n\r\n\t\t\t\treturnedArray = this.awd_file_data.getAssetByID(targetID, [ TextureBase.assetType ], \"CubeTexture\");\r\n\t\t\t\t//if (!returnedArray[0])\r\n\t\t\t\t//\tthis.awd_file_data._blocks[blockID].addError(\"Could not find the EnvMap (ID = \" + targetID + \" ) for this.awd_file_data EnvMapMethod\");\r\n\t\t\t\teffectMethodReturn = new EffectEnvMapMethod(<CubeTextureBase> returnedArray[1], <number> props.get(101, 1));\r\n\t\t\t\ttargetID = props.get(2, 0);\r\n\t\t\t\tif (targetID > 0) {\r\n\t\t\t\t\treturnedArray = this.awd_file_data.getAssetByID(targetID, [TextureBase.assetType]);\r\n\t\t\t\t\t//if (!returnedArray[0])\r\n\t\t\t\t\t//\tthis.awd_file_data._blocks[blockID].addError(\"Could not find the Mask-texture (ID = \" + targetID + \" ) for this.awd_file_data EnvMapMethod\");\r\n\r\n\t\t\t\t\t// Todo: test mask with EnvMapMethod\r\n\t\t\t\t\t//(<EnvMapMethod> effectMethodReturn).mask = <Texture2DBase> returnedArray[1];\r\n\t\t\t\t}\r\n\t\t\t\t*/\r\n\t\t\t\tbreak;\r\n\t\t\tcase 404: //LightMapMethod\r\n\t\t\t\t/*\r\n\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t\treturnedArray = this.awd_file_data.getAssetByID(targetID, [TextureBase.assetType]);\r\n\t\t\t\t//if (!returnedArray[0])\r\n\t\t\t\t//\tthis.awd_file_data._blocks[blockID].addError(\"Could not find the LightMap (ID = \" + targetID + \" ) for this.awd_file_data LightMapMethod\");\r\n\t\t\t\teffectMethodReturn = new EffectLightMapMethod(returnedArray[1], this.awd_file_data.getBlendModeStringFromEnum(props.get(401, 10))); //usesecondaryUV not set\r\n\t\t\t\t*/\r\n\t\t\t\tbreak;\r\n\t\t\t//\t\t\t\tcase 405: //ProjectiveTextureMethod\r\n\t\t\t//\t\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t//\t\t\t\t\treturnedArray = getAssetByID(targetID, [TextureProjector.assetType]);\r\n\t\t\t//\t\t\t\t\tif (!returnedArray[0])\r\n\t\t\t//\t\t\t\t\t\t_blocks[blockID].addError(\"Could not find the TextureProjector (ID = \" + targetID + \" ) for this.awd_file_data ProjectiveTextureMethod\");\r\n\t\t\t//\t\t\t\t\teffectMethodReturn = new ProjectiveTextureMethod(returnedArray[1], blendModeDic[props.get(401, 10)]);\r\n\t\t\t//\t\t\t\t\tbreak;\r\n\t\t\tcase 406: //RimLightMethod\r\n\t\t\t\teffectMethodReturn = new EffectRimLightMethod(props.get(601, 0xffffff), props.get(101, 0.4), props.get(101, 2)); //blendMode\r\n\t\t\t\tbreak;\r\n\t\t\tcase 407: //AlphaMaskMethod\r\n\t\t\t\t/*\r\n\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t\treturnedArray = this.awd_file_data.getAssetByID(targetID, [TextureBase.assetType]);\r\n\t\t\t\t//if (!returnedArray[0])\r\n\t\t\t\t//\tthis.awd_file_data._blocks[blockID].addError(\"Could not find the Alpha-texture (ID = \" + targetID + \" ) for this.awd_file_data AlphaMaskMethod\");\r\n\t\t\t\teffectMethodReturn = new EffectAlphaMaskMethod(returnedArray[1], props.get(701, false));\r\n\t\t\t\t*/\r\n\t\t\t\tbreak;\r\n\t\t\t//\t\t\t\tcase 408: //RefractionEnvMapMethod\r\n\t\t\t//\t\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t//\t\t\t\t\treturnedArray = getAssetByID(targetID, [TextureBase.assetType], \"CubeTexture\");\r\n\t\t\t//\t\t\t\t\tif (!returnedArray[0])\r\n\t\t\t//\t\t\t\t\t\t_blocks[blockID].addError(\"Could not find the EnvMap (ID = \" + targetID + \" ) for this.awd_file_data RefractionEnvMapMethod\");\r\n\t\t\t//\t\t\t\t\teffectMethodReturn = new RefractionEnvMapMethod(returnedArray[1], props.get(101, 0.1), props.get(102, 0.01), props.get(103, 0.01), props.get(104, 0.01));\r\n\t\t\t//\t\t\t\t\tRefractionEnvMapMethod(effectMethodReturn).alpha = props.get(104, 1);\r\n\t\t\t//\t\t\t\t\tbreak;\r\n\t\t\t//\t\t\t\tcase 409: //OutlineMethod\r\n\t\t\t//\t\t\t\t\teffectMethodReturn = new OutlineMethod(props.get(601, 0x00000000), props.get(101, 1), props.get(701, true), props.get(702, false));\r\n\t\t\t//\t\t\t\t\tbreak;\r\n\t\t\tcase 410: //FresnelEnvMapMethod\r\n\t\t\t\t/*\r\n\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t\treturnedArray = this.awd_file_data.getAssetByID(targetID, [TextureBase.assetType], \"CubeTexture\");\r\n\t\t\t\t//if (!returnedArray[0])\r\n\t\t\t\t//\tthis.awd_file_data._blocks[blockID].addError(\"Could not find the EnvMap (ID = \" + targetID + \" ) for this.awd_file_data FresnelEnvMapMethod\");\r\n\t\t\t\teffectMethodReturn = new EffectFresnelEnvMapMethod(returnedArray[1], props.get(101, 1));\r\n\t\t\t\t*/\r\n\t\t\t\tbreak;\r\n\t\t\tcase 411: //FogMethod\r\n\t\t\t\teffectMethodReturn = new EffectFogMethod(props.get(101, 0), props.get(102, 1000), props.get(601, 0x808080));\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\t\tthis.awd_file_data.parseUserAttributes();\r\n\t\treturn effectMethodReturn;\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport = SharedMethodAWDParser;",
    "\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDBlockParserBase\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\nimport AWD3Utils\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\nimport Skeleton\t\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/Skeleton\");\r\nimport SkeletonJoint\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/SkeletonJoint\");\r\nimport Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\n\r\nclass SkeletonAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\t\tvar skeleton:Skeleton = new Skeleton();\r\n\t\tskeleton.name = this.awd_file_data.parseVarStr();\r\n\t\tvar num_joints:number /*uint*/ = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\tthis.awd_file_data.parseProperties(null); // Discard properties for now\r\n\r\n\t\tvar joints_parsed:number /*uint*/ = 0;\r\n\t\twhile (joints_parsed < num_joints) {\r\n\t\t\tvar joint:SkeletonJoint;\r\n\t\t\tvar ibp:Matrix3D;\r\n\t\t\t// Ignore joint id\r\n\t\t\tthis.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\t\tjoint = new SkeletonJoint();\r\n\t\t\tjoint.parentIndex = this.awd_file_data.newBlockBytes.readUnsignedShort() - 1; // 0=null in AWD\r\n\t\t\tjoint.name = this.awd_file_data.parseVarStr();\r\n\r\n\t\t\tibp = this.awd_file_data.parseMatrix3D();\r\n\t\t\tjoint.inverseBindPose = ibp.rawData;\r\n\t\t\t// Ignore joint props/attributes for now\r\n\t\t\tthis.awd_file_data.parseProperties(null);\r\n\t\t\tthis.awd_file_data.parseUserAttributes();\r\n\t\t\tskeleton.joints.push(joint);\r\n\t\t\tjoints_parsed++;\r\n\t\t}\r\n\r\n\t\t// Discard attributes for now\r\n\t\tthis.awd_file_data.parseUserAttributes();\r\n\t\tif (this.awd_file_data.debug)\r\n\t\t\tconsole.log(\"Parsed a Skeleton: Name = \" + skeleton.name + \" | Number of Joints = \" + joints_parsed);\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport = SkeletonAWDParser;",
    "\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDBlockParserBase\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\nimport AWD3Utils\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\nimport SkeletonClipNode\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/SkeletonClipNode\");\r\nimport SkeletonPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/SkeletonPose\");\r\n\r\nclass SkeletonAnimClipAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\t\tvar frame_dur:number;\r\n\t\tvar pose_addr:number /*uint*/;\r\n\t\tvar clip:SkeletonClipNode = new SkeletonClipNode();\r\n\t\tclip.name = this.awd_file_data.parseVarStr();\r\n\t\tvar num_frames:number /*uint*/ = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\tthis.awd_file_data.parseProperties(null); // Ignore properties for now\r\n\r\n\t\tvar frames_parsed:number /*uint*/ = 0;\r\n\t\tvar returnedArray:Array<any>;\r\n\t\twhile (frames_parsed < num_frames) {\r\n\t\t\tpose_addr = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t\tframe_dur = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\t\tvar skel_pose:SkeletonPose = <SkeletonPose>this.awd_file_data.getAssetByID(pose_addr);\r\n\t\t\tif (skel_pose==undefined){\r\n\t\t\t\t//this.awd_file_data._blocks[blockID].addError(\"Could not find the SkeletonPose Frame # \" + frames_parsed + \" (ID = \" + pose_addr + \" ) for this.awd_file_data SkeletonClipNode\");\r\n\t\t\t}else\r\n\t\t\t\tclip.addFrame(<SkeletonPose> this.awd_file_data.getBlockByID(pose_addr).data, frame_dur);\r\n\t\t\tframes_parsed++;\r\n\t\t}\r\n\t\tif (clip.frames.length == 0) {\r\n\t\t\t//this.awd_file_data._blocks[blockID].addError(\"Could not this.awd_file_data SkeletonClipNode, because no Frames where set.\");\r\n\t\t\treturn undefined;\r\n\t\t}\r\n\t\t// Ignore attributes for now\r\n\t\tthis.awd_file_data.parseUserAttributes();\r\n\t\tif (this.awd_file_data.debug)\r\n\t\t\tconsole.log(\"Parsed a SkeletonClipNode: Name = \" + clip.name + \" | Number of Frames = \" + clip.frames.length);\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport = SkeletonAnimClipAWDParser;",
    "\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDBlockParserBase\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\nimport AWD3Utils\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\nimport SkeletonPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/SkeletonPose\");\r\nimport JointPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/JointPose\");\r\nimport Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\n\r\nclass SkeletonPoseAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\t\tvar pose:SkeletonPose = new SkeletonPose();\r\n\t\tpose.name = this.awd_file_data.parseVarStr();\r\n\t\tvar num_joints:number /*uint*/ = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\tthis.awd_file_data.parseProperties(null); // Ignore properties for now\r\n\r\n\r\n\t\tvar joints_parsed:number /*uint*/ = 0;\r\n\t\twhile (joints_parsed < num_joints) {\r\n\t\t\tvar joint_pose:JointPose;\r\n\t\t\tvar has_transform:number /*uint*/;\r\n\t\t\tjoint_pose = new JointPose();\r\n\t\t\thas_transform = this.awd_file_data.newBlockBytes.readUnsignedByte();\r\n\t\t\tif (has_transform == 1) {\r\n\t\t\t\tvar mtx_data:Array<number> = this.awd_file_data.parseMatrix43RawData();\r\n\r\n\t\t\t\tvar mtx:Matrix3D = new Matrix3D(mtx_data);\r\n\t\t\t\tjoint_pose.orientation.fromMatrix(mtx);\r\n\t\t\t\tjoint_pose.translation.copyFrom(mtx.position);\r\n\r\n\t\t\t\tpose.jointPoses[joints_parsed] = joint_pose;\r\n\t\t\t}\r\n\t\t\tjoints_parsed++;\r\n\t\t}\r\n\t\t// Skip attributes for now\r\n\t\tthis.awd_file_data.parseUserAttributes();\r\n\t\tif (this.awd_file_data.debug)\r\n\t\t\tconsole.log(\"Parsed a SkeletonPose: Name = \" + pose.name + \" | Number of Joints = \" + joints_parsed);\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport = SkeletonPoseAWDParser;",
    "\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDBlockParserBase\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\nimport AWD3Utils\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\nimport DefaultMaterialManager\t\t\t= require(\"awayjs-display/lib/managers/DefaultMaterialManager\");\r\nimport Skybox\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Skybox\");\r\nimport TextureBase\t\t\t\t\t\t= require(\"awayjs-core/lib/textures/TextureBase\");\r\nimport ImageCubeTexture\t\t\t\t\t= require(\"awayjs-core/lib/textures/ImageCubeTexture\");\r\n\r\nclass SkyboxAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\t\tvar name:string = this.awd_file_data.parseVarStr();\r\n\t\tvar cubeTexAddr:number = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\r\n\t\tvar cube_tex:ImageCubeTexture = undefined;\r\n\t\tif(cubeTexAddr>0) {\r\n\t\t\tcube_tex = <ImageCubeTexture> this.awd_file_data.getAssetByID(cubeTexAddr);\r\n\t\t}\r\n\t\tif(cube_tex==undefined){\r\n\t\t\tcube_tex=<ImageCubeTexture>this.awd_file_data.getDefaultCubeTexture();\r\n\t\t}\r\n\t\t//if ((!returnedArrayCubeTex[0]) && (cubeTexAddr != 0))\r\n\t\t\t//this.awd_file_data._blocks[blockID].addError(\"Could not find the Cubetexture (ID = \" + cubeTexAddr + \" ) for this.awd_file_data Skybox\");\r\n\t\tvar new_skybox:Skybox = new Skybox(<ImageCubeTexture> cube_tex);\r\n\r\n\t\tthis.awd_file_data.parseProperties(null)\r\n\t\tnew_skybox.extra = this.awd_file_data.parseUserAttributes();\r\n\t\tnew_skybox.name = name;\r\n\t\tif (this.awd_file_data.debug)\r\n\t\t\tconsole.log(\"Parsed a Skybox: Name = '\" + new_skybox.name + \"' | CubeTexture-Name = \" + cube_tex.name);\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport = SkyboxAWDParser;",
    "import EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDBlockParserBase\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\nimport AWD3Utils\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\nimport Font\t\t\t\t\t\t\t= require(\"awayjs-display/lib/text/Font\");\r\nimport TesselatedFontTable\t\t\t= require(\"awayjs-display/lib/text/TesselatedFontTable\");\r\nimport SubGeometryBase\t\t\t\t\t= require(\"awayjs-core/lib/data/SubGeometryBase\");\r\nimport CurveSubGeometry\t\t\t\t\t= require(\"awayjs-core/lib/data/CurveSubGeometry\");\r\n\r\nclass TesselatedFontAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\t\tvar new_font:Font=new Font();\r\n\t\tnew_font.name = this.awd_file_data.parseVarStr();\r\n\t\tvar font_style_cnt:number = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t//console.log(\"Font font_style_cnt = \"+font_style_cnt);\r\n\t\tfor (var i:number = 0; i < font_style_cnt; ++i) {\r\n\t\t\tvar font_style_name:string = this.awd_file_data.parseVarStr();\r\n\t\t\t//console.log(\"Font font_style_name = \"+font_style_name);\r\n\t\t\tvar new_font_style:TesselatedFontTable=new_font.get_font_table(font_style_name);\r\n\t\t\tnew_font_style.set_font_em_size(this.awd_file_data.newBlockBytes.readUnsignedInt());\r\n\t\t\t//console.log(\"Font new_font_style.font_em_size = \"+new_font_style.get_font_em_size);\r\n\t\t\tvar font_style_char_cnt:number = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t\t//console.log(\"Font font_style_char_cnt = \"+font_style_char_cnt);\r\n\t\t\tfor (var i:number = 0; i < font_style_char_cnt; ++i) {\r\n\r\n\t\t\t\tvar font_style_char:number = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t\t\t//console.log(\"Font font_style_char = \"+font_style_char);\r\n\t\t\t\t// todo: this.awd_file_data is basically a simplified version of the subgeom-parsing done in parseTriangleGeometry. Make a parseSubGeom() instead (?)\r\n\t\t\t\tvar sm_len:number = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t\t\tvar sm_end:number = this.awd_file_data.newBlockBytes.position + sm_len;\r\n\t\t\t\t//console.log(\"Font sm_len = \"+sm_len);\r\n\r\n\t\t\t\t//this.awd_file_data.parseProperties(null); // no properties for font-table subgeos\r\n\t\t\t\t// Loop through data streams\r\n\t\t\t\twhile (this.awd_file_data.newBlockBytes.position < sm_end) {\r\n\t\t\t\t\tvar idx:number = 0;\r\n\t\t\t\t\tvar str_ftype:number, str_type:number, str_len:number, str_end:number;\r\n\r\n\t\t\t\t\t// Type, field type, length\r\n\t\t\t\t\tstr_type = this.awd_file_data.newBlockBytes.readUnsignedByte();\r\n\t\t\t\t\tstr_ftype = this.awd_file_data.newBlockBytes.readUnsignedByte();\r\n\t\t\t\t\tstr_len = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t\t\t\tstr_end = this.awd_file_data.newBlockBytes.position + str_len;\r\n\r\n\t\t\t\t\tif (str_type == 2) {//face indicies positions\r\n\t\t\t\t\t\tvar indices:Array<number> = new Array<number>();\r\n\r\n\t\t\t\t\t\twhile (this.awd_file_data.newBlockBytes.position < str_end) {\r\n\t\t\t\t\t\t\tindices[idx++] = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (str_type == 10) {// combined vertex2D stream 5 x float32\r\n\t\t\t\t\t\tvar idx_pos:number = 0;\r\n\t\t\t\t\t\tvar idx_curves:number = 0;\r\n\t\t\t\t\t\tvar idx_uvs:number = 0;\r\n\r\n\t\t\t\t\t\tvar positions:Array<number> = new Array<number>();\r\n\t\t\t\t\t\tvar curveData:Array<number> = new Array<number>();\r\n\t\t\t\t\t\tvar uvs:Array<number> = new Array<number>();\r\n\r\n\t\t\t\t\t\twhile (this.awd_file_data.newBlockBytes.position < str_end) {\r\n\r\n\t\t\t\t\t\t\tpositions[idx_pos++] = this.awd_file_data.readNumber(this.awd_file_data.accuracyGeo);// x\r\n\t\t\t\t\t\t\tpositions[idx_pos++] = this.awd_file_data.readNumber(this.awd_file_data.accuracyGeo);// y\r\n\t\t\t\t\t\t\tpositions[idx_pos++] = this.awd_file_data.readNumber(this.awd_file_data.accuracyGeo);// type\r\n\r\n\t\t\t\t\t\t\tcurveData[idx_curves++] = this.awd_file_data.readNumber(this.awd_file_data.accuracyGeo);// curve value 1\r\n\t\t\t\t\t\t\tcurveData[idx_curves++] = this.awd_file_data.readNumber(this.awd_file_data.accuracyGeo);// curve value 2\r\n\r\n\t\t\t\t\t\t\tuvs[idx_uvs++] = this.awd_file_data.readNumber(this.awd_file_data.accuracyGeo);// curve value 1\r\n\t\t\t\t\t\t\tuvs[idx_uvs++] = this.awd_file_data.readNumber(this.awd_file_data.accuracyGeo);// curve value 1\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tthis.awd_file_data.newBlockBytes.position = str_end;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t//this.awd_file_data.parseProperties(null);// no attributes for font-table subgeos\r\n\t\t\t\tvar curve_sub_geom:CurveSubGeometry = new CurveSubGeometry(true);\r\n\t\t\t\tcurve_sub_geom.updateIndices(indices);\r\n\t\t\t\tcurve_sub_geom.updatePositions(positions);\r\n\t\t\t\tcurve_sub_geom.updateCurves(curveData);\r\n\t\t\t\tcurve_sub_geom.updateUVs(uvs);\r\n\t\t\t\tnew_font_style.set_subgeo_for_char(font_style_char.toString(), curve_sub_geom);\r\n\t\t\t}\r\n\t\t\t//console.log(\"Parsed a font-table\");\r\n\r\n\t\t}\r\n\t\t//console.log(\"Parsed a font\");\r\n\t\tthis.awd_file_data.parseProperties(null);\r\n\t\tthis.awd_file_data.parseUserAttributes();\r\n\t\tif (this.awd_file_data.debug) {\r\n\t\t\tconsole.log(\"Parsed a font: Name = '\" + new_font.name);\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport = TesselatedFontAWDParser;",
    "\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDBlockParserBase\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\nimport AWD3Utils\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\n\r\nimport TextFormat\t\t\t\t\t= require(\"awayjs-display/lib/text/TextFormat\");\r\nimport TextFieldType\t\t\t\t= require(\"awayjs-display/lib/text/TextFieldType\");\r\n\r\nimport AS2SceneGraphFactory \t\t= require(\"awayjs-player/lib/factories/AS2SceneGraphFactory\");\r\n\r\nclass TextfieldAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\tprivate factory:AS2SceneGraphFactory;\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t\tthis.factory = new AS2SceneGraphFactory();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\t\tvar newTextField = this.factory.createTextField();\r\n\t\tnewTextField.name = this.awd_file_data.parseVarStr();\r\n\t\tvar text_field_type:number=this.awd_file_data.newBlockBytes.readUnsignedByte();\r\n\t\tif(text_field_type==0) {\r\n\t\t\tnewTextField.type = \"static\";\r\n\t\t}\r\n\t\telse if(text_field_type==1) {\r\n\t\t\tnewTextField.type = \"dynamic\";\r\n\t\t}\r\n\t\telse if(text_field_type==2) {\r\n\t\t\tnewTextField.type = \"input\";\r\n\t\t}\r\n\t\telse if(text_field_type==3) {\r\n\t\t\tnewTextField.type =\"input\";\r\n\t\t\tnewTextField.displayAsPassword=true;\r\n\t\t}\r\n\r\n\t\tnewTextField.width=this.awd_file_data.newBlockBytes.readFloat();\r\n\t\tnewTextField.height=this.awd_file_data.newBlockBytes.readFloat();\r\n\t\tvar num_paragraphs:number = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\tvar complete_text:string = \"\";\r\n\t\t//console.log(\"num_paragraphs  '\" + num_paragraphs);\r\n\t\tvar text_format:TextFormat;\r\n\t\tfor(var paracnt:number=0; paracnt<num_paragraphs; paracnt++){\r\n\r\n\t\t\tvar num_textruns:number = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t\t//console.log(\"num_textruns  '\" + num_textruns);\r\n\t\t\tfor(var textrun_cnt:number=0; textrun_cnt<num_textruns; textrun_cnt++) {\r\n\r\n\t\t\t\tvar format_id:number = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t\t\t//console.log(\"format_id  '\" + format_id);\r\n\t\t\t\tvar textFormat:TextFormat = <TextFormat>this.awd_file_data.getAssetByID(format_id);\r\n\t\t\t\tif (textFormat==undefined) {\r\n\t\t\t\t\ttext_format = new TextFormat();\r\n\t\t\t\t}\r\n\t\t\t\t//console.log(\"text_format  '\" + text_format.name);\r\n\t\t\t\tvar txt_length = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t\t\t//console.log(\"txt_length  '\" + txt_length);\r\n\t\t\t\tif (txt_length > 0) {\r\n\t\t\t\t\tvar this_txt:string = this.awd_file_data.newBlockBytes.readUTFBytes(txt_length);\r\n\t\t\t\t\t//newTextField.appendText(this_txt, text_format);\r\n\t\t\t\t\tcomplete_text+=this_txt;\r\n\t\t\t\t\t//console.log(\"this_txt  '\" + this_txt);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//newTextField.closeParagraph();\r\n\t\t}\r\n\t\tnewTextField.textFormat=text_format;\r\n\t\tnewTextField.text=complete_text;\r\n\r\n\t\t//newTextField.construct_geometry();\r\n\r\n\t\t// todo: optional matrix etc can be put in properties.\r\n\t\tvar props:AWDProperties = this.awd_file_data.parseProperties({1:AWD3Utils.BOOL, 3:AWD3Utils.BOOL, 4:AWD3Utils.BOOL, 5:AWD3Utils.BOOL, 7:AWD3Utils.UINT8, 8:AWD3Utils.UINT8, 9:AWD3Utils.UINT8});\r\n\t\tnewTextField.selectable = props.get(1, false);\r\n\t\tnewTextField.border =  props.get(3, false);\r\n\t\t//newTextField.renderHTML =  props.get(4, false);\r\n\t\t//newTextField.scrollable =  props.get(5, false);\r\n\t\t//newTextField.text_flow =  props.get(7, 0);\r\n\t\t//newTextField.orientationMode =  props.get(8, 0);\r\n\t\t//newTextField.line_mode =  props.get(9, 0);\r\n\r\n\t\tnewTextField.extra = this.awd_file_data.parseUserAttributes();\r\n\r\n\t\tif (this.awd_file_data.debug) {\r\n\t\t\tconsole.log(\"Parsed a TextField: Name = '\" + newTextField.name + \"| text  = \" + complete_text);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport = TextfieldAWDParser;",
    "\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDBlockParserBase\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\nimport AWD3Utils\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\nimport TextFormat\t\t\t\t\t= require(\"awayjs-display/lib/text/TextFormat\");\r\nimport TesselatedFontTable\t\t\t= require(\"awayjs-display/lib/text/TesselatedFontTable\");\r\nimport Font\t\t\t\t\t\t\t= require(\"awayjs-display/lib/text/Font\");\r\nimport BasicMaterial\t\t\t\t\t= require(\"awayjs-display/lib/materials/BasicMaterial\");\r\nimport MaterialBase\t\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\r\n\r\nclass TextformatAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\t\tvar newTextFormat:TextFormat = new TextFormat();\r\n\t\tnewTextFormat.name = this.awd_file_data.parseVarStr();\r\n\t\t//console.log(\"this.awd_file_data._blocks[blockID].name  '\" + this.awd_file_data._blocks[blockID].name );\r\n\t\tvar font_id:number = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t//console.log(\"font_id  '\" + font_id);\r\n\t\tvar font_style_name:string = this.awd_file_data.parseVarStr();\r\n\t\t//console.log(\"font_style_name  '\" + font_style_name);\r\n\t\tvar font:Font = <Font>this.awd_file_data.getAssetByID(font_id);\r\n\t\tif (font==undefined) {\r\n\t\t\tfont = new Font();\r\n\t\t}\r\n\t\tnewTextFormat.font_name = font.name;\r\n\t\tvar font_table:TesselatedFontTable = font.get_font_table(font_style_name);\r\n\t\tif(font_table!=null){\r\n\t\t\tnewTextFormat.font_style = font_style_name;\r\n\t\t\tnewTextFormat.font_table = font_table;\r\n\t\t}\r\n\r\n\t\tvar data_id:number = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t//console.log(\"mat  '\" + data_id);\r\n\t\tvar mat:BasicMaterial = <BasicMaterial> this.awd_file_data.getAssetByID(data_id);\r\n\r\n\t\tif (mat==undefined) {\r\n\t\t\tmat = new BasicMaterial();\r\n\t\t}\r\n\t\tmat.bothSides=true;\r\n\r\n\t\tvar num_uv_values:number = this.awd_file_data.newBlockBytes.readUnsignedByte();\r\n\t\t//console.log(\"num_uv_values  '\" + num_uv_values);\r\n\t\tvar uv_values:Array<number>=[];\r\n\t\tfor(var uvcnt:number=0; uvcnt<num_uv_values; uvcnt++){\r\n\t\t\tvar uv_value:number=this.awd_file_data.newBlockBytes.readFloat();\r\n\t\t\tuv_values.push(uv_value);\r\n\t\t\t//console.log(\"uv_value  '\" + uv_value);\r\n\t\t}\r\n\t\tnewTextFormat.uv_values=uv_values;\r\n\t\tvar format_props:AWDProperties = this.awd_file_data.parseProperties({1:AWD3Utils.UINT16, 2:AWD3Utils.UINT16, 3:AWD3Utils.UINT8,4:AWD3Utils.UINT8,5:AWD3Utils.UINT8,6:AWD3Utils.UINT8, 7:AWD3Utils.UINT16, 8:AWD3Utils.UINT16, 9:AWD3Utils.UINT16, 10:AWD3Utils.UINT16});\r\n\r\n\t\tnewTextFormat.size = format_props.get(1,12);\r\n\t\tnewTextFormat.letterSpacing = format_props.get(2,0);\r\n\t\t//newTextFormat.rotated = format_props.get(3,false);\r\n\t\tnewTextFormat.kerning = format_props.get(4,true);\r\n\t\t//newTextFormat.baseline_shift = format_props.get(5,1);\r\n\t\t//newTextFormat.align = format_props.get(6,0);\r\n\t\tnewTextFormat.indent = format_props.get(7,0);\r\n\t\tnewTextFormat.leftMargin = format_props.get(8,0);\r\n\t\tnewTextFormat.rightMargin = format_props.get(9,0);\r\n\t\t//newTextFormat.linespacing = format_props.get(10,0);\r\n\t\tnewTextFormat.size = format_props.get(1,12);\r\n\t\tnewTextFormat.letterSpacing = format_props.get(2,0);\r\n\t\t//newTextFormat.rotated = format_props.get(3,false);\r\n\t\tnewTextFormat.kerning = format_props.get(4,true);\r\n\t\t//newTextFormat.baseline_shift = format_props.get(5,1);\r\n\t\tnewTextFormat.material = mat;\r\n\t\tthis.awd_file_data.parseUserAttributes();// textformat has no extra-properties\r\n\t\t//newTextFormat.extra =\r\n\r\n\r\n\t\tif (this.awd_file_data.debug) {\r\n\t\t\tconsole.log(\"Parsed a TextFormat: Name = '\" + name + \" font: \"+font.name);\r\n\t\t}\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport = TextformatAWDParser;/**\r\n * Created by 80prozent on 4/18/2015.\r\n */\r\n",
    "\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDBlockParserBase\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\nimport AWD3Utils\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\nimport TriangleSubGeometry\t\t\t\t= require(\"awayjs-core/lib/data/TriangleSubGeometry\");\r\nimport VertexClipNode\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/VertexClipNode\");\r\nimport Geometry\t\t\t\t\t\t\t= require(\"awayjs-core/lib/data/Geometry\");\r\n\r\nclass VertexAnimClipAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\t\tvar poseOnly:boolean=false;\r\n\t\tif(this.awd_file_data.cur_block.type==123){\r\n\t\t\tposeOnly=true\r\n\t\t}\r\n\t\tvar num_frames:number /*uint*/ = 1;\r\n\t\tvar num_submeshes:number /*uint*/;\r\n\t\tvar frames_parsed:number /*uint*/;\r\n\t\tvar subMeshParsed:number /*uint*/;\r\n\t\tvar frame_dur:number;\r\n\t\tvar x:number;\r\n\t\tvar y:number;\r\n\t\tvar z:number;\r\n\t\tvar str_len:number;\r\n\t\tvar str_end:number;\r\n\t\tvar geometry:Geometry;\r\n\t\tvar subGeom:TriangleSubGeometry;\r\n\t\tvar idx:number /*int*/ = 0;\r\n\t\tvar indices:Array<number> /*uint*/;\r\n\t\tvar verts:Array<number>;\r\n\t\tvar num_Streams:number /*int*/ = 0;\r\n\t\tvar streamsParsed:number /*int*/ = 0;\r\n\t\tvar streamtypes:Array<number> /*int*/ = new Array<number>() /*int*/;\r\n\t\tvar props:AWDProperties;\r\n\t\tvar thisGeo:Geometry;\r\n\t\tvar clip:VertexClipNode = new VertexClipNode();\r\n\t\tclip.name = this.awd_file_data.parseVarStr();\r\n\t\tvar geoAdress:number /*int*/ = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\tvar geom:Geometry = <Geometry>this.awd_file_data.getAssetByID(geoAdress);\r\n\t\tif (geom==undefined) {\r\n\t\t\t//this.awd_file_data._blocks[blockID].addError(\"Could not find the target-Geometry-Object \" + geoAdress + \" ) for this.awd_file_data VertexClipNode\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar uvs:Array<Array<number>> = this.awd_file_data.getUVForVertexAnimation(geoAdress);\r\n\t\tif (!poseOnly)\r\n\t\t\tnum_frames = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\r\n\t\tnum_submeshes = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\tnum_Streams = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\tstreamsParsed = 0;\r\n\t\twhile (streamsParsed < num_Streams) {\r\n\t\t\tstreamtypes.push(this.awd_file_data.newBlockBytes.readUnsignedShort());\r\n\t\t\tstreamsParsed++;\r\n\t\t}\r\n\t\tprops = this.awd_file_data.parseProperties({1:AWD3Utils.BOOL, 2:AWD3Utils.BOOL});\r\n\r\n\t\tclip.looping = props.get(1, true);\r\n\t\tclip.stitchFinalFrame = props.get(2, false);\r\n\r\n\t\tframes_parsed = 0;\r\n\t\twhile (frames_parsed < num_frames) {\r\n\t\t\tframe_dur = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\t\tgeometry = new Geometry();\r\n\t\t\tsubMeshParsed = 0;\r\n\t\t\twhile (subMeshParsed < num_submeshes) {\r\n\t\t\t\tstreamsParsed = 0;\r\n\t\t\t\tstr_len = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t\t\tstr_end = this.awd_file_data.newBlockBytes.position + str_len;\r\n\t\t\t\twhile (streamsParsed < num_Streams) {\r\n\t\t\t\t\tif (streamtypes[streamsParsed] == 1) {\r\n\t\t\t\t\t\tindices = geom.subGeometries[subMeshParsed].indices;\r\n\t\t\t\t\t\tverts = new Array<number>();\r\n\t\t\t\t\t\tidx = 0;\r\n\t\t\t\t\t\twhile (this.awd_file_data.newBlockBytes.position < str_end) {\r\n\t\t\t\t\t\t\tx = this.awd_file_data.readNumber(this.awd_file_data.accuracyGeo)\r\n\t\t\t\t\t\t\ty = this.awd_file_data.readNumber(this.awd_file_data.accuracyGeo)\r\n\t\t\t\t\t\t\tz = this.awd_file_data.readNumber(this.awd_file_data.accuracyGeo)\r\n\t\t\t\t\t\t\tverts[idx++] = x;\r\n\t\t\t\t\t\t\tverts[idx++] = y;\r\n\t\t\t\t\t\t\tverts[idx++] = z;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tsubGeom = new TriangleSubGeometry(true);\r\n\t\t\t\t\t\tsubGeom.updateIndices(indices);\r\n\t\t\t\t\t\tsubGeom.updatePositions(verts);\r\n\t\t\t\t\t\tsubGeom.updateUVs(uvs[subMeshParsed]);\r\n\t\t\t\t\t\tsubGeom.updateVertexNormals(null);\r\n\t\t\t\t\t\tsubGeom.updateVertexTangents(null);\r\n\t\t\t\t\t\tsubGeom.autoDeriveNormals = false;\r\n\t\t\t\t\t\tsubGeom.autoDeriveTangents = false;\r\n\t\t\t\t\t\tsubMeshParsed++;\r\n\t\t\t\t\t\tgeometry.addSubGeometry(subGeom)\r\n\t\t\t\t\t} else\r\n\t\t\t\t\t\tthis.awd_file_data.newBlockBytes.position = str_end;\r\n\t\t\t\t\tstreamsParsed++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tclip.addFrame(geometry, frame_dur);\r\n\t\t\tframes_parsed++;\r\n\t\t}\r\n\t\tthis.awd_file_data.parseUserAttributes();\r\n\t\tif (this.awd_file_data.debug)\r\n\t\t\tconsole.log(\"Parsed a VertexClipNode: Name = \" + clip.name + \" | Target-Geometry-Name = \" + geom.name + \" | Number of Frames = \" + clip.frames.length);\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport = VertexAnimClipAWDParser;",
    "\r\nimport EventDispatcher\t\t\t= require(\"awayjs-core/lib/events/EventDispatcher\");\r\nimport ByteArray\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AbstractMethodError\t\t= require(\"awayjs-core/lib/errors/AbstractMethodError\");\r\nimport IAsset\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport AWDBlockParserBase\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParserBase\");\r\nimport AWDProperties\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\nimport AWD3Utils\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\nimport AnimationNodeBase\t\t\t\t= require(\"awayjs-display/lib/animators/nodes/AnimationNodeBase\");\r\nimport SkeletonClipNode\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/SkeletonClipNode\");\r\nimport VertexClipNode\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/VertexClipNode\");\r\nimport VertexAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/VertexAnimationSet\");\r\nimport SkeletonAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/SkeletonAnimationSet\");\r\n\r\nclass VertexAnimationSetAWDParser extends AWDBlockParserBase\r\n{\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t}\r\n\r\n\r\n\tpublic parseFromBytes():void\r\n\t{\r\n\t\tvar poseBlockAdress:number /*int*/\r\n\t\tvar outputString:string = \"\";\r\n\t\tvar name:string = this.awd_file_data.parseVarStr();\r\n\t\tvar num_frames:number /*uint*/ = this.awd_file_data.newBlockBytes.readUnsignedShort();\r\n\t\tvar props:AWDProperties = this.awd_file_data.parseProperties({1:AWD3Utils.UINT16});\r\n\t\tvar frames_parsed:number /*uint*/ = 0;\r\n\t\tvar skeletonFrames:Array<SkeletonClipNode> = new Array<SkeletonClipNode>();\r\n\t\tvar vertexFrames:Array<VertexClipNode> = new Array<VertexClipNode>();\r\n\t\twhile (frames_parsed < num_frames) {\r\n\t\t\tposeBlockAdress = this.awd_file_data.newBlockBytes.readUnsignedInt();\r\n\t\t\tvar animNode:AnimationNodeBase = <AnimationNodeBase>this.awd_file_data.getAssetByID(poseBlockAdress);\r\n\t\t\tif (animNode==undefined) {\r\n\t\t\t//this.awd_file_data._blocks[blockID].addError(\"Could not find the AnimationClipNode Nr \" + frames_parsed + \" ( \" + poseBlockAdress + \" ) for this.awd_file_data AnimationSet\");\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tif (animNode instanceof VertexClipNode)\r\n\t\t\t\t\tvertexFrames.push(<VertexClipNode>animNode)\r\n\t\t\t\tif (animNode instanceof SkeletonClipNode)\r\n\t\t\t\t\tskeletonFrames.push(<SkeletonClipNode>animNode)\r\n\t\t\t}\r\n\t\t\tframes_parsed++;\r\n\t\t}\r\n\t\tif ((vertexFrames.length == 0) && (skeletonFrames.length == 0)) {\r\n\t\t\t//this.awd_file_data._blocks[blockID].addError(\"Could not create this.awd_file_data AnimationSet, because it contains no animations\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.awd_file_data.parseUserAttributes();\r\n\t\tif (vertexFrames.length > 0) {\r\n\t\t\tvar newVertexAnimationSet:VertexAnimationSet = new VertexAnimationSet();\r\n\t\t\tfor (var i:number /*int*/ = 0; i < vertexFrames.length; i++)\r\n\t\t\t\tnewVertexAnimationSet.addAnimation(vertexFrames[i]);\r\n\t\t\tnewVertexAnimationSet.name=name;\r\n\t\t\tif (this.awd_file_data.debug)\r\n\t\t\t\tconsole.log(\"Parsed a VertexAnimationSet: Name = \" + newVertexAnimationSet.name + \" | Animations = \" + newVertexAnimationSet.animations.length + \" | Animation-Names = \" + newVertexAnimationSet.animationNames.toString());\r\n\t\t\treturn;\r\n\t\t} else if (skeletonFrames.length > 0) {\r\n\t\t\tvar newSkeletonAnimationSet:SkeletonAnimationSet = new SkeletonAnimationSet(props.get(1, 4)); //props.get(1,4));\r\n\t\t\tfor (var i:number /*int*/ = 0; i < skeletonFrames.length; i++)\r\n\t\t\t\tnewSkeletonAnimationSet.addAnimation(skeletonFrames[i]);\r\n\t\t\tnewSkeletonAnimationSet.name=name;\r\n\t\t\tif (this.awd_file_data.debug)\r\n\t\t\t\tconsole.log(\"Parsed a SkeletonAnimationSet: Name = \" + newSkeletonAnimationSet.name + \" | Animations = \" + newSkeletonAnimationSet.animations.length + \" | Animation-Names = \" + newSkeletonAnimationSet.animationNames.toString());\r\n\t\t}\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport = VertexAnimationSetAWDParser;",
    "\r\n\r\n\r\nimport BitmapData\t\t\t\t\t\t= require(\"awayjs-core/lib/data/BitmapData\");\r\nimport BlendMode\t\t\t\t\t\t= require(\"awayjs-core/lib/data/BlendMode\");\r\nimport TriangleSubGeometry\t\t\t\t= require(\"awayjs-core/lib/data/TriangleSubGeometry\");\r\nimport Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\nimport URLLoaderDataFormat\t\t\t\t= require(\"awayjs-core/lib/net/URLLoaderDataFormat\");\r\nimport URLRequest\t\t\t\t\t\t= require(\"awayjs-core/lib/net/URLRequest\");\r\nimport IAsset\t\t\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport ParserBase\t\t\t\t\t\t= require(\"awayjs-core/lib/parsers/ParserBase\");\r\nimport ParserUtils\t\t\t\t\t\t= require(\"awayjs-core/lib/parsers/ParserUtils\");\r\nimport ResourceDependency\t\t\t\t= require(\"awayjs-core/lib/parsers/ResourceDependency\");\r\n\r\nimport BitmapCubeTexture\t\t\t\t= require(\"awayjs-core/lib/textures/BitmapCubeTexture\");\r\nimport BitmapTexture\t\t\t\t\t= require(\"awayjs-core/lib/textures/BitmapTexture\");\r\n\r\nimport CubeTextureBase\t\t\t\t\t= require(\"awayjs-core/lib/textures/CubeTextureBase\");\r\nimport ImageCubeTexture\t\t\t\t\t= require(\"awayjs-core/lib/textures/ImageCubeTexture\");\r\nimport ImageTexture\t\t\t\t\t\t= require(\"awayjs-core/lib/textures/ImageTexture\");\r\nimport TextureBase\t\t\t\t\t\t= require(\"awayjs-core/lib/textures/TextureBase\");\r\nimport ByteArray\t\t\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport Geometry\t\t\t\t\t\t\t= require(\"awayjs-core/lib/data/Geometry\");\r\n\r\nimport Texture2DBase\t\t\t\t\t= require(\"awayjs-core/lib/textures/Texture2DBase\");\r\nimport DisplayObject\t\t\t\t\t= require(\"awayjs-display/lib/base/DisplayObject\");\r\nimport DisplayObjectContainer\t\t\t= require(\"awayjs-display/lib/containers/DisplayObjectContainer\");\r\n\r\nimport MaterialBase\t\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\r\nimport DefaultMaterialManager\t\t\t= require(\"awayjs-display/lib/managers/DefaultMaterialManager\");\r\n\r\n\r\nimport Mesh\t\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Mesh\");\r\n\r\n\r\n\r\n\r\nimport AWDBitFlags\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDBitFlags\");\r\nimport AWDProperties\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\n\r\nimport AWDBlock\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDBlock\");\r\nimport AWD3Utils\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\n\r\n\r\n/**\r\n * AWD3FileData stores the data loaded for a AWD-file. It also gives access to some helper functions.\r\n */\r\nclass AWD3FileData\r\n{\r\n\t//set to \"true\" to have some console.logs in the Console\r\n\tprivate _debug:boolean = false;\r\n\r\n\tprivate _cur_block:AWDBlock;\r\n\tprivate _blocks:Array<AWDBlock>;\r\n\tprivate _newBlockBytes:ByteArray;\r\n\r\n\tpublic  major_version:number;\r\n\tpublic  minor_version:number;\r\n\r\n\tprivate _accuracyOnBlocks:boolean = false;\r\n\r\n\tprivate _accuracyMatrix:boolean;\r\n\tprivate _accuracyGeo:boolean;\r\n\tprivate _accuracyProps:boolean;\r\n\tprivate _matrixNrType:number;\r\n\tprivate _geoNrType:number;\r\n\tprivate _propsNrType:number;\r\n\r\n\tprivate blendModeDic:Array<string>;\r\n\tprivate _depthSizeDic:Array<number>;\r\n\r\n\tprivate _defaultCubeTexture:BitmapCubeTexture;\r\n\t/**\r\n\t * Creates a new AWD3FileData object.\r\n\t */\r\n\tconstructor()\r\n\t{\r\n\t\tthis.major_version=0;\r\n\t\tthis.minor_version=0;\r\n\r\n\t\tthis._blocks = new Array<AWDBlock>();\r\n\r\n\t\tthis.blendModeDic = new Array<string>(); // used to translate ints to blendMode-strings\r\n\t\tthis.blendModeDic.push(BlendMode.NORMAL);\r\n\t\tthis.blendModeDic.push(BlendMode.ADD);\r\n\t\tthis.blendModeDic.push(BlendMode.ALPHA);\r\n\t\tthis.blendModeDic.push(BlendMode.DARKEN);\r\n\t\tthis.blendModeDic.push(BlendMode.DIFFERENCE);\r\n\t\tthis.blendModeDic.push(BlendMode.ERASE);\r\n\t\tthis.blendModeDic.push(BlendMode.HARDLIGHT);\r\n\t\tthis.blendModeDic.push(BlendMode.INVERT);\r\n\t\tthis.blendModeDic.push(BlendMode.LAYER);\r\n\t\tthis.blendModeDic.push(BlendMode.LIGHTEN);\r\n\t\tthis.blendModeDic.push(BlendMode.MULTIPLY);\r\n\t\tthis.blendModeDic.push(BlendMode.NORMAL);\r\n\t\tthis.blendModeDic.push(BlendMode.OVERLAY);\r\n\t\tthis.blendModeDic.push(BlendMode.SCREEN);\r\n\t\tthis.blendModeDic.push(BlendMode.SHADER);\r\n\t\tthis.blendModeDic.push(BlendMode.OVERLAY);\r\n\r\n\t\tthis._depthSizeDic = new Array<number>(); // used to translate ints to depthSize-values\r\n\t\tthis._depthSizeDic.push(256);\r\n\t\tthis._depthSizeDic.push(512);\r\n\t\tthis._depthSizeDic.push(2048);\r\n\t\tthis._depthSizeDic.push(1024);\r\n\t}\r\n\r\n\tpublic getDepthSizeFromEnum(depthSize:number):number\r\n\t{\r\n\t\treturn this._depthSizeDic[depthSize];\r\n\t}\r\n\tpublic getBlendModeStringFromEnum(blendmode:number):string\r\n\t{\r\n\t\treturn this.blendModeDic[blendmode];\r\n\t}\r\n\r\n\tpublic dispose():void\r\n\t{\r\n\r\n\t\tfor (var c in this._blocks) {\r\n\r\n\t\t\tvar b:AWDBlock = <AWDBlock> this._blocks[ c ];\r\n\t\t\tb.dispose();\r\n\r\n\t\t}\r\n\r\n\t}\r\n\tpublic get accuracyOnBlocks():boolean\r\n\t{\r\n\t\treturn this._accuracyOnBlocks;\r\n\t}\r\n\tpublic get accuracyMatrix():boolean\r\n\t{\r\n\t\treturn this._accuracyMatrix;\r\n\t}\r\n\tpublic set accuracyMatrix(new_accuracyMatrix:boolean)\r\n\t{\r\n\t\tthis._accuracyMatrix = new_accuracyMatrix;\r\n\t}\r\n\tpublic get accuracyProps():boolean\r\n\t{\r\n\t\treturn this._accuracyProps;\r\n\t}\r\n\tpublic set accuracyProps(new_accuracyProps:boolean)\r\n\t{\r\n\t\tthis._accuracyProps = new_accuracyProps;\r\n\t}\r\n\tpublic set accuracyGeo(new_accuracyGeo:boolean)\r\n\t{\r\n\t\tthis._accuracyGeo = new_accuracyGeo;\r\n\t}\r\n\tpublic get accuracyGeo():boolean\r\n\t{\r\n\t\treturn this._accuracyGeo;\r\n\t}\r\n\tpublic get debug():boolean\r\n\t{\r\n\t\treturn this._debug;\r\n\t}\r\n\r\n\tpublic get matrixNrType():number\r\n\t{\r\n\t\treturn this._matrixNrType;\r\n\t}\r\n\tpublic set matrixNrType(newmatrixNrType:number)\r\n\t{\r\n\t\tthis._matrixNrType = newmatrixNrType;\r\n\t}\r\n\r\n\tpublic get propsNrType():number\r\n\t{\r\n\t\treturn this._propsNrType;\r\n\t}\r\n\tpublic set propsNrType(new_props_nr:number)\r\n\t{\r\n\t\tthis._propsNrType = new_props_nr;\r\n\t}\r\n\r\n\tpublic get geoNrType():number\r\n\t{\r\n\t\treturn this._geoNrType;\r\n\t}\r\n\tpublic set geoNrType(new_geoNrType:number)\r\n\t{\r\n\t\tthis._geoNrType = new_geoNrType;\r\n\t}\r\n\r\n\r\n\tpublic set newBlockBytes(new_newBlockBytes:ByteArray)\r\n\t{\r\n\t\tthis._newBlockBytes = new_newBlockBytes;\r\n\t}\r\n\tpublic get newBlockBytes():ByteArray\r\n\t{\r\n\t\treturn this._newBlockBytes;\r\n\t}\r\n\tpublic create_new_block(type:number)\r\n\t{\r\n\t\tvar new_block:AWDBlock= new AWDBlock(this._blocks.length, type);\r\n\t\tthis._cur_block=new_block;\r\n\t\tthis._blocks.push(new_block);\r\n\t}\r\n\tpublic get cur_block():AWDBlock\r\n\t{\r\n\t\treturn this._cur_block;\r\n\t}\r\n\tpublic block_cnt():number\r\n\t{\r\n\t\treturn this._blocks.length;\r\n\t}\r\n\r\n\t//--Parser UTILS---------------------------------------------------------------------------\r\n\r\n\tpublic parseUserAttributes():Object\r\n\t{\r\n\t\tvar attributes:Object;\r\n\t\tvar list_len:number;\r\n\t\tvar attibuteCnt:number;\r\n\r\n\t\tlist_len = this._newBlockBytes.readUnsignedInt();\r\n\r\n\t\tif (list_len > 0) {\r\n\r\n\t\t\tvar list_end:number;\r\n\r\n\t\t\tattributes = {};\r\n\r\n\t\t\tlist_end = this._newBlockBytes.position + list_len;\r\n\r\n\t\t\twhile (this._newBlockBytes.position < list_end) {\r\n\t\t\t\tvar ns_id:number;\r\n\t\t\t\tvar attr_key:string;\r\n\t\t\t\tvar attr_type:number;\r\n\t\t\t\tvar attr_len:number;\r\n\t\t\t\tvar attr_val:any;\r\n\r\n\t\t\t\t// TODO: Properly tend to namespaces in attributes\r\n\t\t\t\tns_id = this._newBlockBytes.readUnsignedByte();\r\n\t\t\t\tattr_key = this.parseVarStr();\r\n\t\t\t\tattr_type = this._newBlockBytes.readUnsignedByte();\r\n\t\t\t\tattr_len = this._newBlockBytes.readUnsignedInt();\r\n\r\n\t\t\t\tif ((this._newBlockBytes.position + attr_len) > list_end) {\r\n\t\t\t\t\tconsole.log(\"           Error in reading attribute # \" + attibuteCnt + \" = skipped to end of attribute-list\");\r\n\t\t\t\t\tthis._newBlockBytes.position = list_end;\r\n\t\t\t\t\treturn attributes;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tswitch (attr_type) {\r\n\t\t\t\t\tcase AWD3Utils.AWDSTRING:\r\n\t\t\t\t\t\tattr_val = this._newBlockBytes.readUTFBytes(attr_len);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase AWD3Utils.INT8:\r\n\t\t\t\t\t\tattr_val = this._newBlockBytes.readByte();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase AWD3Utils.INT16:\r\n\t\t\t\t\t\tattr_val = this._newBlockBytes.readShort();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase AWD3Utils.INT32:\r\n\t\t\t\t\t\tattr_val = this._newBlockBytes.readInt();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase AWD3Utils.BOOL:\r\n\t\t\t\t\tcase AWD3Utils.UINT8:\r\n\t\t\t\t\t\tattr_val = this._newBlockBytes.readUnsignedByte();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase AWD3Utils.UINT16:\r\n\t\t\t\t\t\tattr_val = this._newBlockBytes.readUnsignedShort();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase AWD3Utils.UINT32:\r\n\t\t\t\t\tcase AWD3Utils.BADDR:\r\n\t\t\t\t\t\tattr_val = this._newBlockBytes.readUnsignedInt();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase AWD3Utils.FLOAT32:\r\n\t\t\t\t\t\tattr_val = this._newBlockBytes.readFloat();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase AWD3Utils.FLOAT64:\r\n\t\t\t\t\t\tattr_val = this._newBlockBytes.readDouble();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tattr_val = 'unimplemented attribute type ' + attr_type;\r\n\t\t\t\t\t\tthis._newBlockBytes.position += attr_len;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this._debug) {\r\n\t\t\t\t\tconsole.log(\"attribute = name: \" + attr_key + \"  / value = \" + attr_val);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tattributes[attr_key] = attr_val;\r\n\t\t\t\tattibuteCnt += 1;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn attributes;\r\n\t}\r\n\r\n\tpublic parseProperties(expected:Object):AWDProperties\r\n\t{\r\n\t\tvar list_end:number;\r\n\t\tvar list_len:number;\r\n\t\tvar propertyCnt:number = 0;\r\n\t\tvar props:AWDProperties = new AWDProperties();\r\n\r\n\t\tlist_len = this._newBlockBytes.readUnsignedInt();\r\n\t\tlist_end = this._newBlockBytes.position + list_len;\r\n\r\n\t\tif (expected) {\r\n\r\n\t\t\twhile (this._newBlockBytes.position < list_end) {\r\n\t\t\t\tvar len:number;\r\n\t\t\t\tvar key:number;\r\n\t\t\t\tvar type:number;\r\n\r\n\t\t\t\tkey = this._newBlockBytes.readUnsignedShort();\r\n\t\t\t\tlen = this._newBlockBytes.readUnsignedInt();\r\n\r\n\t\t\t\tif ((this._newBlockBytes.position + len) > list_end) {\r\n\t\t\t\t\tconsole.log(\"           Error in reading property # \" + propertyCnt + \" = skipped to end of propertie-list\");\r\n\t\t\t\t\tthis._newBlockBytes.position = list_end;\r\n\t\t\t\t\treturn props;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (expected.hasOwnProperty(key.toString())) {\r\n\t\t\t\t\ttype = expected[key];\r\n\t\t\t\t\tprops.set(key, this.parseAttrValue(type, len));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._newBlockBytes.position += len;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tpropertyCnt += 1;\r\n\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis._newBlockBytes.position = list_end;\r\n\t\t}\r\n\r\n\t\treturn props;\r\n\r\n\t}\r\n\r\n\tprivate parseAttrValue(type:number, len:number):any\r\n\t{\r\n\t\tvar elem_len:number;\r\n\t\tvar read_func:Function;\r\n\r\n\t\tswitch (type) {\r\n\r\n\t\t\tcase AWD3Utils.BOOL:\r\n\t\t\tcase AWD3Utils.INT8:\r\n\t\t\t\telem_len = 1;\r\n\t\t\t\tread_func = this._newBlockBytes.readByte;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase AWD3Utils.INT16:\r\n\t\t\t\telem_len = 2;\r\n\t\t\t\tread_func = this._newBlockBytes.readShort;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase AWD3Utils.INT32:\r\n\t\t\t\telem_len = 4;\r\n\t\t\t\tread_func = this._newBlockBytes.readInt;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase AWD3Utils.UINT8:\r\n\t\t\t\telem_len = 1;\r\n\t\t\t\tread_func = this._newBlockBytes.readUnsignedByte;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase AWD3Utils.UINT16:\r\n\t\t\t\telem_len = 2;\r\n\t\t\t\tread_func = this._newBlockBytes.readUnsignedShort;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase AWD3Utils.UINT32:\r\n\t\t\tcase AWD3Utils.COLOR:\r\n\t\t\tcase AWD3Utils.BADDR:\r\n\t\t\t\telem_len = 4;\r\n\t\t\t\tread_func = this._newBlockBytes.readUnsignedInt;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase AWD3Utils.FLOAT32:\r\n\t\t\t\telem_len = 4;\r\n\t\t\t\tread_func = this._newBlockBytes.readFloat;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase AWD3Utils.FLOAT64:\r\n\t\t\t\telem_len = 8;\r\n\t\t\t\tread_func = this._newBlockBytes.readDouble;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase AWD3Utils.AWDSTRING:\r\n\t\t\t\treturn this._newBlockBytes.readUTFBytes(len);\r\n\r\n\t\t\tcase AWD3Utils.VECTOR2x1:\r\n\t\t\tcase AWD3Utils.VECTOR3x1:\r\n\t\t\tcase AWD3Utils.VECTOR4x1:\r\n\t\t\tcase AWD3Utils.MTX3x2:\r\n\t\t\tcase AWD3Utils.MTX3x3:\r\n\t\t\tcase AWD3Utils.MTX4x3:\r\n\t\t\tcase AWD3Utils.MTX4x4:\r\n\t\t\t\telem_len = 8;\r\n\t\t\t\tread_func = this._newBlockBytes.readDouble;\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t\tif (elem_len < len) {\r\n\t\t\tvar list:Array<any> = [];\r\n\t\t\tvar num_read:number = 0;\r\n\t\t\tvar num_elems:number = len/elem_len;\r\n\r\n\t\t\twhile (num_read < num_elems) {\r\n\t\t\t\tlist.push(read_func.apply(this._newBlockBytes)); // list.push(read_func());\r\n\t\t\t\tnum_read++;\r\n\t\t\t}\r\n\r\n\t\t\treturn list;\r\n\t\t} else {\r\n\r\n\t\t\tvar val:any = read_func.apply(this._newBlockBytes);//read_func();\r\n\t\t\treturn val;\r\n\t\t}\r\n\t}\r\n\r\n\t// Helper - functions\r\n\tpublic getUVForVertexAnimation(meshID:number /*uint*/):Array<Array<number>>\r\n\t{\r\n\t\tif (this._blocks[meshID].data instanceof Mesh)\r\n\t\t\tmeshID = this._blocks[meshID].geoID;\r\n\t\tif (this._blocks[meshID].uvsForVertexAnimation)\r\n\t\t\treturn this._blocks[meshID].uvsForVertexAnimation;\r\n\t\tvar geometry:Geometry = (<Geometry> this._blocks[meshID].data);\r\n\t\tvar geoCnt:number /*int*/ = 0;\r\n\t\tvar ud:Array<number>;\r\n\t\tvar uStride:number /*uint*/;\r\n\t\tvar uOffs:number /*uint*/;\r\n\t\tvar numPoints:number /*uint*/;\r\n\t\tvar i:number /*int*/;\r\n\t\tvar newUvs:Array<number>;\r\n\t\tvar sub_geom:TriangleSubGeometry;\r\n\t\tthis._blocks[meshID].uvsForVertexAnimation = new Array<Array<number>>();\r\n\t\twhile (geoCnt < geometry.subGeometries.length) {\r\n\t\t\tnewUvs = new Array<number>();\r\n\t\t\tsub_geom = <TriangleSubGeometry> geometry.subGeometries[geoCnt];\r\n\t\t\tnumPoints = sub_geom.numVertices;\r\n\t\t\tud = sub_geom.uvs;\r\n\t\t\tuStride = sub_geom.getStride(TriangleSubGeometry.UV_DATA);\r\n\t\t\tuOffs = sub_geom.getOffset(TriangleSubGeometry.UV_DATA);\r\n\t\t\tfor (i = 0; i < numPoints; i++) {\r\n\t\t\t\tnewUvs.push(ud[uOffs + i*uStride + 0]);\r\n\t\t\t\tnewUvs.push(ud[uOffs + i*uStride + 1]);\r\n\t\t\t}\r\n\t\t\tthis._blocks[meshID].uvsForVertexAnimation.push(newUvs);\r\n\t\t\tgeoCnt++;\r\n\t\t}\r\n\t\treturn this._blocks[meshID].uvsForVertexAnimation;\r\n\t}\r\n\r\n\tpublic parseVarStr():string\r\n\t{\r\n\r\n\t\tvar len:number = this._newBlockBytes.readUnsignedShort();\r\n\t\treturn this._newBlockBytes.readUTFBytes(len);\r\n\t}\r\n\r\n\tpublic getBlockByID(assetID:number):AWDBlock\r\n\t{\r\n\t\treturn this._blocks[assetID];\r\n\t}\r\n\tpublic getAssetByID(assetID:number):IAsset\r\n\t{\r\n\t\treturn this._blocks[assetID].data;\r\n\t}\r\n\tprivate getDefaultAsset(assetType:string, extraTypeInfo:string):IAsset\r\n\t{\r\n\t\tswitch (true) {\r\n\t\t\tcase (assetType == TextureBase.assetType):\r\n\t\t\t\tif (extraTypeInfo == \"CubeTexture\")\r\n\t\t\t\t\treturn this.getDefaultCubeTexture();\r\n\t\t\t\tif (extraTypeInfo == \"SingleTexture\")\r\n\t\t\t\t\treturn DefaultMaterialManager.getDefaultTexture();\r\n\t\t\t\tbreak;\r\n\t\t\tcase (assetType == MaterialBase.assetType):\r\n\t\t\t\treturn DefaultMaterialManager.getDefaultMaterial();\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\tpublic getDefaultCubeTexture():IAsset\r\n\t{\r\n\t\tif (!this._defaultCubeTexture) {\r\n\t\t\tvar defaultBitmap:BitmapData = DefaultMaterialManager.createCheckeredBitmapData();\r\n\r\n\t\t\tthis._defaultCubeTexture = new BitmapCubeTexture(defaultBitmap, defaultBitmap, defaultBitmap, defaultBitmap, defaultBitmap, defaultBitmap);\r\n\t\t\tthis._defaultCubeTexture.name = \"defaultCubeTexture\";\r\n\t\t}\r\n\r\n\t\treturn <IAsset> this._defaultCubeTexture;\r\n\t}\r\n\r\n\tpublic  readNumber(precision:boolean = false):number\r\n\t{\r\n\t\tif (precision)\r\n\t\t\treturn this._newBlockBytes.readDouble();\r\n\t\treturn this._newBlockBytes.readFloat();\r\n\r\n\t}\r\n\r\n\tpublic parseMatrix3D():Matrix3D\r\n\t{\r\n\t\treturn new Matrix3D(this.parseMatrix43RawData());\r\n\t}\r\n\r\n\tprivate parseMatrix32RawData():Array<number>\r\n\t{\r\n\t\tvar i:number;\r\n\t\tvar mtx_raw:Array<number> = new Array<number>(6);\r\n\t\tfor (i = 0; i < 6; i++) {\r\n\t\t\tmtx_raw[i] = this._newBlockBytes.readFloat();\r\n\t\t}\r\n\r\n\t\treturn mtx_raw;\r\n\t}\r\n\r\n\tpublic parseMatrix43RawData():Array<number>\r\n\t{\r\n\t\tvar mtx_raw:Array<number> = new Array<number>(16);\r\n\r\n\t\tmtx_raw[0] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[1] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[2] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[3] = 0.0;\r\n\t\tmtx_raw[4] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[5] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[6] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[7] = 0.0;\r\n\t\tmtx_raw[8] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[9] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[10] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[11] = 0.0;\r\n\t\tmtx_raw[12] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[13] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[14] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[15] = 1.0;\r\n\r\n\t\t//TODO: fix max exporter to remove NaN values in joint 0 inverse bind pose\r\n\r\n\t\tif (isNaN(mtx_raw[0])) {\r\n\t\t\tmtx_raw[0] = 1;\r\n\t\t\tmtx_raw[1] = 0;\r\n\t\t\tmtx_raw[2] = 0;\r\n\t\t\tmtx_raw[4] = 0;\r\n\t\t\tmtx_raw[5] = 1;\r\n\t\t\tmtx_raw[6] = 0;\r\n\t\t\tmtx_raw[8] = 0;\r\n\t\t\tmtx_raw[9] = 0;\r\n\t\t\tmtx_raw[10] = 1;\r\n\t\t\tmtx_raw[12] = 0;\r\n\t\t\tmtx_raw[13] = 0;\r\n\t\t\tmtx_raw[14] = 0;\r\n\r\n\t\t}\r\n\r\n\t\treturn mtx_raw;\r\n\t}\r\n\r\n}\r\n\r\nexport = AWD3FileData;\r\n\r\n\r\n\r\n",
    "\r\nclass AWD3Utils {\r\n\tpublic static BLOCKSTATE_FINALIZE:number = 0;\r\n\tpublic static BLOCKSTATE_INVALID:number = 1;\r\n\tpublic static BLOCKSTATE_LOAD_DEPENDENICES:number = 2;\r\n\tpublic static BLOCKSTATE_NO_ASSET:number = 3;\r\n\tpublic static COMPRESSIONMODE_LZMA:string = \"lzma\";\r\n\tpublic static UNCOMPRESSED:number = 0;\r\n\tpublic static DEFLATE:number = 1;\r\n\tpublic static LZMA:number = 2;\r\n\tpublic static INT8:number = 1;\r\n\tpublic static INT16:number = 2;\r\n\tpublic static INT32:number = 3;\r\n\tpublic static UINT8:number = 4;\r\n\tpublic static UINT16:number = 5;\r\n\tpublic static UINT32:number = 6;\r\n\tpublic static FLOAT32:number = 7;\r\n\tpublic static FLOAT64:number = 8;\r\n\tpublic static BOOL:number = 21;\r\n\tpublic static COLOR:number = 22;\r\n\tpublic static BADDR:number = 23;\r\n\tpublic static AWDSTRING:number = 31;\r\n\tpublic static AWDBYTEARRAY:number = 32;\r\n\tpublic static VECTOR2x1:number = 41;\r\n\tpublic static VECTOR3x1:number = 42;\r\n\tpublic static VECTOR4x1:number = 43;\r\n\tpublic static MTX3x2:number = 44;\r\n\tpublic static MTX3x3:number = 45;\r\n\tpublic static MTX4x3:number = 46;\r\n\tpublic static MTX4x4:number = 47;\r\n}\r\nexport = AWD3Utils;",
    "\r\n/**\r\n *\r\n */\r\nclass AWDBitFlags\r\n{\r\n\tpublic static FLAG1:number = 1;\r\n\tpublic static FLAG2:number = 2;\r\n\tpublic static FLAG3:number = 4;\r\n\tpublic static FLAG4:number = 8;\r\n\tpublic static FLAG5:number = 16;\r\n\tpublic static FLAG6:number = 32;\r\n\tpublic static FLAG7:number = 64;\r\n\tpublic static FLAG8:number = 128;\r\n\tpublic static FLAG9:number = 256;\r\n\tpublic static FLAG10:number = 512;\r\n\tpublic static FLAG11:number = 1024;\r\n\tpublic static FLAG12:number = 2048;\r\n\tpublic static FLAG13:number = 4096;\r\n\tpublic static FLAG14:number = 8192;\r\n\tpublic static FLAG15:number = 16384;\r\n\tpublic static FLAG16:number = 32768;\r\n\r\n\tpublic static test(flags:number, testFlag:number):boolean\r\n\t{\r\n\t\treturn (flags & testFlag) == testFlag;\r\n\t}\r\n}\r\nexport = AWDBitFlags;",
    "import ByteArray\t\t\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport AWD3Utils\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\n\r\nclass AWDBlock\r\n{\r\n\tpublic id:number;\r\n\tpublic name:string;\r\n\tpublic type:number;\r\n\tpublic data:any;\r\n\tpublic dependencies_data:Array<ByteArray>;\r\n\tpublic dependencies_urls:Array<string>;\r\n\tpublic loaded_dependencies:Array<any>;\r\n\tpublic loaded_dependencies_cnt:number;\r\n\tpublic len:number;\r\n\tpublic geoID:number;\r\n\tpublic state:number;\r\n\tpublic extras:Object;\r\n\tpublic bytes:ByteArray;\r\n\tpublic errorMessages:Array<string>;\r\n\tpublic uvsForVertexAnimation:Array<Array<number>>;\r\n\r\n\tconstructor(this_id:number, this_type:number)\r\n\t{\r\n\t\tthis.type=this_type;\r\n\t\tthis.id=this_id;\r\n\t\tthis.state = AWD3Utils.BLOCKSTATE_FINALIZE;\r\n\t\tthis.dependencies_data=Array<any>();\r\n\t\tthis.dependencies_urls=Array<string>();\r\n\t\tif(this_type==83){\r\n\t\t\tthis.loaded_dependencies=Array<any>(6);\r\n\t\t}\r\n\t\tthis.loaded_dependencies_cnt=0;\r\n\t}\r\n\r\n\tpublic dispose()\r\n\t{\r\n\r\n\t\tthis.id = null;\r\n\t\tthis.bytes = null;\r\n\t\tthis.errorMessages = null;\r\n\t\tthis.uvsForVertexAnimation = null;\r\n\r\n\t}\r\n\r\n\tpublic addError(errorMsg:string):void\r\n\t{\r\n\t\tif (!this.errorMessages)\r\n\t\t\tthis.errorMessages = new Array<string>();\r\n\r\n\t\tthis.errorMessages.push(errorMsg);\r\n\t}\r\n}\r\nexport = AWDBlock;",
    "\r\nclass AWDProperties\r\n{\r\n\tpublic set(key:number, value:any):void\r\n\t{\r\n\t\tthis[ key.toString() ] = value;\r\n\t}\r\n\r\n\tpublic get(key:number, fallback:any):any\r\n\t{\r\n\t\tif (this.hasOwnProperty(key.toString())) {\r\n\t\t\treturn this[key.toString()];\r\n\t\t} else {\r\n\t\t\treturn fallback;\r\n\t\t}\r\n\t}\r\n}\r\nexport = AWDProperties;",
    "\r\n\r\nimport BitmapData\t\t\t\t\t\t= require(\"awayjs-core/lib/data/BitmapData\");\r\nimport BlendMode\t\t\t\t\t\t= require(\"awayjs-core/lib/data/BlendMode\");\r\nimport TriangleSubGeometry\t\t\t\t= require(\"awayjs-core/lib/data/TriangleSubGeometry\");\r\nimport Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\nimport URLLoaderDataFormat\t\t\t\t= require(\"awayjs-core/lib/net/URLLoaderDataFormat\");\r\nimport URLRequest\t\t\t\t\t\t= require(\"awayjs-core/lib/net/URLRequest\");\r\nimport IAsset\t\t\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport ParserBase\t\t\t\t\t\t= require(\"awayjs-core/lib/parsers/ParserBase\");\r\nimport ParserUtils\t\t\t\t\t\t= require(\"awayjs-core/lib/parsers/ParserUtils\");\r\nimport ResourceDependency\t\t\t\t= require(\"awayjs-core/lib/parsers/ResourceDependency\");\r\n\r\nimport BitmapCubeTexture\t\t\t\t= require(\"awayjs-core/lib/textures/BitmapCubeTexture\");\r\nimport BitmapTexture\t\t\t\t\t= require(\"awayjs-core/lib/textures/BitmapTexture\");\r\n\r\nimport CubeTextureBase\t\t\t\t\t= require(\"awayjs-core/lib/textures/CubeTextureBase\");\r\nimport ImageCubeTexture\t\t\t\t\t= require(\"awayjs-core/lib/textures/ImageCubeTexture\");\r\nimport ImageTexture\t\t\t\t\t\t= require(\"awayjs-core/lib/textures/ImageTexture\");\r\nimport TextureBase\t\t\t\t\t\t= require(\"awayjs-core/lib/textures/TextureBase\");\r\nimport ByteArray\t\t\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\nimport Geometry\t\t\t\t\t\t\t= require(\"awayjs-core/lib/data/Geometry\");\r\n\r\nimport Texture2DBase\t\t\t\t\t= require(\"awayjs-core/lib/textures/Texture2DBase\");\r\nimport DisplayObject\t\t\t\t\t= require(\"awayjs-display/lib/base/DisplayObject\");\r\nimport DisplayObjectContainer\t\t\t= require(\"awayjs-display/lib/containers/DisplayObjectContainer\");\r\n\r\nimport MaterialBase\t\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\r\nimport DefaultMaterialManager\t\t\t= require(\"awayjs-display/lib/managers/DefaultMaterialManager\");\r\n\r\n\r\nimport Mesh\t\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Mesh\");\r\n\r\n\r\n\r\n\r\nimport AWDBitFlags\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDBitFlags\");\r\nimport AWDProperties\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDProperties\");\r\n\r\nimport AWDAssetParsers\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3BlockParsers/AWDBlockParsers\");\r\nimport AWDBlock\t\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWDBlock\");\r\nimport AWD3FileData\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3FileData\");\r\nimport AWD3Utils\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWD3ParserUtils/AWD3Utils\");\r\n\r\n\r\n\r\n/**\r\n * AWD3Utils provides a parser for the AWD data type.\r\n */\r\nclass AWD3Parser extends ParserBase\r\n{\r\n\t//set to \"true\" to have some console.logs in the Console\r\n\tprivate _debug:boolean = false;\r\n\tprivate _byteData:ByteArray;\r\n\tprivate _startedParsing:boolean = false;\r\n\tprivate _compression:number;\r\n\tprivate _streaming:boolean;\r\n\tprivate _parsed_header:boolean = false;\r\n\tprivate _body:ByteArray;\r\n\tprivate _awd_data:AWD3FileData;\r\n\tprivate _block_parser:AWDAssetParsers;\r\n\r\n\t// temp for checking stats\r\n\tpublic total_time:number = 0;\r\n\tpublic geom_time:number = 0;\r\n\tpublic timeline_time:number = 0;\r\n\r\n\t/**\r\n\t * Creates a new AWD3Utils object.\r\n\t * @param uri The url or id of the data or file to be parsed.\r\n\t * @param extra The holder for extra contextual data that the parser might need.\r\n\t */\r\n\tconstructor(block_parser:AWDAssetParsers = undefined)\r\n\t{\r\n\t\tsuper(URLLoaderDataFormat.ARRAY_BUFFER);\r\n\r\n\t\tthis._block_parser=block_parser;\r\n\t\tif(this._block_parser==undefined){\r\n\t\t\tthis._block_parser=new AWDAssetParsers();\r\n\t\t}\r\n\t\tthis._awd_data=new AWD3FileData();\r\n\t\tthis._block_parser.init_parser(this._awd_data);\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates whether or not a given file extension is supported by the parser.\r\n\t * @param extension The file extension of a potential file to be parsed.\r\n\t * @return Whether or not the given file type is supported.\r\n\t */\r\n\tpublic static supportsType(extension:string):boolean\r\n\t{\r\n\t\textension = extension.toLowerCase();\r\n\t\treturn extension == \"awd\";\r\n\t}\r\n\r\n\t/**\r\n\t * Tests whether a data block can be parsed by the parser.\r\n\t * @param data The data block to potentially be parsed.\r\n\t * @return Whether or not the given data is supported.\r\n\t */\r\n\tpublic static supportsData(data:any):boolean\r\n\t{\r\n\t\treturn (ParserUtils.toString(data, 3) == 'AWD');\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iResolveDependency(resourceDependency:ResourceDependency)\r\n\t{\r\n\t\t// this will be called when Dependency has finished loading.\r\n\t\t// the ressource dependecniy has a id that point to the awd_block waiting for it.\r\n\t\tif (resourceDependency.assets.length == 1) {\r\n\t\t\tvar this_block:AWDBlock = this._awd_data.getBlockByID(parseInt(resourceDependency.id));\r\n\t\t\tif(this_block.type==82){\r\n\t\t\t\tvar testure_asset:Texture2DBase = <Texture2DBase> resourceDependency.assets[0];\r\n\t\t\t\tthis_block.data = testure_asset; // Store finished asset\r\n\t\t\t\t// Finalize texture asset to dispatch texture event, which was\r\n\t\t\t\t// previously suppressed while the dependency was loaded.\r\n\t\t\t\tthis._pFinalizeAsset(<IAsset> testure_asset, this_block.name);\r\n\r\n\t\t\t\tif (this._debug) {\r\n\t\t\t\t\tconsole.log(\"Successfully loaded Bitmap for texture\");\r\n\t\t\t\t\tconsole.log(\"Parsed texture: Name = \" + this_block.name);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if(this_block.type==44){\r\n\t\t\t\t// todo: implement parsing of Audio block data\r\n\t\t\t\t/*asset = <Texture2DBase> resourceDependency.assets[0];\r\n\t\t\t\tthis_block.data = asset; // Store finished asset\r\n\t\t\t\t// Finalize texture asset to dispatch texture event, which was\r\n\t\t\t\t// previously suppressed while the dependency was loaded.\r\n\t\t\t\tthis._pFinalizeAsset(<IAsset> asset, this_block.name);\r\n\r\n\t\t\t\tif (this._debug) {\r\n\t\t\t\t\tconsole.log(\"Successfully loaded Bitmap for texture\");\r\n\t\t\t\t\tconsole.log(\"Parsed texture: Name = \" + this_block.name);\r\n\t\t\t\t}*/\r\n\t\t\t}\r\n\t\t\telse if(this_block.type==83){\r\n\t\t\t\tthis_block.loaded_dependencies[resourceDependency.sub_id]=<Texture2DBase> resourceDependency.assets[0];\r\n\t\t\t\tthis_block.loaded_dependencies_cnt++;\r\n\t\t\t\tif(this_block.loaded_dependencies_cnt==6){\r\n\t\t\t\t\tif (this._debug) {\r\n\t\t\t\t\t\tconsole.log(\"Successfully loaded Bitmap \" + resourceDependency.sub_id + \" / 6 for Cubetexture\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar posX:any = this_block.loaded_dependencies[0];\r\n\t\t\t\t\tvar negX:any = this_block.loaded_dependencies[1];\r\n\t\t\t\t\tvar posY:any = this_block.loaded_dependencies[2];\r\n\t\t\t\t\tvar negY:any = this_block.loaded_dependencies[3];\r\n\t\t\t\t\tvar posZ:any = this_block.loaded_dependencies[4];\r\n\t\t\t\t\tvar negZ:any = this_block.loaded_dependencies[5];\r\n\r\n\t\t\t\t\tvar cube_tex_asset = <TextureBase> new ImageCubeTexture(posX, negX, posY, negY, posZ, negZ);\r\n\t\t\t\t\tthis_block.data = cube_tex_asset; // Store finished asset\r\n\t\t\t\t\tthis._pFinalizeAsset(<IAsset> cube_tex_asset, this_block.name);\r\n\t\t\t\t\tif (this._debug) {\r\n\t\t\t\t\t\tconsole.log(\"Parsed CubeTexture: Name = \" + this_block.name);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iResolveDependencyFailure(resourceDependency:ResourceDependency)\r\n\t{\r\n\t\t//\tnot used - if a dependcy fails, the awaiting Texture or CubeTexture will never be finalized, and the default-bitmaps will be used.\r\n\t\t// \tthis means, that if one Bitmap of a CubeTexture fails, the CubeTexture will have the DefaultTexture applied for all six Bitmaps.\r\n\t}\r\n\r\n\t/**\r\n\t * Resolve a dependency name\r\n\t *\r\n\t * @param resourceDependency The dependency to be resolved.\r\n\t */\r\n\tpublic _iResolveDependencyName(resourceDependency:ResourceDependency, asset:IAsset):string\r\n\t{\r\n\t\tvar oldName:string = asset.name;\r\n\r\n\t\tif (asset) {\r\n\t\t\tvar block:AWDBlock = this._awd_data.getBlockByID(parseInt(resourceDependency.id));\r\n\t\t\t// Reset name of texture to the one defined in the AWD file,\r\n\t\t\t// as opposed to whatever the image parser came up with.\r\n\t\t\tasset.resetAssetPath(block.name, null, true);\r\n\t\t}\r\n\r\n\t\tvar newName:string = asset.name;\r\n\r\n\t\tasset.name = oldName;\r\n\r\n\t\treturn newName;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pProceedParsing():boolean\r\n\t{\r\n\r\n\t\tif (!this._startedParsing) {\r\n\t\t\tthis._byteData = this._pGetByteData();//getByteData();\r\n\t\t\tthis._startedParsing = true;\r\n\t\t}\r\n\r\n\t\tif (!this._parsed_header) {\r\n\r\n\t\t\t//----------------------------------------------------------------------------\r\n\t\t\t// LITTLE_ENDIAN - Default for ArrayBuffer / Not implemented in ByteArray\r\n\t\t\t//----------------------------------------------------------------------------\r\n\t\t\t//this._byteData.endian = Endian.LITTLE_ENDIAN;\r\n\t\t\t//----------------------------------------------------------------------------\r\n\r\n\t\t\t//----------------------------------------------------------------------------\r\n\t\t\t// Parse header and decompress body if needed\r\n\t\t\tthis.parseHeader();\r\n\r\n\t\t\tswitch (this._compression) {\r\n\r\n\t\t\t\tcase AWD3Utils.DEFLATE:\r\n\t\t\t\tcase AWD3Utils.LZMA:\r\n\t\t\t\t\tthis._pDieWithError('Compressed AWD formats not yet supported');\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase AWD3Utils.UNCOMPRESSED:\r\n\t\t\t\t\tthis._body = this._byteData;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t//----------------------------------------------------------------------------\r\n\t\t\t\t// Compressed AWD Formats not yet supported\r\n\t\t\t\t//----------------------------------------------------------------------------\r\n\r\n\t\t\t\t/*\r\n\t\t\t\t case AWD3Parserutils.DEFLATE:\r\n\r\n\t\t\t\t this._body = new ByteArray();\r\n\t\t\t\t this._byteData.readBytes(this._body, 0, this._byteData.getBytesAvailable());\r\n\t\t\t\t this._body.uncompress();\r\n\r\n\t\t\t\t break;\r\n\t\t\t\t case AWD3Parserutils.LZMA:\r\n\r\n\t\t\t\t this._body = new ByteArray();\r\n\t\t\t\t this._byteData.readBytes(this._body, 0, this._byteData.getBytesAvailable());\r\n\t\t\t\t this._body.uncompress(COMPRESSIONMODE_LZMA);\r\n\r\n\t\t\t\t break;\r\n\t\t\t\t //*/\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis._parsed_header = true;\r\n\r\n\t\t\t//----------------------------------------------------------------------------\r\n\t\t\t// LITTLE_ENDIAN - Default for ArrayBuffer / Not implemented in ByteArray\r\n\t\t\t//----------------------------------------------------------------------------\r\n\t\t\t//this._body.endian = Endian.LITTLE_ENDIAN;// Should be default\r\n\t\t\t//----------------------------------------------------------------------------\r\n\r\n\t\t}\r\n\r\n\t\tif (this._body) {\r\n\r\n\t\t\twhile (this._body.getBytesAvailable() > 0 && !this.parsingPaused) //&& this._pHasTime() )\r\n\t\t\t{\r\n\t\t\t\tthis.parseNextBlock();\r\n\r\n\t\t\t}\r\n\r\n\t\t\t//----------------------------------------------------------------------------\r\n\t\t\t// Return complete status\r\n\t\t\tif (this._body.getBytesAvailable() == 0) {\r\n\t\t\t\tthis.dispose();\r\n\t\t\t\treturn  ParserBase.PARSING_DONE;\r\n\t\t\t} else {\r\n\t\t\t\treturn  ParserBase.MORE_TO_PARSE;\r\n\t\t\t}\r\n\t\t} else {\r\n\r\n\t\t\tswitch (this._compression) {\r\n\r\n\t\t\t\tcase AWD3Utils.DEFLATE:\r\n\t\t\t\tcase AWD3Utils.LZMA:\r\n\r\n\t\t\t\t\tif (this._debug) {\r\n\t\t\t\t\t\tconsole.log(\"(!) AWD3Utils Error: Compressed AWD formats not yet supported (!)\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\t\t\t// Error - most likely _body not set because we do not support compression.\r\n\t\t\treturn  ParserBase.PARSING_DONE;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tpublic _pStartParsing(frameLimit:number)\r\n\t{\r\n\t\tsuper._pStartParsing(frameLimit);\r\n\r\n\t\t//create a content object for Loaders\r\n\t\tthis._pContent = new DisplayObjectContainer();\r\n\t}\r\n\r\n\tprivate dispose():void\r\n\t{\r\n\t\tthis._awd_data.dispose();\r\n\t}\r\n\r\n\tprivate parseNextBlock():void\r\n\t{\r\n\t\tvar block_id:number = this._body.readUnsignedInt();\r\n\r\n\t\tvar ns:number = this._body.readUnsignedByte();\r\n\t\tvar block_type:number = this._body.readUnsignedByte();\r\n\t\tvar flags:number = this._body.readUnsignedByte();\r\n\t\tvar len:number = this._body.readUnsignedInt();\r\n\r\n\t\tvar blockCompression:boolean = AWDBitFlags.test(flags, AWDBitFlags.FLAG4);\r\n\t\tvar blockCompressionLZMA:boolean = AWDBitFlags.test(flags, AWDBitFlags.FLAG5);\r\n\r\n\t\tif (this._awd_data.accuracyOnBlocks) {\r\n\t\t\tthis._awd_data.accuracyMatrix = AWDBitFlags.test(flags, AWDBitFlags.FLAG1);\r\n\t\t\tthis._awd_data.accuracyGeo = AWDBitFlags.test(flags, AWDBitFlags.FLAG2);\r\n\t\t\tthis._awd_data.accuracyProps = AWDBitFlags.test(flags, AWDBitFlags.FLAG3);\r\n\t\t\tthis._awd_data.geoNrType = AWD3Utils.FLOAT32;\r\n\r\n\t\t\tif (this._awd_data.accuracyGeo) {\r\n\t\t\t\tthis._awd_data.geoNrType = AWD3Utils.FLOAT64;\r\n\t\t\t}\r\n\r\n\t\t\tthis._awd_data.matrixNrType = AWD3Utils.FLOAT32;\r\n\r\n\t\t\tif (this._awd_data.accuracyMatrix) {\r\n\t\t\t\tthis._awd_data.matrixNrType = AWD3Utils.FLOAT64;\r\n\t\t\t}\r\n\r\n\t\t\tthis._awd_data.propsNrType = AWD3Utils.FLOAT32;\r\n\r\n\t\t\tif (this._awd_data.accuracyProps) {\r\n\t\t\t\tthis._awd_data.propsNrType = AWD3Utils.FLOAT64;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar blockEndAll:number = this._body.position + len;\r\n\r\n\t\tif (len > this._body.getBytesAvailable()) {\r\n\t\t\tthis._pDieWithError('AWD2 block length is bigger than the bytes that are available!');\r\n\t\t\tthis._body.position += this._body.getBytesAvailable();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar newBlockBytes:ByteArray = new ByteArray();\r\n\t\tthis._body.readBytes(newBlockBytes, 0, len);\r\n\t\tthis._awd_data.newBlockBytes = newBlockBytes;\r\n\r\n\t\t//----------------------------------------------------------------------------\r\n\t\t// Compressed AWD Formats not yet supported\r\n\r\n\t\tif (blockCompression) {\r\n\t\t\tthis._pDieWithError('Compressed AWD formats not yet supported');\r\n\r\n\t\t\t/*\r\n\t\t\t if (blockCompressionLZMA)\r\n\t\t\t {\r\n\t\t\t this._newBlockBytes.uncompress(AWD3Parserutils.COMPRESSIONMODE_LZMA);\r\n\t\t\t }\r\n\t\t\t else\r\n\t\t\t {\r\n\t\t\t this._newBlockBytes.uncompress();\r\n\t\t\t }\r\n\t\t\t */\r\n\r\n\t\t}\r\n\r\n\t\t//----------------------------------------------------------------------------\r\n\t\t// LITTLE_ENDIAN - Default for ArrayBuffer / Not implemented in ByteArray\r\n\t\t//----------------------------------------------------------------------------\r\n\t\t//this._newBlockBytes.endian = Endian.LITTLE_ENDIAN;\r\n\t\t//----------------------------------------------------------------------------\r\n\r\n\t\tthis._awd_data.newBlockBytes.position = 0;\r\n\r\n\t\t// if this is the first block, and it is no metadatablock, we add a empty block at index 0,to keep in synch with blocks\r\n\t\tif((block_type!=255)&&(this._awd_data.block_cnt()==0)){\r\n\t\t\tthis._awd_data.create_new_block(255);\r\n\t\t}\r\n\r\n\t\tthis._awd_data.create_new_block(block_type);\r\n\r\n\t\tif (blockCompression) {\r\n\t\t\tthis._pDieWithError('Compressed AWD formats not yet supported');\r\n\t\t\t//blockEndBlock   = this._newBlockBytes.position + this._newBlockBytes.length;\r\n\t\t\t//block.len       = blockEndBlock;\r\n\t\t}\r\n\r\n\t\tif (this._debug) {\r\n\t\t\tconsole.log(\"AWDBlock:  ID = \" + block_id + \" | TypeID = \" + block_type + \" | Compression = \" + blockCompression + \" | Matrix-Precision = \" + this._awd_data.accuracyMatrix + \" | Geometry-Precision = \" + this._awd_data.accuracyGeo + \" | Properties-Precision = \" + this._awd_data.accuracyProps);\r\n\t\t}\r\n\r\n\t\tvar time_start = performance.now();\r\n\r\n\t\t// first check if the block is any of the 3 blocks that does not produce a asset.\r\n\t\t\t// this block contains a asset.\r\n\t\tif(this._block_parser.parseAsset(block_type)){\r\n\t\t\tif(this._awd_data.cur_block.state==AWD3Utils.BLOCKSTATE_FINALIZE){\r\n\t\t\t\tthis._pFinalizeAsset(<IAsset>this._awd_data.cur_block.data, this._awd_data.cur_block.name);\r\n\t\t\t}\r\n\t\t\telse if(this._awd_data.cur_block.state==AWD3Utils.BLOCKSTATE_INVALID){\r\n\t\t\t\tconsole.log(\"ERROR while parsing block - type = \", block_type, \" id = \", block_id);\r\n\t\t\t}\r\n\t\t\telse if(this._awd_data.cur_block.state==AWD3Utils.BLOCKSTATE_LOAD_DEPENDENICES){\r\n\t\t\t\t// trigger No asset created yet, because the block has dependencies. load the dependencies:.\r\n\t\t\t\tfor(var r:number=0; r<this._awd_data.cur_block.dependencies_urls.length;r++){\r\n\t\t\t\t\t// load dependencies by url. let the parser system decide how to parse it\r\n\t\t\t\t\tthis._pAddDependency(this._awd_data.cur_block.id.toString(), new URLRequest(this._awd_data.cur_block.dependencies_urls[r]), false, null, true, r);\r\n\t\t\t\t}\r\n\t\t\t\tfor(var r:number=0; r<this._awd_data.cur_block.dependencies_data.length;r++) {\r\n\t\t\t\t\t// load dependencies from data. need to prepare the data based on block_type (image vs audio).\r\n\t\t\t\t\tif ((block_type == 82) || (block_type == 83)) {\r\n\t\t\t\t\t\tthis._pAddDependency(this._awd_data.cur_block.id.toString(), null, false, ParserUtils.byteArrayToImage(this._awd_data.cur_block.dependencies_data[r]), true, r);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (block_type == 44) {\r\n\t\t\t\t\t\t// todo: parse audio data\r\n\t\t\t\t\t\t// this._pAddDependency(this._awd_data.cur_block.id.toString(), null, false, this._awd_data.cur_block.dependencies_data[r], true, r);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis._pPauseAndRetrieveDependencies();\r\n\t\t\t}\r\n\t\t\telse if(this._awd_data.cur_block.state==AWD3Utils.BLOCKSTATE_NO_ASSET){\r\n\t\t\t\t// this block does not produce any asset (metadata, namespace, command)\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tconsole.log(\"Encountered unknown blocktype - type = \", block_type, \" id = \", block_id);\r\n\t\t}\r\n\r\n\t\tvar time_end = performance.now();\r\n\t\tvar thisTime:number=time_end-time_start;\r\n\t\tthis.total_time+=thisTime;\r\n\t\tif(block_type==1){\r\n\t\t\tthis.geom_time+=thisTime;\r\n\t\t}\r\n\t\telse if(block_type==133){\r\n\t\t\tthis.timeline_time+=thisTime;\r\n\t\t}\r\n\t\tconsole.log(\"'parsed '\"+block_type+\"'  block in \"+thisTime+ \" ms\", \" total: \",this.total_time,\" geom: \",this.geom_time,\"timelines:\",this.timeline_time);\r\n\r\n\t\tthis._body.position = blockEndAll;\r\n\t\tthis._awd_data.newBlockBytes = null;\r\n\r\n\t}\r\n\r\n\r\n\r\n\r\n\tprivate parseHeader():void\r\n\t{\r\n\t\tvar flags:number;\r\n\t\tvar body_len:number;\r\n\r\n\t\tthis._byteData.position = 3; // Skip magic string and parse version\r\n\r\n\t\tthis._awd_data.major_version = this._byteData.readUnsignedByte();\r\n\t\tthis._awd_data.minor_version = this._byteData.readUnsignedByte();\r\n\r\n\t\tflags = this._byteData.readUnsignedShort(); // Parse bit flags\r\n\r\n\t\tthis._streaming = AWDBitFlags.test(flags, AWDBitFlags.FLAG1);\r\n\r\n\t\tif ((this._awd_data.major_version == 2) && (this._awd_data.minor_version == 1)) {\r\n\t\t\tthis._awd_data.accuracyMatrix = AWDBitFlags.test(flags, AWDBitFlags.FLAG2);\r\n\t\t\tthis._awd_data.accuracyGeo = AWDBitFlags.test(flags, AWDBitFlags.FLAG3);\r\n\t\t\tthis._awd_data.accuracyProps = AWDBitFlags.test(flags, AWDBitFlags.FLAG4);\r\n\t\t}\r\n\r\n\t\t// if we set _accuracyOnBlocks, the precision-values are read from each block-header.\r\n\r\n\t\t// set storagePrecision types\r\n\t\tthis._awd_data.geoNrType = AWD3Utils.FLOAT32;\r\n\r\n\t\tif (this._awd_data.accuracyGeo) {\r\n\t\t\tthis._awd_data.geoNrType = AWD3Utils.FLOAT64;\r\n\t\t}\r\n\r\n\t\tthis._awd_data.matrixNrType = AWD3Utils.FLOAT32;\r\n\r\n\t\tif (this._awd_data.accuracyMatrix) {\r\n\t\t\tthis._awd_data.matrixNrType = AWD3Utils.FLOAT64;\r\n\t\t}\r\n\r\n\t\tthis._awd_data.propsNrType = AWD3Utils.FLOAT32;\r\n\r\n\t\tif (this._awd_data.accuracyProps) {\r\n\t\t\tthis._awd_data.propsNrType = AWD3Utils.FLOAT64;\r\n\t\t}\r\n\r\n\t\tthis._compression = this._byteData.readUnsignedByte(); // compression\r\n\r\n\t\tif (this._debug) {\r\n\t\t\tconsole.log(\"Import AWDFile of version = \" + this._awd_data.major_version + \" - \" + this._awd_data.minor_version );\r\n\t\t\tconsole.log(\"Global Settings = Compression = \" + this._compression + \" | Streaming = \" + this._streaming + \" | Matrix-Precision = \" + this._awd_data.accuracyMatrix + \" | Geometry-Precision = \" + this._awd_data.accuracyGeo + \" | Properties-Precision = \" + this._awd_data.accuracyProps);\r\n\t\t}\r\n\r\n\t\t// Check file integrity\r\n\t\tbody_len = this._byteData.readUnsignedInt();\r\n\t\tif (!this._streaming && body_len != this._byteData.getBytesAvailable()) {\r\n\t\t\tthis._pDieWithError('AWD2 body length does not match header integrity field');\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport = AWD3Parser;\r\n\r\n",
    "import BitmapData\t\t\t\t\t\t= require(\"awayjs-core/lib/data/BitmapData\");\r\nimport BlendMode\t\t\t\t\t\t= require(\"awayjs-core/lib/data/BlendMode\");\r\nimport Geometry\t\t\t\t\t\t\t= require(\"awayjs-core/lib/data/Geometry\");\r\nimport SubGeometryBase\t\t\t\t\t= require(\"awayjs-core/lib/data/SubGeometryBase\");\r\nimport CurveSubGeometry\t\t\t\t\t= require(\"awayjs-core/lib/data/CurveSubGeometry\");\r\nimport TriangleSubGeometry\t\t\t\t= require(\"awayjs-core/lib/data/TriangleSubGeometry\");\r\nimport ColorTransform\t\t\t\t\t= require(\"awayjs-core/lib/geom/ColorTransform\");\r\nimport Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\nimport URLLoaderDataFormat\t\t\t\t= require(\"awayjs-core/lib/net/URLLoaderDataFormat\");\r\nimport URLRequest\t\t\t\t\t\t= require(\"awayjs-core/lib/net/URLRequest\");\r\nimport IAsset\t\t\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport ParserBase\t\t\t\t\t\t= require(\"awayjs-core/lib/parsers/ParserBase\");\r\nimport ParserUtils\t\t\t\t\t\t= require(\"awayjs-core/lib/parsers/ParserUtils\");\r\nimport ResourceDependency\t\t\t\t= require(\"awayjs-core/lib/parsers/ResourceDependency\");\r\nimport ProjectionBase\t\t\t\t\t= require(\"awayjs-core/lib/projections/ProjectionBase\");\r\nimport PerspectiveProjection\t\t\t= require(\"awayjs-core/lib/projections/PerspectiveProjection\");\r\nimport OrthographicProjection\t\t\t= require(\"awayjs-core/lib/projections/OrthographicProjection\");\r\nimport OrthographicOffCenterProjection\t= require(\"awayjs-core/lib/projections/OrthographicOffCenterProjection\");\r\nimport BitmapCubeTexture\t\t\t\t= require(\"awayjs-core/lib/textures/BitmapCubeTexture\");\r\nimport BitmapTexture\t\t\t\t\t= require(\"awayjs-core/lib/textures/BitmapTexture\");\r\nimport CubeTextureBase\t\t\t\t\t= require(\"awayjs-core/lib/textures/CubeTextureBase\");\r\nimport ImageCubeTexture\t\t\t\t\t= require(\"awayjs-core/lib/textures/ImageCubeTexture\");\r\nimport ImageTexture\t\t\t\t\t\t= require(\"awayjs-core/lib/textures/ImageTexture\");\r\nimport Texture2DBase\t\t\t\t\t= require(\"awayjs-core/lib/textures/Texture2DBase\");\r\nimport TextureBase\t\t\t\t\t\t= require(\"awayjs-core/lib/textures/TextureBase\");\r\nimport ByteArray\t\t\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\n\r\nimport AnimationNodeBase\t\t\t\t= require(\"awayjs-display/lib/animators/nodes/AnimationNodeBase\");\r\nimport DisplayObjectContainer\t\t\t= require(\"awayjs-display/lib/containers/DisplayObjectContainer\");\r\nimport DisplayObject\t\t\t\t\t= require(\"awayjs-display/lib/base/DisplayObject\");\r\nimport LightBase\t\t\t\t\t\t= require(\"awayjs-display/lib/base/LightBase\");\r\nimport DirectionalLight\t\t\t\t\t= require(\"awayjs-display/lib/entities/DirectionalLight\");\r\nimport PointLight\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/PointLight\");\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\nimport Mesh\t\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Mesh\");\r\nimport TextField\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/TextField\");\r\nimport Billboard\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Billboard\");\r\nimport Skybox\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Skybox\");\r\nimport DefaultMaterialManager\t\t\t= require(\"awayjs-display/lib/managers/DefaultMaterialManager\");\r\nimport MaterialBase\t\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\r\nimport LightPickerBase\t\t\t\t\t= require(\"awayjs-display/lib/materials/lightpickers/LightPickerBase\");\r\nimport StaticLightPicker\t\t\t\t= require(\"awayjs-display/lib/materials/lightpickers/StaticLightPicker\");\r\nimport CubeMapShadowMapper\t\t\t\t= require(\"awayjs-display/lib/materials/shadowmappers/CubeMapShadowMapper\");\r\nimport DirectionalShadowMapper\t\t\t= require(\"awayjs-display/lib/materials/shadowmappers/DirectionalShadowMapper\");\r\nimport ShadowMapperBase\t\t\t\t\t= require(\"awayjs-display/lib/materials/shadowmappers/ShadowMapperBase\");\r\nimport PrefabBase\t\t\t\t\t\t= require(\"awayjs-display/lib/prefabs/PrefabBase\");\r\nimport PrimitiveCapsulePrefab\t\t\t= require(\"awayjs-display/lib/prefabs/PrimitiveCapsulePrefab\");\r\nimport PrimitiveConePrefab\t\t\t\t= require(\"awayjs-display/lib/prefabs/PrimitiveConePrefab\");\r\nimport PrimitiveCubePrefab\t\t\t\t= require(\"awayjs-display/lib/prefabs/PrimitiveCubePrefab\");\r\nimport PrimitiveCylinderPrefab\t\t\t= require(\"awayjs-display/lib/prefabs/PrimitiveCylinderPrefab\");\r\nimport PrimitivePlanePrefab\t\t\t\t= require(\"awayjs-display/lib/prefabs/PrimitivePlanePrefab\");\r\nimport PrimitiveSpherePrefab\t\t\t= require(\"awayjs-display/lib/prefabs/PrimitiveSpherePrefab\");\r\nimport PrimitiveTorusPrefab\t\t\t\t= require(\"awayjs-display/lib/prefabs/PrimitiveTorusPrefab\");\r\n\r\nimport AnimationSetBase\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimationSetBase\");\r\nimport AnimatorBase\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/AnimatorBase\");\r\nimport VertexAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/VertexAnimationSet\");\r\nimport VertexAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/VertexAnimator\");\r\nimport SkeletonAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/SkeletonAnimationSet\");\r\nimport SkeletonAnimator\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/SkeletonAnimator\");\r\nimport JointPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/JointPose\");\r\nimport Skeleton\t\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/Skeleton\");\r\nimport SkeletonPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/SkeletonPose\");\r\nimport SkeletonJoint\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/SkeletonJoint\");\r\nimport SkeletonClipNode\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/SkeletonClipNode\");\r\nimport VertexClipNode\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/VertexClipNode\");\r\n\r\nimport MethodMaterialMode\t\t\t\t= require(\"awayjs-methodmaterials/lib/MethodMaterialMode\");\r\nimport MethodMaterial\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/MethodMaterial\");\r\nimport AmbientEnvMapMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/AmbientEnvMapMethod\");\r\nimport DiffuseDepthMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/DiffuseDepthMethod\");\r\nimport DiffuseCelMethod\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/DiffuseCelMethod\");\r\nimport DiffuseGradientMethod\t\t\t= require(\"awayjs-methodmaterials/lib/methods/DiffuseGradientMethod\");\r\nimport DiffuseLightMapMethod\t\t\t= require(\"awayjs-methodmaterials/lib/methods/DiffuseLightMapMethod\");\r\nimport DiffuseWrapMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/DiffuseWrapMethod\");\r\nimport EffectAlphaMaskMethod\t\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectAlphaMaskMethod\");\r\nimport EffectColorMatrixMethod\t\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectColorMatrixMethod\");\r\nimport EffectColorTransformMethod\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectColorTransformMethod\");\r\nimport EffectEnvMapMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectEnvMapMethod\");\r\nimport EffectFogMethod\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectFogMethod\");\r\nimport EffectFresnelEnvMapMethod\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectFresnelEnvMapMethod\");\r\nimport EffectLightMapMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectLightMapMethod\");\r\nimport EffectMethodBase\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectMethodBase\");\r\nimport EffectRimLightMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/EffectRimLightMethod\");\r\nimport NormalSimpleWaterMethod\t\t\t= require(\"awayjs-methodmaterials/lib/methods/NormalSimpleWaterMethod\");\r\nimport ShadowDitheredMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadowDitheredMethod\");\r\nimport ShadowFilteredMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadowFilteredMethod\");\r\nimport ShadowMapMethodBase\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadowMapMethodBase\");\r\nimport ShadowMethodBase\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadowMethodBase\");\r\nimport SpecularFresnelMethod\t\t\t= require(\"awayjs-methodmaterials/lib/methods/SpecularFresnelMethod\");\r\nimport ShadowHardMethod\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadowHardMethod\");\r\nimport SpecularAnisotropicMethod\t\t= require(\"awayjs-methodmaterials/lib/methods/SpecularAnisotropicMethod\");\r\nimport SpecularCelMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/SpecularCelMethod\");\r\nimport SpecularPhongMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/SpecularPhongMethod\");\r\nimport ShadowNearMethod\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadowNearMethod\");\r\nimport ShadowSoftMethod\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/ShadowSoftMethod\");\r\n\r\nimport CurveMaterial\t\t\t\t\t= require(\"awayjs-display/lib/materials/CurveMaterial\")\r\nimport BasicMaterial\t\t\t\t\t= require(\"awayjs-display/lib/materials/BasicMaterial\");\r\n\r\nimport TimelineSceneGraphFactory \t= require(\"awayjs-player/lib/factories/TimelineSceneGraphFactory\");\r\nimport AS2SceneGraphFactory \t\t= require(\"awayjs-player/lib/factories/AS2SceneGraphFactory\");\r\nimport MovieClip \t\t\t\t\t= require(\"awayjs-player/lib/display/MovieClip\");\r\nimport TimelineKeyFrame \t\t\t= require(\"awayjs-player/lib/timeline/TimelineKeyFrame\");\r\nimport AddChildCommand \t\t\t\t= require(\"awayjs-player/lib/timeline/commands/AddChildCommand\");\r\nimport AddChildAtDepthCommand\t\t= require(\"awayjs-player/lib/timeline/commands/AddChildAtDepthCommand\");\r\nimport ApplyAS2DepthsCommand\t\t= require(\"awayjs-player/lib/timeline/commands/ApplyAS2DepthsCommand\");\r\nimport ExecuteScriptCommand \t\t= require(\"awayjs-player/lib/timeline/commands/ExecuteScriptCommand\");\r\nimport RemoveChildCommand \t\t\t= require(\"awayjs-player/lib/timeline/commands/RemoveChildCommand\");\r\nimport RemoveChildrenAtDepthCommand\t= require(\"awayjs-player/lib/timeline/commands/RemoveChildrenAtDepthCommand\");\r\nimport SetInstanceNameCommand \t\t= require(\"awayjs-player/lib/timeline/commands/SetInstanceNameCommand\");\r\nimport UpdatePropertyCommand \t\t= require(\"awayjs-player/lib/timeline/commands/UpdatePropertyCommand\");\r\nimport SetMaskCommand \t\t        = require(\"awayjs-player/lib/timeline/commands/SetMaskCommand\");\r\n\r\nimport Font\t\t\t\t\t\t\t= require(\"awayjs-display/lib/text/Font\");\r\nimport TesselatedFontTable\t\t\t= require(\"awayjs-display/lib/text/TesselatedFontTable\");\r\nimport TextFormat\t\t\t= require(\"awayjs-display/lib/text/TextFormat\");\r\nimport TextFieldType\t\t\t= require(\"awayjs-display/lib/text/TextFieldType\");\r\n\r\n/**\r\n * AWDParser provides a parser for the AWD data type.\r\n */\r\nclass AWDParser extends ParserBase\r\n{\r\n\t//set to \"true\" to have some console.logs in the Console\r\n\tprivate _debug:boolean = false;\r\n\tprivate _byteData:ByteArray;\r\n\tprivate _startedParsing:boolean = false;\r\n\tprivate _cur_block_id:number;\r\n\tprivate _blocks:Array<AWDBlock>;\r\n\tprivate _newBlockBytes:ByteArray;\r\n\tprivate _version:Array<number>;\r\n\tprivate _compression:number;\r\n\tprivate _accuracyOnBlocks:boolean;\r\n\tprivate _accuracyMatrix:boolean;\r\n\tprivate _accuracyGeo:boolean;\r\n\tprivate _accuracyProps:boolean;\r\n\tprivate _matrixNrType:number;\r\n\tprivate _geoNrType:number;\r\n\tprivate _propsNrType:number;\r\n\tprivate _streaming:boolean;\r\n\tprivate _texture_users:Object = {};\r\n\tprivate _parsed_header:boolean = false;\r\n\tprivate _body:ByteArray;\r\n\tprivate _defaultTexture:BitmapTexture;     // HTML IMAGE TEXTURE >? !\r\n\tprivate _cubeTextures:Array<any>;\r\n\tprivate _defaultBitmapMaterial:MethodMaterial;\r\n\tprivate _defaultCubeTexture:BitmapCubeTexture;\r\n\r\n\r\n\t// temp for checking stats\r\n\tpublic total_time:number = 0;\r\n\tpublic geom_time:number = 0;\r\n\tpublic timeline_time:number = 0;\r\n\r\n\tpublic static COMPRESSIONMODE_LZMA:string = \"lzma\";\r\n\tpublic static UNCOMPRESSED:number = 0;\r\n\tpublic static DEFLATE:number = 1;\r\n\tpublic static LZMA:number = 2;\r\n\tpublic static INT8:number = 1;\r\n\tpublic static INT16:number = 2;\r\n\tpublic static INT32:number = 3;\r\n\tpublic static UINT8:number = 4;\r\n\tpublic static UINT16:number = 5;\r\n\tpublic static UINT32:number = 6;\r\n\tpublic static FLOAT32:number = 7;\r\n\tpublic static FLOAT64:number = 8;\r\n\tpublic static BOOL:number = 21;\r\n\tpublic static COLOR:number = 22;\r\n\tpublic static BADDR:number = 23;\r\n\tpublic static AWDSTRING:number = 31;\r\n\tpublic static AWDBYTEARRAY:number = 32;\r\n\tpublic static VECTOR2x1:number = 41;\r\n\tpublic static VECTOR3x1:number = 42;\r\n\tpublic static VECTOR4x1:number = 43;\r\n\tpublic static MTX3x2:number = 44;\r\n\tpublic static MTX3x3:number = 45;\r\n\tpublic static MTX4x3:number = 46;\r\n\tpublic static MTX4x4:number = 47;\r\n\r\n\tprivate blendModeDic:Array<string>;\r\n\tprivate _depthSizeDic:Array<number>;\r\n\tprivate _allFontTables:Array<TesselatedFontTable>;\r\n\r\n\t/**\r\n\t * Creates a new AWD3Parserutils object.\r\n\t * @param uri The url or id of the data or file to be parsed.\r\n\t * @param extra The holder for extra contextual data that the parser might need.\r\n\t */\r\n\tconstructor()\r\n\t{\r\n\t\tsuper(URLLoaderDataFormat.ARRAY_BUFFER);\r\n\r\n\t\tthis._blocks = new Array<AWDBlock>();\r\n\t\tthis._blocks[0] = new AWDBlock();\r\n\t\tthis._blocks[0].data = null; // Zero address means null in AWD\r\n\r\n\t\tthis.blendModeDic = new Array<string>(); // used to translate ints to blendMode-strings\r\n\t\tthis.blendModeDic.push(BlendMode.NORMAL);\r\n\t\tthis.blendModeDic.push(BlendMode.ADD);\r\n\t\tthis.blendModeDic.push(BlendMode.ALPHA);\r\n\t\tthis.blendModeDic.push(BlendMode.DARKEN);\r\n\t\tthis.blendModeDic.push(BlendMode.DIFFERENCE);\r\n\t\tthis.blendModeDic.push(BlendMode.ERASE);\r\n\t\tthis.blendModeDic.push(BlendMode.HARDLIGHT);\r\n\t\tthis.blendModeDic.push(BlendMode.INVERT);\r\n\t\tthis.blendModeDic.push(BlendMode.LAYER);\r\n\t\tthis.blendModeDic.push(BlendMode.LIGHTEN);\r\n\t\tthis.blendModeDic.push(BlendMode.MULTIPLY);\r\n\t\tthis.blendModeDic.push(BlendMode.NORMAL);\r\n\t\tthis.blendModeDic.push(BlendMode.OVERLAY);\r\n\t\tthis.blendModeDic.push(BlendMode.SCREEN);\r\n\t\tthis.blendModeDic.push(BlendMode.SHADER);\r\n\t\tthis.blendModeDic.push(BlendMode.OVERLAY);\r\n\r\n\t\tthis._depthSizeDic = new Array<number>(); // used to translate ints to depthSize-values\r\n\t\tthis._depthSizeDic.push(256);\r\n\t\tthis._depthSizeDic.push(512);\r\n\t\tthis._depthSizeDic.push(2048);\r\n\t\tthis._depthSizeDic.push(1024);\r\n\t\tthis._version = Array<number>(); // will contain 2 int (major-version, minor-version) for awd-version-check\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates whether or not a given file extension is supported by the parser.\r\n\t * @param extension The file extension of a potential file to be parsed.\r\n\t * @return Whether or not the given file type is supported.\r\n\t */\r\n\tpublic static supportsType(extension:string):boolean\r\n\t{\r\n\t\textension = extension.toLowerCase();\r\n\t\treturn extension == \"awd\";\r\n\t}\r\n\r\n\t/**\r\n\t * Tests whether a data block can be parsed by the parser.\r\n\t * @param data The data block to potentially be parsed.\r\n\t * @return Whether or not the given data is supported.\r\n\t */\r\n\tpublic static supportsData(data:any):boolean\r\n\t{\r\n\t\treturn (ParserUtils.toString(data, 3) == 'AWD');\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iResolveDependency(resourceDependency:ResourceDependency)\r\n\t{\r\n\t\t// this will be called when Dependency has finished loading.\r\n\t\t// the Assets waiting for this Bitmap, can be Texture or CubeTexture.\r\n\t\t// if the Bitmap is awaited by a CubeTexture, we need to check if its the last Bitmap of the CubeTexture,\r\n\t\t// so we know if we have to finalize the Asset (CubeTexture) or not.\r\n\t\tif (resourceDependency.assets.length == 1) {\r\n\t\t\tvar isCubeTextureArray:Array<string> = resourceDependency.id.split(\"#\");\r\n\t\t\tvar ressourceID:string = isCubeTextureArray[0];\r\n\t\t\tvar asset:TextureBase;\r\n\t\t\tvar thisBitmapTexture:Texture2DBase;\r\n\t\t\tvar block:AWDBlock;\r\n\r\n\t\t\tif (isCubeTextureArray.length == 1) // Not a cube texture\r\n\t\t\t{\r\n\t\t\t\tasset = <Texture2DBase> resourceDependency.assets[0];\r\n\t\t\t\tif (asset) {\r\n\t\t\t\t\tvar mat:MethodMaterial;\r\n\t\t\t\t\tvar users:Array<string>;\r\n\r\n\t\t\t\t\tblock = this._blocks[ resourceDependency.id ];\r\n\t\t\t\t\tblock.data = asset; // Store finished asset\r\n\r\n\t\t\t\t\t// Reset name of texture to the one defined in the AWD file,\r\n\t\t\t\t\t// as opposed to whatever the image parser came up with.\r\n\t\t\t\t\tasset.resetAssetPath(block.name, null, true);\r\n\t\t\t\t\tblock.name = asset.name;\r\n\t\t\t\t\t// Finalize texture asset to dispatch texture event, which was\r\n\t\t\t\t\t// previously suppressed while the dependency was loaded.\r\n\t\t\t\t\tthis._pFinalizeAsset(<IAsset> asset);\r\n\r\n\t\t\t\t\tif (this._debug) {\r\n\t\t\t\t\t\tconsole.log(\"Successfully loaded Bitmap for texture\");\r\n\t\t\t\t\t\tconsole.log(\"Parsed texture: Name = \" + block.name);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (isCubeTextureArray.length > 1) // Cube Texture\r\n\t\t\t{\r\n\t\t\t\tthisBitmapTexture = <BitmapTexture> resourceDependency.assets[0];\r\n\r\n\t\t\t\tvar tx:ImageTexture = <ImageTexture> thisBitmapTexture;\r\n\r\n\t\t\t\tthis._cubeTextures[ isCubeTextureArray[1] ] = tx.htmlImageElement; // ?\r\n\t\t\t\tthis._texture_users[ressourceID].push(1);\r\n\r\n\t\t\t\tif (this._debug) {\r\n\t\t\t\t\tconsole.log(\"Successfully loaded Bitmap \" + this._texture_users[ressourceID].length + \" / 6 for Cubetexture\");\r\n\t\t\t\t}\r\n\t\t\t\tif (this._texture_users[ressourceID].length == this._cubeTextures.length) {\r\n\r\n\t\t\t\t\tvar posX:any = this._cubeTextures[0];\r\n\t\t\t\t\tvar negX:any = this._cubeTextures[1];\r\n\t\t\t\t\tvar posY:any = this._cubeTextures[2];\r\n\t\t\t\t\tvar negY:any = this._cubeTextures[3];\r\n\t\t\t\t\tvar posZ:any = this._cubeTextures[4];\r\n\t\t\t\t\tvar negZ:any = this._cubeTextures[5];\r\n\r\n\t\t\t\t\tasset = <TextureBase> new ImageCubeTexture(posX, negX, posY, negY, posZ, negZ);\r\n\t\t\t\t\tblock = this._blocks[ressourceID];\r\n\t\t\t\t\tblock.data = asset; // Store finished asset\r\n\r\n\t\t\t\t\t// Reset name of texture to the one defined in the AWD file,\r\n\t\t\t\t\t// as opposed to whatever the image parser came up with.\r\n\t\t\t\t\tasset.resetAssetPath(block.name, null, true);\r\n\t\t\t\t\tblock.name = asset.name;\r\n\t\t\t\t\t// Finalize texture asset to dispatch texture event, which was\r\n\t\t\t\t\t// previously suppressed while the dependency was loaded.\r\n\t\t\t\t\tthis._pFinalizeAsset(<IAsset> asset);\r\n\t\t\t\t\tif (this._debug) {\r\n\t\t\t\t\t\tconsole.log(\"Parsed CubeTexture: Name = \" + block.name);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iResolveDependencyFailure(resourceDependency:ResourceDependency)\r\n\t{\r\n\t\t//not used - if a dependcy fails, the awaiting Texture or CubeTexture will never be finalized, and the default-bitmaps will be used.\r\n\t\t// this means, that if one Bitmap of a CubeTexture fails, the CubeTexture will have the DefaultTexture applied for all six Bitmaps.\r\n\t}\r\n\r\n\t/**\r\n\t * Resolve a dependency name\r\n\t *\r\n\t * @param resourceDependency The dependency to be resolved.\r\n\t */\r\n\tpublic _iResolveDependencyName(resourceDependency:ResourceDependency, asset:IAsset):string\r\n\t{\r\n\t\tvar oldName:string = asset.name;\r\n\r\n\t\tif (asset) {\r\n\t\t\tvar block:AWDBlock = this._blocks[parseInt(resourceDependency.id)];\r\n\t\t\t// Reset name of texture to the one defined in the AWD file,\r\n\t\t\t// as opposed to whatever the image parser came up with.\r\n\t\t\tasset.resetAssetPath(block.name, null, true);\r\n\t\t}\r\n\r\n\t\tvar newName:string = asset.name;\r\n\r\n\t\tasset.name = oldName;\r\n\r\n\t\treturn newName;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pProceedParsing():boolean\r\n\t{\r\n\r\n\t\tif (!this._startedParsing) {\r\n\t\t\tthis._byteData = this._pGetByteData();//getByteData();\r\n\t\t\tthis._startedParsing = true;\r\n\t\t}\r\n\r\n\t\tif (!this._parsed_header) {\r\n\r\n\t\t\t//----------------------------------------------------------------------------\r\n\t\t\t// LITTLE_ENDIAN - Default for ArrayBuffer / Not implemented in ByteArray\r\n\t\t\t//----------------------------------------------------------------------------\r\n\t\t\t//this._byteData.endian = Endian.LITTLE_ENDIAN;\r\n\t\t\t//----------------------------------------------------------------------------\r\n\r\n\t\t\t//----------------------------------------------------------------------------\r\n\t\t\t// Parse header and decompress body if needed\r\n\t\t\tthis.parseHeader();\r\n\r\n\t\t\tswitch (this._compression) {\r\n\r\n\t\t\t\tcase AWDParser.DEFLATE:\r\n\t\t\t\tcase AWDParser.LZMA:\r\n\t\t\t\t\tthis._pDieWithError('Compressed AWD formats not yet supported');\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase AWDParser.UNCOMPRESSED:\r\n\t\t\t\t\tthis._body = this._byteData;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t//----------------------------------------------------------------------------\r\n\t\t\t\t// Compressed AWD Formats not yet supported\r\n\t\t\t\t//----------------------------------------------------------------------------\r\n\r\n\t\t\t\t/*\r\n\t\t\t\t case AWD3Parserutils.DEFLATE:\r\n\r\n\t\t\t\t this._body = new ByteArray();\r\n\t\t\t\t this._byteData.readBytes(this._body, 0, this._byteData.getBytesAvailable());\r\n\t\t\t\t this._body.uncompress();\r\n\r\n\t\t\t\t break;\r\n\t\t\t\t case AWD3Parserutils.LZMA:\r\n\r\n\t\t\t\t this._body = new ByteArray();\r\n\t\t\t\t this._byteData.readBytes(this._body, 0, this._byteData.getBytesAvailable());\r\n\t\t\t\t this._body.uncompress(COMPRESSIONMODE_LZMA);\r\n\r\n\t\t\t\t break;\r\n\t\t\t\t //*/\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis._parsed_header = true;\r\n\r\n\t\t\t//----------------------------------------------------------------------------\r\n\t\t\t// LITTLE_ENDIAN - Default for ArrayBuffer / Not implemented in ByteArray\r\n\t\t\t//----------------------------------------------------------------------------\r\n\t\t\t//this._body.endian = Endian.LITTLE_ENDIAN;// Should be default\r\n\t\t\t//----------------------------------------------------------------------------\r\n\r\n\t\t}\r\n\r\n\t\tif (this._body) {\r\n\r\n\t\t\twhile (this._body.getBytesAvailable() > 0 && !this.parsingPaused) //&& this._pHasTime() )\r\n\t\t\t{\r\n\t\t\t\tthis.parseNextBlock();\r\n\r\n\t\t\t}\r\n\r\n\t\t\t//----------------------------------------------------------------------------\r\n\t\t\t// Return complete status\r\n\t\t\tif (this._body.getBytesAvailable() == 0) {\r\n\t\t\t\tthis.dispose();\r\n\t\t\t\treturn  ParserBase.PARSING_DONE;\r\n\t\t\t} else {\r\n\t\t\t\treturn  ParserBase.MORE_TO_PARSE;\r\n\t\t\t}\r\n\t\t} else {\r\n\r\n\t\t\tswitch (this._compression) {\r\n\r\n\t\t\t\tcase AWDParser.DEFLATE:\r\n\t\t\t\tcase AWDParser.LZMA:\r\n\r\n\t\t\t\t\tif (this._debug) {\r\n\t\t\t\t\t\tconsole.log(\"(!) AWDParser Error: Compressed AWD formats not yet supported (!)\");\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\t\t\t// Error - most likely _body not set because we do not support compression.\r\n\t\t\treturn  ParserBase.PARSING_DONE;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tpublic _pStartParsing(frameLimit:number)\r\n\t{\r\n\t\tsuper._pStartParsing(frameLimit);\r\n\r\n\t\t//create a content object for Loaders\r\n\t\tthis._pContent = new DisplayObjectContainer();\r\n\t}\r\n\r\n\tprivate dispose():void\r\n\t{\r\n\r\n\t\tfor (var c in this._blocks) {\r\n\r\n\t\t\tvar b:AWDBlock = <AWDBlock> this._blocks[ c ];\r\n\t\t\tb.dispose();\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tprivate parseNextBlock():void\r\n\t{\r\n\t\tvar block:AWDBlock;\r\n\t\tvar assetData:IAsset;\r\n\t\tvar isParsed:boolean = false;\r\n\t\tvar ns:number;\r\n\t\tvar type:number;\r\n\t\tvar flags:number;\r\n\t\tvar len:number;\r\n\r\n\t\tthis._cur_block_id = this._body.readUnsignedInt();\r\n\r\n\t\tns = this._body.readUnsignedByte();\r\n\t\ttype = this._body.readUnsignedByte();\r\n\t\tflags = this._body.readUnsignedByte();\r\n\t\tlen = this._body.readUnsignedInt();\r\n\r\n\t\tvar blockCompression:boolean = BitFlags.test(flags, BitFlags.FLAG4);\r\n\t\tvar blockCompressionLZMA:boolean = BitFlags.test(flags, BitFlags.FLAG5);\r\n\r\n\t\tif (this._accuracyOnBlocks) {\r\n\t\t\tthis._accuracyMatrix = BitFlags.test(flags, BitFlags.FLAG1);\r\n\t\t\tthis._accuracyGeo = BitFlags.test(flags, BitFlags.FLAG2);\r\n\t\t\tthis._accuracyProps = BitFlags.test(flags, BitFlags.FLAG3);\r\n\t\t\tthis._geoNrType = AWDParser.FLOAT32;\r\n\r\n\t\t\tif (this._accuracyGeo) {\r\n\t\t\t\tthis._geoNrType = AWDParser.FLOAT64;\r\n\t\t\t}\r\n\r\n\t\t\tthis._matrixNrType = AWDParser.FLOAT32;\r\n\r\n\t\t\tif (this._accuracyMatrix) {\r\n\t\t\t\tthis._matrixNrType = AWDParser.FLOAT64;\r\n\t\t\t}\r\n\r\n\t\t\tthis._propsNrType = AWDParser.FLOAT32;\r\n\r\n\t\t\tif (this._accuracyProps) {\r\n\t\t\t\tthis._propsNrType = AWDParser.FLOAT64;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar blockEndAll:number = this._body.position + len;\r\n\r\n\t\tif (len > this._body.getBytesAvailable()) {\r\n\t\t\tthis._pDieWithError('AWD2 block length is bigger than the bytes that are available!');\r\n\t\t\tthis._body.position += this._body.getBytesAvailable();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis._newBlockBytes = new ByteArray();\r\n\r\n\r\n\t\tthis._body.readBytes(this._newBlockBytes, 0, len);\r\n\r\n\t\t//----------------------------------------------------------------------------\r\n\t\t// Compressed AWD Formats not yet supported\r\n\r\n\t\tif (blockCompression) {\r\n\t\t\tthis._pDieWithError('Compressed AWD formats not yet supported');\r\n\r\n\t\t\t/*\r\n\t\t\t if (blockCompressionLZMA)\r\n\t\t\t {\r\n\t\t\t this._newBlockBytes.uncompress(AWD3Parserutils.COMPRESSIONMODE_LZMA);\r\n\t\t\t }\r\n\t\t\t else\r\n\t\t\t {\r\n\t\t\t this._newBlockBytes.uncompress();\r\n\t\t\t }\r\n\t\t\t */\r\n\r\n\t\t}\r\n\r\n\t\t//----------------------------------------------------------------------------\r\n\t\t// LITTLE_ENDIAN - Default for ArrayBuffer / Not implemented in ByteArray\r\n\t\t//----------------------------------------------------------------------------\r\n\t\t//this._newBlockBytes.endian = Endian.LITTLE_ENDIAN;\r\n\t\t//----------------------------------------------------------------------------\r\n\r\n\t\tthis._newBlockBytes.position = 0;\r\n\t\tblock = new AWDBlock();\r\n\t\tblock.len = this._newBlockBytes.position + len;\r\n\t\tblock.id = this._cur_block_id;\r\n\r\n\t\tvar blockEndBlock:number = this._newBlockBytes.position + len;\r\n\r\n\t\tif (blockCompression) {\r\n\t\t\tthis._pDieWithError('Compressed AWD formats not yet supported');\r\n\t\t\t//blockEndBlock   = this._newBlockBytes.position + this._newBlockBytes.length;\r\n\t\t\t//block.len       = blockEndBlock;\r\n\t\t}\r\n\r\n\t\tif (this._debug) {\r\n\t\t\tconsole.log(\"AWDBlock:  ID = \" + this._cur_block_id + \" | TypeID = \" + type + \" | Compression = \" + blockCompression + \" | Matrix-Precision = \" + this._accuracyMatrix + \" | Geometry-Precision = \" + this._accuracyGeo + \" | Properties-Precision = \" + this._accuracyProps);\r\n\t\t}\r\n\r\n\t\tthis._blocks[this._cur_block_id] = block;\r\n\r\n\t\t//var time_start = performance.now();\r\n\t\tif ((this._version[0] == 3) && (this._version[1] == 0)) {\r\n\t\t\t// probably should contain some info about the type of animation\r\n\t\t\tvar factory = new AS2SceneGraphFactory();\r\n\r\n\t\t\tswitch (type) {\r\n\t\t\t\tcase 24:\r\n\t\t\t\t\tthis.parseMeshLibraryBlock(this._cur_block_id);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 25:\r\n\t\t\t\t\tthis.parseBillBoardLibraryBlock(this._cur_block_id);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 44:\r\n\t\t\t\t\tthis.parseAudioBlock(this._cur_block_id, factory);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 133:\r\n\t\t\t\t\tthis.parseTimeLine(this._cur_block_id, factory);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 134:\r\n\t\t\t\t\tthis.paresTextField(this._cur_block_id, factory);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 135:\r\n\t\t\t\t\tthis.parseTesselatedFont(this._cur_block_id);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 136:\r\n\t\t\t\t\tthis.parseTextFormat(this._cur_block_id);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif ((this._version[0] > 2)||((this._version[0] >= 2) && (this._version[1] >= 1))) {\r\n\r\n\t\t\tswitch (type) {\r\n\t\t\t\tcase 11:\r\n\t\t\t\t\tthis.parsePrimitves(this._cur_block_id);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 31:\r\n\t\t\t\t\tthis.parseSkyboxInstance(this._cur_block_id);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 41:\r\n\t\t\t\t\tthis.parseLight(this._cur_block_id);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 42:\r\n\t\t\t\t\tthis.parseCamera(this._cur_block_id);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t//  case 43:\r\n\t\t\t\t//      parseTextureProjector(_cur_block_id);\r\n\t\t\t\t//      isParsed = true;\r\n\t\t\t\t//      break;\r\n\r\n\t\t\t\tcase 51:\r\n\t\t\t\t\tthis.parseLightPicker(this._cur_block_id);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 81:\r\n\t\t\t\t\tthis.parseMaterial_v1(this._cur_block_id);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 83:\r\n\t\t\t\t\tthis.parseCubeTexture(this._cur_block_id);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 91:\r\n\t\t\t\t\tthis.parseSharedMethodBlock(this._cur_block_id);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 92:\r\n\t\t\t\t\tthis.parseShadowMethodBlock(this._cur_block_id);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 111:\r\n\t\t\t\t\tthis.parseMeshPoseAnimation(this._cur_block_id, true);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 112:\r\n\t\t\t\t\tthis.parseMeshPoseAnimation(this._cur_block_id);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 113:\r\n\t\t\t\t\tthis.parseVertexAnimationSet(this._cur_block_id);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 122:\r\n\t\t\t\t\tthis.parseAnimatorSet(this._cur_block_id);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 253:\r\n\t\t\t\t\tthis.parseCommand(this._cur_block_id);\r\n\t\t\t\t\tisParsed = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\t//*/\r\n\t\t}\r\n\t\t//*\r\n\t\tif (isParsed == false) {\r\n\t\t\tswitch (type) {\r\n\r\n\t\t\t\tcase 1:\r\n\t\t\t\t\tthis.parseTriangleGeometrieBlock(this._cur_block_id);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 22:\r\n\t\t\t\t\tthis.parseContainer(this._cur_block_id);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 23:\r\n\t\t\t\t\tthis.parseMeshInstance(this._cur_block_id);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 81:\r\n\t\t\t\t\tthis.parseMaterial(this._cur_block_id);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 82:\r\n\t\t\t\t\tthis.parseTexture(this._cur_block_id);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 101:\r\n\t\t\t\t\tthis.parseSkeleton(this._cur_block_id);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 102:\r\n\t\t\t\t\tthis.parseSkeletonPose(this._cur_block_id);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 103:\r\n\t\t\t\t\tthis.parseSkeletonAnimation(this._cur_block_id);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 121:\r\n\t\t\t\t//this.parseUVAnimation(this._cur_block_id);\r\n\t\t\t\t//break;\r\n\t\t\t\tcase 254:\r\n\t\t\t\t\tthis.parseNameSpace(this._cur_block_id);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 255:\r\n\t\t\t\t\tthis.parseMetaData(this._cur_block_id);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tif (this._debug) {\r\n\t\t\t\t\t\tconsole.log(\"AWDBlock:   Unknown BlockType  (BlockID = \" + this._cur_block_id + \") - Skip \" + len + \" bytes\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._newBlockBytes.position += len;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\t//*/\r\n\r\n\t\tvar msgCnt:number = 0;\r\n\t\tif (this._newBlockBytes.position == blockEndBlock) {\r\n\t\t\tif (this._debug) {\r\n\t\t\t\tif (block.errorMessages) {\r\n\t\t\t\t\twhile (msgCnt < block.errorMessages.length) {\r\n\t\t\t\t\t\tconsole.log(\"        (!) Error: \" + block.errorMessages[msgCnt] + \" (!)\");\r\n\t\t\t\t\t\tmsgCnt++;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (this._debug) {\r\n\t\t\t\tconsole.log(\"\\n\");\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (this._debug) {\r\n\r\n\t\t\t\tconsole.log(\"  (!)(!)(!) Error while reading AWDBlock ID \" + this._cur_block_id + \" = skip to next block\");\r\n\r\n\t\t\t\tif (block.errorMessages) {\r\n\t\t\t\t\twhile (msgCnt < block.errorMessages.length) {\r\n\t\t\t\t\t\tconsole.log(\"        (!) Error: \" + block.errorMessages[msgCnt] + \" (!)\");\r\n\t\t\t\t\t\tmsgCnt++;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n/*\r\n\t\tvar time_end = performance.now();\r\n\t\tvar thisTime:number=time_end-time_start;\r\n\t\tthis.total_time+=thisTime;\r\n\t\tif(type==1){\r\n\t\t\tthis.geom_time+=thisTime;\r\n\t\t}\r\n\t\telse if(type==133){\r\n\t\t\tthis.timeline_time+=thisTime;\r\n\t\t}\r\n\t\tconsole.log(\"'parsed '\"+type+\"'  block in \"+thisTime+ \" ms\", \" total: \",this.total_time,\" geom: \",this.geom_time,\"timelines:\",this.timeline_time);\r\n*/\r\n\t\tthis._body.position = blockEndAll;\r\n\t\tthis._newBlockBytes = null;\r\n\r\n\t}\r\n\r\n\r\n\t//--Parser Blocks---------------------------------------------------------------------------\r\n\r\n\r\n\tprivate parseTesselatedFont(blockID:number):void {\r\n\t\tvar name:string = this.parseVarStr();\r\n\t\tthis._blocks[blockID].name = name;\r\n\t\t//console.log(\"Font name = \"+this._blocks[blockID].name);\r\n\t\tvar font_style_cnt:number = this._newBlockBytes.readUnsignedInt();\r\n\t\t//console.log(\"Font font_style_cnt = \"+font_style_cnt);\r\n\t\tvar new_font:Font=new Font();\r\n\t\tfor (var i:number = 0; i < font_style_cnt; ++i) {\r\n\t\t\tvar font_style_name:string = this.parseVarStr();\r\n\t\t\t//console.log(\"Font font_style_name = \"+font_style_name);\r\n\t\t\tvar new_font_style:TesselatedFontTable=new_font.get_font_table(font_style_name);\r\n\t\t\tnew_font_style.set_font_em_size(this._newBlockBytes.readUnsignedInt());\r\n\t\t\t//console.log(\"Font new_font_style.font_em_size = \"+new_font_style.get_font_em_size);\r\n\t\t\tvar font_style_char_cnt:number = this._newBlockBytes.readUnsignedInt();\r\n\t\t\t//console.log(\"Font font_style_char_cnt = \"+font_style_char_cnt);\r\n\t\t\tfor (var i:number = 0; i < font_style_char_cnt; ++i) {\r\n\r\n\t\t\t\tvar font_style_char:number = this._newBlockBytes.readUnsignedInt();\r\n\t\t\t\t//console.log(\"Font font_style_char = \"+font_style_char);\r\n\t\t\t\t// todo: this is basically a simplified version of the subgeom-parsing done in parseTriangleGeometry. Make a parseSubGeom() instead (?)\r\n\t\t\t\tvar sm_len:number = this._newBlockBytes.readUnsignedInt();\r\n\t\t\t\tvar sm_end:number = this._newBlockBytes.position + sm_len;\r\n\t\t\t\t//console.log(\"Font sm_len = \"+sm_len);\r\n\r\n\t\t\t\t//this.parseProperties(null); // no properties for font-table subgeos\r\n\t\t\t\t// Loop through data streams\r\n\t\t\t\twhile (this._newBlockBytes.position < sm_end) {\r\n\t\t\t\t\tvar idx:number = 0;\r\n\t\t\t\t\tvar str_ftype:number, str_type:number, str_len:number, str_end:number;\r\n\r\n\t\t\t\t\t// Type, field type, length\r\n\t\t\t\t\tstr_type = this._newBlockBytes.readUnsignedByte();\r\n\t\t\t\t\tstr_ftype = this._newBlockBytes.readUnsignedByte();\r\n\t\t\t\t\tstr_len = this._newBlockBytes.readUnsignedInt();\r\n\t\t\t\t\tstr_end = this._newBlockBytes.position + str_len;\r\n\r\n\t\t\t\t\tif (str_type == 2) {//face indicies positions\r\n\t\t\t\t\t\tvar indices:Array<number> = new Array<number>();\r\n\r\n\t\t\t\t\t\twhile (this._newBlockBytes.position < str_end) {\r\n\t\t\t\t\t\t\tindices[idx++] = this._newBlockBytes.readUnsignedShort();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (str_type == 10) {// combined vertex2D stream 5 x float32\r\n\t\t\t\t\t\tvar idx_pos:number = 0;\r\n\t\t\t\t\t\tvar idx_curves:number = 0;\r\n\t\t\t\t\t\tvar idx_uvs:number = 0;\r\n\r\n\t\t\t\t\t\tvar positions:Array<number> = new Array<number>();\r\n\t\t\t\t\t\tvar curveData:Array<number> = new Array<number>();\r\n\t\t\t\t\t\tvar uvs:Array<number> = new Array<number>();\r\n\r\n\t\t\t\t\t\twhile (this._newBlockBytes.position < str_end) {\r\n\r\n\t\t\t\t\t\t\tpositions[idx_pos++] = this.readNumber(this._accuracyGeo);// x\r\n\t\t\t\t\t\t\tpositions[idx_pos++] = this.readNumber(this._accuracyGeo);// y\r\n\t\t\t\t\t\t\tpositions[idx_pos++] = this.readNumber(this._accuracyGeo);// type\r\n\r\n\t\t\t\t\t\t\tcurveData[idx_curves++] = this.readNumber(this._accuracyGeo);// curve value 1\r\n\t\t\t\t\t\t\tcurveData[idx_curves++] = this.readNumber(this._accuracyGeo);// curve value 2\r\n\r\n\t\t\t\t\t\t\tuvs[idx_uvs++] = this.readNumber(this._accuracyGeo);// curve value 1\r\n\t\t\t\t\t\t\tuvs[idx_uvs++] = this.readNumber(this._accuracyGeo);// curve value 1\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tthis._newBlockBytes.position = str_end;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t//this.parseProperties(null);// no attributes for font-table subgeos\r\n\t\t\t\tvar curve_sub_geom:CurveSubGeometry = new CurveSubGeometry(true);\r\n\t\t\t\tcurve_sub_geom.updateIndices(indices);\r\n\t\t\t\tcurve_sub_geom.updatePositions(positions);\r\n\t\t\t\tcurve_sub_geom.updateCurves(curveData);\r\n\t\t\t\tcurve_sub_geom.updateUVs(uvs);\r\n\t\t\t\tnew_font_style.set_subgeo_for_char(font_style_char.toString(), curve_sub_geom);\r\n\t\t\t}\r\n\t\t\t//console.log(\"Parsed a font-table\");\r\n\r\n\t\t}\r\n\t\t//console.log(\"Parsed a font\");\r\n\t\tthis.parseProperties(null);\r\n\t\tthis.parseUserAttributes();\r\n\t\tthis._pFinalizeAsset(<IAsset>new_font, name);\r\n\t\tthis._blocks[blockID].data = new_font;\r\n\t\tif (this._debug) {\r\n\t\t\tconsole.log(\"Parsed a font: Name = '\" + name);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tprivate parseTextFormat(blockID:number):void {\r\n\t\tvar name:string = this.parseVarStr();\r\n\t\tthis._blocks[blockID].name = name;\r\n\t\t//console.log(\"this._blocks[blockID].name  '\" + this._blocks[blockID].name );\r\n\t\tvar font_id:number = this._newBlockBytes.readUnsignedInt();\r\n\t\t//console.log(\"font_id  '\" + font_id);\r\n\t\tvar font_style_name:string = this.parseVarStr();\r\n\t\t//console.log(\"font_style_name  '\" + font_style_name);\r\n\t\tvar returnArrayFont:Array<any> = this.getAssetByID(font_id, [Font.assetType]);\r\n\t\tvar font:Font;\r\n\t\tif (returnArrayFont[0]) {\r\n\t\t\tfont = <Font> returnArrayFont[1];\r\n\t\t} else {\r\n\t\t\tthis._blocks[blockID].addError(\"Could not find a Font for this TextFormat. A empty Font is created!\");\r\n\t\t\tfont = new Font();\r\n\t\t}\r\n\t\tvar newTextFormat:TextFormat = new TextFormat();\r\n\t\tnewTextFormat.font_name = font.name;\r\n\t\tvar font_table:TesselatedFontTable = font.get_font_table(font_style_name);\r\n\t\tif(font_table!=null){\r\n\t\t\tnewTextFormat.font_style = font_style_name;\r\n\t\t\tnewTextFormat.font_table = font_table;\r\n\t\t}\r\n\r\n\t\tvar data_id:number = this._newBlockBytes.readUnsignedInt();\r\n\t\t//console.log(\"mat  '\" + data_id);\r\n\t\tvar mat:BasicMaterial;\r\n\t\tvar returnedArrayMaterial:Array<any> = this.getAssetByID(data_id, [MaterialBase.assetType]);\r\n\r\n\t\tif (returnedArrayMaterial[0]) {\r\n\t\t\tmat = <BasicMaterial> returnedArrayMaterial[1];\r\n\t\t} else {\r\n\t\t\tthis._blocks[blockID].addError(\"Could not find a Material for this TextFormat. Default Material will be used!\");\r\n\t\t\tmat = new BasicMaterial();\r\n\t\t}\r\n\t\tmat.bothSides=true;\r\n\r\n\t\tvar num_uv_values:number = this._newBlockBytes.readUnsignedByte();\r\n\t\t//console.log(\"num_uv_values  '\" + num_uv_values);\r\n\t\tvar uv_values:Array<number>=[];\r\n\t\tfor(var uvcnt:number=0; uvcnt<num_uv_values; uvcnt++){\r\n\t\t\tvar uv_value:number=this._newBlockBytes.readFloat();\r\n\t\t\tuv_values.push(uv_value);\r\n\t\t\t//console.log(\"uv_value  '\" + uv_value);\r\n\t\t}\r\n\t\tnewTextFormat.uv_values=uv_values;\r\n\t\tvar format_props:AWDProperties = this.parseProperties({1:AWDParser.UINT16, 2:AWDParser.UINT16, 3:AWDParser.UINT8,4:AWDParser.UINT8,5:AWDParser.UINT8,6:AWDParser.UINT8, 7:AWDParser.UINT16, 8:AWDParser.UINT16, 9:AWDParser.UINT16, 10:AWDParser.UINT16});\r\n\r\n\t\tnewTextFormat.size = format_props.get(1,12);\r\n\t\tnewTextFormat.letterSpacing = format_props.get(2,0);\r\n\t\t//newTextFormat.rotated = format_props.get(3,false);\r\n\t\tnewTextFormat.kerning = format_props.get(4,true);\r\n\t\t//newTextFormat.baseline_shift = format_props.get(5,1);\r\n\t\t//newTextFormat.align = format_props.get(6,0);\r\n\t\tnewTextFormat.indent = format_props.get(7,0);\r\n\t\tnewTextFormat.leftMargin = format_props.get(8,0);\r\n\t\tnewTextFormat.rightMargin = format_props.get(9,0);\r\n\t\t//newTextFormat.linespacing = format_props.get(10,0);\r\n\t\tnewTextFormat.material = mat;\r\n\t\tthis.parseUserAttributes();// textformat has no extra-properties\r\n\t\t//newTextFormat.extra =\r\n\r\n\t\tthis._pFinalizeAsset(<IAsset> newTextFormat, name);\r\n\t\tthis._blocks[blockID].data = newTextFormat;\r\n\r\n\t\tif (this._debug) {\r\n\t\t\tconsole.log(\"Parsed a TextFormat: Name = '\" + name + \" font: \"+font.name);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tprivate paresTextField(blockID:number, factory:TimelineSceneGraphFactory):void {\r\n\t\tvar name:string = this.parseVarStr();\r\n\t\tthis._blocks[blockID].name = name;\r\n\t\t//console.log(\"name  '\" + name);\r\n        var newTextField = factory.createTextField();\r\n\t\tvar text_field_type:number=this._newBlockBytes.readUnsignedByte();\r\n\t\tif(text_field_type==0) {\r\n\t\t\tnewTextField.type = \"static\";\r\n\t\t}\r\n\t\telse if(text_field_type==1) {\r\n\t\t\tnewTextField.type = \"dynamic\";\r\n\t\t}\r\n\t\telse if(text_field_type==2) {\r\n\t\t\tnewTextField.type = \"input\";\r\n\t\t}\r\n\t\telse if(text_field_type==3) {\r\n\t\t\tnewTextField.type =\"input\";\r\n\t\t\tnewTextField.displayAsPassword=true;\r\n\t\t}\r\n\r\n\t\tnewTextField.width=this._newBlockBytes.readFloat();\r\n\t\tnewTextField.height=this._newBlockBytes.readFloat();\r\n\t\tvar num_paragraphs:number = this._newBlockBytes.readUnsignedInt();\r\n\t\tvar complete_text:string = \"\";\r\n\t\t//console.log(\"num_paragraphs  '\" + num_paragraphs);\r\n\t\tvar text_format:TextFormat;\r\n\t\tfor(var paracnt:number=0; paracnt<num_paragraphs; paracnt++){\r\n\r\n\t\t\tvar num_textruns:number = this._newBlockBytes.readUnsignedInt();\r\n\t\t\t//console.log(\"num_textruns  '\" + num_textruns);\r\n\t\t\tfor(var textrun_cnt:number=0; textrun_cnt<num_textruns; textrun_cnt++) {\r\n\r\n\t\t\t\tvar format_id:number = this._newBlockBytes.readUnsignedInt();\r\n\t\t\t\t//console.log(\"format_id  '\" + format_id);\r\n\t\t\t\tvar textFormatArray:Array<any> = this.getAssetByID(format_id, [TextFormat.assetType]);\r\n\t\t\t\tif (textFormatArray[0]) {\r\n\t\t\t\t\ttext_format = <TextFormat> textFormatArray[1];\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._blocks[blockID].addError(\"Could not find a Material for this Billboard. A empty material is created!\");\r\n\t\t\t\t\ttext_format = new TextFormat();\r\n\t\t\t\t}\r\n\t\t\t\t//console.log(\"text_format  '\" + text_format.name);\r\n\t\t\t\tvar txt_length = this._newBlockBytes.readUnsignedInt();\r\n\t\t\t\t//console.log(\"txt_length  '\" + txt_length);\r\n\t\t\t\tif (txt_length > 0) {\r\n\t\t\t\t\tvar this_txt:string = this._newBlockBytes.readUTFBytes(txt_length);\r\n\t\t\t\t\t//newTextField.appendText(this_txt, text_format);\r\n\t\t\t\t\tcomplete_text+=this_txt;\r\n\t\t\t\t\t//console.log(\"this_txt  '\" + this_txt);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t//newTextField.closeParagraph();\r\n\t\t}\r\n\t\tnewTextField.textFormat=text_format;\r\n\t\tnewTextField.text=complete_text;\r\n\t\t//newTextField.construct_geometry();\r\n\t\t// todo: optional matrix etc can be put in properties.\r\n\r\n\t\tvar props:AWDProperties = this.parseProperties({1:AWDParser.BOOL, 3:AWDParser.BOOL, 4:AWDParser.BOOL, 5:AWDParser.BOOL, 7:AWDParser.UINT8, 8:AWDParser.UINT8, 9:AWDParser.UINT8});\r\n\t\tnewTextField.selectable = props.get(1, false);\r\n\t\tnewTextField.border =  props.get(3, false);\r\n\t\t//newTextField.renderHTML =  props.get(4, false);\r\n\t\t//newTextField.scrollable =  props.get(5, false);\r\n\t\t//newTextField.text_flow =  props.get(7, 0);\r\n\t\t//newTextField.orientationMode =  props.get(8, 0);\r\n\t\t//newTextField.line_mode =  props.get(9, 0);\r\n\t\tnewTextField.extra = this.parseUserAttributes();\r\n\r\n\t\t//console.log(\"Parsed a TextField: Name = '\" + name + \"| text  = \" + complete_text);\r\n\t\tthis._pFinalizeAsset(<IAsset> newTextField, name);\r\n\t\tthis._blocks[blockID].data = newTextField;\r\n\r\n\t\tif (this._debug) {\r\n\t\t\tconsole.log(\"Parsed a TextField: Name = '\" + name + \"| text  = \" + complete_text);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t// Block ID = 25\r\n\tprivate parseBillBoardLibraryBlock(blockID:number):void {\r\n\r\n\t\tvar name:string = this.parseVarStr();\r\n\r\n\t\tvar data_id:number = this._newBlockBytes.readUnsignedInt();\r\n\t\tvar mat:BasicMaterial;\r\n\t\tvar returnedArrayMaterial:Array<any> = this.getAssetByID(data_id, [MaterialBase.assetType]);\r\n\r\n\t\tif (returnedArrayMaterial[0]) {\r\n\t\t\tmat = <BasicMaterial> returnedArrayMaterial[1];\r\n\t\t} else {\r\n\t\t\tthis._blocks[blockID].addError(\"Could not find a Material for this Billboard. A empty material is created!\");\r\n\t\t\tmat = new BasicMaterial();\r\n\t\t}\r\n\t\tmat.bothSides=true;\r\n\t\tvar billboard:Billboard = new Billboard(mat);\r\n\r\n\t\t// todo: optional matrix etc can be put in properties.\r\n\t\tthis.parseProperties(null);\r\n\r\n\t\tbillboard.extra = this.parseUserAttributes();\r\n\r\n\t\tthis._pFinalizeAsset(<IAsset> billboard, name);\r\n\t\tthis._blocks[blockID].data = billboard;\r\n\r\n\t\tif (this._debug) {\r\n\t\t\tconsole.log(\"Parsed a Library-Billboard: Name = '\" + name + \"| Material-Name = \" + mat.name);\r\n\t\t}\r\n\t}\r\n\t// Block ID = 24\r\n\tprivate parseMeshLibraryBlock(blockID:number):void {\r\n\t\tvar num_materials:number;\r\n\t\tvar materials_parsed:number;\r\n\r\n\t\tvar name:string = this.parseVarStr();\r\n\r\n\t\tvar data_id:number = this._newBlockBytes.readUnsignedInt();\r\n\t\tvar geom:Geometry;\r\n\t\tvar returnedArrayGeometry:Array<any> = this.getAssetByID(data_id, [Geometry.assetType])\r\n\r\n\t\tif (returnedArrayGeometry[0]) {\r\n\t\t\tgeom = <Geometry> returnedArrayGeometry[1];\r\n\t\t} else {\r\n\t\t\tthis._blocks[blockID].addError(\"Could not find a Geometry for this Mesh. A empty Geometry is created!\");\r\n\t\t\tgeom = new Geometry();\r\n\t\t}\r\n\r\n\t\tthis._blocks[blockID].geoID = data_id;\r\n\t\tvar materials:Array<MaterialBase> = new Array<MaterialBase>();\r\n\t\tnum_materials = this._newBlockBytes.readUnsignedShort();\r\n\r\n\t\tvar materialNames:Array<string> = new Array<string>();\r\n\t\tmaterials_parsed = 0;\r\n\r\n\t\tvar returnedArrayMaterial:Array<any>;\r\n\r\n\t\twhile (materials_parsed < num_materials) {\r\n\t\t\tvar mat_id:number;\r\n\t\t\tmat_id = this._newBlockBytes.readUnsignedInt();\r\n\t\t\treturnedArrayMaterial = this.getAssetByID(mat_id, [MaterialBase.assetType])\r\n\t\t\tif ((!returnedArrayMaterial[0]) && (mat_id > 0)) {\r\n\t\t\t\tthis._blocks[blockID].addError(\"Could not find Material Nr \" + materials_parsed + \" (ID = \" + mat_id + \" ) for this Mesh\");\r\n\t\t\t}\r\n\r\n\t\t\tvar m:MaterialBase = <MaterialBase> returnedArrayMaterial[1];\r\n\r\n\t\t\tmaterials.push(m);\r\n\t\t\tmaterialNames.push(m.name);\r\n\r\n\t\t\tmaterials_parsed++;\r\n\t\t}\r\n\r\n\t\tvar mesh:Mesh = new Mesh(geom, null);\r\n\r\n\r\n\t\tif (materials.length >= 1 && mesh.subMeshes.length == 1) {\r\n\t\t\tmesh.material = materials[0];\r\n\t\t} else if (materials.length > 1) {\r\n\t\t\tvar i:number;\r\n\r\n\t\t\t// Assign each sub-mesh in the mesh a material from the list. If more sub-meshes\r\n\t\t\t// than materials, repeat the last material for all remaining sub-meshes.\r\n\t\t\tfor (i = 0; i < mesh.subMeshes.length; i++) {\r\n\t\t\t\tmesh.subMeshes[i].material = materials[Math.min(materials.length - 1, i)];\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.parseProperties(null);\r\n\t\tmesh.extra = this.parseUserAttributes();\r\n\r\n\t\tthis._pFinalizeAsset(<IAsset> mesh, name);\r\n\t\tthis._blocks[blockID].data = mesh;\r\n\r\n\t\tif (this._debug) {\r\n\t\t\tconsole.log(\"Parsed a Library-Mesh: Name = '\" + name + \"| Geometry-Name = \" + geom.name + \" | SubMeshes = \" + mesh.subMeshes.length + \" | Mat-Names = \" + materialNames.toString());\r\n\t\t}\r\n\t}\r\n\tprivate parseAudioBlock(blockID:number, factory:TimelineSceneGraphFactory):void {\r\n\r\n\t\t//var asset:Audio;todo create asset for audio\r\n\r\n\t\tthis._blocks[blockID].name = this.parseVarStr();\r\n\r\n\t\tvar type:number = this._newBlockBytes.readUnsignedByte();\r\n\t\tvar data_len:number;\r\n\r\n\t\t//this._texture_users[this._cur_block_id.toString()] = [];\r\n\r\n\t\t// External\r\n\t\tif (type == 0) {\r\n\t\t\tdata_len = this._newBlockBytes.readUnsignedInt();\r\n\t\t\tvar url:string;\r\n\t\t\turl = this._newBlockBytes.readUTFBytes(data_len);\r\n\t\t\t// todo parser needs to be able to handle mp3 and wav files if we trigger the loading of external ressource\r\n\t\t\t//this._pAddDependency(this._cur_block_id.toString(), new URLRequest(url), false, null, true);\r\n\t\t\tconsole.log(\"Audio url = \"+url);\r\n\r\n\t\t} else {\r\n\t\t\t// todo: exporter does not export embed sounds yet\r\n\t\t\tdata_len = this._newBlockBytes.readUnsignedInt();\r\n\r\n\t\t\tvar data:ByteArray;\r\n\t\t\tdata = new ByteArray();\r\n\t\t\tthis._newBlockBytes.readBytes(data, 0, data_len);\r\n\r\n\t\t\t// todo parse sound from bytes\r\n\t\t\t// this._pAddDependency(this._cur_block_id.toString(), null, false, ParserUtils.by(data), true);\r\n\t\t\t//this._pAddDependency(this._cur_block_id.toString(), null, false, data, true);\r\n\r\n\t\t}\r\n\r\n\t\t// Ignore for now\r\n\t\tthis.parseProperties(null);\r\n\t\tthis._blocks[blockID].extras = this.parseUserAttributes();\r\n\t\tthis._pPauseAndRetrieveDependencies();\r\n\t\t//this._blocks[blockID].data = asset;todo\r\n\r\n\t\tif (this._debug) {\r\n\t\t\tvar textureStylesNames:Array<string> = [\"external\", \"embed\"]\r\n\t\t\tconsole.log(\"Start parsing a \" + textureStylesNames[type] + \" Audio file\");\r\n\t\t}\r\n\t}\r\n\r\n\t//Block ID = 4\r\n\tprivate parseTimeLine(blockID:number, factory:TimelineSceneGraphFactory):void {\r\n\r\n\t\tvar i:number;\r\n\t\tvar j:number;\r\n\t\tvar c:number;\r\n\t\tvar timeLineContainer = factory.createMovieClip();\r\n\t\tvar name = this.parseVarStr();\r\n\t\tvar isScene = !!this._newBlockBytes.readUnsignedByte();\r\n\t\tvar sceneID = this._newBlockBytes.readUnsignedByte();\r\n\t\tvar fps:number = this._newBlockBytes.readFloat();\r\n\t\t//console.log(\"fps = \"+fps);\r\n\t\t//timeLineContainer.fps=fps;\r\n\t\tvar ms_per_frame = 1000 / fps;\r\n\t\tvar num_instances:number=0;\r\n\t\tvar num_all_display_instances:number=0;\r\n\r\n\r\n\t\t// register list of potential childs\r\n\t\t// a potential child can be reused on a timeline (added / removed / added)\r\n\t\t// However, for each potential child, we need to register the max-number of instances that a frame contains\r\n\t\t// we parse 2 lists of potential-childs:\r\n\t\t// -\tthe first list contains potential-childs that are only ever instanced once per frame.\r\n\t\t// -\tthe second list contains potential-childs that are instanced multiple times on some frames.\r\n\r\n\t\t// on registering a child, the child gets a incremental-id assigned. This is the id, that the commands are using to access the childs.\r\n\t\t// hence we need to be careful to register all objects in correct order.\r\n\r\n\t\tvar num_potential_childs:number = this._newBlockBytes.readUnsignedShort();\r\n\t\tfor (i = 0; i < num_potential_childs; i++) {\r\n\t\t\tresourceID = this._newBlockBytes.readUnsignedInt();\r\n\t\t\tvar cmd_asset:DisplayObject = <DisplayObject>this._blocks[resourceID].data;\r\n\t\t\tif (cmd_asset != null) {\r\n\t\t\t\ttimeLineContainer.registerPotentialChild(cmd_asset);\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\t//todo: register a default display object on timeline, so we do not mess up the incremental obj-id\r\n\t\t\t\t//timeLineContainer.registerPotentialChild(cmd_asset);\r\n\t\t\t\tconsole.log(\"ERROR when collecting objects for timeline\");\r\n\t\t\t}\r\n\t\t}\r\n\t\tnum_all_display_instances+=num_potential_childs;\r\n\t\tvar num_potential_childs_multi_instanced = this._newBlockBytes.readUnsignedShort();\r\n\t\tnum_potential_childs+=num_potential_childs_multi_instanced;\r\n\t\tfor (i = 0; i < num_potential_childs_multi_instanced; i++) {\r\n\t\t\tresourceID = this._newBlockBytes.readUnsignedInt();\r\n\t\t\tnum_instances = this._newBlockBytes.readUnsignedShort();\r\n\t\t\tnum_all_display_instances+=num_instances;\r\n\t\t\tvar cmd_asset:DisplayObject = <DisplayObject>this._blocks[resourceID].data;\r\n\t\t\tif (cmd_asset != null) {\r\n\t\t\t\tfor (j = 0; j < num_instances; j++) {\r\n\t\t\t\t\ttimeLineContainer.registerPotentialChild(cmd_asset);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\tfor (j = 0; j < num_instances; j++) {\r\n\t\t\t\t\t//todo: register a default display object on timeline, so we do not mess up the incremental obj-id\r\n\t\t\t\t\t//timeLineContainer.registerPotentialChild(cmd_asset);\r\n\t\t\t\t\tconsole.log(\"ERROR when collecting objects for timeline\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t//console.log(\"Parsed \"+num_potential_childs+\" potential childs. They will be used by \"+num_all_display_instances+\" instances.\");\r\n\r\n\t\t// register list of potential sounds\r\n\t\t// a potential child can be reused on a timeline (added / removed / added)\r\n\t\tvar num_potential_sounds = this._newBlockBytes.readUnsignedShort();\r\n\t\tfor (i = 0; i < num_potential_sounds; i++) {\r\n\t\t\tresourceID = this._newBlockBytes.readUnsignedInt();\r\n\t\t\tvar cmd_asset:DisplayObject = <DisplayObject>this._blocks[resourceID].data;\r\n\t\t\tif (cmd_asset != null) {\r\n\t\t\t\t//todo: register sound objects on movieclip\r\n\t\t\t\tconsole.log(\"ERROR when collecting objects for timeline\");\r\n\t\t\t\t//timeLineContainer.registerPotentialChild(cmd_asset);\r\n\t\t\t}\r\n\t\t\telse{\r\n\t\t\t\t//todo: this is a error that might break complete timeline, because all sound obj-id shift\r\n\t\t\t}\r\n\t\t}\r\n\t\t//console.log(\"Parsed \"+num_potential_sounds+\" potential sounds\");\r\n\r\n\t\tvar numFrames = this._newBlockBytes.readUnsignedShort();\r\n\r\n\t\t//console.log(\"numFrames \"+numFrames);\r\n\t\t// var previousTimeLine:TimeLineFrame;\r\n\t\t// var fill_props:AWDProperties = this.parseProperties({1:AWD3Parserutils.UINT32});// { 1:UINT32, 6:AWDSTRING }  ); //; , 2:UINT32, 3:UINT32, 5:BOOL } );\r\n\r\n\r\n\t\tvar totalDuration:number;\r\n\t\tvar frameDuration:number;\r\n\t\tvar numLabels:number;\r\n\t\tvar numCommands:number;\r\n\t\tvar objectID:number;\r\n\t\tvar target_depth:number;\r\n\t\tvar resourceID:number;\r\n\t\tvar number_of_obj:number;\r\n\t\tvar commandType:number;\r\n\t\tvar frame:TimelineKeyFrame;\r\n\t\tvar label:string;\r\n\t\tvar hasDepthChanges:boolean;\r\n\t\ttotalDuration=0;\r\n\t\tfor (i = 0; i < numFrames; i++) {\r\n\t\t\tframe = new TimelineKeyFrame();\r\n\t\t\t// todo: remove the ms_per_frame to set the duration in frames\r\n\t\t\tframeDuration = this._newBlockBytes.readUnsignedInt()*ms_per_frame;\r\n\t\t\tframe.setFrameTime(totalDuration, frameDuration);\r\n\t\t\ttotalDuration += frameDuration;\r\n\t\t\t//console.log(\"duration = \" + frameDuration);\r\n\r\n\t\t\tnumLabels = this._newBlockBytes.readUnsignedByte();\r\n\t\t\tfor (j = 0; j < numLabels; j++) {\r\n\t\t\t\tlabel = this.parseVarStr();\r\n\t\t\t\t//console.log(\"label \"+label);\r\n\t\t\t}\r\n\r\n\t\t\tnumCommands = this._newBlockBytes.readUnsignedShort();\r\n\t\t\t//console.log(\"numCommands \"+numCommands);\r\n\t\t\t//traceString += \"\\n      Commands \" + numCommands;\r\n\t\t\thasDepthChanges = false;\r\n\t\t\tfor (j = 0; j < numCommands; j++) {\r\n\t\t\t\tcommandType = this._newBlockBytes.readUnsignedByte();\r\n\r\n\t\t\t\t// 1 = remove a number of objects by depth\r\n\t\t\t\t// 2 = add a object by child-id at specific depth\r\n\t\t\t\t// 3 = update a object by child-id\r\n\t\t\t\t// 4 = add / update sound - (not finished)\r\n\r\n\t\t\t\tswitch (commandType) {\r\n\r\n\t\t\t\t\tcase 1:// remove a number of objects at specific depth\r\n\t\t\t\t\t\tnumber_of_obj = this._newBlockBytes.readUnsignedShort();\r\n\t\t\t\t\t\t//console.log(\"number_of_obj \", number_of_obj);\r\n\t\t\t\t\t\tvar remove_depths:Array<number>=new Array<number>();\r\n\t\t\t\t\t\tfor (c = 0; c < number_of_obj; c++) {\r\n\t\t\t\t\t\t\t// Remove Object Command\r\n\t\t\t\t\t\t\ttarget_depth = this._newBlockBytes.readShort();\r\n\t\t\t\t\t\t\tremove_depths.push(target_depth);\r\n\t\t\t\t\t\t\t//console.log(\"\\n       - Remove object at depth: \" + target_depth);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tframe.addConstructCommand(new RemoveChildrenAtDepthCommand(remove_depths));\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 2:// add a of object by child-id at specific depth\r\n\t\t\t\t\tcase 3:// update a object by child-id\r\n\t\t\t\t\t\tobjectID = this._newBlockBytes.readUnsignedShort();\r\n\t\t\t\t\t\t//console.log(\"add / update objectID \", objectID);\r\n\t\t\t\t\t\tif (commandType == 2) {\r\n\t\t\t\t\t\t\thasDepthChanges=true;\r\n\t\t\t\t\t\t\ttarget_depth = this._newBlockBytes.readShort();\r\n\t\t\t\t\t\t\t//console.log(\"target_depth \", target_depth);\r\n                            var potChild = timeLineContainer.getPotentialChild(objectID);\r\n\t\t\t\t\t\t\tif (potChild != undefined) {\r\n\t\t\t\t\t\t\t\tframe.addConstructCommand(new AddChildAtDepthCommand(objectID, target_depth));\r\n\t\t\t\t\t\t\t\t// if the object is a tetfield, we set the textfield-name as instancename\r\n                                if(potChild.isAsset(TextField)) {\r\n                                    frame.addConstructCommand(new SetInstanceNameCommand(objectID, potChild.name));\r\n                                }\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse{\r\n\t\t\t\t\t\t\t\tconsole.log(\"ERROR: could not find the objectID \", objectID);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvar props_flag = this._newBlockBytes.readUnsignedShort();\r\n\t\t\t\t\t\t/*\tProps_flags\r\n\t\t\t\t\t\t 1: read display matrix - 6 x float,\r\n\t\t\t\t\t\t 2: read display matrix - read another UINT8-bitflag that determinates what matrix components to parse\r\n\t\t\t\t\t\t 3: read color matrix - 4 x float, 4 x uint16\r\n\t\t\t\t\t\t 4: read color matrix - read another UINT8-bitflag that determinates what matrix components to parse\r\n\t\t\t\t\t\t 5: blendmode - uint8\r\n\t\t\t\t\t\t 6: visible - boolean\r\n\t\t\t\t\t\t 7: AWD3Parserutils.UINT8\r\n\t\t\t\t\t\t });*/\r\n\t\t\t\t\t\t// read display matrix\r\n\t\t\t\t\t\tif (BitFlags.test(props_flag, BitFlags.FLAG1)) {\r\n\t\t\t\t\t\t\tvar thisMatrix = new Matrix3D();\r\n\t\t\t\t\t\t\tif (BitFlags.test(props_flag, BitFlags.FLAG2)) {\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tthisMatrix.rawData[0] = this._newBlockBytes.readFloat();\r\n\t\t\t\t\t\t\t\tthisMatrix.rawData[1] = this._newBlockBytes.readFloat();\r\n\t\t\t\t\t\t\t\tthisMatrix.rawData[4] = this._newBlockBytes.readFloat();\r\n\t\t\t\t\t\t\t\tthisMatrix.rawData[5] = this._newBlockBytes.readFloat();\r\n\t\t\t\t\t\t\t\tthisMatrix.position = new Vector3D(this._newBlockBytes.readFloat(), this._newBlockBytes.readFloat(), 0);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tframe.addConstructCommand(new UpdatePropertyCommand(objectID, \"_iMatrix3D\", thisMatrix));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// read colortransforms\r\n\t\t\t\t\t\tif (BitFlags.test(props_flag, BitFlags.FLAG3)) {\r\n\t\t\t\t\t\t\tvar thisColorTransform = new ColorTransform();\r\n\t\t\t\t\t\t\tif (BitFlags.test(props_flag, BitFlags.FLAG4)) {\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tthisColorTransform.redMultiplier = this._newBlockBytes.readFloat();\r\n\t\t\t\t\t\t\t\tthisColorTransform.greenMultiplier = this._newBlockBytes.readFloat();\r\n\t\t\t\t\t\t\t\tthisColorTransform.blueMultiplier = this._newBlockBytes.readFloat();\r\n\t\t\t\t\t\t\t\tthisColorTransform.alphaMultiplier = this._newBlockBytes.readFloat();\r\n\t\t\t\t\t\t\t\tthisColorTransform.redOffset = this._newBlockBytes.readShort();\r\n\t\t\t\t\t\t\t\tthisColorTransform.greenOffset = this._newBlockBytes.readShort();\r\n\t\t\t\t\t\t\t\tthisColorTransform.blueOffset = this._newBlockBytes.readShort();\r\n\t\t\t\t\t\t\t\tthisColorTransform.alphaOffset = this._newBlockBytes.readShort();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (BitFlags.test(props_flag, BitFlags.FLAG5)) {\r\n\t\t\t\t\t\t\tvar blendmode_int = this._newBlockBytes.readUnsignedByte();\r\n\t\t\t\t\t\t\tvar blendmode_string = this.blendModeDic[blendmode_int];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (BitFlags.test(props_flag, BitFlags.FLAG6)) {\r\n\t\t\t\t\t\t\tframe.addConstructCommand(new UpdatePropertyCommand(objectID, \"visible\", this._newBlockBytes.readByte()));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (BitFlags.test(props_flag, BitFlags.FLAG7)) {\r\n\t\t\t\t\t\t\tvar instanceName = this.parseVarStr();\r\n\t\t\t\t\t\t\tif (instanceName.length) {\r\n\t\t\t\t\t\t\t\tframe.addConstructCommand(new SetInstanceNameCommand(objectID, instanceName));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (BitFlags.test(props_flag, BitFlags.FLAG8)) {\r\n\t\t\t\t\t\t\tvar mask_id_nums = this._newBlockBytes.readUnsignedShort();\r\n\t\t\t\t\t\t\tvar mask_ids = new Array();\r\n\t\t\t\t\t\t\tfor (var mi_cnt = 0; mi_cnt < mask_id_nums; mi_cnt++) {\r\n\t\t\t\t\t\t\t\tmask_ids.push(this._newBlockBytes.readShort());\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (mask_ids.length > 0) {\r\n\t\t\t\t\t\t\t\tif ((mask_ids.length == 1) && (mask_ids[0] == -1)) {\r\n\t\t\t\t\t\t\t\t\t// TODO: this object is used as mask\r\n\t\t\t\t\t\t\t\t\tframe.addConstructCommand(new UpdatePropertyCommand(objectID, \"_iMaskID\", objectID));\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\telse\r\n\t\t\t\t\t\t\t\t\tframe.addConstructCommand(new SetMaskCommand(objectID, mask_ids));\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 4:\r\n\r\n\t\t\t\t\t\t// Add Sound Command\r\n\t\t\t\t\t\t// TODO: create CommandPropsSound and check which asset to use\r\n\t\t\t\t\t\tobjectID = this._newBlockBytes.readUnsignedInt();\r\n\t\t\t\t\t\tresourceID = this._newBlockBytes.readUnsignedInt();\r\n\t\t\t\t\t\t// TODO: implement sound in timeline\r\n\t\t\t\t\t\t//commandString += \"\\n      - Add new Sound AWD-ID = \" + resourceID.toString() + \" as object_id = \" + objectID.toString();\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tdefault:\r\n\r\n\t\t\t\t\t\t//commandString += \"\\n       - Unknown Command Type = \" + commandType;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (hasDepthChanges) {\r\n\t\t\t\t// only want to do this once after all children's depth values are updated\r\n\t\t\t\tframe.addConstructCommand(new ApplyAS2DepthsCommand());\r\n\t\t\t\thasDepthChanges = false;\r\n\t\t\t}\r\n\r\n\t\t\tvar length_code = this._newBlockBytes.readUnsignedInt();\r\n\t\t\tif (length_code > 0) {\r\n\t\t\t\t// TODO: Script should probably not be attached to keyframes?\r\n\t\t\t\tvar frame_code = this._newBlockBytes.readUTFBytes(length_code);\r\n\t\t\t\tframe.addConstructCommand(new ExecuteScriptCommand(frame_code));\r\n\t\t\t\t//traceString += \"\\nframe-code = \" + frame_code;\r\n\t\t\t}\r\n\t\t\t//traceString += commandString;\r\n\t\t\t//trace(\"length_code = \"+length_code+\" frame_code = \"+frame_code);\r\n\t\t\tthis._newBlockBytes.readUnsignedInt();// user attributes - skip for now\r\n\t\t\t//console.log(traceString);\r\n\t\t\ttimeLineContainer.addFrame(frame);\r\n\r\n\t\t}\r\n\r\n\t\tthis._pFinalizeAsset(<IAsset>timeLineContainer, name);\r\n\t\tthis._blocks[blockID].data = timeLineContainer;\r\n\t\tthis.parseProperties(null);\r\n\t\tthis.parseUserAttributes();\r\n\t\tif (this._debug)\r\n\t\t\tconsole.log(\"Parsed a TIMELINE: Name = \" + name + \"| isScene = \" + isScene + \"| sceneID = \" + sceneID + \"| numFrames = \" + numFrames);\r\n\t}\r\n\t//Block ID = 1\r\n\tprivate parseTriangleGeometrieBlock(blockID:number):void\r\n\t{\r\n\r\n\t\tvar geom:Geometry = new Geometry();\r\n\r\n\t\t// Read name and sub count\r\n\t\tvar name:string = this.parseVarStr();\r\n\t\tvar num_subs:number = this._newBlockBytes.readUnsignedShort();\r\n\r\n\t\t// Read optional properties\r\n\t\tvar props:AWDProperties = this.parseProperties({1:this._geoNrType, 2:this._geoNrType});\r\n\t\tvar geoScaleU:number = props.get(1, 1);\r\n\t\tvar geoScaleV:number = props.get(2, 1);\r\n\r\n\t\t// Loop through sub meshes\r\n\t\tvar subs_parsed:number = 0;\r\n\t\twhile (subs_parsed < num_subs) {\r\n\t\t\tvar is_curve_geom:boolean=false;\r\n\t\t\tvar i:number;\r\n\t\t\tvar sm_len:number, sm_end:number;\r\n\t\t\tvar w_indices:Array<number>;\r\n\t\t\tvar weights:Array<number>;\r\n\r\n\t\t\tsm_len = this._newBlockBytes.readUnsignedInt();\r\n\t\t\tsm_end = this._newBlockBytes.position + sm_len;\r\n\r\n\t\t\tvar subProps:AWDProperties = this.parseProperties({1:this._geoNrType, 2:this._geoNrType});\r\n\t\t\t// Loop through data streams\r\n\t\t\twhile (this._newBlockBytes.position < sm_end) {\r\n\t\t\t\tvar idx:number = 0;\r\n\t\t\t\tvar str_ftype:number, str_type:number, str_len:number, str_end:number;\r\n\r\n\t\t\t\t// Type, field type, length\r\n\t\t\t\tstr_type = this._newBlockBytes.readUnsignedByte();\r\n\t\t\t\tstr_ftype = this._newBlockBytes.readUnsignedByte();\r\n\t\t\t\tstr_len = this._newBlockBytes.readUnsignedInt();\r\n\t\t\t\tstr_end = this._newBlockBytes.position + str_len;\r\n\r\n\t\t\t\tvar x:number, y:number, z:number;\r\n\r\n\t\t\t\tif (str_type == 1) {//vertex 3d positions\r\n\t\t\t\t\tvar verts:Array<number> = new Array<number>();\r\n\r\n\t\t\t\t\twhile (this._newBlockBytes.position < str_end) {\r\n\r\n\t\t\t\t\t\tx = this.readNumber(this._accuracyGeo);\r\n\t\t\t\t\t\ty = this.readNumber(this._accuracyGeo);\r\n\t\t\t\t\t\tz = this.readNumber(this._accuracyGeo);\r\n\r\n\t\t\t\t\t\tverts[idx++] = x;\r\n\t\t\t\t\t\tverts[idx++] = y;\r\n\t\t\t\t\t\tverts[idx++] = z;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (str_type == 2) {//face indicies positions\r\n\t\t\t\t\tvar indices:Array<number> = new Array<number>();\r\n\r\n\t\t\t\t\twhile (this._newBlockBytes.position < str_end) {\r\n\t\t\t\t\t\tindices[idx++] = this._newBlockBytes.readUnsignedShort();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else if (str_type == 3) {\r\n\t\t\t\t\tvar uvs:Array<number> = new Array<number>();\r\n\t\t\t\t\twhile (this._newBlockBytes.position < str_end) {\r\n\t\t\t\t\t\tuvs[idx++] = this.readNumber(this._accuracyGeo);\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (str_type == 4) {\r\n\r\n\t\t\t\t\tvar normals:Array<number> = new Array<number>();\r\n\r\n\t\t\t\t\twhile (this._newBlockBytes.position < str_end) {\r\n\t\t\t\t\t\tnormals[idx++] = this.readNumber(this._accuracyGeo);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else if (str_type == 6) {\r\n\t\t\t\t\tw_indices = Array<number>();\r\n\r\n\t\t\t\t\twhile (this._newBlockBytes.position < str_end) {\r\n\t\t\t\t\t\tw_indices[idx++] = this._newBlockBytes.readUnsignedShort()*3;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else if (str_type == 7) {\r\n\r\n\t\t\t\t\tweights = new Array<number>();\r\n\r\n\t\t\t\t\twhile (this._newBlockBytes.position < str_end) {\r\n\t\t\t\t\t\tweights[idx++] = this.readNumber(this._accuracyGeo);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (str_type == 8) {// 2d-positions - not used yet.\r\n\t\t\t\t\tthis._newBlockBytes.position = str_end;\r\n\t\t\t\t} else if (str_type == 9) {// combined vertex3D stream 13 x float32\r\n\t\t\t\t\tthis._newBlockBytes.position = str_end;\r\n\t\t\t\t} else if (str_type == 10) {// combined vertex2D stream 5 x float32\r\n\t\t\t\t\tis_curve_geom=true;\r\n\t\t\t\t\tvar idx_pos:number = 0;\r\n\t\t\t\t\tvar idx_curves:number = 0;\r\n\t\t\t\t\tvar idx_uvs:number = 0;\r\n\r\n\t\t\t\t\tvar positions:Array<number> = new Array<number>();\r\n\t\t\t\t\tvar curveData:Array<number> = new Array<number>();\r\n\t\t\t\t\tvar uvs:Array<number> = new Array<number>();\r\n\r\n\t\t\t\t\twhile (this._newBlockBytes.position < str_end) {\r\n\r\n\t\t\t\t\t\tpositions[idx_pos++] = this.readNumber(this._accuracyGeo);// x\r\n\t\t\t\t\t\tpositions[idx_pos++] = this.readNumber(this._accuracyGeo);// y\r\n\t\t\t\t\t\tpositions[idx_pos++] =  this.readNumber(this._accuracyGeo);// type\r\n\r\n\t\t\t\t\t\tcurveData[idx_curves++] = this.readNumber(this._accuracyGeo);// curve value 1\r\n\t\t\t\t\t\tcurveData[idx_curves++] = this.readNumber(this._accuracyGeo);// curve value 2\r\n\r\n\t\t\t\t\t\tuvs[idx_uvs++] = this.readNumber(this._accuracyGeo);// curve value 1\r\n\t\t\t\t\t\tuvs[idx_uvs++] = this.readNumber(this._accuracyGeo);// curve value 1\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis._newBlockBytes.position = str_end;\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.parseUserAttributes(); // Ignore sub-mesh attributes for now\r\n\t\t\tif(is_curve_geom){\r\n\t\t\t\tvar curve_sub_geom:CurveSubGeometry = new CurveSubGeometry(true);\r\n\t\t\t\tcurve_sub_geom.updateIndices(indices);\r\n\t\t\t\tcurve_sub_geom.updatePositions(positions);\r\n\t\t\t\tcurve_sub_geom.updateCurves(curveData);\r\n\t\t\t\tcurve_sub_geom.updateUVs(uvs);\r\n\t\t\t\tgeom.addSubGeometry(curve_sub_geom);\r\n\t\t\t\tif (this._debug)\r\n\t\t\t\t\tconsole.log(\"Parsed a CurveSubGeometry\");\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tvar triangle_sub_geom = new TriangleSubGeometry(true);\r\n\t\t\t\tif (weights)\r\n\t\t\t\t\ttriangle_sub_geom.jointsPerVertex = weights.length / (verts.length / 3);\r\n\t\t\t\tif (normals)\r\n\t\t\t\t\ttriangle_sub_geom.autoDeriveNormals = false;\r\n\t\t\t\tif (uvs)\r\n\t\t\t\t\ttriangle_sub_geom.autoDeriveUVs = false;\r\n\t\t\t\t//triangle_sub_geom.autoDeriveNormals = false;\r\n\t\t\t\tif (true) {\r\n\t\t\t\t\ttriangle_sub_geom.autoDeriveTangents = true;\r\n\t\t\t\t}\r\n\t\t\t\ttriangle_sub_geom.updateIndices(indices);\r\n\t\t\t\ttriangle_sub_geom.updatePositions(verts);\r\n\t\t\t\ttriangle_sub_geom.updateVertexNormals(normals);\r\n\t\t\t\ttriangle_sub_geom.updateUVs(uvs);\r\n\t\t\t\ttriangle_sub_geom.updateVertexTangents(null);\r\n\t\t\t\ttriangle_sub_geom.updateJointWeights(weights);\r\n\t\t\t\ttriangle_sub_geom.updateJointIndices(w_indices);\r\n\r\n\t\t\t\tvar scaleU:number = subProps.get(1, 1);\r\n\t\t\t\tvar scaleV:number = subProps.get(2, 1);\r\n\t\t\t\tvar setSubUVs:boolean = false; //this should remain false atm, because in AwayBuilder the uv is only scaled by the geometry\r\n\r\n\t\t\t\tif ((geoScaleU != scaleU) || (geoScaleV != scaleV)) {\r\n\t\t\t\t\tsetSubUVs = true;\r\n\t\t\t\t\tscaleU = geoScaleU / scaleU;\r\n\t\t\t\t\tscaleV = geoScaleV / scaleV;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (setSubUVs)\r\n\t\t\t\t\ttriangle_sub_geom.scaleUV(scaleU, scaleV);\r\n\t\t\t\tgeom.addSubGeometry(triangle_sub_geom);\r\n\t\t\t\tif (this._debug)\r\n\t\t\t\t\tconsole.log(\"Parsed a TriangleSubGeometry\");\r\n\t\t\t}\r\n\r\n\r\n\t\t\t// TODO: Somehow map in-sub to out-sub indices to enable look-up\r\n\t\t\t// when creating meshes (and their material assignments.)\r\n\r\n\t\t\tsubs_parsed++;\r\n\t\t}\r\n\t\tif ((geoScaleU != 1) || (geoScaleV != 1))\r\n\t\t\tgeom.scaleUV(geoScaleU, geoScaleV);\r\n\t\tthis.parseUserAttributes();\r\n\t\tthis._pFinalizeAsset(<IAsset> geom, name);\r\n\t\tthis._blocks[blockID].data = geom;\r\n\r\n\t\tif (this._debug) {\r\n\t\t\tconsole.log(\"Parsed a TriangleGeometry: Name = \" + name);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\r\n\t//Block ID = 11\r\n\tprivate parsePrimitves(blockID:number):void\r\n\t{\r\n\t\tvar name:string;\r\n\t\tvar prefab:PrefabBase;\r\n\t\tvar primType:number;\r\n\t\tvar subs_parsed:number;\r\n\t\tvar props:AWDProperties;\r\n\t\tvar bsm:Matrix3D;\r\n\r\n\t\t// Read name and sub count\r\n\t\tname = this.parseVarStr();\r\n\t\tprimType = this._newBlockBytes.readUnsignedByte();\r\n\t\tprops = this.parseProperties({101:this._geoNrType, 102:this._geoNrType, 103:this._geoNrType, 110:this._geoNrType, 111:this._geoNrType, 301:AWDParser.UINT16, 302:AWDParser.UINT16, 303:AWDParser.UINT16, 701:AWDParser.BOOL, 702:AWDParser.BOOL, 703:AWDParser.BOOL, 704:AWDParser.BOOL});\r\n\r\n\t\tvar primitiveTypes:Array<string> = [\"Unsupported Type-ID\", \"PrimitivePlanePrefab\", \"PrimitiveCubePrefab\", \"PrimitiveSpherePrefab\", \"PrimitiveCylinderPrefab\", \"PrimitivesConePrefab\", \"PrimitivesCapsulePrefab\", \"PrimitivesTorusPrefab\"]\r\n\r\n\t\tswitch (primType) {\r\n\t\t\t// to do, not all properties are set on all primitives\r\n\r\n\t\t\tcase 1:\r\n\t\t\t\tprefab = new PrimitivePlanePrefab(props.get(101, 100), props.get(102, 100), props.get(301, 1), props.get(302, 1), props.get(701, true), props.get(702, false));\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 2:\r\n\t\t\t\tprefab = new PrimitiveCubePrefab(props.get(101, 100), props.get(102, 100), props.get(103, 100), props.get(301, 1), props.get(302, 1), props.get(303, 1), props.get(701, true));\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 3:\r\n\t\t\t\tprefab = new PrimitiveSpherePrefab(props.get(101, 50), props.get(301, 16), props.get(302, 12), props.get(701, true));\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 4:\r\n\t\t\t\tprefab = new PrimitiveCylinderPrefab(props.get(101, 50), props.get(102, 50), props.get(103, 100), props.get(301, 16), props.get(302, 1), true, true, true); // bool701, bool702, bool703, bool704);\r\n\t\t\t\tif (!props.get(701, true))\r\n\t\t\t\t\t(<PrimitiveCylinderPrefab>prefab).topClosed = false;\r\n\t\t\t\tif (!props.get(702, true))\r\n\t\t\t\t\t(<PrimitiveCylinderPrefab>prefab).bottomClosed = false;\r\n\t\t\t\tif (!props.get(703, true))\r\n\t\t\t\t\t(<PrimitiveCylinderPrefab>prefab).yUp = false;\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 5:\r\n\t\t\t\tprefab = new PrimitiveConePrefab(props.get(101, 50), props.get(102, 100), props.get(301, 16), props.get(302, 1), props.get(701, true), props.get(702, true));\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 6:\r\n\t\t\t\tprefab = new PrimitiveCapsulePrefab(props.get(101, 50), props.get(102, 100), props.get(301, 16), props.get(302, 15), props.get(701, true));\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 7:\r\n\t\t\t\tprefab = new PrimitiveTorusPrefab(props.get(101, 50), props.get(102, 50), props.get(301, 16), props.get(302, 8), props.get(701, true));\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\t\t\t\tprefab = new PrefabBase();\r\n\t\t\t\tconsole.log(\"ERROR: UNSUPPORTED PREFAB_TYPE\");\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tif ((props.get(110, 1) != 1) || (props.get(111, 1) != 1)) {\r\n\t\t\t//geom.subGeometries;\r\n\t\t\t//geom.scaleUV(props.get(110, 1), props.get(111, 1)); //TODO add back scaling to prefabs\r\n\t\t}\r\n\r\n\t\tthis.parseUserAttributes();\r\n\t\tprefab.name = name;\r\n\t\tthis._pFinalizeAsset(prefab, name);\r\n\t\tthis._blocks[blockID].data = prefab;\r\n\r\n\t\tif (this._debug) {\r\n\t\t\tif ((primType < 0) || (primType > 7)) {\r\n\t\t\t\tprimType = 0;\r\n\t\t\t}\r\n\t\t\tconsole.log(\"Parsed a Primivite: Name = \" + name + \"| type = \" + primitiveTypes[primType]);\r\n\t\t}\r\n\t}\r\n\r\n\t// Block ID = 22\r\n\tprivate parseContainer(blockID:number):void\r\n\t{\r\n\t\tvar name:string;\r\n\t\tvar par_id:number;\r\n\t\tvar mtx:Matrix3D;\r\n\t\tvar ctr:DisplayObjectContainer;\r\n\t\tvar parent:DisplayObjectContainer;\r\n\r\n\t\tpar_id = this._newBlockBytes.readUnsignedInt();\r\n\t\tmtx = this.parseMatrix3D();\r\n\t\tname = this.parseVarStr();\r\n\r\n\t\tvar parentName:string = \"Root (TopLevel)\";\r\n\t\tctr = new DisplayObjectContainer();\r\n\t\tctr.transform.matrix3D = mtx;\r\n\r\n\t\tvar returnedArray:Array<any> = this.getAssetByID(par_id, [DisplayObjectContainer.assetType, LightBase.assetType, Mesh.assetType]);\r\n\r\n\t\tif (returnedArray[0]) {\r\n\t\t\tvar obj:DisplayObject = (<DisplayObjectContainer> returnedArray[1]).addChild(ctr);\r\n\t\t\tparentName = (<DisplayObjectContainer> returnedArray[1]).name;\r\n\t\t} else if (par_id > 0) {\r\n\t\t\tthis._blocks[ blockID ].addError(\"Could not find a parent for this ObjectContainer3D\");\r\n\t\t} else {\r\n\t\t\t//add to the content property\r\n\t\t\t(<DisplayObjectContainer> this._pContent).addChild(ctr);\r\n\t\t}\r\n\r\n\t\t// in AWD version 2.1 we read the Container properties\r\n\t\tif ((this._version[0] == 2) && (this._version[1] == 1)) {\r\n\t\t\tvar props:AWDProperties = this.parseProperties({1:this._matrixNrType, 2:this._matrixNrType, 3:this._matrixNrType, 4:AWDParser.UINT8});\r\n\t\t\tctr.pivot = new Vector3D(props.get(1, 0), props.get(2, 0), props.get(3, 0));\r\n\t\t}\r\n\t\t// in other versions we do not read the Container properties\r\n\t\telse {\r\n\t\t\tthis.parseProperties(null);\r\n\t\t}\r\n\r\n\t\t// the extraProperties should only be set for AWD2.1-Files, but is read for both versions\r\n\t\tctr.extra = this.parseUserAttributes();\r\n\r\n\t\tthis._pFinalizeAsset(<IAsset> ctr, name);\r\n\t\tthis._blocks[blockID].data = ctr;\r\n\r\n\t\tif (this._debug) {\r\n\t\t\tconsole.log(\"Parsed a Container: Name = '\" + name + \"' | Parent-Name = \" + parentName);\r\n\t\t}\r\n\t}\r\n\r\n\t// Block ID = 23\r\n\tprivate parseMeshInstance(blockID:number):void\r\n\t{\r\n\t\tvar num_materials:number;\r\n\t\tvar materials_parsed:number;\r\n\t\tvar parent:DisplayObjectContainer;\r\n\t\tvar par_id:number = this._newBlockBytes.readUnsignedInt();\r\n\t\tvar mtx:Matrix3D = this.parseMatrix3D();\r\n\t\tvar name:string = this.parseVarStr();\r\n\t\tvar parentName:string = \"Root (TopLevel)\";\r\n\t\tvar data_id:number = this._newBlockBytes.readUnsignedInt();\r\n\t\tvar geom:Geometry;\r\n\t\tvar returnedArrayGeometry:Array<any> = this.getAssetByID(data_id, [Geometry.assetType])\r\n\r\n\t\tif (returnedArrayGeometry[0]) {\r\n\t\t\tgeom = <Geometry> returnedArrayGeometry[1];\r\n\t\t} else {\r\n\t\t\tthis._blocks[blockID].addError(\"Could not find a Geometry for this Mesh. A empty Geometry is created!\");\r\n\t\t\tgeom = new Geometry();\r\n\t\t}\r\n\r\n\t\tthis._blocks[blockID].geoID = data_id;\r\n\t\tvar materials:Array<MaterialBase> = new Array<MaterialBase>();\r\n\t\tnum_materials = this._newBlockBytes.readUnsignedShort();\r\n\r\n\t\tvar materialNames:Array<string> = new Array<string>();\r\n\t\tmaterials_parsed = 0;\r\n\r\n\t\tvar returnedArrayMaterial:Array<any>;\r\n\r\n\t\twhile (materials_parsed < num_materials) {\r\n\t\t\tvar mat_id:number;\r\n\t\t\tmat_id = this._newBlockBytes.readUnsignedInt();\r\n\t\t\treturnedArrayMaterial = this.getAssetByID(mat_id, [MaterialBase.assetType])\r\n\t\t\tif ((!returnedArrayMaterial[0]) && (mat_id > 0)) {\r\n\t\t\t\tthis._blocks[blockID].addError(\"Could not find Material Nr \" + materials_parsed + \" (ID = \" + mat_id + \" ) for this Mesh\");\r\n\t\t\t}\r\n\r\n\t\t\tvar m:MaterialBase = <MaterialBase> returnedArrayMaterial[1];\r\n\r\n\t\t\tmaterials.push(m);\r\n\t\t\tmaterialNames.push(m.name);\r\n\r\n\t\t\tmaterials_parsed++;\r\n\t\t}\r\n\r\n\t\tvar mesh:Mesh = new Mesh(geom, null);\r\n\t\tmesh.transform.matrix3D = mtx;\r\n\r\n\t\tvar returnedArrayParent:Array<any> = this.getAssetByID(par_id, [DisplayObjectContainer.assetType, LightBase.assetType, Mesh.assetType])\r\n\r\n\t\tif (returnedArrayParent[0]) {\r\n\t\t\tvar objC:DisplayObjectContainer = <DisplayObjectContainer> returnedArrayParent[1];\r\n\t\t\tobjC.addChild(mesh);\r\n\t\t\tparentName = objC.name;\r\n\t\t} else if (par_id > 0) {\r\n\t\t\tthis._blocks[blockID].addError(\"Could not find a parent for this Mesh\");\r\n\t\t} else {\r\n\t\t\t//add to the content property\r\n\t\t\t(<DisplayObjectContainer> this._pContent).addChild(mesh);\r\n\t\t}\r\n\r\n\t\tif (materials.length >= 1 && mesh.subMeshes.length == 1) {\r\n\t\t\tmesh.material = materials[0];\r\n\t\t} else if (materials.length > 1) {\r\n\t\t\tvar i:number;\r\n\r\n\t\t\t// Assign each sub-mesh in the mesh a material from the list. If more sub-meshes\r\n\t\t\t// than materials, repeat the last material for all remaining sub-meshes.\r\n\t\t\tfor (i = 0; i < mesh.subMeshes.length; i++) {\r\n\t\t\t\tmesh.subMeshes[i].material = materials[Math.min(materials.length - 1, i)];\r\n\t\t\t}\r\n\t\t}\r\n\t\tif ((this._version[0] == 2) && (this._version[1] == 1)) {\r\n\t\t\tvar props:AWDProperties = this.parseProperties({1:this._matrixNrType, 2:this._matrixNrType, 3:this._matrixNrType, 4:AWDParser.UINT8, 5:AWDParser.BOOL});\r\n\t\t\tmesh.pivot = new Vector3D(<number>props.get(1, 0), <number>props.get(2, 0), <number> props.get(3, 0));\r\n\t\t\tmesh.castsShadows = props.get(5, true);\r\n\t\t} else {\r\n\t\t\tthis.parseProperties(null);\r\n\t\t}\r\n\r\n\t\tmesh.extra = this.parseUserAttributes();\r\n\r\n\t\tthis._pFinalizeAsset(<IAsset> mesh, name);\r\n\t\tthis._blocks[blockID].data = mesh;\r\n\r\n\t\tif (this._debug) {\r\n\t\t\tconsole.log(\"Parsed a Mesh: Name = '\" + name + \"' | Parent-Name = \" + parentName + \"| Geometry-Name = \" + geom.name + \" | SubMeshes = \" + mesh.subMeshes.length + \" | Mat-Names = \" + materialNames.toString());\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t//Block ID 31\r\n\tprivate parseSkyboxInstance(blockID:number):void\r\n\t{\r\n\t\tvar name:string = this.parseVarStr();\r\n\t\tvar cubeTexAddr:number = this._newBlockBytes.readUnsignedInt();\r\n\r\n\t\tvar returnedArrayCubeTex:Array<any> = this.getAssetByID(cubeTexAddr, [TextureBase.assetType], \"CubeTexture\");\r\n\t\tif ((!returnedArrayCubeTex[0]) && (cubeTexAddr != 0))\r\n\t\t\tthis._blocks[blockID].addError(\"Could not find the Cubetexture (ID = \" + cubeTexAddr + \" ) for this Skybox\");\r\n\t\tvar asset:Skybox = new Skybox(<ImageCubeTexture> returnedArrayCubeTex[1]);\r\n\r\n\t\tthis.parseProperties(null)\r\n\t\tasset.extra = this.parseUserAttributes();\r\n\t\tthis._pFinalizeAsset(asset, name);\r\n\t\tthis._blocks[blockID].data = asset;\r\n\t\tif (this._debug)\r\n\t\t\tconsole.log(\"Parsed a Skybox: Name = '\" + name + \"' | CubeTexture-Name = \" + (<ImageCubeTexture> returnedArrayCubeTex[1]).name);\r\n\r\n\t}\r\n\r\n\t//Block ID = 41\r\n\tprivate parseLight(blockID:number):void\r\n\t{\r\n\t\tvar light:LightBase;\r\n\t\tvar newShadowMapper:ShadowMapperBase;\r\n\r\n\t\tvar par_id:number = this._newBlockBytes.readUnsignedInt();\r\n\t\tvar mtx:Matrix3D = this.parseMatrix3D();\r\n\t\tvar name:string = this.parseVarStr();\r\n\t\tvar lightType:number = this._newBlockBytes.readUnsignedByte();\r\n\t\tvar props:AWDProperties = this.parseProperties({1:this._propsNrType, 2:this._propsNrType, 3:AWDParser.COLOR, 4:this._propsNrType, 5:this._propsNrType, 6:AWDParser.BOOL, 7:AWDParser.COLOR, 8:this._propsNrType, 9:AWDParser.UINT8, 10:AWDParser.UINT8, 11:this._propsNrType, 12:AWDParser.UINT16, 21:this._matrixNrType, 22:this._matrixNrType, 23:this._matrixNrType});\r\n\t\tvar shadowMapperType:number = props.get(9, 0);\r\n\t\tvar parentName:string = \"Root (TopLevel)\";\r\n\t\tvar lightTypes:Array<string> = [\"Unsupported LightType\", \"PointLight\", \"DirectionalLight\"];\r\n\t\tvar shadowMapperTypes:Array<string> = [\"No ShadowMapper\", \"DirectionalShadowMapper\", \"NearDirectionalShadowMapper\", \"CascadeShadowMapper\", \"CubeMapShadowMapper\"];\r\n\r\n\t\tif (lightType == 1) {\r\n\t\t\tlight = new PointLight();\r\n\r\n\t\t\t(<PointLight> light).radius = props.get(1, 90000);\r\n\t\t\t(<PointLight> light).fallOff = props.get(2, 100000);\r\n\r\n\t\t\tif (shadowMapperType > 0) {\r\n\t\t\t\tif (shadowMapperType == 4) {\r\n\t\t\t\t\tnewShadowMapper = new CubeMapShadowMapper();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tlight.transform.matrix3D = mtx;\r\n\r\n\t\t}\r\n\r\n\t\tif (lightType == 2) {\r\n\r\n\t\t\tlight = new DirectionalLight(props.get(21, 0), props.get(22, -1), props.get(23, 1));\r\n\r\n\t\t\tif (shadowMapperType > 0) {\r\n\t\t\t\tif (shadowMapperType == 1) {\r\n\t\t\t\t\tnewShadowMapper = new DirectionalShadowMapper();\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//if (shadowMapperType == 2)\r\n\t\t\t\t//  newShadowMapper = new NearDirectionalShadowMapper(props.get(11, 0.5));\r\n\t\t\t\t//if (shadowMapperType == 3)\r\n\t\t\t\t//   newShadowMapper = new CascadeShadowMapper(props.get(12, 3));\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\tlight.color = props.get(3, 0xffffff);\r\n\t\tlight.specular = props.get(4, 1.0);\r\n\t\tlight.diffuse = props.get(5, 1.0);\r\n\t\tlight.ambientColor = props.get(7, 0xffffff);\r\n\t\tlight.ambient = props.get(8, 0.0);\r\n\r\n\t\t// if a shadowMapper has been created, adjust the depthMapSize if needed, assign to light and set castShadows to true\r\n\t\tif (newShadowMapper) {\r\n\t\t\tif (newShadowMapper instanceof CubeMapShadowMapper) {\r\n\t\t\t\tif (props.get(10, 1) != 1) {\r\n\t\t\t\t\tnewShadowMapper.depthMapSize = this._depthSizeDic[props.get(10, 1)];\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (props.get(10, 2) != 2) {\r\n\t\t\t\t\tnewShadowMapper.depthMapSize = this._depthSizeDic[props.get(10, 2)];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tlight.shadowMapper = newShadowMapper;\r\n\t\t\tlight.castsShadows = true;\r\n\t\t}\r\n\r\n\t\tif (par_id != 0) {\r\n\r\n\t\t\tvar returnedArrayParent:Array<any> = this.getAssetByID(par_id, [DisplayObjectContainer.assetType, LightBase.assetType, Mesh.assetType])\r\n\r\n\t\t\tif (returnedArrayParent[0]) {\r\n\t\t\t\t(<DisplayObjectContainer> returnedArrayParent[1]).addChild(light);\r\n\t\t\t\tparentName = (<DisplayObjectContainer> returnedArrayParent[1]).name;\r\n\t\t\t} else {\r\n\t\t\t\tthis._blocks[blockID].addError(\"Could not find a parent for this Light\");\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t//add to the content property\r\n\t\t\t(<DisplayObjectContainer> this._pContent).addChild(light);\r\n\t\t}\r\n\r\n\t\tthis.parseUserAttributes();\r\n\r\n\t\tthis._pFinalizeAsset(< IAsset> light, name);\r\n\r\n\t\tthis._blocks[blockID].data = light;\r\n\r\n\t\tif (this._debug)\r\n\t\t\tconsole.log(\"Parsed a Light: Name = '\" + name + \"' | Type = \" + lightTypes[lightType] + \" | Parent-Name = \" + parentName + \" | ShadowMapper-Type = \" + shadowMapperTypes[shadowMapperType]);\r\n\r\n\t}\r\n\r\n\t//Block ID = 43\r\n\tprivate parseCamera(blockID:number):void\r\n\t{\r\n\r\n\t\tvar par_id:number = this._newBlockBytes.readUnsignedInt();\r\n\t\tvar mtx:Matrix3D = this.parseMatrix3D();\r\n\t\tvar name:string = this.parseVarStr();\r\n\t\tvar parentName:string = \"Root (TopLevel)\";\r\n\t\tvar projection:ProjectionBase;\r\n\r\n\t\tthis._newBlockBytes.readUnsignedByte(); //set as active camera\r\n\t\tthis._newBlockBytes.readShort(); //lengthof lenses - not used yet\r\n\r\n\t\tvar projectiontype:number = this._newBlockBytes.readShort();\r\n\t\tvar props:AWDProperties = this.parseProperties({101:this._propsNrType, 102:this._propsNrType, 103:this._propsNrType, 104:this._propsNrType});\r\n\r\n\t\tswitch (projectiontype) {\r\n\t\t\tcase 5001:\r\n\t\t\t\tprojection = new PerspectiveProjection(props.get(101, 60));\r\n\t\t\t\tbreak;\r\n\t\t\tcase 5002:\r\n\t\t\t\tprojection = new OrthographicProjection(props.get(101, 500));\r\n\t\t\t\tbreak;\r\n\t\t\tcase 5003:\r\n\t\t\t\tprojection = new OrthographicOffCenterProjection(props.get(101, -400), props.get(102, 400), props.get(103, -300), props.get(104, 300));\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tconsole.log(\"unsupportedLenstype\");\r\n\t\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar camera:Camera = new Camera(projection);\r\n\t\tcamera.transform.matrix3D = mtx;\r\n\r\n\t\tvar returnedArrayParent:Array<any> = this.getAssetByID(par_id, [DisplayObjectContainer.assetType, LightBase.assetType, Mesh.assetType])\r\n\r\n\t\tif (returnedArrayParent[0]) {\r\n\r\n\t\t\tvar objC:DisplayObjectContainer = <DisplayObjectContainer> returnedArrayParent[1];\r\n\t\t\tobjC.addChild(camera);\r\n\r\n\t\t\tparentName = objC.name;\r\n\r\n\t\t} else if (par_id > 0) {\r\n\t\t\tthis._blocks[blockID].addError(\"Could not find a parent for this Camera\");\r\n\t\t} else {\r\n\t\t\t//add to the content property\r\n\t\t\t(<DisplayObjectContainer> this._pContent).addChild(camera);\r\n\t\t}\r\n\r\n\t\tcamera.name = name;\r\n\t\tprops = this.parseProperties({1:this._matrixNrType, 2:this._matrixNrType, 3:this._matrixNrType, 4:AWDParser.UINT8});\r\n\t\tcamera.pivot = new Vector3D(props.get(1, 0), props.get(2, 0), props.get(3, 0));\r\n\t\tcamera.extra = this.parseUserAttributes();\r\n\r\n\t\tthis._pFinalizeAsset(camera, name);\r\n\r\n\t\tthis._blocks[blockID].data = camera\r\n\r\n\t\tif (this._debug) {\r\n\t\t\tconsole.log(\"Parsed a Camera: Name = '\" + name + \"' | Projectiontype = \" + projection + \" | Parent-Name = \" + parentName);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t//Block ID = 51\r\n\tprivate parseLightPicker(blockID:number):void\r\n\t{\r\n\t\tvar name:string = this.parseVarStr();\r\n\t\tvar numLights:number = this._newBlockBytes.readUnsignedShort();\r\n\t\tvar lightsArray:Array<LightBase> = new Array<LightBase>();\r\n\t\tvar k:number = 0;\r\n\t\tvar lightID:number = 0;\r\n\r\n\t\tvar returnedArrayLight:Array<any>;\r\n\t\tvar lightsArrayNames:Array<string> = new Array<string>();\r\n\r\n\t\tfor (k = 0; k < numLights; k++) {\r\n\t\t\tlightID = this._newBlockBytes.readUnsignedInt();\r\n\t\t\treturnedArrayLight = this.getAssetByID(lightID, [LightBase.assetType])\r\n\r\n\t\t\tif (returnedArrayLight[0]) {\r\n\t\t\t\tlightsArray.push(<LightBase> returnedArrayLight[1]);\r\n\t\t\t\tlightsArrayNames.push(( <LightBase> returnedArrayLight[1]).name);\r\n\r\n\t\t\t} else {\r\n\t\t\t\tthis._blocks[blockID].addError(\"Could not find a Light Nr \" + k + \" (ID = \" + lightID + \" ) for this LightPicker\");\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (lightsArray.length == 0) {\r\n\t\t\tthis._blocks[blockID].addError(\"Could not create this LightPicker, cause no Light was found.\");\r\n\t\t\tthis.parseUserAttributes();\r\n\t\t\treturn; //return without any more parsing for this block\r\n\t\t}\r\n\r\n\t\tvar lightPick:LightPickerBase = new StaticLightPicker(lightsArray);\r\n\t\tlightPick.name = name;\r\n\r\n\t\tthis.parseUserAttributes();\r\n\t\tthis._pFinalizeAsset(<IAsset> lightPick, name);\r\n\r\n\t\tthis._blocks[blockID].data = lightPick\r\n\t\tif (this._debug) {\r\n\t\t\tconsole.log(\"Parsed a StaticLightPicker: Name = '\" + name + \"' | Texture-Name = \" + lightsArrayNames.toString());\r\n\t\t}\r\n\t}\r\n\r\n\t//Block ID = 81\r\n\tprivate parseMaterial(blockID:number):void\r\n\t{\r\n\t\t// TODO: not used\r\n\t\t////blockLength = block.len;\r\n\t\tvar name:string;\r\n\t\tvar type:number;\r\n\t\tvar props:AWDProperties;\r\n\t\tvar mat:MethodMaterial;\r\n\t\tvar attributes:Object;\r\n\t\tvar finalize:boolean;\r\n\t\tvar num_methods:number;\r\n\t\tvar methods_parsed:number;\r\n\t\tvar returnedArray:Array<any>;\r\n\r\n\t\tname = this.parseVarStr();\r\n\t\ttype = this._newBlockBytes.readUnsignedByte();\r\n\t\tnum_methods = this._newBlockBytes.readUnsignedByte();\r\n\r\n\t\t// Read material numerical properties\r\n\t\t// (1=color, 2=bitmap url, 10=alpha, 11=alpha_blending, 12=alpha_threshold, 13=repeat)\r\n\t\tprops = this.parseProperties({ 1:AWDParser.INT32, 2:AWDParser.BADDR, 10:this._propsNrType, 11:AWDParser.BOOL, 12:this._propsNrType, 13:AWDParser.BOOL});\r\n\r\n\t\tmethods_parsed = 0;\r\n\t\twhile (methods_parsed < num_methods) {\r\n\t\t\tvar method_type:number;\r\n\r\n\t\t\tmethod_type = this._newBlockBytes.readUnsignedShort();\r\n\t\t\tthis.parseProperties(null);\r\n\t\t\tthis.parseUserAttributes();\r\n\t\t\tmethods_parsed += 1;\r\n\t\t}\r\n\t\tvar debugString:string = \"\";\r\n\t\tattributes = this.parseUserAttributes();\r\n\t\tif (type === 1) { // Color material\r\n\t\t\tdebugString += \"Parsed a ColorMaterial(SinglePass): Name = '\" + name + \"' | \";\r\n\t\t\tvar color:number;\r\n\t\t\tcolor = props.get(1, 0xffffff);\r\n\t\t\tif (this.materialMode < 2) {\r\n\t\t\t\tmat = new MethodMaterial(color, props.get(10, 1.0));\r\n\t\t\t} else {\r\n\t\t\t\tmat = new MethodMaterial(color);\r\n\t\t\t\tmat.mode = MethodMaterialMode.MULTI_PASS;\r\n\t\t\t}\r\n\t\t} else if (type === 2) {\r\n\t\t\tvar tex_addr:number = props.get(2, 0);\r\n\r\n\t\t\treturnedArray = this.getAssetByID(tex_addr, [TextureBase.assetType]);\r\n\r\n\t\t\tif ((!returnedArray[0]) && (tex_addr > 0))\r\n\t\t\t\tthis._blocks[blockID].addError(\"Could not find the DiffsueTexture (ID = \" + tex_addr + \" ) for this Material\");\r\n\r\n\t\t\tmat = new MethodMaterial(<Texture2DBase> returnedArray[1]);\r\n\r\n\t\t\tif (this.materialMode < 2) {\r\n\t\t\t\tmat.alphaBlending = props.get(11, false);\r\n\t\t\t\tmat.alpha = props.get(10, 1.0);\r\n\t\t\t\tdebugString += \"Parsed a MethodMaterial(SinglePass): Name = '\" + name + \"' | Texture-Name = \" + mat.name;\r\n\t\t\t} else {\r\n\t\t\t\tmat.mode = MethodMaterialMode.MULTI_PASS;\r\n\t\t\t\tdebugString += \"Parsed a MethodMaterial(MultiPass): Name = '\" + name + \"' | Texture-Name = \" + mat.name;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tmat.extra = attributes;\r\n\t\tmat.alphaThreshold = props.get(12, 0.0);\r\n\t\tmat.repeat = props.get(13, false);\r\n\t\tthis._pFinalizeAsset(<IAsset> mat, name);\r\n\t\tthis._blocks[blockID].data = mat;\r\n\r\n\t\tif (this._debug) {\r\n\t\t\tconsole.log(debugString);\r\n\r\n\t\t}\r\n\t}\r\n\r\n\t// Block ID = 81 AWD2.1\r\n\tprivate parseMaterial_v1(blockID:number):void\r\n\t{\r\n\t\tvar mat:MethodMaterial;\r\n\t\tvar normalTexture:Texture2DBase;\r\n\t\tvar specTexture:Texture2DBase;\r\n\t\tvar returnedArray:Array<any>;\r\n\r\n\t\tvar name:string = this.parseVarStr();\r\n\t\tvar type:number = this._newBlockBytes.readUnsignedByte();\r\n\t\tvar num_methods:number = this._newBlockBytes.readUnsignedByte();\r\n\t\tvar props:AWDProperties = this.parseProperties({1:AWDParser.UINT32, 2:AWDParser.BADDR, 3:AWDParser.BADDR, 4:AWDParser.UINT8, 5:AWDParser.BOOL, 6:AWDParser.BOOL, 7:AWDParser.BOOL, 8:AWDParser.BOOL, 9:AWDParser.UINT8, 10:this._propsNrType, 11:AWDParser.BOOL, 12:this._propsNrType, 13:AWDParser.BOOL, 15:this._propsNrType, 16:AWDParser.UINT32, 17:AWDParser.BADDR, 18:this._propsNrType, 19:this._propsNrType, 20:AWDParser.UINT32, 21:AWDParser.BADDR, 22:AWDParser.BADDR});\r\n\t\tvar spezialType:number = props.get(4, 0);\r\n\t\tvar debugString:string = \"Parsed Material \";\r\n\r\n\t\tif (spezialType >= 2) {//this is no supported material\r\n\t\t\tthis._blocks[blockID].addError(\"Material-spezialType '\" + spezialType + \"' is not supported, can only be 0:singlePass, 1:MultiPass !\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (type <= 2) {// Color material\r\n\t\t\tif (this.materialMode == 1)\r\n\t\t\t\tspezialType = 0;\r\n\t\t\telse if (this.materialMode == 2)\r\n\t\t\t\tspezialType = 1;\r\n\r\n\t\t\tif (spezialType < 2) {//this is SinglePass or MultiPass\r\n\r\n\t\t\t\tif (type == 1) {// Color material\r\n\t\t\t\t\tvar color:number = props.get(1, 0xcccccc);//TODO temporarily swapped so that diffuse color goes to ambient\r\n\r\n\t\t\t\t\tif (spezialType == 1) {//\tMultiPassMaterial\r\n\t\t\t\t\t\tmat = new MethodMaterial(color);\r\n\t\t\t\t\t\tmat.mode = MethodMaterialMode.MULTI_PASS;\r\n\t\t\t\t\t\tdebugString += \"Parsed a ColorMaterial(MultiPass): Name = '\" + name + \"' | \";\r\n\r\n\t\t\t\t\t} else { //\tSinglePassMaterial\r\n\t\t\t\t\t\tmat = new MethodMaterial(color, props.get(10, 1.0));\r\n\t\t\t\t\t\tmat.alphaBlending = props.get(11, false);\r\n\t\t\t\t\t\tdebugString += \"Parsed a ColorMaterial(SinglePass): Name = '\" + name + \"' | \";\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else if (type == 2) {// texture material\r\n\t\t\t\t\tvar tex_addr:number = props.get(2, 0);//TODO temporarily swapped so that diffuse texture goes to ambient\r\n\t\t\t\t\treturnedArray = this.getAssetByID(tex_addr, [TextureBase.assetType]);\r\n\r\n\t\t\t\t\tif ((!returnedArray[0]) && (tex_addr > 0))\r\n\t\t\t\t\t\tthis._blocks[blockID].addError(\"Could not find the AmbientTexture (ID = \" + tex_addr + \" ) for this MethodMaterial\");\r\n\r\n\t\t\t\t\tvar texture:Texture2DBase = returnedArray[1];\r\n\r\n\t\t\t\t\tmat = new MethodMaterial(texture);\r\n\r\n\t\t\t\t\tif (spezialType == 1) {// MultiPassMaterial\r\n\t\t\t\t\t\tmat.mode = MethodMaterialMode.MULTI_PASS;\r\n\r\n\t\t\t\t\t\tdebugString += \"Parsed a MethodMaterial(MultiPass): Name = '\" + name + \"' | Texture-Name = \" + texture.name;\r\n\t\t\t\t\t} else {//\tSinglePassMaterial\r\n\t\t\t\t\t\tmat.alpha = props.get(10, 1.0);\r\n\t\t\t\t\t\tmat.alphaBlending = props.get(11, false);\r\n\r\n\t\t\t\t\t\tdebugString += \"Parsed a MethodMaterial(SinglePass): Name = '\" + name + \"' | Texture-Name = \" + texture.name;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar diffuseTexture:Texture2DBase;\r\n\t\t\t\tvar diffuseTex_addr:number = props.get(17, 0);\r\n\r\n\t\t\t\treturnedArray = this.getAssetByID(diffuseTex_addr, [TextureBase.assetType]);\r\n\r\n\t\t\t\tif ((!returnedArray[0]) && (diffuseTex_addr != 0)) {\r\n\t\t\t\t\tthis._blocks[blockID].addError(\"Could not find the DiffuseTexture (ID = \" + diffuseTex_addr + \" ) for this MethodMaterial\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (returnedArray[0])\r\n\t\t\t\t\tdiffuseTexture = returnedArray[1];\r\n\r\n\t\t\t\tif (diffuseTexture) {\r\n\t\t\t\t\tmat.diffuseTexture = diffuseTexture;\r\n\t\t\t\t\tdebugString += \" | DiffuseTexture-Name = \" + diffuseTexture.name;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar normalTex_addr:number = props.get(3, 0);\r\n\r\n\t\t\t\treturnedArray = this.getAssetByID(normalTex_addr, [TextureBase.assetType]);\r\n\r\n\t\t\t\tif ((!returnedArray[0]) && (normalTex_addr != 0)) {\r\n\t\t\t\t\tthis._blocks[blockID].addError(\"Could not find the NormalTexture (ID = \" + normalTex_addr + \" ) for this MethodMaterial\");\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (returnedArray[0]) {\r\n\t\t\t\t\tnormalTexture = returnedArray[1];\r\n\t\t\t\t\tdebugString += \" | NormalTexture-Name = \" + normalTexture.name;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar specTex_addr:number = props.get(21, 0);\r\n\t\t\t\treturnedArray = this.getAssetByID(specTex_addr, [TextureBase.assetType]);\r\n\r\n\t\t\t\tif ((!returnedArray[0]) && (specTex_addr != 0)) {\r\n\t\t\t\t\tthis._blocks[blockID].addError(\"Could not find the SpecularTexture (ID = \" + specTex_addr + \" ) for this MethodMaterial\");\r\n\t\t\t\t}\r\n\t\t\t\tif (returnedArray[0]) {\r\n\t\t\t\t\tspecTexture = returnedArray[1];\r\n\t\t\t\t\tdebugString += \" | SpecularTexture-Name = \" + specTexture.name;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar lightPickerAddr:number = props.get(22, 0);\r\n\t\t\t\treturnedArray = this.getAssetByID(lightPickerAddr, [LightPickerBase.assetType])\r\n\r\n\t\t\t\tif ((!returnedArray[0]) && (lightPickerAddr)) {\r\n\t\t\t\t\tthis._blocks[blockID].addError(\"Could not find the LightPicker (ID = \" + lightPickerAddr + \" ) for this MethodMaterial\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmat.lightPicker = <LightPickerBase> returnedArray[1];\r\n\t\t\t\t\t//debugString+=\" | Lightpicker-Name = \"+LightPickerBase(returnedArray[1]).name;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmat.smooth = props.get(5, true);\r\n\t\t\t\tmat.mipmap = props.get(6, true);\r\n\t\t\t\tmat.bothSides = props.get(7, false);\r\n\t\t\t\tmat.alphaPremultiplied = props.get(8, false);\r\n\t\t\t\tmat.blendMode = this.blendModeDic[props.get(9, 0)];\r\n\t\t\t\tmat.repeat = props.get(13, false);\r\n\r\n\t\t\t\tif (normalTexture)\r\n\t\t\t\t\tmat.normalMap = normalTexture;\r\n\r\n\t\t\t\tif (specTexture)\r\n\t\t\t\t\tmat.specularMap = specTexture;\r\n\r\n\t\t\t\tmat.alphaThreshold = props.get(12, 0.0);\r\n\t\t\t\tmat.ambient = props.get(15, 1.0);\r\n\t\t\t\tmat.diffuseColor = props.get(16, 0xffffff);\r\n\t\t\t\tmat.specular = props.get(18, 1.0);\r\n\t\t\t\tmat.gloss = props.get(19, 50);\r\n\t\t\t\tmat.specularColor = props.get(20, 0xffffff);\r\n\r\n\t\t\t\tvar methods_parsed:number = 0;\r\n\t\t\t\tvar targetID:number;\r\n\r\n\t\t\t\twhile (methods_parsed < num_methods) {\r\n\t\t\t\t\tvar method_type:number;\r\n\t\t\t\t\tmethod_type = this._newBlockBytes.readUnsignedShort();\r\n\r\n\t\t\t\t\tprops = this.parseProperties({\r\n\t\t\t\t\t\t1: AWDParser.BADDR,\r\n\t\t\t\t\t\t2: AWDParser.BADDR,\r\n\t\t\t\t\t\t3: AWDParser.BADDR,\r\n\t\t\t\t\t\t101: this._propsNrType,\r\n\t\t\t\t\t\t102: this._propsNrType,\r\n\t\t\t\t\t\t103: this._propsNrType,\r\n\t\t\t\t\t\t201: AWDParser.UINT32,\r\n\t\t\t\t\t\t202: AWDParser.UINT32,\r\n\t\t\t\t\t\t301: AWDParser.UINT16,\r\n\t\t\t\t\t\t302: AWDParser.UINT16,\r\n\t\t\t\t\t\t401: AWDParser.UINT8,\r\n\t\t\t\t\t\t402: AWDParser.UINT8,\r\n\t\t\t\t\t\t601: AWDParser.COLOR,\r\n\t\t\t\t\t\t602: AWDParser.COLOR,\r\n\t\t\t\t\t\t701: AWDParser.BOOL,\r\n\t\t\t\t\t\t702: AWDParser.BOOL,\r\n\t\t\t\t\t\t801: AWDParser.MTX4x4\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tswitch (method_type) {\r\n\t\t\t\t\t\tcase 999: //wrapper-Methods that will load a previous parsed EffektMethod returned\r\n\r\n\t\t\t\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t\t\t\t\treturnedArray = this.getAssetByID(targetID, [EffectMethodBase.assetType]);\r\n\r\n\t\t\t\t\t\t\tif (!returnedArray[0]) {\r\n\t\t\t\t\t\t\t\tthis._blocks[blockID].addError(\"Could not find the EffectMethod (ID = \" + targetID + \" ) for this Material\");\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tmat.addEffectMethod(returnedArray[1]);\r\n\r\n\t\t\t\t\t\t\t\tdebugString += \" | EffectMethod-Name = \" + (<EffectMethodBase> returnedArray[1]).name;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase 998: //wrapper-Methods that will load a previous parsed ShadowMapMethod\r\n\r\n\t\t\t\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t\t\t\t\treturnedArray = this.getAssetByID(targetID, [ShadowMapMethodBase.assetType]);\r\n\r\n\t\t\t\t\t\t\tif (!returnedArray[0]) {\r\n\t\t\t\t\t\t\t\tthis._blocks[blockID].addError(\"Could not find the ShadowMethod (ID = \" + targetID + \" ) for this Material\");\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tmat.shadowMethod = returnedArray[1];\r\n\t\t\t\t\t\t\t\tdebugString += \" | ShadowMethod-Name = \" + (<ShadowMethodBase> returnedArray[1]).name;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase 1: //EnvMapAmbientMethod\r\n\t\t\t\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t\t\t\t\treturnedArray = this.getAssetByID(targetID, [TextureBase.assetType], \"CubeTexture\");\r\n\t\t\t\t\t\t\tif (!returnedArray[0])\r\n\t\t\t\t\t\t\t\tthis._blocks[blockID].addError(\"Could not find the EnvMap (ID = \" + targetID + \" ) for this EnvMapAmbientMethodMaterial\");\r\n\t\t\t\t\t\t\tmat.ambientMethod = new AmbientEnvMapMethod(returnedArray[1]);\r\n\t\t\t\t\t\t\tdebugString += \" | AmbientEnvMapMethod | EnvMap-Name =\" + (<CubeTextureBase> returnedArray[1]).name;\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase 51: //DepthDiffuseMethod\r\n\t\t\t\t\t\t\tmat.diffuseMethod = new DiffuseDepthMethod();\r\n\t\t\t\t\t\t\tdebugString += \" | DiffuseDepthMethod\";\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 52: //GradientDiffuseMethod\r\n\t\t\t\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t\t\t\t\treturnedArray = this.getAssetByID(targetID, [TextureBase.assetType]);\r\n\t\t\t\t\t\t\tif (!returnedArray[0])\r\n\t\t\t\t\t\t\t\tthis._blocks[blockID].addError(\"Could not find the GradientDiffuseTexture (ID = \" + targetID + \" ) for this GradientDiffuseMethod\");\r\n\t\t\t\t\t\t\tmat.diffuseMethod = new DiffuseGradientMethod(returnedArray[1]);\r\n\t\t\t\t\t\t\tdebugString += \" | DiffuseGradientMethod | GradientDiffuseTexture-Name =\" + (<Texture2DBase> returnedArray[1]).name;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 53: //WrapDiffuseMethod\r\n\t\t\t\t\t\t\tmat.diffuseMethod = new DiffuseWrapMethod(props.get(101, 5));\r\n\t\t\t\t\t\t\tdebugString += \" | DiffuseWrapMethod\";\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 54: //LightMapDiffuseMethod\r\n\t\t\t\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t\t\t\t\treturnedArray = this.getAssetByID(targetID, [TextureBase.assetType]);\r\n\t\t\t\t\t\t\tif (!returnedArray[0])\r\n\t\t\t\t\t\t\t\tthis._blocks[blockID].addError(\"Could not find the LightMap (ID = \" + targetID + \" ) for this LightMapDiffuseMethod\");\r\n\t\t\t\t\t\t\tmat.diffuseMethod = new DiffuseLightMapMethod(returnedArray[1], this.blendModeDic[props.get(401, 10)], false, mat.diffuseMethod);\r\n\t\t\t\t\t\t\tdebugString += \" | DiffuseLightMapMethod | LightMapTexture-Name =\" + (<Texture2DBase> returnedArray[1]).name;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 55: //CelDiffuseMethod\r\n\t\t\t\t\t\t\tmat.diffuseMethod = new DiffuseCelMethod(props.get(401, 3), mat.diffuseMethod);\r\n\t\t\t\t\t\t\t(<DiffuseCelMethod> mat.diffuseMethod).smoothness = props.get(101, 0.1);\r\n\t\t\t\t\t\t\tdebugString += \" | DiffuseCelMethod\";\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 56: //SubSurfaceScatteringMethod\r\n\t\t\t\t\t\t\t//\t\t\t\t\t\t\tmat.diffuseMethod = new DiffuseSubSurfaceMethod(); //depthMapSize and depthMapOffset ?\r\n\t\t\t\t\t\t\t//\t\t\t\t\t\t\t(<DiffuseSubSurfaceMethod> mat.diffuseMethod).scattering = props.get(101, 0.2);\r\n\t\t\t\t\t\t\t//\t\t\t\t\t\t\t(<DiffuseSubSurfaceMethod> mat.diffuseMethod).translucency = props.get(102, 1);\r\n\t\t\t\t\t\t\t//\t\t\t\t\t\t\t(<DiffuseSubSurfaceMethod> mat.diffuseMethod).scatterColor = props.get(601, 0xffffff);\r\n\t\t\t\t\t\t\t//\t\t\t\t\t\t\tdebugString += \" | DiffuseSubSurfaceMethod\";\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase 101: //AnisotropicSpecularMethod\r\n\t\t\t\t\t\t\tmat.specularMethod = new SpecularAnisotropicMethod();\r\n\t\t\t\t\t\t\tdebugString += \" | SpecularAnisotropicMethod\";\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 102: //SpecularPhongMethod\r\n\t\t\t\t\t\t\tmat.specularMethod = new SpecularPhongMethod();\r\n\t\t\t\t\t\t\tdebugString += \" | SpecularPhongMethod\";\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 103: //CellSpecularMethod\r\n\t\t\t\t\t\t\tmat.specularMethod = new SpecularCelMethod(props.get(101, 0.5), mat.specularMethod);\r\n\t\t\t\t\t\t\t(<SpecularCelMethod> mat.specularMethod).smoothness = props.get(102, 0.1);\r\n\t\t\t\t\t\t\tdebugString += \" | SpecularCelMethod\";\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 104: //SpecularFresnelMethod\r\n\t\t\t\t\t\t\tmat.specularMethod = new SpecularFresnelMethod(props.get(701, true), mat.specularMethod);\r\n\t\t\t\t\t\t\t(<SpecularFresnelMethod> mat.specularMethod).fresnelPower = props.get(101, 5);\r\n\t\t\t\t\t\t\t(<SpecularFresnelMethod> mat.specularMethod).normalReflectance = props.get(102, 0.1);\r\n\t\t\t\t\t\t\tdebugString += \" | SpecularFresnelMethod\";\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 151://HeightMapNormalMethod - thios is not implemented for now, but might appear later\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 152: //SimpleWaterNormalMethod\r\n\t\t\t\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t\t\t\t\treturnedArray = this.getAssetByID(targetID, [TextureBase.assetType]);\r\n\t\t\t\t\t\t\tif (!returnedArray[0])\r\n\t\t\t\t\t\t\t\tthis._blocks[blockID].addError(\"Could not find the SecoundNormalMap (ID = \" + targetID + \" ) for this SimpleWaterNormalMethod\");\r\n\t\t\t\t\t\t\tif (!mat.normalMap)\r\n\t\t\t\t\t\t\t\tthis._blocks[blockID].addError(\"Could not find a normal Map on this Material to use with this SimpleWaterNormalMethod\");\r\n\r\n\t\t\t\t\t\t\tmat.normalMap = returnedArray[1];\r\n\t\t\t\t\t\t\tmat.normalMethod = new NormalSimpleWaterMethod(mat.normalMap, returnedArray[1]);\r\n\t\t\t\t\t\t\tdebugString += \" | NormalSimpleWaterMethod | Second-NormalTexture-Name = \" + (<Texture2DBase> returnedArray[1]).name;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.parseUserAttributes();\r\n\t\t\t\t\tmethods_parsed += 1;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t// todo: we should not need this anymore (if using texture-atlas)\r\n\t\telse if ((type>=3)&&(type<=7)){\r\n\t\t\t// if this is a curve material, we create it, finalize it, assign it to block-cache and return and return.\r\n\t\t\tvar color:number = props.get(1, 0xcccccc);\r\n\t\t\tdebugString+=color;\r\n\r\n\t\t\tvar diffuseTexture:Texture2DBase;\r\n\t\t\tvar diffuseTex_addr:number = props.get(2, 0);\r\n\r\n\t\t\treturnedArray = this.getAssetByID(diffuseTex_addr, [TextureBase.assetType]);\r\n\r\n\t\t\tif ((!returnedArray[0]) && (diffuseTex_addr != 0)) {\r\n\t\t\t\tthis._blocks[blockID].addError(\"Could not find the DiffuseTexture (ID = \" + diffuseTex_addr + \" ) for this MethodMaterial\");\r\n\t\t\t\tdiffuseTexture = DefaultMaterialManager.getDefaultTexture();\r\n\t\t\t}\r\n\r\n\t\t\tif (returnedArray[0])\r\n\t\t\t\tdiffuseTexture = returnedArray[1];\r\n\t\t\tvar curve_mat:CurveMaterial = new CurveMaterial(diffuseTexture);\r\n\t\t\t//debugString+= \" alpha = \"+props.get(10, 1.0)+\" \";\r\n\t\t\tdebugString+= \" texture = \"+diffuseTex_addr+\" \";\r\n\t\t\tcurve_mat.bothSides = true;\r\n\t\t\tcurve_mat.preserveAlpha = true;\r\n\t\t\tcurve_mat.alphaBlending = true;\r\n\t\t\tcurve_mat.extra = this.parseUserAttributes();\r\n\t\t\tthis._pFinalizeAsset(<IAsset> curve_mat, name);\r\n\t\t\tthis._blocks[blockID].data = curve_mat;\r\n\t\t\tif (this._debug)\r\n\t\t\t\tconsole.log(debugString);\r\n\t\t\treturn;\r\n\r\n\t\t}\r\n\t\tmat.extra = this.parseUserAttributes();\r\n\t\tthis._pFinalizeAsset(<IAsset> mat, name);\r\n\r\n\t\tthis._blocks[blockID].data = mat;\r\n\t\tif (this._debug) {\r\n\t\t\tconsole.log(debugString);\r\n\t\t}\r\n\t}\r\n\r\n\t//Block ID = 82\r\n\tprivate parseTexture(blockID:number):void\r\n\t{\r\n\r\n\t\tvar asset:Texture2DBase;\r\n\r\n\t\tthis._blocks[blockID].name = this.parseVarStr();\r\n\r\n\t\tvar type:number = this._newBlockBytes.readUnsignedByte();\r\n\t\tvar data_len:number;\r\n\r\n\t\tthis._texture_users[this._cur_block_id.toString()] = [];\r\n\r\n\t\t// External\r\n\t\tif (type == 0) {\r\n\t\t\tdata_len = this._newBlockBytes.readUnsignedInt();\r\n\t\t\tvar url:string;\r\n\t\t\turl = this._newBlockBytes.readUTFBytes(data_len);\r\n\t\t\tthis._pAddDependency(this._cur_block_id.toString(), new URLRequest(url), false, null, true);\r\n\r\n\t\t} else {\r\n\t\t\tdata_len = this._newBlockBytes.readUnsignedInt();\r\n\r\n\t\t\tvar data:ByteArray;\r\n\t\t\tdata = new ByteArray();\r\n\t\t\tthis._newBlockBytes.readBytes(data, 0, data_len);\r\n\r\n\t\t\t//\r\n\t\t\t// AWD3Parserutils - Fix for FireFox Bug: https://bugzilla.mozilla.org/show_bug.cgi?id=715075 .\r\n\t\t\t//\r\n\t\t\t// Converting data to image here instead of parser - fix FireFox bug where image width / height is 0 when created from data\r\n\t\t\t// This gives the browser time to initialise image width / height.\r\n\r\n\t\t\tthis._pAddDependency(this._cur_block_id.toString(), null, false, ParserUtils.byteArrayToImage(data), true);\r\n\t\t\t//this._pAddDependency(this._cur_block_id.toString(), null, false, data, true);\r\n\r\n\t\t}\r\n\r\n\t\t// Ignore for now\r\n\t\tthis.parseProperties(null);\r\n\t\tthis._blocks[blockID].extras = this.parseUserAttributes();\r\n\t\tthis._pPauseAndRetrieveDependencies();\r\n\t\tthis._blocks[blockID].data = asset;\r\n\r\n\t\tif (this._debug) {\r\n\t\t\tvar textureStylesNames:Array<string> = [\"external\", \"embed\"]\r\n\t\t\tconsole.log(\"Start parsing a \" + textureStylesNames[type] + \" Bitmap for Texture\");\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t//Block ID = 83\r\n\tprivate parseCubeTexture(blockID:number):void\r\n\t{\r\n\t\t//blockLength = block.len;\r\n\t\tvar data_len:number;\r\n\t\tvar asset:CubeTextureBase;\r\n\t\tvar i:number;\r\n\r\n\t\tthis._cubeTextures = new Array<any>();\r\n\t\tthis._texture_users[ this._cur_block_id.toString() ] = [];\r\n\r\n\t\tvar type:number = this._newBlockBytes.readUnsignedByte();\r\n\r\n\t\tthis._blocks[blockID].name = this.parseVarStr();\r\n\r\n\t\tfor (i = 0; i < 6; i++) {\r\n\t\t\tthis._texture_users[this._cur_block_id.toString()] = [];\r\n\t\t\tthis._cubeTextures.push(null);\r\n\r\n\t\t\t// External\r\n\t\t\tif (type == 0) {\r\n\t\t\t\tdata_len = this._newBlockBytes.readUnsignedInt();\r\n\t\t\t\tvar url:string;\r\n\t\t\t\turl = this._newBlockBytes.readUTFBytes(data_len);\r\n\r\n\t\t\t\tthis._pAddDependency(this._cur_block_id.toString() + \"#\" + i, new URLRequest(url), false, null, true);\r\n\t\t\t} else {\r\n\r\n\t\t\t\tdata_len = this._newBlockBytes.readUnsignedInt();\r\n\t\t\t\tvar data:ByteArray;\r\n\t\t\t\tdata = new ByteArray();\r\n\r\n\t\t\t\tthis._newBlockBytes.readBytes(data, 0, data_len);\r\n\r\n\t\t\t\tthis._pAddDependency(this._cur_block_id.toString() + \"#\" + i, null, false, ParserUtils.byteArrayToImage(data), true);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Ignore for now\r\n\t\tthis.parseProperties(null);\r\n\t\tthis._blocks[blockID].extras = this.parseUserAttributes();\r\n\t\tthis._pPauseAndRetrieveDependencies();\r\n\t\tthis._blocks[blockID].data = asset;\r\n\r\n\t\tif (this._debug) {\r\n\t\t\tvar textureStylesNames:Array<string> = [\"external\", \"embed\"]\r\n\t\t\tconsole.log(\"Start parsing 6 \" + textureStylesNames[type] + \" Bitmaps for CubeTexture\");\r\n\t\t}\r\n\t}\r\n\r\n\t//Block ID = 91\r\n\tprivate parseSharedMethodBlock(blockID:number):void\r\n\t{\r\n\t\tvar asset:EffectMethodBase;\r\n\r\n\t\tthis._blocks[blockID].name = this.parseVarStr();\r\n\t\tasset = this.parseSharedMethodList(blockID);\r\n\t\tthis.parseUserAttributes();\r\n\t\tthis._blocks[blockID].data = asset;\r\n\t\tthis._pFinalizeAsset(<IAsset> asset, this._blocks[blockID].name);\r\n\t\tthis._blocks[blockID].data = asset;\r\n\r\n\t\tif (this._debug) {\r\n\t\t\tconsole.log(\"Parsed a EffectMethod: Name = \" + asset.name + \" Type = \" + asset);\r\n\t\t}\r\n\t}\r\n\r\n\t//Block ID = 92\r\n\tprivate parseShadowMethodBlock(blockID:number):void\r\n\t{\r\n\t\tvar type:number;\r\n\t\tvar data_len:number;\r\n\t\tvar asset:ShadowMethodBase;\r\n\t\tvar shadowLightID:number;\r\n\t\tthis._blocks[blockID].name = this.parseVarStr();\r\n\r\n\t\tshadowLightID = this._newBlockBytes.readUnsignedInt();\r\n\t\tvar returnedArray:Array<any> = this.getAssetByID(shadowLightID, [LightBase.assetType]);\r\n\r\n\t\tif (!returnedArray[0]) {\r\n\t\t\tthis._blocks[blockID].addError(\"Could not find the TargetLight (ID = \" + shadowLightID + \" ) for this ShadowMethod - ShadowMethod not created\");\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tasset = this.parseShadowMethodList(<LightBase> returnedArray[1], blockID);\r\n\r\n\t\tif (!asset)\r\n\t\t\treturn;\r\n\r\n\t\tthis.parseUserAttributes(); // Ignore for now\r\n\t\tthis._pFinalizeAsset(<IAsset> asset, this._blocks[blockID].name);\r\n\t\tthis._blocks[blockID].data = asset;\r\n\r\n\t\tif (this._debug) {\r\n\t\t\tconsole.log(\"Parsed a ShadowMapMethodMethod: Name = \" + asset.name + \" | Type = \" + asset + \" | Light-Name = \", ( <LightBase> returnedArray[1] ).name);\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t//Block ID = 253\r\n\tprivate parseCommand(blockID:number):void\r\n\t{\r\n\t\tvar hasBlocks:boolean = ( this._newBlockBytes.readUnsignedByte() == 1 );\r\n\t\tvar par_id:number = this._newBlockBytes.readUnsignedInt();\r\n\t\tvar mtx:Matrix3D = this.parseMatrix3D();\r\n\t\tvar name:string = this.parseVarStr();\r\n\r\n\t\tvar parentObject:DisplayObjectContainer;\r\n\t\tvar targetObject:DisplayObjectContainer;\r\n\r\n\t\tvar returnedArray:Array<any> = this.getAssetByID(par_id, [DisplayObjectContainer.assetType, LightBase.assetType, Mesh.assetType]);\r\n\r\n\t\tif (returnedArray[0]) {\r\n\t\t\tparentObject = <DisplayObjectContainer> returnedArray[1];\r\n\t\t}\r\n\r\n\t\tvar numCommands:number = this._newBlockBytes.readShort();\r\n\t\tvar typeCommand:number = this._newBlockBytes.readShort();\r\n\r\n\t\tvar props:AWDProperties = this.parseProperties({1:AWDParser.BADDR});\r\n\r\n\t\tswitch (typeCommand) {\r\n\t\t\tcase 1:\r\n\r\n\t\t\t\tvar targetID:number = props.get(1, 0);\r\n\t\t\t\t//var returnedArrayTarget:Array<any> = this.getAssetByID(targetID, [LightBase.assetType, TextureProjector.assetType]); //for no only light is requested!!!!\r\n\t\t\t\tvar returnedArrayTarget:Array<any> = this.getAssetByID(targetID, [LightBase.assetType]); //for no only light is requested!!!!\r\n\r\n\t\t\t\tif ((!returnedArrayTarget[0]) && (targetID != 0)) {\r\n\t\t\t\t\tthis._blocks[blockID].addError(\"Could not find the light (ID = \" + targetID + \" ( for this CommandBock!\");\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttargetObject = returnedArrayTarget[1];\r\n\r\n\t\t\t\tif (parentObject) {\r\n\t\t\t\t\tparentObject.addChild(targetObject);\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttargetObject.transform.matrix3D = mtx;\r\n\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tif (targetObject) {\r\n\t\t\tprops = this.parseProperties({1:this._matrixNrType, 2:this._matrixNrType, 3:this._matrixNrType, 4:AWDParser.UINT8});\r\n\r\n\t\t\ttargetObject.pivot = new Vector3D(props.get(1, 0), props.get(2, 0), props.get(3, 0));\r\n\t\t\ttargetObject.extra = this.parseUserAttributes();\r\n\r\n\t\t}\r\n\t\tthis._blocks[blockID].data = targetObject\r\n\r\n\t\tif (this._debug) {\r\n\t\t\tconsole.log(\"Parsed a CommandBlock: Name = '\" + name);\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t//blockID 255\r\n\tprivate parseMetaData(blockID:number):void\r\n\t{\r\n\t\tvar props:AWDProperties = this.parseProperties({1:AWDParser.UINT32, 2:AWDParser.AWDSTRING, 3:AWDParser.AWDSTRING, 4:AWDParser.AWDSTRING, 5:AWDParser.AWDSTRING});\r\n\r\n\t\tif (this._debug) {\r\n\t\t\tconsole.log(\"Parsed a MetaDataBlock: TimeStamp         = \" + props.get(1, 0));\r\n\t\t\tconsole.log(\"                        EncoderName       = \" + props.get(2, \"unknown\"));\r\n\t\t\tconsole.log(\"                        EncoderVersion    = \" + props.get(3, \"unknown\"));\r\n\t\t\tconsole.log(\"                        GeneratorName     = \" + props.get(4, \"unknown\"));\r\n\t\t\tconsole.log(\"                        GeneratorVersion  = \" + props.get(5, \"unknown\"));\r\n\t\t}\r\n\t}\r\n\r\n\t//blockID 254\r\n\tprivate parseNameSpace(blockID:number):void\r\n\t{\r\n\t\tvar id:number = this._newBlockBytes.readUnsignedByte();\r\n\t\tvar nameSpaceString:string = this.parseVarStr();\r\n\t\tif (this._debug)\r\n\t\t\tconsole.log(\"Parsed a NameSpaceBlock: ID = \" + id + \" | String = \" + nameSpaceString);\r\n\t}\r\n\r\n\t//--Parser UTILS---------------------------------------------------------------------------\r\n\r\n\t// this functions reads and creates a ShadowMethodMethod\r\n\tprivate parseShadowMethodList(light:LightBase, blockID:number):ShadowMethodBase\r\n\t{\r\n\r\n\t\tvar methodType:number = this._newBlockBytes.readUnsignedShort();\r\n\t\tvar shadowMethod:ShadowMethodBase;\r\n\t\tvar props:AWDProperties = this.parseProperties({1:AWDParser.BADDR, 2:AWDParser.BADDR, 3:AWDParser.BADDR, 101:this._propsNrType, 102:this._propsNrType, 103:this._propsNrType, 201:AWDParser.UINT32, 202:AWDParser.UINT32, 301:AWDParser.UINT16, 302:AWDParser.UINT16, 401:AWDParser.UINT8, 402:AWDParser.UINT8, 601:AWDParser.COLOR, 602:AWDParser.COLOR, 701:AWDParser.BOOL, 702:AWDParser.BOOL, 801:AWDParser.MTX4x4});\r\n\r\n\t\tvar targetID:number;\r\n\t\tvar returnedArray:Array<any>\r\n\t\tswitch (methodType) {\r\n\t\t\t//\t\t\t\tcase 1001: //CascadeShadowMapMethod\r\n\t\t\t//\t\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t//\t\t\t\t\treturnedArray = getAssetByID(targetID, [ShadowMapMethodBase.assetType]);\r\n\t\t\t//\t\t\t\t\tif (!returnedArray[0]) {\r\n\t\t\t//\t\t\t\t\t\t_blocks[blockID].addError(\"Could not find the ShadowBaseMethod (ID = \" + targetID + \" ) for this CascadeShadowMapMethod - ShadowMethod not created\");\r\n\t\t\t//\t\t\t\t\t\treturn shadowMethod;\r\n\t\t\t//\t\t\t\t\t}\r\n\t\t\t//\t\t\t\t\tshadowMethod = new CascadeShadowMapMethod(returnedArray[1]);\r\n\t\t\t//\t\t\t\t\tbreak;\r\n\t\t\tcase 1002: //ShadowNearMethod\r\n\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t\treturnedArray = this.getAssetByID(targetID, [ShadowMapMethodBase.assetType]);\r\n\t\t\t\tif (!returnedArray[0]) {\r\n\t\t\t\t\tthis._blocks[blockID].addError(\"Could not find the ShadowBaseMethod (ID = \" + targetID + \" ) for this ShadowNearMethod - ShadowMethod not created\");\r\n\t\t\t\t\treturn shadowMethod;\r\n\t\t\t\t}\r\n\t\t\t\tshadowMethod = new ShadowNearMethod(<ShadowMethodBase> returnedArray[1]);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 1101: //ShadowFilteredMethod\r\n\r\n\t\t\t\tshadowMethod = new ShadowFilteredMethod(<DirectionalLight> light);\r\n\t\t\t\t(<ShadowFilteredMethod> shadowMethod).alpha = props.get(101, 1);\r\n\t\t\t\t(<ShadowFilteredMethod> shadowMethod).epsilon = props.get(102, 0.002);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 1102: //ShadowDitheredMethod\r\n\r\n\r\n\t\t\t\tshadowMethod = new ShadowDitheredMethod(<DirectionalLight> light, <number> props.get(201, 5));\r\n\t\t\t\t(<ShadowDitheredMethod> shadowMethod).alpha = props.get(101, 1);\r\n\t\t\t\t(<ShadowDitheredMethod> shadowMethod).epsilon = props.get(102, 0.002);\r\n\t\t\t\t(<ShadowDitheredMethod> shadowMethod).range = props.get(103, 1);\r\n\r\n\t\t\t\tbreak;\r\n\t\t\tcase 1103: //ShadowSoftMethod\r\n\r\n\t\t\t\tshadowMethod = new ShadowSoftMethod(<DirectionalLight> light, <number> props.get(201, 5));\r\n\t\t\t\t(<ShadowSoftMethod> shadowMethod).alpha = props.get(101, 1);\r\n\t\t\t\t(<ShadowSoftMethod> shadowMethod).epsilon = props.get(102, 0.002);\r\n\t\t\t\t(<ShadowSoftMethod> shadowMethod).range = props.get(103, 1);\r\n\r\n\t\t\t\tbreak;\r\n\t\t\tcase 1104: //ShadowHardMethod\r\n\t\t\t\tshadowMethod = new ShadowHardMethod(light);\r\n\t\t\t\t(<ShadowHardMethod> shadowMethod).alpha = props.get(101, 1);\r\n\t\t\t\t(<ShadowHardMethod> shadowMethod).epsilon = props.get(102, 0.002);\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\t\tthis.parseUserAttributes();\r\n\t\treturn shadowMethod;\r\n\t}\r\n\r\n\t//Block ID 101\r\n\tprivate parseSkeleton(blockID:number /*uint*/):void\r\n\t{\r\n\t\tvar name:string = this.parseVarStr();\r\n\t\tvar num_joints:number /*uint*/ = this._newBlockBytes.readUnsignedShort();\r\n\t\tvar skeleton:Skeleton = new Skeleton();\r\n\t\tthis.parseProperties(null); // Discard properties for now\r\n\r\n\t\tvar joints_parsed:number /*uint*/ = 0;\r\n\t\twhile (joints_parsed < num_joints) {\r\n\t\t\tvar joint:SkeletonJoint;\r\n\t\t\tvar ibp:Matrix3D;\r\n\t\t\t// Ignore joint id\r\n\t\t\tthis._newBlockBytes.readUnsignedShort();\r\n\t\t\tjoint = new SkeletonJoint();\r\n\t\t\tjoint.parentIndex = this._newBlockBytes.readUnsignedShort() - 1; // 0=null in AWD\r\n\t\t\tjoint.name = this.parseVarStr();\r\n\r\n\t\t\tibp = this.parseMatrix3D();\r\n\t\t\tjoint.inverseBindPose = ibp.rawData;\r\n\t\t\t// Ignore joint props/attributes for now\r\n\t\t\tthis.parseProperties(null);\r\n\t\t\tthis.parseUserAttributes();\r\n\t\t\tskeleton.joints.push(joint);\r\n\t\t\tjoints_parsed++;\r\n\t\t}\r\n\r\n\t\t// Discard attributes for now\r\n\t\tthis.parseUserAttributes();\r\n\t\tthis._pFinalizeAsset(skeleton, name);\r\n\t\tthis._blocks[blockID].data = skeleton;\r\n\t\tif (this._debug)\r\n\t\t\tconsole.log(\"Parsed a Skeleton: Name = \" + skeleton.name + \" | Number of Joints = \" + joints_parsed);\r\n\t}\r\n\r\n\t//Block ID = 102\r\n\tprivate parseSkeletonPose(blockID:number /*uint*/):void\r\n\t{\r\n\t\tvar name:string = this.parseVarStr();\r\n\t\tvar num_joints:number /*uint*/ = this._newBlockBytes.readUnsignedShort();\r\n\t\tthis.parseProperties(null); // Ignore properties for now\r\n\r\n\t\tvar pose:SkeletonPose = new SkeletonPose();\r\n\r\n\t\tvar joints_parsed:number /*uint*/ = 0;\r\n\t\twhile (joints_parsed < num_joints) {\r\n\t\t\tvar joint_pose:JointPose;\r\n\t\t\tvar has_transform:number /*uint*/;\r\n\t\t\tjoint_pose = new JointPose();\r\n\t\t\thas_transform = this._newBlockBytes.readUnsignedByte();\r\n\t\t\tif (has_transform == 1) {\r\n\t\t\t\tvar mtx_data:Array<number> = this.parseMatrix43RawData();\r\n\r\n\t\t\t\tvar mtx:Matrix3D = new Matrix3D(mtx_data);\r\n\t\t\t\tjoint_pose.orientation.fromMatrix(mtx);\r\n\t\t\t\tjoint_pose.translation.copyFrom(mtx.position);\r\n\r\n\t\t\t\tpose.jointPoses[joints_parsed] = joint_pose;\r\n\t\t\t}\r\n\t\t\tjoints_parsed++;\r\n\t\t}\r\n\t\t// Skip attributes for now\r\n\t\tthis.parseUserAttributes();\r\n\t\tthis._pFinalizeAsset(pose, name);\r\n\t\tthis._blocks[blockID].data = pose;\r\n\t\tif (this._debug)\r\n\t\t\tconsole.log(\"Parsed a SkeletonPose: Name = \" + pose.name + \" | Number of Joints = \" + joints_parsed);\r\n\t}\r\n\r\n\t//blockID 103\r\n\tprivate parseSkeletonAnimation(blockID:number /*uint*/):void\r\n\t{\r\n\t\tvar frame_dur:number;\r\n\t\tvar pose_addr:number /*uint*/;\r\n\t\tvar name:string = this.parseVarStr();\r\n\t\tvar clip:SkeletonClipNode = new SkeletonClipNode();\r\n\t\tvar num_frames:number /*uint*/ = this._newBlockBytes.readUnsignedShort();\r\n\t\tthis.parseProperties(null); // Ignore properties for now\r\n\r\n\t\tvar frames_parsed:number /*uint*/ = 0;\r\n\t\tvar returnedArray:Array<any>;\r\n\t\twhile (frames_parsed < num_frames) {\r\n\t\t\tpose_addr = this._newBlockBytes.readUnsignedInt();\r\n\t\t\tframe_dur = this._newBlockBytes.readUnsignedShort();\r\n\t\t\treturnedArray = this.getAssetByID(pose_addr, [SkeletonPose.assetType]);\r\n\t\t\tif (!returnedArray[0])\r\n\t\t\t\tthis._blocks[blockID].addError(\"Could not find the SkeletonPose Frame # \" + frames_parsed + \" (ID = \" + pose_addr + \" ) for this SkeletonClipNode\");\r\n\t\t\telse\r\n\t\t\t\tclip.addFrame(<SkeletonPose> this._blocks[pose_addr].data, frame_dur);\r\n\t\t\tframes_parsed++;\r\n\t\t}\r\n\t\tif (clip.frames.length == 0) {\r\n\t\t\tthis._blocks[blockID].addError(\"Could not this SkeletonClipNode, because no Frames where set.\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// Ignore attributes for now\r\n\t\tthis.parseUserAttributes();\r\n\t\tthis._pFinalizeAsset(clip, name);\r\n\t\tthis._blocks[blockID].data = clip;\r\n\t\tif (this._debug)\r\n\t\t\tconsole.log(\"Parsed a SkeletonClipNode: Name = \" + clip.name + \" | Number of Frames = \" + clip.frames.length);\r\n\t}\r\n\r\n\t//Block ID = 111 /  Block ID = 112\r\n\tprivate parseMeshPoseAnimation(blockID:number /*uint*/, poseOnly:boolean = false):void\r\n\t{\r\n\t\tvar num_frames:number /*uint*/ = 1;\r\n\t\tvar num_submeshes:number /*uint*/;\r\n\t\tvar frames_parsed:number /*uint*/;\r\n\t\tvar subMeshParsed:number /*uint*/;\r\n\t\tvar frame_dur:number;\r\n\t\tvar x:number;\r\n\t\tvar y:number;\r\n\t\tvar z:number;\r\n\t\tvar str_len:number;\r\n\t\tvar str_end:number;\r\n\t\tvar geometry:Geometry;\r\n\t\tvar subGeom:TriangleSubGeometry;\r\n\t\tvar idx:number /*int*/ = 0;\r\n\t\tvar clip:VertexClipNode = new VertexClipNode();\r\n\t\tvar indices:Array<number> /*uint*/;\r\n\t\tvar verts:Array<number>;\r\n\t\tvar num_Streams:number /*int*/ = 0;\r\n\t\tvar streamsParsed:number /*int*/ = 0;\r\n\t\tvar streamtypes:Array<number> /*int*/ = new Array<number>() /*int*/;\r\n\t\tvar props:AWDProperties;\r\n\t\tvar thisGeo:Geometry;\r\n\t\tvar name:string = this.parseVarStr();\r\n\t\tvar geoAdress:number /*int*/ = this._newBlockBytes.readUnsignedInt();\r\n\t\tvar returnedArray:Array<any> = this.getAssetByID(geoAdress, [Geometry.assetType]);\r\n\t\tif (!returnedArray[0]) {\r\n\t\t\tthis._blocks[blockID].addError(\"Could not find the target-Geometry-Object \" + geoAdress + \" ) for this VertexClipNode\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar uvs:Array<Array<number>> = this.getUVForVertexAnimation(geoAdress);\r\n\t\tif (!poseOnly)\r\n\t\t\tnum_frames = this._newBlockBytes.readUnsignedShort();\r\n\r\n\t\tnum_submeshes = this._newBlockBytes.readUnsignedShort();\r\n\t\tnum_Streams = this._newBlockBytes.readUnsignedShort();\r\n\t\tstreamsParsed = 0;\r\n\t\twhile (streamsParsed < num_Streams) {\r\n\t\t\tstreamtypes.push(this._newBlockBytes.readUnsignedShort());\r\n\t\t\tstreamsParsed++;\r\n\t\t}\r\n\t\tprops = this.parseProperties({1:AWDParser.BOOL, 2:AWDParser.BOOL});\r\n\r\n\t\tclip.looping = props.get(1, true);\r\n\t\tclip.stitchFinalFrame = props.get(2, false);\r\n\r\n\t\tframes_parsed = 0;\r\n\t\twhile (frames_parsed < num_frames) {\r\n\t\t\tframe_dur = this._newBlockBytes.readUnsignedShort();\r\n\t\t\tgeometry = new Geometry();\r\n\t\t\tsubMeshParsed = 0;\r\n\t\t\twhile (subMeshParsed < num_submeshes) {\r\n\t\t\t\tstreamsParsed = 0;\r\n\t\t\t\tstr_len = this._newBlockBytes.readUnsignedInt();\r\n\t\t\t\tstr_end = this._newBlockBytes.position + str_len;\r\n\t\t\t\twhile (streamsParsed < num_Streams) {\r\n\t\t\t\t\tif (streamtypes[streamsParsed] == 1) {\r\n\t\t\t\t\t\tindices = (<Geometry> returnedArray[1]).subGeometries[subMeshParsed].indices;\r\n\t\t\t\t\t\tverts = new Array<number>();\r\n\t\t\t\t\t\tidx = 0;\r\n\t\t\t\t\t\twhile (this._newBlockBytes.position < str_end) {\r\n\t\t\t\t\t\t\tx = this.readNumber(this._accuracyGeo)\r\n\t\t\t\t\t\t\ty = this.readNumber(this._accuracyGeo)\r\n\t\t\t\t\t\t\tz = this.readNumber(this._accuracyGeo)\r\n\t\t\t\t\t\t\tverts[idx++] = x;\r\n\t\t\t\t\t\t\tverts[idx++] = y;\r\n\t\t\t\t\t\t\tverts[idx++] = z;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tsubGeom = new TriangleSubGeometry(true);\r\n\t\t\t\t\t\tsubGeom.updateIndices(indices);\r\n\t\t\t\t\t\tsubGeom.updatePositions(verts);\r\n\t\t\t\t\t\tsubGeom.updateUVs(uvs[subMeshParsed]);\r\n\t\t\t\t\t\tsubGeom.updateVertexNormals(null);\r\n\t\t\t\t\t\tsubGeom.updateVertexTangents(null);\r\n\t\t\t\t\t\tsubGeom.autoDeriveNormals = false;\r\n\t\t\t\t\t\tsubGeom.autoDeriveTangents = false;\r\n\t\t\t\t\t\tsubMeshParsed++;\r\n\t\t\t\t\t\tgeometry.addSubGeometry(subGeom)\r\n\t\t\t\t\t} else\r\n\t\t\t\t\t\tthis._newBlockBytes.position = str_end;\r\n\t\t\t\t\tstreamsParsed++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tclip.addFrame(geometry, frame_dur);\r\n\t\t\tframes_parsed++;\r\n\t\t}\r\n\t\tthis.parseUserAttributes();\r\n\t\tthis._pFinalizeAsset(clip, name);\r\n\r\n\t\tthis._blocks[blockID].data = clip;\r\n\t\tif (this._debug)\r\n\t\t\tconsole.log(\"Parsed a VertexClipNode: Name = \" + clip.name + \" | Target-Geometry-Name = \" + (<Geometry> returnedArray[1]).name + \" | Number of Frames = \" + clip.frames.length);\r\n\t}\r\n\r\n\t//BlockID 113\r\n\tprivate parseVertexAnimationSet(blockID:number /*uint*/):void\r\n\t{\r\n\t\tvar poseBlockAdress:number /*int*/\r\n\t\tvar outputString:string = \"\";\r\n\t\tvar name:string = this.parseVarStr();\r\n\t\tvar num_frames:number /*uint*/ = this._newBlockBytes.readUnsignedShort();\r\n\t\tvar props:AWDProperties = this.parseProperties({1:AWDParser.UINT16});\r\n\t\tvar frames_parsed:number /*uint*/ = 0;\r\n\t\tvar skeletonFrames:Array<SkeletonClipNode> = new Array<SkeletonClipNode>();\r\n\t\tvar vertexFrames:Array<VertexClipNode> = new Array<VertexClipNode>();\r\n\t\twhile (frames_parsed < num_frames) {\r\n\t\t\tposeBlockAdress = this._newBlockBytes.readUnsignedInt();\r\n\t\t\tvar returnedArray:Array<any> = this.getAssetByID(poseBlockAdress, [AnimationNodeBase.assetType]);\r\n\t\t\tif (!returnedArray[0])\r\n\t\t\t\tthis._blocks[blockID].addError(\"Could not find the AnimationClipNode Nr \" + frames_parsed + \" ( \" + poseBlockAdress + \" ) for this AnimationSet\");\r\n\t\t\telse {\r\n\t\t\t\tif (returnedArray[1] instanceof VertexClipNode)\r\n\t\t\t\t\tvertexFrames.push(returnedArray[1])\r\n\t\t\t\tif (returnedArray[1] instanceof SkeletonClipNode)\r\n\t\t\t\t\tskeletonFrames.push(returnedArray[1])\r\n\t\t\t}\r\n\t\t\tframes_parsed++;\r\n\t\t}\r\n\t\tif ((vertexFrames.length == 0) && (skeletonFrames.length == 0)) {\r\n\t\t\tthis._blocks[blockID].addError(\"Could not create this AnimationSet, because it contains no animations\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.parseUserAttributes();\r\n\t\tif (vertexFrames.length > 0) {\r\n\t\t\tvar newVertexAnimationSet:VertexAnimationSet = new VertexAnimationSet();\r\n\t\t\tfor (var i:number /*int*/ = 0; i < vertexFrames.length; i++)\r\n\t\t\t\tnewVertexAnimationSet.addAnimation(vertexFrames[i]);\r\n\t\t\tthis._pFinalizeAsset(newVertexAnimationSet, name);\r\n\t\t\tthis._blocks[blockID].data = newVertexAnimationSet;\r\n\t\t\tif (this._debug)\r\n\t\t\t\tconsole.log(\"Parsed a VertexAnimationSet: Name = \" + name + \" | Animations = \" + newVertexAnimationSet.animations.length + \" | Animation-Names = \" + newVertexAnimationSet.animationNames.toString());\r\n\r\n\t\t} else if (skeletonFrames.length > 0) {\r\n\t\t\treturnedArray = this.getAssetByID(poseBlockAdress, [AnimationNodeBase.assetType]);\r\n\t\t\tvar newSkeletonAnimationSet:SkeletonAnimationSet = new SkeletonAnimationSet(props.get(1, 4)); //props.get(1,4));\r\n\t\t\tfor (var i:number /*int*/ = 0; i < skeletonFrames.length; i++)\r\n\t\t\t\tnewSkeletonAnimationSet.addAnimation(skeletonFrames[i]);\r\n\t\t\tthis._pFinalizeAsset(newSkeletonAnimationSet, name);\r\n\t\t\tthis._blocks[blockID].data = newSkeletonAnimationSet;\r\n\t\t\tif (this._debug)\r\n\t\t\t\tconsole.log(\"Parsed a SkeletonAnimationSet: Name = \" + name + \" | Animations = \" + newSkeletonAnimationSet.animations.length + \" | Animation-Names = \" + newSkeletonAnimationSet.animationNames.toString());\r\n\r\n\t\t}\r\n\t}\r\n\r\n\t//BlockID 122\r\n\tprivate parseAnimatorSet(blockID:number /*uint*/):void\r\n\t{\r\n\t\tvar targetMesh:Mesh;\r\n\t\tvar animSetBlockAdress:number /*int*/\r\n\t\tvar targetAnimationSet:AnimationSetBase;\r\n\t\tvar outputString:string = \"\";\r\n\t\tvar name:string = this.parseVarStr();\r\n\t\tvar type:number /*uint*/ = this._newBlockBytes.readUnsignedShort();\r\n\r\n\t\tvar props:AWDProperties = this.parseProperties({1:AWDParser.BADDR});\r\n\r\n\t\tanimSetBlockAdress = this._newBlockBytes.readUnsignedInt();\r\n\t\tvar targetMeshLength:number /*uint*/ = this._newBlockBytes.readUnsignedShort();\r\n\t\tvar meshAdresses:Array<number> /*uint*/ = new Array<number>() /*uint*/;\r\n\t\tfor (var i:number /*int*/ = 0; i < targetMeshLength; i++)\r\n\t\t\tmeshAdresses.push(this._newBlockBytes.readUnsignedInt());\r\n\r\n\t\tvar activeState:number /*uint*/ = this._newBlockBytes.readUnsignedShort();\r\n\t\tvar autoplay:boolean = ( this._newBlockBytes.readUnsignedByte() == 1 );\r\n\t\tthis.parseUserAttributes();\r\n\t\tthis.parseUserAttributes();\r\n\r\n\t\tvar returnedArray:Array<any>;\r\n\t\tvar targetMeshes:Array<Mesh> = new Array<Mesh>();\r\n\r\n\t\tfor (i = 0; i < meshAdresses.length; i++) {\r\n\t\t\treturnedArray = this.getAssetByID(meshAdresses[i], [Mesh.assetType]);\r\n\t\t\tif (returnedArray[0])\r\n\t\t\t\ttargetMeshes.push(<Mesh> returnedArray[1]);\r\n\t\t}\r\n\t\treturnedArray = this.getAssetByID(animSetBlockAdress, [AnimationSetBase.assetType]);\r\n\t\tif (!returnedArray[0]) {\r\n\t\t\tthis._blocks[blockID].addError(\"Could not find the AnimationSet ( \" + animSetBlockAdress + \" ) for this Animator\");;\r\n\t\t\treturn\r\n\t\t}\r\n\t\ttargetAnimationSet = <AnimationSetBase> returnedArray[1];\r\n\t\tvar thisAnimator:AnimatorBase;\r\n\t\tif (type == 1) {\r\n\r\n\t\t\treturnedArray = this.getAssetByID(props.get(1, 0), [Skeleton.assetType]);\r\n\t\t\tif (!returnedArray[0]) {\r\n\t\t\t\tthis._blocks[blockID].addError(\"Could not find the Skeleton ( \" + props.get(1, 0) + \" ) for this Animator\");\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\tthisAnimator = new SkeletonAnimator(<SkeletonAnimationSet> targetAnimationSet, <Skeleton> returnedArray[1]);\r\n\r\n\t\t} else if (type == 2)\r\n\t\t\tthisAnimator = new VertexAnimator(<VertexAnimationSet> targetAnimationSet);\r\n\r\n\t\tthis._pFinalizeAsset(thisAnimator, name);\r\n\t\tthis._blocks[blockID].data = thisAnimator;\r\n\t\tfor (i = 0; i < targetMeshes.length; i++) {\r\n\t\t\tif (type == 1)\r\n\t\t\t\ttargetMeshes[i].animator = (<SkeletonAnimator> thisAnimator);\r\n\t\t\tif (type == 2)\r\n\t\t\t\ttargetMeshes[i].animator = (<VertexAnimator> thisAnimator);\r\n\r\n\t\t}\r\n\t\tif (this._debug)\r\n\t\t\tconsole.log(\"Parsed a Animator: Name = \" + name);\r\n\t}\r\n\r\n\t// this functions reads and creates a EffectMethod\r\n\tprivate parseSharedMethodList(blockID:number):EffectMethodBase\r\n\t{\r\n\r\n\t\tvar methodType:number = this._newBlockBytes.readUnsignedShort();\r\n\t\tvar effectMethodReturn:EffectMethodBase;\r\n\r\n\t\tvar props:AWDProperties = this.parseProperties({1:AWDParser.BADDR, 2:AWDParser.BADDR, 3:AWDParser.BADDR, 101:this._propsNrType, 102:this._propsNrType, 103:this._propsNrType, 104:this._propsNrType, 105:this._propsNrType, 106:this._propsNrType, 107:this._propsNrType, 201:AWDParser.UINT32, 202:AWDParser.UINT32, 301:AWDParser.UINT16, 302:AWDParser.UINT16, 401:AWDParser.UINT8, 402:AWDParser.UINT8, 601:AWDParser.COLOR, 602:AWDParser.COLOR, 701:AWDParser.BOOL, 702:AWDParser.BOOL});\r\n\t\tvar targetID:number;\r\n\t\tvar returnedArray:Array<any>;\r\n\r\n\t\tswitch (methodType) {\r\n\t\t\t// Effect Methods\r\n\t\t\tcase 401: //ColorMatrix\r\n\t\t\t\teffectMethodReturn = new EffectColorMatrixMethod(props.get(101, new Array(0, 0, 0, 1, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1)));\r\n\t\t\t\tbreak;\r\n\t\t\tcase 402: //ColorTransform\r\n\t\t\t\teffectMethodReturn = new EffectColorTransformMethod();\r\n\t\t\t\tvar offCol:number /*uint*/ = props.get(601, 0x00000000);\r\n\t\t\t\t(<EffectColorTransformMethod> effectMethodReturn).colorTransform = new ColorTransform(props.get(102, 1), props.get(103, 1), props.get(104, 1), props.get(101, 1), ((offCol >> 16) & 0xFF), ((offCol >> 8) & 0xFF), (offCol & 0xFF), ((offCol >> 24) & 0xFF));\r\n\t\t\t\tbreak;\r\n\t\t\tcase 403: //EnvMap\r\n\r\n\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t\tconsole.log('ENV MAP', targetID);\r\n\r\n\r\n\t\t\t\treturnedArray = this.getAssetByID(targetID, [ TextureBase.assetType ], \"CubeTexture\");\r\n\t\t\t\tif (!returnedArray[0])\r\n\t\t\t\t\tthis._blocks[blockID].addError(\"Could not find the EnvMap (ID = \" + targetID + \" ) for this EnvMapMethod\");\r\n\t\t\t\teffectMethodReturn = new EffectEnvMapMethod(<CubeTextureBase> returnedArray[1], <number> props.get(101, 1));\r\n\t\t\t\ttargetID = props.get(2, 0);\r\n\t\t\t\tif (targetID > 0) {\r\n\t\t\t\t\treturnedArray = this.getAssetByID(targetID, [TextureBase.assetType]);\r\n\t\t\t\t\tif (!returnedArray[0])\r\n\t\t\t\t\t\tthis._blocks[blockID].addError(\"Could not find the Mask-texture (ID = \" + targetID + \" ) for this EnvMapMethod\");\r\n\r\n\t\t\t\t\t// Todo: test mask with EnvMapMethod\r\n\t\t\t\t\t//(<EnvMapMethod> effectMethodReturn).mask = <Texture2DBase> returnedArray[1];\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 404: //LightMapMethod\r\n\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t\treturnedArray = this.getAssetByID(targetID, [TextureBase.assetType]);\r\n\t\t\t\tif (!returnedArray[0])\r\n\t\t\t\t\tthis._blocks[blockID].addError(\"Could not find the LightMap (ID = \" + targetID + \" ) for this LightMapMethod\");\r\n\t\t\t\teffectMethodReturn = new EffectLightMapMethod(returnedArray[1], this.blendModeDic[props.get(401, 10)]); //usesecondaryUV not set\r\n\t\t\t\tbreak;\r\n\t\t\t//\t\t\t\tcase 405: //ProjectiveTextureMethod\r\n\t\t\t//\t\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t//\t\t\t\t\treturnedArray = getAssetByID(targetID, [TextureProjector.assetType]);\r\n\t\t\t//\t\t\t\t\tif (!returnedArray[0])\r\n\t\t\t//\t\t\t\t\t\t_blocks[blockID].addError(\"Could not find the TextureProjector (ID = \" + targetID + \" ) for this ProjectiveTextureMethod\");\r\n\t\t\t//\t\t\t\t\teffectMethodReturn = new ProjectiveTextureMethod(returnedArray[1], blendModeDic[props.get(401, 10)]);\r\n\t\t\t//\t\t\t\t\tbreak;\r\n\t\t\tcase 406: //RimLightMethod\r\n\t\t\t\teffectMethodReturn = new EffectRimLightMethod(props.get(601, 0xffffff), props.get(101, 0.4), props.get(101, 2)); //blendMode\r\n\t\t\t\tbreak;\r\n\t\t\tcase 407: //AlphaMaskMethod\r\n\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t\treturnedArray = this.getAssetByID(targetID, [TextureBase.assetType]);\r\n\t\t\t\tif (!returnedArray[0])\r\n\t\t\t\t\tthis._blocks[blockID].addError(\"Could not find the Alpha-texture (ID = \" + targetID + \" ) for this AlphaMaskMethod\");\r\n\t\t\t\teffectMethodReturn = new EffectAlphaMaskMethod(returnedArray[1], props.get(701, false));\r\n\t\t\t\tbreak;\r\n\t\t\t//\t\t\t\tcase 408: //RefractionEnvMapMethod\r\n\t\t\t//\t\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t//\t\t\t\t\treturnedArray = getAssetByID(targetID, [TextureBase.assetType], \"CubeTexture\");\r\n\t\t\t//\t\t\t\t\tif (!returnedArray[0])\r\n\t\t\t//\t\t\t\t\t\t_blocks[blockID].addError(\"Could not find the EnvMap (ID = \" + targetID + \" ) for this RefractionEnvMapMethod\");\r\n\t\t\t//\t\t\t\t\teffectMethodReturn = new RefractionEnvMapMethod(returnedArray[1], props.get(101, 0.1), props.get(102, 0.01), props.get(103, 0.01), props.get(104, 0.01));\r\n\t\t\t//\t\t\t\t\tRefractionEnvMapMethod(effectMethodReturn).alpha = props.get(104, 1);\r\n\t\t\t//\t\t\t\t\tbreak;\r\n\t\t\t//\t\t\t\tcase 409: //OutlineMethod\r\n\t\t\t//\t\t\t\t\teffectMethodReturn = new OutlineMethod(props.get(601, 0x00000000), props.get(101, 1), props.get(701, true), props.get(702, false));\r\n\t\t\t//\t\t\t\t\tbreak;\r\n\t\t\tcase 410: //FresnelEnvMapMethod\r\n\t\t\t\ttargetID = props.get(1, 0);\r\n\t\t\t\treturnedArray = this.getAssetByID(targetID, [TextureBase.assetType], \"CubeTexture\");\r\n\t\t\t\tif (!returnedArray[0])\r\n\t\t\t\t\tthis._blocks[blockID].addError(\"Could not find the EnvMap (ID = \" + targetID + \" ) for this FresnelEnvMapMethod\");\r\n\t\t\t\teffectMethodReturn = new EffectFresnelEnvMapMethod(returnedArray[1], props.get(101, 1));\r\n\t\t\t\tbreak;\r\n\t\t\tcase 411: //FogMethod\r\n\t\t\t\teffectMethodReturn = new EffectFogMethod(props.get(101, 0), props.get(102, 1000), props.get(601, 0x808080));\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\t\tthis.parseUserAttributes();\r\n\t\treturn effectMethodReturn;\r\n\r\n\t}\r\n\r\n\tprivate parseUserAttributes():Object\r\n\t{\r\n\t\tvar attributes:Object;\r\n\t\tvar list_len:number;\r\n\t\tvar attibuteCnt:number;\r\n\r\n\t\tlist_len = this._newBlockBytes.readUnsignedInt();\r\n\r\n\t\tif (list_len > 0) {\r\n\r\n\t\t\tvar list_end:number;\r\n\r\n\t\t\tattributes = {};\r\n\r\n\t\t\tlist_end = this._newBlockBytes.position + list_len;\r\n\r\n\t\t\twhile (this._newBlockBytes.position < list_end) {\r\n\t\t\t\tvar ns_id:number;\r\n\t\t\t\tvar attr_key:string;\r\n\t\t\t\tvar attr_type:number;\r\n\t\t\t\tvar attr_len:number;\r\n\t\t\t\tvar attr_val:any;\r\n\r\n\t\t\t\t// TODO: Properly tend to namespaces in attributes\r\n\t\t\t\tns_id = this._newBlockBytes.readUnsignedByte();\r\n\t\t\t\tattr_key = this.parseVarStr();\r\n\t\t\t\tattr_type = this._newBlockBytes.readUnsignedByte();\r\n\t\t\t\tattr_len = this._newBlockBytes.readUnsignedInt();\r\n\r\n\t\t\t\tif ((this._newBlockBytes.position + attr_len) > list_end) {\r\n\t\t\t\t\tconsole.log(\"           Error in reading attribute # \" + attibuteCnt + \" = skipped to end of attribute-list\");\r\n\t\t\t\t\tthis._newBlockBytes.position = list_end;\r\n\t\t\t\t\treturn attributes;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tswitch (attr_type) {\r\n\t\t\t\t\tcase AWDParser.AWDSTRING:\r\n\t\t\t\t\t\tattr_val = this._newBlockBytes.readUTFBytes(attr_len);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase AWDParser.INT8:\r\n\t\t\t\t\t\tattr_val = this._newBlockBytes.readByte();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase AWDParser.INT16:\r\n\t\t\t\t\t\tattr_val = this._newBlockBytes.readShort();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase AWDParser.INT32:\r\n\t\t\t\t\t\tattr_val = this._newBlockBytes.readInt();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase AWDParser.BOOL:\r\n\t\t\t\t\tcase AWDParser.UINT8:\r\n\t\t\t\t\t\tattr_val = this._newBlockBytes.readUnsignedByte();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase AWDParser.UINT16:\r\n\t\t\t\t\t\tattr_val = this._newBlockBytes.readUnsignedShort();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase AWDParser.UINT32:\r\n\t\t\t\t\tcase AWDParser.BADDR:\r\n\t\t\t\t\t\tattr_val = this._newBlockBytes.readUnsignedInt();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase AWDParser.FLOAT32:\r\n\t\t\t\t\t\tattr_val = this._newBlockBytes.readFloat();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase AWDParser.FLOAT64:\r\n\t\t\t\t\t\tattr_val = this._newBlockBytes.readDouble();\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tattr_val = 'unimplemented attribute type ' + attr_type;\r\n\t\t\t\t\t\tthis._newBlockBytes.position += attr_len;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (this._debug) {\r\n\t\t\t\t\tconsole.log(\"attribute = name: \" + attr_key + \"  / value = \" + attr_val);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tattributes[attr_key] = attr_val;\r\n\t\t\t\tattibuteCnt += 1;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn attributes;\r\n\t}\r\n\r\n\tprivate parseProperties(expected:Object):AWDProperties\r\n\t{\r\n\t\tvar list_end:number;\r\n\t\tvar list_len:number;\r\n\t\tvar propertyCnt:number = 0;\r\n\t\tvar props:AWDProperties = new AWDProperties();\r\n\r\n\t\tlist_len = this._newBlockBytes.readUnsignedInt();\r\n\t\tlist_end = this._newBlockBytes.position + list_len;\r\n\r\n\t\tif (expected) {\r\n\r\n\t\t\twhile (this._newBlockBytes.position < list_end) {\r\n\t\t\t\tvar len:number;\r\n\t\t\t\tvar key:number;\r\n\t\t\t\tvar type:number;\r\n\r\n\t\t\t\tkey = this._newBlockBytes.readUnsignedShort();\r\n\t\t\t\tlen = this._newBlockBytes.readUnsignedInt();\r\n\r\n\t\t\t\tif ((this._newBlockBytes.position + len) > list_end) {\r\n\t\t\t\t\tconsole.log(\"           Error in reading property # \" + propertyCnt + \" = skipped to end of propertie-list\");\r\n\t\t\t\t\tthis._newBlockBytes.position = list_end;\r\n\t\t\t\t\treturn props;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (expected.hasOwnProperty(key.toString())) {\r\n\t\t\t\t\ttype = expected[key];\r\n\t\t\t\t\tprops.set(key, this.parseAttrValue(type, len));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._newBlockBytes.position += len;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tpropertyCnt += 1;\r\n\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis._newBlockBytes.position = list_end;\r\n\t\t}\r\n\r\n\t\treturn props;\r\n\r\n\t}\r\n\r\n\tprivate parseAttrValue(type:number, len:number):any\r\n\t{\r\n\t\tvar elem_len:number;\r\n\t\tvar read_func:Function;\r\n\r\n\t\tswitch (type) {\r\n\r\n\t\t\tcase AWDParser.BOOL:\r\n\t\t\tcase AWDParser.INT8:\r\n\t\t\t\telem_len = 1;\r\n\t\t\t\tread_func = this._newBlockBytes.readByte;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase AWDParser.INT16:\r\n\t\t\t\telem_len = 2;\r\n\t\t\t\tread_func = this._newBlockBytes.readShort;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase AWDParser.INT32:\r\n\t\t\t\telem_len = 4;\r\n\t\t\t\tread_func = this._newBlockBytes.readInt;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase AWDParser.UINT8:\r\n\t\t\t\telem_len = 1;\r\n\t\t\t\tread_func = this._newBlockBytes.readUnsignedByte;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase AWDParser.UINT16:\r\n\t\t\t\telem_len = 2;\r\n\t\t\t\tread_func = this._newBlockBytes.readUnsignedShort;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase AWDParser.UINT32:\r\n\t\t\tcase AWDParser.COLOR:\r\n\t\t\tcase AWDParser.BADDR:\r\n\t\t\t\telem_len = 4;\r\n\t\t\t\tread_func = this._newBlockBytes.readUnsignedInt;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase AWDParser.FLOAT32:\r\n\t\t\t\telem_len = 4;\r\n\t\t\t\tread_func = this._newBlockBytes.readFloat;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase AWDParser.FLOAT64:\r\n\t\t\t\telem_len = 8;\r\n\t\t\t\tread_func = this._newBlockBytes.readDouble;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase AWDParser.AWDSTRING:\r\n\t\t\t\treturn this._newBlockBytes.readUTFBytes(len);\r\n\r\n\t\t\tcase AWDParser.VECTOR2x1:\r\n\t\t\tcase AWDParser.VECTOR3x1:\r\n\t\t\tcase AWDParser.VECTOR4x1:\r\n\t\t\tcase AWDParser.MTX3x2:\r\n\t\t\tcase AWDParser.MTX3x3:\r\n\t\t\tcase AWDParser.MTX4x3:\r\n\t\t\tcase AWDParser.MTX4x4:\r\n\t\t\t\telem_len = 8;\r\n\t\t\t\tread_func = this._newBlockBytes.readDouble;\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t\tif (elem_len < len) {\r\n\t\t\tvar list:Array<any> = [];\r\n\t\t\tvar num_read:number = 0;\r\n\t\t\tvar num_elems:number = len/elem_len;\r\n\r\n\t\t\twhile (num_read < num_elems) {\r\n\t\t\t\tlist.push(read_func.apply(this._newBlockBytes)); // list.push(read_func());\r\n\t\t\t\tnum_read++;\r\n\t\t\t}\r\n\r\n\t\t\treturn list;\r\n\t\t} else {\r\n\r\n\t\t\tvar val:any = read_func.apply(this._newBlockBytes);//read_func();\r\n\t\t\treturn val;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate parseHeader():void\r\n\t{\r\n\t\tvar flags:number;\r\n\t\tvar body_len:number;\r\n\r\n\t\tthis._byteData.position = 3; // Skip magic string and parse version\r\n\r\n\t\tthis._version[0] = this._byteData.readUnsignedByte();\r\n\t\tthis._version[1] = this._byteData.readUnsignedByte();\r\n\r\n\t\tflags = this._byteData.readUnsignedShort(); // Parse bit flags\r\n\r\n\t\tthis._streaming = BitFlags.test(flags, BitFlags.FLAG1);\r\n\r\n\t\tif ((this._version[0] == 2) && (this._version[1] == 1)) {\r\n\t\t\tthis._accuracyMatrix = BitFlags.test(flags, BitFlags.FLAG2);\r\n\t\t\tthis._accuracyGeo = BitFlags.test(flags, BitFlags.FLAG3);\r\n\t\t\tthis._accuracyProps = BitFlags.test(flags, BitFlags.FLAG4);\r\n\t\t}\r\n\r\n\t\t// if we set _accuracyOnBlocks, the precision-values are read from each block-header.\r\n\r\n\t\t// set storagePrecision types\r\n\t\tthis._geoNrType = AWDParser.FLOAT32;\r\n\r\n\t\tif (this._accuracyGeo) {\r\n\t\t\tthis._geoNrType = AWDParser.FLOAT64;\r\n\t\t}\r\n\r\n\t\tthis._matrixNrType = AWDParser.FLOAT32;\r\n\r\n\t\tif (this._accuracyMatrix) {\r\n\t\t\tthis._matrixNrType = AWDParser.FLOAT64;\r\n\t\t}\r\n\r\n\t\tthis._propsNrType = AWDParser.FLOAT32;\r\n\r\n\t\tif (this._accuracyProps) {\r\n\t\t\tthis._propsNrType = AWDParser.FLOAT64;\r\n\t\t}\r\n\r\n\t\tthis._compression = this._byteData.readUnsignedByte(); // compression\r\n\r\n\t\tif (this._debug) {\r\n\t\t\tconsole.log(\"Import AWDFile of version = \" + this._version[0] + \" - \" + this._version[1]);\r\n\t\t\tconsole.log(\"Global Settings = Compression = \" + this._compression + \" | Streaming = \" + this._streaming + \" | Matrix-Precision = \" + this._accuracyMatrix + \" | Geometry-Precision = \" + this._accuracyGeo + \" | Properties-Precision = \" + this._accuracyProps);\r\n\t\t}\r\n\r\n\t\t// Check file integrity\r\n\t\tbody_len = this._byteData.readUnsignedInt();\r\n\t\tif (!this._streaming && body_len != this._byteData.getBytesAvailable()) {\r\n\t\t\tthis._pDieWithError('AWD2 body length does not match header integrity field');\r\n\t\t}\r\n\r\n\t}\r\n\t// Helper - functions\r\n\tprivate getUVForVertexAnimation(meshID:number /*uint*/):Array<Array<number>>\r\n\t{\r\n\t\tif (this._blocks[meshID].data instanceof Mesh)\r\n\t\t\tmeshID = this._blocks[meshID].geoID;\r\n\t\tif (this._blocks[meshID].uvsForVertexAnimation)\r\n\t\t\treturn this._blocks[meshID].uvsForVertexAnimation;\r\n\t\tvar geometry:Geometry = (<Geometry> this._blocks[meshID].data);\r\n\t\tvar geoCnt:number /*int*/ = 0;\r\n\t\tvar ud:Array<number>;\r\n\t\tvar uStride:number /*uint*/;\r\n\t\tvar uOffs:number /*uint*/;\r\n\t\tvar numPoints:number /*uint*/;\r\n\t\tvar i:number /*int*/;\r\n\t\tvar newUvs:Array<number>;\r\n\t\tvar sub_geom:TriangleSubGeometry;\r\n\t\tthis._blocks[meshID].uvsForVertexAnimation = new Array<Array<number>>();\r\n\t\twhile (geoCnt < geometry.subGeometries.length) {\r\n\t\t\tnewUvs = new Array<number>();\r\n\t\t\tsub_geom = <TriangleSubGeometry> geometry.subGeometries[geoCnt];\r\n\t\t\tnumPoints = sub_geom.numVertices;\r\n\t\t\tud = sub_geom.uvs;\r\n\t\t\tuStride = sub_geom.getStride(TriangleSubGeometry.UV_DATA);\r\n\t\t\tuOffs = sub_geom.getOffset(TriangleSubGeometry.UV_DATA);\r\n\t\t\tfor (i = 0; i < numPoints; i++) {\r\n\t\t\t\tnewUvs.push(ud[uOffs + i*uStride + 0]);\r\n\t\t\t\tnewUvs.push(ud[uOffs + i*uStride + 1]);\r\n\t\t\t}\r\n\t\t\tthis._blocks[meshID].uvsForVertexAnimation.push(newUvs);\r\n\t\t\tgeoCnt++;\r\n\t\t}\r\n\t\treturn this._blocks[meshID].uvsForVertexAnimation;\r\n\t}\r\n\r\n\tprivate parseVarStr():string\r\n\t{\r\n\r\n\t\tvar len:number = this._newBlockBytes.readUnsignedShort();\r\n\t\treturn this._newBlockBytes.readUTFBytes(len);\r\n\t}\r\n\r\n\tprivate getAssetByID(assetID:number, assetTypesToGet:Array<string>, extraTypeInfo:string = \"SingleTexture\"):Array<any>\r\n\t{\r\n\t\tvar returnArray:Array<any> = new Array<any>();\r\n\t\tvar typeCnt:number = 0;\r\n\t\tif (assetID > 0) {\r\n\t\t\tif (this._blocks[assetID]) {\r\n\t\t\t\tif (this._blocks[assetID].data) {\r\n\t\t\t\t\twhile (typeCnt < assetTypesToGet.length) {\r\n\r\n\t\t\t\t\t\tvar iasset:IAsset = <IAsset> this._blocks[assetID].data;\r\n\r\n\t\t\t\t\t\tif (iasset.assetType == assetTypesToGet[typeCnt]) {\r\n\t\t\t\t\t\t\t//if the right assetType was found\r\n\t\t\t\t\t\t\tif ((assetTypesToGet[typeCnt] == TextureBase.assetType) && (extraTypeInfo == \"CubeTexture\")) {\r\n\t\t\t\t\t\t\t\tif (this._blocks[assetID].data instanceof ImageCubeTexture) {\r\n\t\t\t\t\t\t\t\t\treturnArray.push(true);\r\n\t\t\t\t\t\t\t\t\treturnArray.push(this._blocks[assetID].data);\r\n\t\t\t\t\t\t\t\t\treturn returnArray;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif ((assetTypesToGet[typeCnt] == TextureBase.assetType) && (extraTypeInfo == \"SingleTexture\")) {\r\n\t\t\t\t\t\t\t\tif (this._blocks[assetID].data instanceof ImageTexture) {\r\n\t\t\t\t\t\t\t\t\treturnArray.push(true);\r\n\t\t\t\t\t\t\t\t\treturnArray.push(this._blocks[assetID].data);\r\n\t\t\t\t\t\t\t\t\treturn returnArray;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\treturnArray.push(true);\r\n\t\t\t\t\t\t\t\treturnArray.push(this._blocks[assetID].data);\r\n\t\t\t\t\t\t\t\treturn returnArray;\r\n\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t//if ((assetTypesToGet[typeCnt] == Geometry.assetType) && (IAsset(_blocks[assetID].data).assetType == Mesh.assetType)) {\r\n\t\t\t\t\t\tif ((assetTypesToGet[typeCnt] == Geometry.assetType) && (iasset.assetType == Mesh.assetType)) {\r\n\r\n\t\t\t\t\t\t\tvar mesh:Mesh = <Mesh> this._blocks[assetID].data\r\n\r\n\t\t\t\t\t\t\treturnArray.push(true);\r\n\t\t\t\t\t\t\treturnArray.push(mesh.geometry);\r\n\t\t\t\t\t\t\treturn returnArray;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\ttypeCnt++;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t// if the has not returned anything yet, the asset is not found, or the found asset is not the right type.\r\n\t\treturnArray.push(false);\r\n\t\treturnArray.push(this.getDefaultAsset(assetTypesToGet[0], extraTypeInfo));\r\n\t\treturn returnArray;\r\n\t}\r\n\tprivate getDefaultAsset(assetType:string, extraTypeInfo:string):IAsset\r\n\t{\r\n\t\tswitch (true) {\r\n\t\t\tcase (assetType == TextureBase.assetType):\r\n\t\t\t\tif (extraTypeInfo == \"CubeTexture\")\r\n\t\t\t\t\treturn this.getDefaultCubeTexture();\r\n\t\t\t\tif (extraTypeInfo == \"SingleTexture\")\r\n\t\t\t\t\treturn DefaultMaterialManager.getDefaultTexture();\r\n\t\t\t\tbreak;\r\n\t\t\tcase (assetType == MaterialBase.assetType):\r\n\t\t\t\treturn DefaultMaterialManager.getDefaultMaterial();\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n\tprivate getDefaultCubeTexture():IAsset\r\n\t{\r\n\t\tif (!this._defaultCubeTexture) {\r\n\t\t\tvar defaultBitmap:BitmapData = DefaultMaterialManager.createCheckeredBitmapData();\r\n\r\n\t\t\tthis._defaultCubeTexture = new BitmapCubeTexture(defaultBitmap, defaultBitmap, defaultBitmap, defaultBitmap, defaultBitmap, defaultBitmap);\r\n\t\t\tthis._defaultCubeTexture.name = \"defaultCubeTexture\";\r\n\t\t}\r\n\r\n\t\treturn <IAsset> this._defaultCubeTexture;\r\n\t}\r\n\r\n\tprivate readNumber(precision:boolean = false):number\r\n\t{\r\n\t\tif (precision)\r\n\t\t\treturn this._newBlockBytes.readDouble();\r\n\t\treturn this._newBlockBytes.readFloat();\r\n\r\n\t}\r\n\r\n\tprivate parseMatrix3D():Matrix3D\r\n\t{\r\n\t\treturn new Matrix3D(this.parseMatrix43RawData());\r\n\t}\r\n\r\n\tprivate parseMatrix32RawData():Array<number>\r\n\t{\r\n\t\tvar i:number;\r\n\t\tvar mtx_raw:Array<number> = new Array<number>(6);\r\n\t\tfor (i = 0; i < 6; i++) {\r\n\t\t\tmtx_raw[i] = this._newBlockBytes.readFloat();\r\n\t\t}\r\n\r\n\t\treturn mtx_raw;\r\n\t}\r\n\r\n\tprivate parseMatrix43RawData():Array<number>\r\n\t{\r\n\t\tvar mtx_raw:Array<number> = new Array<number>(16);\r\n\r\n\t\tmtx_raw[0] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[1] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[2] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[3] = 0.0;\r\n\t\tmtx_raw[4] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[5] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[6] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[7] = 0.0;\r\n\t\tmtx_raw[8] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[9] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[10] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[11] = 0.0;\r\n\t\tmtx_raw[12] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[13] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[14] = this.readNumber(this._accuracyMatrix);\r\n\t\tmtx_raw[15] = 1.0;\r\n\r\n\t\t//TODO: fix max exporter to remove NaN values in joint 0 inverse bind pose\r\n\r\n\t\tif (isNaN(mtx_raw[0])) {\r\n\t\t\tmtx_raw[0] = 1;\r\n\t\t\tmtx_raw[1] = 0;\r\n\t\t\tmtx_raw[2] = 0;\r\n\t\t\tmtx_raw[4] = 0;\r\n\t\t\tmtx_raw[5] = 1;\r\n\t\t\tmtx_raw[6] = 0;\r\n\t\t\tmtx_raw[8] = 0;\r\n\t\t\tmtx_raw[9] = 0;\r\n\t\t\tmtx_raw[10] = 1;\r\n\t\t\tmtx_raw[12] = 0;\r\n\t\t\tmtx_raw[13] = 0;\r\n\t\t\tmtx_raw[14] = 0;\r\n\r\n\t\t}\r\n\r\n\t\treturn mtx_raw;\r\n\t}\r\n\r\n}\r\n\r\nexport = AWDParser;\r\n\r\nclass AWDBlock\r\n{\r\n\tpublic id:number;\r\n\tpublic name:string;\r\n\tpublic data:any;\r\n\tpublic len:any;\r\n\tpublic geoID:number;\r\n\tpublic extras:Object;\r\n\tpublic bytes:ByteArray;\r\n\tpublic errorMessages:Array<string>;\r\n\tpublic uvsForVertexAnimation:Array<Array<number>>;\r\n\r\n\tconstructor()\r\n\t{\r\n\t}\r\n\r\n\tpublic dispose()\r\n\t{\r\n\r\n\t\tthis.id = null;\r\n\t\tthis.bytes = null;\r\n\t\tthis.errorMessages = null;\r\n\t\tthis.uvsForVertexAnimation = null;\r\n\r\n\t}\r\n\r\n\tpublic addError(errorMsg:string):void\r\n\t{\r\n\t\tif (!this.errorMessages)\r\n\t\t\tthis.errorMessages = new Array<string>();\r\n\r\n\t\tthis.errorMessages.push(errorMsg);\r\n\t}\r\n}\r\n\r\nclass AWDProperties\r\n{\r\n\tpublic set(key:number, value:any):void\r\n\t{\r\n\t\tthis[ key.toString() ] = value;\r\n\t}\r\n\r\n\tpublic get(key:number, fallback:any):any\r\n\t{\r\n\t\tif (this.hasOwnProperty(key.toString())) {\r\n\t\t\treturn this[key.toString()];\r\n\t\t} else {\r\n\t\t\treturn fallback;\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/**\r\n *\r\n */\r\nclass BitFlags\r\n{\r\n\tpublic static FLAG1:number = 1;\r\n\tpublic static FLAG2:number = 2;\r\n\tpublic static FLAG3:number = 4;\r\n\tpublic static FLAG4:number = 8;\r\n\tpublic static FLAG5:number = 16;\r\n\tpublic static FLAG6:number = 32;\r\n\tpublic static FLAG7:number = 64;\r\n\tpublic static FLAG8:number = 128;\r\n\tpublic static FLAG9:number = 256;\r\n\tpublic static FLAG10:number = 512;\r\n\tpublic static FLAG11:number = 1024;\r\n\tpublic static FLAG12:number = 2048;\r\n\tpublic static FLAG13:number = 4096;\r\n\tpublic static FLAG14:number = 8192;\r\n\tpublic static FLAG15:number = 16384;\r\n\tpublic static FLAG16:number = 32768;\r\n\r\n\tpublic static test(flags:number, testFlag:number):boolean\r\n\t{\r\n\t\treturn (flags & testFlag) == testFlag;\r\n\t}\r\n}\r\n",
    "import BitmapData\t\t\t\t\t\t= require(\"awayjs-core/lib/data/BitmapData\");\r\nimport Geometry\t\t\t\t\t\t\t= require(\"awayjs-core/lib/data/Geometry\");\r\nimport TriangleSubGeometry\t\t\t\t= require(\"awayjs-core/lib/data/TriangleSubGeometry\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\nimport URLLoaderDataFormat\t\t\t\t= require(\"awayjs-core/lib/net/URLLoaderDataFormat\");\r\nimport URLRequest\t\t\t\t\t\t= require(\"awayjs-core/lib/net/URLRequest\");\r\nimport ParserBase\t\t\t\t\t\t= require(\"awayjs-core/lib/parsers/ParserBase\");\r\nimport ParserUtils\t\t\t\t\t\t= require(\"awayjs-core/lib/parsers/ParserUtils\");\r\nimport ResourceDependency\t\t\t\t= require(\"awayjs-core/lib/parsers/ResourceDependency\");\r\nimport Texture2DBase\t\t\t\t\t= require(\"awayjs-core/lib/textures/Texture2DBase\");\r\nimport ByteArray\t\t\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\n\r\nimport DisplayObjectContainer\t\t\t= require(\"awayjs-display/lib/containers/DisplayObjectContainer\");\r\nimport DisplayObject\t\t\t\t\t= require(\"awayjs-display/lib/base/DisplayObject\");\r\nimport Camera\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Camera\");\r\nimport Mesh\t\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Mesh\");\r\nimport DefaultMaterialManager\t\t\t= require(\"awayjs-display/lib/managers/DefaultMaterialManager\");\r\n\r\nimport VertexClipNode\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/VertexClipNode\");\r\nimport VertexAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/VertexAnimationSet\");\r\n\r\nimport MethodMaterial\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/MethodMaterial\");\r\nimport MethodMaterialMode\t\t\t\t= require(\"awayjs-methodmaterials/lib/MethodMaterialMode\");\r\n\r\n/**\r\n * MD2Parser provides a parser for the MD2 data type.\r\n */\r\nclass MD2Parser extends ParserBase\r\n{\r\n\tpublic static FPS:number /*int*/ = 6;\r\n\r\n\tprivate _clipNodes:Object = new Object();\r\n\tprivate _byteData:ByteArray;\r\n\tprivate _startedParsing:boolean;\r\n\tprivate _parsedHeader:boolean;\r\n\tprivate _parsedUV:boolean;\r\n\tprivate _parsedFaces:boolean;\r\n\tprivate _parsedFrames:boolean;\r\n\r\n\tprivate _ident:number /*uint*/;\r\n\tprivate _version:number /*uint*/;\r\n\tprivate _skinWidth:number /*uint*/;\r\n\tprivate _skinHeight:number /*uint*/;\r\n\t//private _frameSize : number /*uint*/;\r\n\tprivate _numSkins:number /*uint*/;\r\n\tprivate _numVertices:number /*uint*/;\r\n\tprivate _numST:number /*uint*/;\r\n\tprivate _numTris:number /*uint*/;\r\n\t//private _numGlCmds : number /*uint*/;\r\n\tprivate _numFrames:number /*uint*/;\r\n\tprivate _offsetSkins:number /*uint*/;\r\n\tprivate _offsetST:number /*uint*/;\r\n\tprivate _offsetTris:number /*uint*/;\r\n\tprivate _offsetFrames:number /*uint*/;\r\n\t//private _offsetGlCmds : number /*uint*/;\r\n\tprivate _offsetEnd:number /*uint*/;\r\n\r\n\tprivate _uvIndices:Array<number>;\r\n\tprivate _indices:Array<number> /*uint*/;\r\n\tprivate _vertIndices:Array<number>;\r\n\r\n\t// the current subgeom being built\r\n\tprivate _animationSet:VertexAnimationSet = new VertexAnimationSet();\r\n\tprivate _firstSubGeom:TriangleSubGeometry;\r\n\tprivate _uvs:Array<number>;\r\n\tprivate _finalUV:Array<number>;\r\n\r\n\tprivate _materialNames:Array<string>;\r\n\tprivate _textureType:string;\r\n\tprivate _ignoreTexturePath:boolean;\r\n\tprivate _mesh:Mesh;\r\n\tprivate _geometry:Geometry;\r\n\r\n\tprivate materialFinal:boolean = false;\r\n\tprivate geoCreated:boolean = false;\r\n\r\n\t/**\r\n\t * Creates a new MD2Parser object.\r\n\t * @param textureType The extension of the texture (e.g. jpg/png/...)\r\n\t * @param ignoreTexturePath If true, the path of the texture is ignored\r\n\t */\r\n\tconstructor(textureType:string = \"jpg\", ignoreTexturePath:boolean = true)\r\n\t{\r\n\t\tsuper(URLLoaderDataFormat.ARRAY_BUFFER);\r\n\t\tthis._textureType = textureType;\r\n\t\tthis._ignoreTexturePath = ignoreTexturePath;\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates whether or not a given file extension is supported by the parser.\r\n\t * @param extension The file extension of a potential file to be parsed.\r\n\t * @return Whether or not the given file type is supported.\r\n\t */\r\n\tpublic static supportsType(extension:string):boolean\r\n\t{\r\n\t\textension = extension.toLowerCase();\r\n\t\treturn extension == \"md2\";\r\n\t}\r\n\r\n\t/**\r\n\t * Tests whether a data block can be parsed by the parser.\r\n\t * @param data The data block to potentially be parsed.\r\n\t * @return Whether or not the given data is supported.\r\n\t */\r\n\tpublic static supportsData(data:any):boolean\r\n\t{\r\n\t\treturn (ParserUtils.toString(data, 4) == 'IDP2');\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iResolveDependency(resourceDependency:ResourceDependency)\r\n\t{\r\n\t\tif (resourceDependency.assets.length != 1)\r\n\t\t\treturn;\r\n\r\n\t\tvar asset:Texture2DBase = <Texture2DBase> resourceDependency.assets[0];\r\n\r\n\t\tif (asset) {\r\n\t\t\tvar material:MethodMaterial = new MethodMaterial(asset);\r\n\r\n\t\t\tif (this.materialMode >= 2)\r\n\t\t\t\tmaterial.mode = MethodMaterialMode.MULTI_PASS;\r\n\r\n\t\t\t//add to the content property\r\n\t\t\t(<DisplayObjectContainer> this._pContent).addChild(this._mesh);\r\n\r\n\t\t\tmaterial.name = this._mesh.material.name;\r\n\t\t\tthis._mesh.material = material;\r\n\t\t\tthis._pFinalizeAsset(material);\r\n\t\t\tthis._pFinalizeAsset(this._mesh.geometry);\r\n\t\t\tthis._pFinalizeAsset(this._mesh);\r\n\t\t}\r\n\t\tthis.materialFinal = true;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iResolveDependencyFailure(resourceDependency:ResourceDependency)\r\n\t{\r\n\t\t// apply system default\r\n\t\tif (this.materialMode < 2) {\r\n\t\t\tthis._mesh.material = DefaultMaterialManager.getDefaultMaterial();\r\n\t\t} else {\r\n\t\t\tthis._mesh.material = new MethodMaterial(DefaultMaterialManager.getDefaultTexture());\r\n\t\t\t(<MethodMaterial> this._mesh.material).mode = MethodMaterialMode.MULTI_PASS;\r\n\t\t}\r\n\r\n\t\t//add to the content property\r\n\t\t(<DisplayObjectContainer> this._pContent).addChild(this._mesh);\r\n\r\n\t\tthis._pFinalizeAsset(this._mesh.geometry);\r\n\t\tthis._pFinalizeAsset(this._mesh);\r\n\t\tthis.materialFinal = true;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pProceedParsing():boolean\r\n\t{\r\n\t\tif (!this._startedParsing) {\r\n\t\t\tthis._byteData = this._pGetByteData();\r\n\t\t\tthis._startedParsing = true;\r\n\r\n\t\t\t// Reset bytearray read position (which may have been\r\n\t\t\t// moved forward by the supportsData() function.)\r\n\t\t\tthis._byteData.position = 0;\r\n\t\t}\r\n\r\n\t\twhile (this._pHasTime()) {\r\n\t\t\tif (!this._parsedHeader) {\r\n\t\t\t\t//----------------------------------------------------------------------------\r\n\t\t\t\t// LITTLE_ENDIAN - Default for ArrayBuffer / Not implemented in ByteArray\r\n\t\t\t\t//----------------------------------------------------------------------------\r\n\t\t\t\t//this._byteData.endian = Endian.LITTLE_ENDIAN;\r\n\r\n\t\t\t\t// TODO: Create a mesh only when encountered (if it makes sense\r\n\t\t\t\t// for this file format) and return it using this._pFinalizeAsset()\r\n\t\t\t\tthis._geometry = new Geometry();\r\n\t\t\t\tthis._mesh = new Mesh(this._geometry, null);\r\n\t\t\t\tif (this.materialMode < 2) {\r\n\t\t\t\t\tthis._mesh.material = DefaultMaterialManager.getDefaultMaterial();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._mesh.material = new MethodMaterial(DefaultMaterialManager.getDefaultTexture());\r\n\t\t\t\t\t(<MethodMaterial> this._mesh.material).mode = MethodMaterialMode.MULTI_PASS;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//_geometry.animation = new VertexAnimation(2, VertexAnimationMode.ABSOLUTE);\r\n\t\t\t\t//_animator = new VertexAnimator(VertexAnimationState(_mesh.animationState));\r\n\r\n\t\t\t\t// Parse header and decompress body\r\n\t\t\t\tthis.parseHeader();\r\n\t\t\t\tthis.parseMaterialNames();\r\n\t\t\t} else if (!this._parsedUV) {\r\n\t\t\t\tthis.parseUV();\r\n\t\t\t} else if (!this._parsedFaces) {\r\n\t\t\t\tthis.parseFaces();\r\n\t\t\t} else if (!this._parsedFrames) {\r\n\t\t\t\tthis.parseFrames();\r\n\t\t\t} else if ((this.geoCreated) && (this.materialFinal)) {\r\n\t\t\t\treturn ParserBase.PARSING_DONE;\r\n\t\t\t} else if (!this.geoCreated) {\r\n\t\t\t\tthis.geoCreated = true;\r\n\t\t\t\t//create default subgeometry\r\n\t\t\t\tthis._geometry.addSubGeometry(this._firstSubGeom.clone());\r\n\t\t\t\t// Force name to be chosen by this._pFinalizeAsset()\r\n\t\t\t\tthis._mesh.name = \"\";\r\n\t\t\t\tif (this.materialFinal) {\r\n\t\t\t\t\t//add to the content property\r\n\t\t\t\t\t(<DisplayObjectContainer> this._pContent).addChild(this._mesh);\r\n\r\n\t\t\t\t\tthis._pFinalizeAsset(this._mesh.geometry);\r\n\t\t\t\t\tthis._pFinalizeAsset(this._mesh);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._pPauseAndRetrieveDependencies();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn ParserBase.MORE_TO_PARSE;\r\n\t}\r\n\r\n\tpublic _pStartParsing(frameLimit:number)\r\n\t{\r\n\t\tsuper._pStartParsing(frameLimit);\r\n\r\n\t\t//create a content object for Loaders\r\n\t\tthis._pContent = new DisplayObjectContainer();\r\n\t}\r\n\r\n\t/**\r\n\t * Reads in all that MD2 Header data that is declared as private variables.\r\n\t * I know its a lot, and it looks ugly, but only way to do it in Flash\r\n\t */\r\n\tprivate parseHeader()\r\n\t{\r\n\t\tthis._ident = this._byteData.readInt();\r\n\t\tthis._version = this._byteData.readInt();\r\n\t\tthis._skinWidth = this._byteData.readInt();\r\n\t\tthis._skinHeight = this._byteData.readInt();\r\n\t\t//skip this._frameSize\r\n\t\tthis._byteData.readInt();\r\n\t\tthis._numSkins = this._byteData.readInt();\r\n\t\tthis._numVertices = this._byteData.readInt();\r\n\t\tthis._numST = this._byteData.readInt();\r\n\t\tthis._numTris = this._byteData.readInt();\r\n\t\t//skip this._numGlCmds\r\n\t\tthis._byteData.readInt();\r\n\t\tthis._numFrames = this._byteData.readInt();\r\n\t\tthis._offsetSkins = this._byteData.readInt();\r\n\t\tthis._offsetST = this._byteData.readInt();\r\n\t\tthis._offsetTris = this._byteData.readInt();\r\n\t\tthis._offsetFrames = this._byteData.readInt();\r\n\t\t//skip this._offsetGlCmds\r\n\t\tthis._byteData.readInt();\r\n\t\tthis._offsetEnd = this._byteData.readInt();\r\n\r\n\t\tthis._parsedHeader = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Parses the file names for the materials.\r\n\t */\r\n\tprivate parseMaterialNames()\r\n\t{\r\n\t\tvar url:string;\r\n\t\tvar name:string;\r\n\t\tvar extIndex:number /*int*/;\r\n\t\tvar slashIndex:number /*int*/;\r\n\t\tthis._materialNames = new Array<string>();\r\n\t\tthis._byteData.position = this._offsetSkins;\r\n\r\n\t\tvar regExp:RegExp = new RegExp(\"[^a-zA-Z0-9\\\\_\\/.]\", \"g\");\r\n\t\tfor (var i:number /*uint*/ = 0; i < this._numSkins; ++i) {\r\n\t\t\tname = this._byteData.readUTFBytes(64);\r\n\t\t\tname = name.replace(regExp, \"\");\r\n\t\t\textIndex = name.lastIndexOf(\".\");\r\n\t\t\tif (this._ignoreTexturePath)\r\n\t\t\t\tslashIndex = name.lastIndexOf(\"/\");\r\n\t\t\tif (name.toLowerCase().indexOf(\".jpg\") == -1 && name.toLowerCase().indexOf(\".png\") == -1) {\r\n\t\t\t\tname = name.substring(slashIndex + 1, extIndex);\r\n\t\t\t\turl = name + \".\" + this._textureType;\r\n\t\t\t} else {\r\n\t\t\t\turl = name;\r\n\t\t\t}\r\n\r\n\t\t\tthis._materialNames[i] = name;\r\n\r\n\t\t\t// only support 1 skin TODO: really?\r\n\t\t\tif (this.dependencies.length == 0)\r\n\t\t\t\tthis._pAddDependency(name, new URLRequest(url));\r\n\t\t}\r\n\r\n\t\tif (this._materialNames.length > 0)\r\n\t\t\tthis._mesh.material.name = this._materialNames[0]; else\r\n\t\t\tthis.materialFinal = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Parses the uv data for the mesh.\r\n\t */\r\n\tprivate parseUV()\r\n\t{\r\n\t\tvar j:number /*uint*/ = 0;\r\n\r\n\t\tthis._uvs = new Array<number>(this._numST*2);\r\n\t\tthis._byteData.position = this._offsetST;\r\n\t\tfor (var i:number /*uint*/ = 0; i < this._numST; i++) {\r\n\t\t\tthis._uvs[j++] = this._byteData.readShort()/this._skinWidth;\r\n\t\t\tthis._uvs[j++] = this._byteData.readShort()/this._skinHeight;\r\n\t\t}\r\n\r\n\t\tthis._parsedUV = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Parses unique indices for the faces.\r\n\t */\r\n\tprivate parseFaces()\r\n\t{\r\n\t\tvar a:number /*uint*/, b:number /*uint*/, c:number /*uint*/, ta:number /*uint*/, tb:number /*uint*/, tc:number /*uint*/;\r\n\t\tvar i:number /*uint*/;\r\n\r\n\t\tthis._vertIndices = new Array<number>();\r\n\t\tthis._uvIndices = new Array<number>();\r\n\t\tthis._indices = new Array<number>() /*uint*/;\r\n\r\n\t\tthis._byteData.position = this._offsetTris;\r\n\r\n\t\tfor (i = 0; i < this._numTris; i++) {\r\n\t\t\t//collect vertex indices\r\n\t\t\ta = this._byteData.readUnsignedShort();\r\n\t\t\tb = this._byteData.readUnsignedShort();\r\n\t\t\tc = this._byteData.readUnsignedShort();\r\n\r\n\t\t\t//collect uv indices\r\n\t\t\tta = this._byteData.readUnsignedShort();\r\n\t\t\ttb = this._byteData.readUnsignedShort();\r\n\t\t\ttc = this._byteData.readUnsignedShort();\r\n\r\n\t\t\tthis.addIndex(a, ta);\r\n\t\t\tthis.addIndex(b, tb);\r\n\t\t\tthis.addIndex(c, tc);\r\n\t\t}\r\n\r\n\t\tvar len:number /*uint*/ = this._uvIndices.length;\r\n\t\tthis._finalUV = new Array<number>(len*2);\r\n\r\n\t\tfor (i = 0; i < len; ++i) {\r\n\t\t\tthis._finalUV[i << 1] = this._uvs[this._uvIndices[i] << 1];\r\n\t\t\tthis._finalUV[(i << 1) + 1] = this._uvs[(this._uvIndices[i] << 1) + 1];\r\n\t\t}\r\n\r\n\t\tthis._parsedFaces = true;\r\n\t}\r\n\r\n\t/**\r\n\t * Adds a face index to the list if it doesn't exist yet, based on vertexIndex and uvIndex, and adds the\r\n\t * corresponding vertex and uv data in the correct location.\r\n\t * @param vertexIndex The original index in the vertex list.\r\n\t * @param uvIndex The original index in the uv list.\r\n\t */\r\n\tprivate addIndex(vertexIndex:number /*uint*/, uvIndex:number /*uint*/)\r\n\t{\r\n\t\tvar index:number /*int*/ = this.findIndex(vertexIndex, uvIndex);\r\n\r\n\t\tif (index == -1) {\r\n\t\t\tthis._indices.push(this._vertIndices.length);\r\n\t\t\tthis._vertIndices.push(vertexIndex);\r\n\t\t\tthis._uvIndices.push(uvIndex);\r\n\t\t} else\r\n\t\t\tthis._indices.push(index);\r\n\t}\r\n\r\n\t/**\r\n\t * Finds the final index corresponding to the original MD2's vertex and uv indices. Returns -1 if it wasn't added yet.\r\n\t * @param vertexIndex The original index in the vertex list.\r\n\t * @param uvIndex The original index in the uv list.\r\n\t * @return The index of the final mesh corresponding to the original vertex and uv index. -1 if it doesn't exist yet.\r\n\t */\r\n\tprivate findIndex(vertexIndex:number /*uint*/, uvIndex:number /*uint*/):number /*int*/\r\n\t{\r\n\t\tvar len:number /*uint*/ = this._vertIndices.length;\r\n\r\n\t\tfor (var i:number /*uint*/ = 0; i < len; ++i) {\r\n\t\t\tif (this._vertIndices[i] == vertexIndex && this._uvIndices[i] == uvIndex)\r\n\t\t\t\treturn i;\r\n\t\t}\r\n\r\n\t\treturn -1;\r\n\t}\r\n\r\n\t/**\r\n\t * Parses all the frame geometries.\r\n\t */\r\n\tprivate parseFrames()\r\n\t{\r\n\t\tvar sx:number, sy:number, sz:number;\r\n\t\tvar tx:number, ty:number, tz:number;\r\n\t\tvar geometry:Geometry;\r\n\t\tvar subGeom:TriangleSubGeometry;\r\n\t\tvar vertLen:number /*uint*/ = this._vertIndices.length;\r\n\t\tvar fvertices:Array<number>;\r\n\t\tvar tvertices:Array<number>;\r\n\t\tvar i:number /*uint*/, j:number /*int*/, k:number /*uint*/;\r\n\t\t//var ch : number /*uint*/;\r\n\t\tvar name:string = \"\";\r\n\t\tvar prevClip:VertexClipNode = null;\r\n\r\n\t\tthis._byteData.position = this._offsetFrames;\r\n\r\n\t\tfor (i = 0; i < this._numFrames; i++) {\r\n\r\n\t\t\ttvertices = new Array<number>();\r\n\t\t\tfvertices = new Array<number>(vertLen*3);\r\n\r\n\t\t\tsx = this._byteData.readFloat();\r\n\t\t\tsy = this._byteData.readFloat();\r\n\t\t\tsz = this._byteData.readFloat();\r\n\r\n\t\t\ttx = this._byteData.readFloat();\r\n\t\t\tty = this._byteData.readFloat();\r\n\t\t\ttz = this._byteData.readFloat();\r\n\r\n\t\t\tname = this.readFrameName();\r\n\r\n\t\t\t// Note, the extra data.position++ in the for loop is there\r\n\t\t\t// to skip over a byte that holds the \"vertex normal index\"\r\n\t\t\tfor (j = 0; j < this._numVertices; j++, this._byteData.position++)\r\n\t\t\t\ttvertices.push(sx*this._byteData.readUnsignedByte() + tx, sy*this._byteData.readUnsignedByte() + ty, sz*this._byteData.readUnsignedByte() + tz);\r\n\r\n\t\t\tk = 0;\r\n\t\t\tfor (j = 0; j < vertLen; j++) {\r\n\t\t\t\tfvertices[k++] = tvertices[this._vertIndices[j]*3];\r\n\t\t\t\tfvertices[k++] = tvertices[this._vertIndices[j]*3 + 2];\r\n\t\t\t\tfvertices[k++] = tvertices[this._vertIndices[j]*3 + 1];\r\n\t\t\t}\r\n\r\n\t\t\tsubGeom = new TriangleSubGeometry(true);\r\n\r\n\t\t\tif (this._firstSubGeom == null)\r\n\t\t\t\tthis._firstSubGeom = subGeom;\r\n\r\n\t\t\tgeometry = new Geometry();\r\n\t\t\tgeometry.addSubGeometry(subGeom);\r\n\r\n\t\t\tsubGeom.updateIndices(this._indices);\r\n\t\t\tsubGeom.updatePositions(fvertices);\r\n\t\t\tsubGeom.updateUVs(this._finalUV);\r\n\t\t\tsubGeom.vertexNormals;\r\n\t\t\tsubGeom.vertexTangents;\r\n\t\t\tsubGeom.autoDeriveNormals = false;\r\n\t\t\tsubGeom.autoDeriveTangents = false;\r\n\r\n\t\t\tvar clip:VertexClipNode = this._clipNodes[name];\r\n\r\n\t\t\tif (!clip) {\r\n\t\t\t\t// If another sequence was parsed before this one, starting\r\n\t\t\t\t// a new state means the previous one is complete and can\r\n\t\t\t\t// hence be finalized.\r\n\t\t\t\tif (prevClip) {\r\n\t\t\t\t\tthis._pFinalizeAsset(prevClip);\r\n\t\t\t\t\tthis._animationSet.addAnimation(prevClip);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tclip = new VertexClipNode();\r\n\t\t\t\tclip.name = name;\r\n\t\t\t\tclip.stitchFinalFrame = true;\r\n\r\n\t\t\t\tthis._clipNodes[name] = clip;\r\n\r\n\t\t\t\tprevClip = clip;\r\n\t\t\t}\r\n\t\t\tclip.addFrame(geometry, 1000/MD2Parser.FPS);\r\n\t\t}\r\n\r\n\t\t// Finalize the last state\r\n\t\tif (prevClip) {\r\n\t\t\tthis._pFinalizeAsset(prevClip);\r\n\t\t\tthis._animationSet.addAnimation(prevClip);\r\n\t\t}\r\n\r\n\t\t// Force this._pFinalizeAsset() to decide name\r\n\t\tthis._pFinalizeAsset(this._animationSet);\r\n\r\n\t\tthis._parsedFrames = true;\r\n\t}\r\n\r\n\tprivate readFrameName():string\r\n\t{\r\n\t\tvar name:string = \"\";\r\n\t\tvar k:number /*uint*/ = 0;\r\n\t\tfor (var j:number /*uint*/ = 0; j < 16; j++) {\r\n\t\t\tvar ch:number /*uint*/ = this._byteData.readUnsignedByte();\r\n\r\n\t\t\tif (Math.floor(ch) > 0x39 && Math.floor(ch) <= 0x7A && k == 0)\r\n\t\t\t\tname += String.fromCharCode(ch);\r\n\r\n\t\t\tif (Math.floor(ch) >= 0x30 && Math.floor(ch) <= 0x39)\r\n\t\t\t\tk++;\r\n\t\t}\r\n\t\treturn name;\r\n\t}\r\n}\r\n\r\nexport = MD2Parser;",
    "import Quaternion\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Quaternion\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\nimport URLLoaderDataFormat\t\t\t\t= require(\"awayjs-core/lib/net/URLLoaderDataFormat\");\r\nimport ParserBase\t\t\t\t\t\t= require(\"awayjs-core/lib/parsers/ParserBase\");\r\n\r\nimport JointPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/JointPose\");\r\nimport SkeletonPose\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/SkeletonPose\");\r\nimport SkeletonClipNode\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/nodes/SkeletonClipNode\");\r\n\r\n/**\r\n * MD5AnimParser provides a parser for the md5anim data type, providing an animation sequence for the md5 format.\r\n *\r\n * todo: optimize\r\n */\r\nclass MD5AnimParser extends ParserBase\r\n{\r\n\tprivate _textData:string;\r\n\tprivate _startedParsing:boolean;\r\n\tpublic static VERSION_TOKEN:string = \"MD5Version\";\r\n\tpublic static COMMAND_LINE_TOKEN:string = \"commandline\";\r\n\tpublic static NUM_FRAMES_TOKEN:string = \"numFrames\";\r\n\tpublic static NUM_JOINTS_TOKEN:string = \"numJoints\";\r\n\tpublic static FRAME_RATE_TOKEN:string = \"frameRate\";\r\n\tpublic static NUM_ANIMATED_COMPONENTS_TOKEN:string = \"numAnimatedComponents\";\r\n\r\n\tpublic static HIERARCHY_TOKEN:string = \"hierarchy\";\r\n\tpublic static BOUNDS_TOKEN:string = \"bounds\";\r\n\tpublic static BASE_FRAME_TOKEN:string = \"baseframe\";\r\n\tpublic static FRAME_TOKEN:string = \"frame\";\r\n\r\n\tpublic static COMMENT_TOKEN:string = \"//\";\r\n\r\n\tprivate _parseIndex:number /*int*/ = 0;\r\n\tprivate _reachedEOF:boolean;\r\n\tprivate _line:number /*int*/ = 0;\r\n\tprivate _charLineIndex:number /*int*/ = 0;\r\n\tprivate _version:number /*int*/;\r\n\tprivate _frameRate:number /*int*/;\r\n\tprivate _numFrames:number /*int*/;\r\n\tprivate _numJoints:number /*int*/;\r\n\tprivate _numAnimatedComponents:number /*int*/;\r\n\r\n\tprivate _hierarchy:Array<HierarchyData>;\r\n\tprivate _bounds:Array<BoundsData>;\r\n\tprivate _frameData:Array<FrameData>;\r\n\tprivate _baseFrameData:Array<BaseFrameData>;\r\n\r\n\tprivate _rotationQuat:Quaternion;\r\n\tprivate _clip:SkeletonClipNode;\r\n\r\n\t/**\r\n\t * Creates a new MD5AnimParser object.\r\n\t * @param uri The url or id of the data or file to be parsed.\r\n\t * @param extra The holder for extra contextual data that the parser might need.\r\n\t */\r\n\tconstructor(additionalRotationAxis:Vector3D = null, additionalRotationRadians:number = 0)\r\n\t{\r\n\t\tsuper(URLLoaderDataFormat.TEXT);\r\n\t\tthis._rotationQuat = new Quaternion();\r\n\t\tvar t1:Quaternion = new Quaternion();\r\n\t\tvar t2:Quaternion = new Quaternion();\r\n\r\n\t\tt1.fromAxisAngle(Vector3D.X_AXIS, -Math.PI*.5);\r\n\t\tt2.fromAxisAngle(Vector3D.Y_AXIS, -Math.PI*.5);\r\n\r\n\t\tthis._rotationQuat.multiply(t2, t1);\r\n\r\n\t\tif (additionalRotationAxis) {\r\n\t\t\tthis._rotationQuat.multiply(t2, t1);\r\n\t\t\tt1.fromAxisAngle(additionalRotationAxis, additionalRotationRadians);\r\n\t\t\tthis._rotationQuat.multiply(t1, this._rotationQuat);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates whether or not a given file extension is supported by the parser.\r\n\t * @param extension The file extension of a potential file to be parsed.\r\n\t * @return Whether or not the given file type is supported.\r\n\t */\r\n\tpublic static supportsType(extension:string):boolean\r\n\t{\r\n\t\textension = extension.toLowerCase();\r\n\t\treturn extension == \"md5anim\";\r\n\t}\r\n\r\n\t/**\r\n\t * Tests whether a data block can be parsed by the parser.\r\n\t * @param data The data block to potentially be parsed.\r\n\t * @return Whether or not the given data is supported.\r\n\t */\r\n\tpublic static supportsData(data:any):boolean\r\n\t{\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pProceedParsing():boolean\r\n\t{\r\n\t\tvar token:string;\r\n\r\n\t\tif (!this._startedParsing) {\r\n\t\t\tthis._textData = this._pGetTextData();\r\n\t\t\tthis._startedParsing = true;\r\n\t\t}\r\n\r\n\t\twhile (this._pHasTime()) {\r\n\t\t\ttoken = this.getNextToken();\r\n\t\t\tswitch (token) {\r\n\t\t\t\tcase MD5AnimParser.COMMENT_TOKEN:\r\n\t\t\t\t\tthis.ignoreLine();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"\":\r\n\t\t\t\t\t// can occur at the end of a file\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5AnimParser.VERSION_TOKEN:\r\n\t\t\t\t\tthis._version = this.getNextInt();\r\n\t\t\t\t\tif (this._version != 10)\r\n\t\t\t\t\t\tthrow new Error(\"Unknown version number encountered!\");\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5AnimParser.COMMAND_LINE_TOKEN:\r\n\t\t\t\t\tthis.parseCMD();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5AnimParser.NUM_FRAMES_TOKEN:\r\n\t\t\t\t\tthis._numFrames = this.getNextInt();\r\n\t\t\t\t\tthis._bounds = new Array<BoundsData>();\r\n\t\t\t\t\tthis._frameData = new Array<FrameData>();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5AnimParser.NUM_JOINTS_TOKEN:\r\n\t\t\t\t\tthis._numJoints = this.getNextInt();\r\n\t\t\t\t\tthis._hierarchy = new Array<HierarchyData>(this._numJoints);\r\n\t\t\t\t\tthis._baseFrameData = new Array<BaseFrameData>(this._numJoints);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5AnimParser.FRAME_RATE_TOKEN:\r\n\t\t\t\t\tthis._frameRate = this.getNextInt();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5AnimParser.NUM_ANIMATED_COMPONENTS_TOKEN:\r\n\t\t\t\t\tthis._numAnimatedComponents = this.getNextInt();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5AnimParser.HIERARCHY_TOKEN:\r\n\t\t\t\t\tthis.parseHierarchy();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5AnimParser.BOUNDS_TOKEN:\r\n\t\t\t\t\tthis.parseBounds();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5AnimParser.BASE_FRAME_TOKEN:\r\n\t\t\t\t\tthis.parseBaseFrame();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5AnimParser.FRAME_TOKEN:\r\n\t\t\t\t\tthis.parseFrame();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tif (!this._reachedEOF)\r\n\t\t\t\t\t\tthis.sendUnknownKeywordError();\r\n\t\t\t}\r\n\r\n\t\t\tif (this._reachedEOF) {\r\n\t\t\t\tthis._clip = new SkeletonClipNode();\r\n\t\t\t\tthis.translateClip();\r\n\t\t\t\tthis._pFinalizeAsset(this._clip);\r\n\t\t\t\treturn ParserBase.PARSING_DONE;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn ParserBase.MORE_TO_PARSE;\r\n\t}\r\n\r\n\t/**\r\n\t * Converts all key frame data to an SkinnedAnimationSequence.\r\n\t */\r\n\tprivate translateClip():void\r\n\t{\r\n\t\tfor (var i:number /*int*/ = 0; i < this._numFrames; ++i)\r\n\t\t\tthis._clip.addFrame(this.translatePose(this._frameData[i]), 1000/this._frameRate);\r\n\t}\r\n\r\n\t/**\r\n\t * Converts a single key frame data to a SkeletonPose.\r\n\t * @param frameData The actual frame data.\r\n\t * @return A SkeletonPose containing the frame data's pose.\r\n\t */\r\n\tprivate translatePose(frameData:FrameData):SkeletonPose\r\n\t{\r\n\t\tvar hierarchy:HierarchyData;\r\n\t\tvar pose:JointPose;\r\n\t\tvar base:BaseFrameData;\r\n\t\tvar flags:number /*int*/;\r\n\t\tvar j:number /*int*/;\r\n\t\tvar translate:Vector3D = new Vector3D();\r\n\t\tvar orientation:Quaternion = new Quaternion();\r\n\t\tvar components:Array<number> = frameData.components;\r\n\t\tvar skelPose:SkeletonPose = new SkeletonPose();\r\n\t\tvar jointPoses:Array<JointPose> = skelPose.jointPoses;\r\n\r\n\t\tfor (var i:number /*int*/ = 0; i < this._numJoints; ++i) {\r\n\t\t\tj = 0;\r\n\t\t\tpose = new JointPose();\r\n\t\t\thierarchy = this._hierarchy[i];\r\n\t\t\tbase = this._baseFrameData[i];\r\n\t\t\tflags = hierarchy.flags;\r\n\t\t\ttranslate.x = base.position.x;\r\n\t\t\ttranslate.y = base.position.y;\r\n\t\t\ttranslate.z = base.position.z;\r\n\t\t\torientation.x = base.orientation.x;\r\n\t\t\torientation.y = base.orientation.y;\r\n\t\t\torientation.z = base.orientation.z;\r\n\r\n\t\t\tif (flags & 1)\r\n\t\t\t\ttranslate.x = components[hierarchy.startIndex + (j++)];\r\n\t\t\tif (flags & 2)\r\n\t\t\t\ttranslate.y = components[hierarchy.startIndex + (j++)];\r\n\t\t\tif (flags & 4)\r\n\t\t\t\ttranslate.z = components[hierarchy.startIndex + (j++)];\r\n\t\t\tif (flags & 8)\r\n\t\t\t\torientation.x = components[hierarchy.startIndex + (j++)];\r\n\t\t\tif (flags & 16)\r\n\t\t\t\torientation.y = components[hierarchy.startIndex + (j++)];\r\n\t\t\tif (flags & 32)\r\n\t\t\t\torientation.z = components[hierarchy.startIndex + (j++)];\r\n\r\n\t\t\tvar w:number = 1 - orientation.x*orientation.x - orientation.y*orientation.y - orientation.z*orientation.z;\r\n\t\t\torientation.w = w < 0? 0 : -Math.sqrt(w);\r\n\r\n\t\t\tif (hierarchy.parentIndex < 0) {\r\n\t\t\t\tpose.orientation.multiply(this._rotationQuat, orientation);\r\n\t\t\t\tpose.translation = this._rotationQuat.rotatePoint(translate);\r\n\t\t\t} else {\r\n\t\t\t\tpose.orientation.copyFrom(orientation);\r\n\t\t\t\tpose.translation.x = translate.x;\r\n\t\t\t\tpose.translation.y = translate.y;\r\n\t\t\t\tpose.translation.z = translate.z;\r\n\t\t\t}\r\n\t\t\tpose.orientation.y = -pose.orientation.y;\r\n\t\t\tpose.orientation.z = -pose.orientation.z;\r\n\t\t\tpose.translation.x = -pose.translation.x;\r\n\r\n\t\t\tjointPoses[i] = pose;\r\n\t\t}\r\n\r\n\t\treturn skelPose;\r\n\t}\r\n\r\n\t/**\r\n\t * Parses the skeleton's hierarchy data.\r\n\t */\r\n\tprivate parseHierarchy():void\r\n\t{\r\n\t\tvar ch:string;\r\n\t\tvar data:HierarchyData;\r\n\t\tvar token:string = this.getNextToken();\r\n\t\tvar i:number /*int*/ = 0;\r\n\r\n\t\tif (token != \"{\")\r\n\t\t\tthis.sendUnknownKeywordError();\r\n\r\n\t\tdo {\r\n\t\t\tif (this._reachedEOF)\r\n\t\t\t\tthis.sendEOFError();\r\n\t\t\tdata = new HierarchyData();\r\n\t\t\tdata.name = this.parseLiteralstring();\r\n\t\t\tdata.parentIndex = this.getNextInt();\r\n\t\t\tdata.flags = this.getNextInt();\r\n\t\t\tdata.startIndex = this.getNextInt();\r\n\t\t\tthis._hierarchy[i++] = data;\r\n\r\n\t\t\tch = this.getNextChar();\r\n\r\n\t\t\tif (ch == \"/\") {\r\n\t\t\t\tthis.putBack();\r\n\t\t\t\tch = this.getNextToken();\r\n\t\t\t\tif (ch == MD5AnimParser.COMMENT_TOKEN)\r\n\t\t\t\t\tthis.ignoreLine();\r\n\t\t\t\tch = this.getNextChar();\r\n\t\t\t}\r\n\r\n\t\t\tif (ch != \"}\")\r\n\t\t\t\tthis.putBack();\r\n\r\n\t\t} while (ch != \"}\");\r\n\t}\r\n\r\n\t/**\r\n\t * Parses frame bounds.\r\n\t */\r\n\tprivate parseBounds():void\r\n\t{\r\n\t\tvar ch:string;\r\n\t\tvar data:BoundsData;\r\n\t\tvar token:string = this.getNextToken();\r\n\t\tvar i:number /*int*/ = 0;\r\n\r\n\t\tif (token != \"{\")\r\n\t\t\tthis.sendUnknownKeywordError();\r\n\r\n\t\tdo {\r\n\t\t\tif (this._reachedEOF)\r\n\t\t\t\tthis.sendEOFError();\r\n\t\t\tdata = new BoundsData();\r\n\t\t\tdata.min = this.parseVector3D();\r\n\t\t\tdata.max = this.parseVector3D();\r\n\t\t\tthis._bounds[i++] = data;\r\n\r\n\t\t\tch = this.getNextChar();\r\n\r\n\t\t\tif (ch == \"/\") {\r\n\t\t\t\tthis.putBack();\r\n\t\t\t\tch = this.getNextToken();\r\n\t\t\t\tif (ch == MD5AnimParser.COMMENT_TOKEN)\r\n\t\t\t\t\tthis.ignoreLine();\r\n\t\t\t\tch = this.getNextChar();\r\n\t\t\t}\r\n\r\n\t\t\tif (ch != \"}\")\r\n\t\t\t\tthis.putBack();\r\n\r\n\t\t} while (ch != \"}\");\r\n\t}\r\n\r\n\t/**\r\n\t * Parses the base frame.\r\n\t */\r\n\tprivate parseBaseFrame():void\r\n\t{\r\n\t\tvar ch:string;\r\n\t\tvar data:BaseFrameData;\r\n\t\tvar token:string = this.getNextToken();\r\n\t\tvar i:number /*int*/ = 0;\r\n\r\n\t\tif (token != \"{\")\r\n\t\t\tthis.sendUnknownKeywordError();\r\n\r\n\t\tdo {\r\n\t\t\tif (this._reachedEOF)\r\n\t\t\t\tthis.sendEOFError();\r\n\t\t\tdata = new BaseFrameData();\r\n\t\t\tdata.position = this.parseVector3D();\r\n\t\t\tdata.orientation = this.parseQuaternion();\r\n\t\t\tthis._baseFrameData[i++] = data;\r\n\r\n\t\t\tch = this.getNextChar();\r\n\r\n\t\t\tif (ch == \"/\") {\r\n\t\t\t\tthis.putBack();\r\n\t\t\t\tch = this.getNextToken();\r\n\t\t\t\tif (ch == MD5AnimParser.COMMENT_TOKEN)\r\n\t\t\t\t\tthis.ignoreLine();\r\n\t\t\t\tch = this.getNextChar();\r\n\t\t\t}\r\n\r\n\t\t\tif (ch != \"}\")\r\n\t\t\t\tthis.putBack();\r\n\r\n\t\t} while (ch != \"}\");\r\n\t}\r\n\r\n\t/**\r\n\t * Parses a single frame.\r\n\t */\r\n\tprivate parseFrame():void\r\n\t{\r\n\t\tvar ch:string;\r\n\t\tvar data:FrameData;\r\n\t\tvar token:string;\r\n\t\tvar frameIndex:number /*int*/;\r\n\r\n\t\tframeIndex = this.getNextInt();\r\n\r\n\t\ttoken = this.getNextToken();\r\n\t\tif (token != \"{\")\r\n\t\t\tthis.sendUnknownKeywordError();\r\n\r\n\t\tdo {\r\n\t\t\tif (this._reachedEOF)\r\n\t\t\t\tthis.sendEOFError();\r\n\t\t\tdata = new FrameData();\r\n\t\t\tdata.components = new Array<number>(this._numAnimatedComponents);\r\n\r\n\t\t\tfor (var i:number /*int*/ = 0; i < this._numAnimatedComponents; ++i)\r\n\t\t\t\tdata.components[i] = this.getNextNumber();\r\n\r\n\t\t\tthis._frameData[frameIndex] = data;\r\n\r\n\t\t\tch = this.getNextChar();\r\n\r\n\t\t\tif (ch == \"/\") {\r\n\t\t\t\tthis.putBack();\r\n\t\t\t\tch = this.getNextToken();\r\n\t\t\t\tif (ch == MD5AnimParser.COMMENT_TOKEN)\r\n\t\t\t\t\tthis.ignoreLine();\r\n\t\t\t\tch = this.getNextChar();\r\n\t\t\t}\r\n\r\n\t\t\tif (ch != \"}\")\r\n\t\t\t\tthis.putBack();\r\n\r\n\t\t} while (ch != \"}\");\r\n\t}\r\n\r\n\t/**\r\n\t * Puts back the last read character into the data stream.\r\n\t */\r\n\tprivate putBack():void\r\n\t{\r\n\t\tthis._parseIndex--;\r\n\t\tthis._charLineIndex--;\r\n\t\tthis._reachedEOF = this._parseIndex >= this._textData.length;\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the next token in the data stream.\r\n\t */\r\n\tprivate getNextToken():string\r\n\t{\r\n\t\tvar ch:string;\r\n\t\tvar token:string = \"\";\r\n\r\n\t\twhile (!this._reachedEOF) {\r\n\t\t\tch = this.getNextChar();\r\n\t\t\tif (ch == \" \" || ch == \"\\r\" || ch == \"\\n\" || ch == \"\\t\") {\r\n\t\t\t\tif (token != MD5AnimParser.COMMENT_TOKEN)\r\n\t\t\t\t\tthis.skipWhiteSpace();\r\n\t\t\t\tif (token != \"\")\r\n\t\t\t\t\treturn token;\r\n\t\t\t} else\r\n\t\t\t\ttoken += ch;\r\n\r\n\t\t\tif (token == MD5AnimParser.COMMENT_TOKEN)\r\n\t\t\t\treturn token;\r\n\t\t}\r\n\r\n\t\treturn token;\r\n\t}\r\n\r\n\t/**\r\n\t * Skips all whitespace in the data stream.\r\n\t */\r\n\tprivate skipWhiteSpace():void\r\n\t{\r\n\t\tvar ch:string;\r\n\r\n\t\tdo\r\n\t\t\tch = this.getNextChar(); while (ch == \"\\n\" || ch == \" \" || ch == \"\\r\" || ch == \"\\t\");\r\n\r\n\t\tthis.putBack();\r\n\t}\r\n\r\n\t/**\r\n\t * Skips to the next line.\r\n\t */\r\n\tprivate ignoreLine():void\r\n\t{\r\n\t\tvar ch:string;\r\n\t\twhile (!this._reachedEOF && ch != \"\\n\")\r\n\t\t\tch = this.getNextChar();\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieves the next single character in the data stream.\r\n\t */\r\n\tprivate getNextChar():string\r\n\t{\r\n\t\tvar ch:string = this._textData.charAt(this._parseIndex++);\r\n\r\n\t\tif (ch == \"\\n\") {\r\n\t\t\t++this._line;\r\n\t\t\tthis._charLineIndex = 0;\r\n\t\t} else if (ch != \"\\r\")\r\n\t\t\t++this._charLineIndex;\r\n\r\n\t\tif (this._parseIndex == this._textData.length)\r\n\t\t\tthis._reachedEOF = true;\r\n\r\n\t\treturn ch;\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieves the next integer in the data stream.\r\n\t */\r\n\tprivate getNextInt():number /*int*/\r\n\t{\r\n\t\tvar i:number = parseInt(this.getNextToken());\r\n\t\tif (isNaN(i))\r\n\t\t\tthis.sendParseError(\"int type\");\r\n\t\treturn i;\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieves the next floating point number in the data stream.\r\n\t */\r\n\tprivate getNextNumber():number\r\n\t{\r\n\t\tvar f:number = parseFloat(this.getNextToken());\r\n\t\tif (isNaN(f))\r\n\t\t\tthis.sendParseError(\"float type\");\r\n\t\treturn f;\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieves the next 3d vector in the data stream.\r\n\t */\r\n\tprivate parseVector3D():Vector3D\r\n\t{\r\n\t\tvar vec:Vector3D = new Vector3D();\r\n\t\tvar ch:string = this.getNextToken();\r\n\r\n\t\tif (ch != \"(\")\r\n\t\t\tthis.sendParseError(\"(\");\r\n\t\tvec.x = this.getNextNumber();\r\n\t\tvec.y = this.getNextNumber();\r\n\t\tvec.z = this.getNextNumber();\r\n\r\n\t\tif (this.getNextToken() != \")\")\r\n\t\t\tthis.sendParseError(\")\");\r\n\r\n\t\treturn vec;\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieves the next quaternion in the data stream.\r\n\t */\r\n\tprivate parseQuaternion():Quaternion\r\n\t{\r\n\t\tvar quat:Quaternion = new Quaternion();\r\n\t\tvar ch:string = this.getNextToken();\r\n\r\n\t\tif (ch != \"(\")\r\n\t\t\tthis.sendParseError(\"(\");\r\n\t\tquat.x = this.getNextNumber();\r\n\t\tquat.y = this.getNextNumber();\r\n\t\tquat.z = this.getNextNumber();\r\n\r\n\t\t// quat supposed to be unit length\r\n\t\tvar t:number = 1 - (quat.x*quat.x) - (quat.y*quat.y) - (quat.z*quat.z);\r\n\t\tquat.w = t < 0? 0 : -Math.sqrt(t);\r\n\r\n\t\tif (this.getNextToken() != \")\")\r\n\t\t\tthis.sendParseError(\")\");\r\n\r\n\t\treturn quat;\r\n\t}\r\n\r\n\t/**\r\n\t * Parses the command line data.\r\n\t */\r\n\tprivate parseCMD():void\r\n\t{\r\n\t\t// just ignore the command line property\r\n\t\tthis.parseLiteralstring();\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieves the next literal string in the data stream. A literal string is a sequence of characters bounded\r\n\t * by double quotes.\r\n\t */\r\n\tprivate parseLiteralstring():string\r\n\t{\r\n\t\tthis.skipWhiteSpace();\r\n\r\n\t\tvar ch:string = this.getNextChar();\r\n\t\tvar str:string = \"\";\r\n\r\n\t\tif (ch != \"\\\"\")\r\n\t\t\tthis.sendParseError(\"\\\"\");\r\n\r\n\t\tdo {\r\n\t\t\tif (this._reachedEOF)\r\n\t\t\t\tthis.sendEOFError();\r\n\t\t\tch = this.getNextChar();\r\n\t\t\tif (ch != \"\\\"\")\r\n\t\t\t\tstr += ch;\r\n\t\t} while (ch != \"\\\"\");\r\n\r\n\t\treturn str;\r\n\t}\r\n\r\n\t/**\r\n\t * Throws an end-of-file error when a premature end of file was encountered.\r\n\t */\r\n\tprivate sendEOFError():void\r\n\t{\r\n\t\tthrow new Error(\"Unexpected end of file\");\r\n\t}\r\n\r\n\t/**\r\n\t * Throws an error when an unexpected token was encountered.\r\n\t * @param expected The token type that was actually expected.\r\n\t */\r\n\tprivate sendParseError(expected:string):void\r\n\t{\r\n\t\tthrow new Error(\"Unexpected token at line \" + (this._line + 1) + \", character \" + this._charLineIndex + \". \" + expected + \" expected, but \" + this._textData.charAt(this._parseIndex - 1) + \" encountered\");\r\n\t}\r\n\r\n\t/**\r\n\t * Throws an error when an unknown keyword was encountered.\r\n\t */\r\n\tprivate sendUnknownKeywordError():void\r\n\t{\r\n\t\tthrow new Error(\"Unknown keyword at line \" + (this._line + 1) + \", character \" + this._charLineIndex + \". \");\r\n\t}\r\n}\r\n\r\nexport = MD5AnimParser;\r\n\r\n\r\n/**\r\n *\r\n */\r\nclass BaseFrameData\r\n{\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic position:Vector3D;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic orientation:Quaternion;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nclass BoundsData\r\n{\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic min:Vector3D;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic max:Vector3D;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nclass FrameData\r\n{\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic index:number /*int*/;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic components:Array<number>;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nclass HierarchyData\r\n{\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic name:string;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic parentIndex:number /*int*/;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic flags:number /*int*/;\r\n\r\n\t/**\r\n\t *\r\n\t */\r\n\tpublic startIndex:number /*int*/;\r\n}",
    "import Geometry\t\t\t\t\t\t\t= require(\"awayjs-core/lib/data/Geometry\");\r\nimport TriangleSubGeometry\t\t\t\t= require(\"awayjs-core/lib/data/TriangleSubGeometry\");\r\nimport Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Quaternion\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Quaternion\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\nimport URLLoaderDataFormat\t\t\t\t= require(\"awayjs-core/lib/net/URLLoaderDataFormat\");\r\nimport ParserBase\t\t\t\t\t\t= require(\"awayjs-core/lib/parsers/ParserBase\");\r\n\r\nimport DisplayObjectContainer\t\t\t= require(\"awayjs-display/lib/containers/DisplayObjectContainer\");\r\nimport Mesh\t\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Mesh\");\r\n\r\nimport SkeletonAnimationSet\t\t\t\t= require(\"awayjs-renderergl/lib/animators/SkeletonAnimationSet\");\r\nimport Skeleton\t\t\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/Skeleton\");\r\nimport SkeletonJoint\t\t\t\t\t= require(\"awayjs-renderergl/lib/animators/data/SkeletonJoint\");\r\n\r\n// todo: create animation system, parse skeleton\r\n\r\n/**\r\n * MD5MeshParser provides a parser for the md5mesh data type, providing the geometry of the md5 format.\r\n *\r\n * todo: optimize\r\n */\r\nclass MD5MeshParser extends ParserBase\r\n{\r\n\tprivate _textData:string;\r\n\tprivate _startedParsing:boolean;\r\n\tpublic static VERSION_TOKEN:string = \"MD5Version\";\r\n\tpublic static COMMAND_LINE_TOKEN:string = \"commandline\";\r\n\tpublic static NUM_JOINTS_TOKEN:string = \"numJoints\";\r\n\tpublic static NUM_MESHES_TOKEN:string = \"numMeshes\";\r\n\tpublic static COMMENT_TOKEN:string = \"//\";\r\n\tpublic static JOINTS_TOKEN:string = \"joints\";\r\n\tpublic static MESH_TOKEN:string = \"mesh\";\r\n\r\n\tpublic static MESH_SHADER_TOKEN:string = \"shader\";\r\n\tpublic static MESH_NUM_VERTS_TOKEN:string = \"numverts\";\r\n\tpublic static MESH_VERT_TOKEN:string = \"vert\";\r\n\tpublic static MESH_NUM_TRIS_TOKEN:string = \"numtris\";\r\n\tpublic static MESH_TRI_TOKEN:string = \"tri\";\r\n\tpublic static MESH_NUM_WEIGHTS_TOKEN:string = \"numweights\";\r\n\tpublic static MESH_WEIGHT_TOKEN:string = \"weight\";\r\n\r\n\tprivate _parseIndex:number /*int*/ = 0;\r\n\tprivate _reachedEOF:boolean;\r\n\tprivate _line:number /*int*/ = 0;\r\n\tprivate _charLineIndex:number /*int*/ = 0;\r\n\tprivate _version:number /*int*/;\r\n\tprivate _numJoints:number /*int*/;\r\n\tprivate _numMeshes:number /*int*/;\r\n\r\n\tprivate _mesh:Mesh;\r\n\tprivate _shaders:Array<string>;\r\n\r\n\tprivate _maxJointCount:number /*int*/;\r\n\tprivate _meshData:Array<MeshData>;\r\n\tprivate _bindPoses:Array<Matrix3D>;\r\n\tprivate _geometry:Geometry;\r\n\r\n\tprivate _skeleton:Skeleton;\r\n\tprivate _animationSet:SkeletonAnimationSet;\r\n\r\n\tprivate _rotationQuat:Quaternion;\r\n\r\n\t/**\r\n\t * Creates a new MD5MeshParser object.\r\n\t */\r\n\tconstructor(additionalRotationAxis:Vector3D = null, additionalRotationRadians:number = 0)\r\n\t{\r\n\t\tsuper(URLLoaderDataFormat.TEXT);\r\n\t\tthis._rotationQuat = new Quaternion();\r\n\r\n\t\tthis._rotationQuat.fromAxisAngle(Vector3D.X_AXIS, -Math.PI*.5);\r\n\r\n\t\tif (additionalRotationAxis) {\r\n\t\t\tvar quat:Quaternion = new Quaternion();\r\n\t\t\tquat.fromAxisAngle(additionalRotationAxis, additionalRotationRadians);\r\n\t\t\tthis._rotationQuat.multiply(this._rotationQuat, quat);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates whether or not a given file extension is supported by the parser.\r\n\t * @param extension The file extension of a potential file to be parsed.\r\n\t * @return Whether or not the given file type is supported.\r\n\t */\r\n\tpublic static supportsType(extension:string):boolean\r\n\t{\r\n\t\textension = extension.toLowerCase();\r\n\t\treturn extension == \"md5mesh\";\r\n\t}\r\n\r\n\t/**\r\n\t * Tests whether a data block can be parsed by the parser.\r\n\t * @param data The data block to potentially be parsed.\r\n\t * @return Whether or not the given data is supported.\r\n\t */\r\n\tpublic static supportsData(data:any):boolean\r\n\t{\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pProceedParsing():boolean\r\n\t{\r\n\t\tvar token:string;\r\n\r\n\t\tif (!this._startedParsing) {\r\n\t\t\tthis._textData = this._pGetTextData();\r\n\t\t\tthis._startedParsing = true;\r\n\t\t}\r\n\r\n\t\twhile (this._pHasTime()) {\r\n\t\t\ttoken = this.getNextToken();\r\n\t\t\tswitch (token) {\r\n\t\t\t\tcase MD5MeshParser.COMMENT_TOKEN:\r\n\t\t\t\t\tthis.ignoreLine();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5MeshParser.VERSION_TOKEN:\r\n\t\t\t\t\tthis._version = this.getNextInt();\r\n\t\t\t\t\tif (this._version != 10)\r\n\t\t\t\t\t\tthrow new Error(\"Unknown version number encountered!\");\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5MeshParser.COMMAND_LINE_TOKEN:\r\n\t\t\t\t\tthis.parseCMD();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5MeshParser.NUM_JOINTS_TOKEN:\r\n\t\t\t\t\tthis._numJoints = this.getNextInt();\r\n\t\t\t\t\tthis._bindPoses = new Array<Matrix3D>(this._numJoints);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5MeshParser.NUM_MESHES_TOKEN:\r\n\t\t\t\t\tthis._numMeshes = this.getNextInt();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5MeshParser.JOINTS_TOKEN:\r\n\t\t\t\t\tthis.parseJoints();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5MeshParser.MESH_TOKEN:\r\n\t\t\t\t\tthis.parseMesh();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tif (!this._reachedEOF)\r\n\t\t\t\t\t\tthis.sendUnknownKeywordError();\r\n\t\t\t}\r\n\r\n\t\t\tif (this._reachedEOF) {\r\n\t\t\t\tthis.calculateMaxJointCount();\r\n\t\t\t\tthis._animationSet = new SkeletonAnimationSet(this._maxJointCount);\r\n\r\n\t\t\t\tthis._mesh = new Mesh(new Geometry(), null);\r\n\t\t\t\tthis._geometry = this._mesh.geometry;\r\n\r\n\t\t\t\tfor (var i:number /*int*/ = 0; i < this._meshData.length; ++i)\r\n\t\t\t\t\tthis._geometry.addSubGeometry(this.translateGeom(this._meshData[i].vertexData, this._meshData[i].weightData, this._meshData[i].indices));\r\n\r\n\t\t\t\t//_geometry.animation = _animation;\r\n\t\t\t\t//\t\t\t\t\t_mesh.animationController = _animationController;\r\n\r\n\t\t\t\t//add to the content property\r\n\t\t\t\t(<DisplayObjectContainer> this._pContent).addChild(this._mesh);\r\n\r\n\t\t\t\tthis._pFinalizeAsset(this._geometry);\r\n\t\t\t\tthis._pFinalizeAsset(this._mesh);\r\n\t\t\t\tthis._pFinalizeAsset(this._skeleton);\r\n\t\t\t\tthis._pFinalizeAsset(this._animationSet);\r\n\t\t\t\treturn ParserBase.PARSING_DONE;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn ParserBase.MORE_TO_PARSE;\r\n\t}\r\n\r\n\tpublic _pStartParsing(frameLimit:number)\r\n\t{\r\n\t\tsuper._pStartParsing(frameLimit);\r\n\r\n\t\t//create a content object for Loaders\r\n\t\tthis._pContent = new DisplayObjectContainer();\r\n\t}\r\n\r\n\tprivate calculateMaxJointCount():void\r\n\t{\r\n\t\tthis._maxJointCount = 0;\r\n\r\n\t\tvar numMeshData:number /*int*/ = this._meshData.length;\r\n\t\tfor (var i:number /*int*/ = 0; i < numMeshData; ++i) {\r\n\t\t\tvar meshData:MeshData = this._meshData[i];\r\n\t\t\tvar vertexData:Array<VertexData> = meshData.vertexData;\r\n\t\t\tvar numVerts:number /*int*/ = vertexData.length;\r\n\r\n\t\t\tfor (var j:number /*int*/ = 0; j < numVerts; ++j) {\r\n\t\t\t\tvar zeroWeights:number /*int*/ = this.countZeroWeightJoints(vertexData[j], meshData.weightData);\r\n\t\t\t\tvar totalJoints:number /*int*/ = vertexData[j].countWeight - zeroWeights;\r\n\t\t\t\tif (totalJoints > this._maxJointCount)\r\n\t\t\t\t\tthis._maxJointCount = totalJoints;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate countZeroWeightJoints(vertex:VertexData, weights:Array<JointData>):number /*int*/\r\n\t{\r\n\t\tvar start:number /*int*/ = vertex.startWeight;\r\n\t\tvar end:number /*int*/ = vertex.startWeight + vertex.countWeight;\r\n\t\tvar count:number /*int*/ = 0;\r\n\t\tvar weight:number;\r\n\r\n\t\tfor (var i:number /*int*/ = start; i < end; ++i) {\r\n\t\t\tweight = weights[i].bias;\r\n\t\t\tif (weight == 0)\r\n\t\t\t\t++count;\r\n\t\t}\r\n\r\n\t\treturn count;\r\n\t}\r\n\r\n\t/**\r\n\t * Parses the skeleton's joints.\r\n\t */\r\n\tprivate parseJoints():void\r\n\t{\r\n\t\tvar ch:string;\r\n\t\tvar joint:SkeletonJoint;\r\n\t\tvar pos:Vector3D;\r\n\t\tvar quat:Quaternion;\r\n\t\tvar i:number /*int*/ = 0;\r\n\t\tvar token:string = this.getNextToken();\r\n\r\n\t\tif (token != \"{\")\r\n\t\t\tthis.sendUnknownKeywordError();\r\n\r\n\t\tthis._skeleton = new Skeleton();\r\n\r\n\t\tdo {\r\n\t\t\tif (this._reachedEOF)\r\n\t\t\t\tthis.sendEOFError();\r\n\t\t\tjoint = new SkeletonJoint();\r\n\t\t\tjoint.name = this.parseLiteralstring();\r\n\t\t\tjoint.parentIndex = this.getNextInt();\r\n\t\t\tpos = this.parseVector3D();\r\n\t\t\tpos = this._rotationQuat.rotatePoint(pos);\r\n\t\t\tquat = this.parseQuaternion();\r\n\r\n\t\t\t// todo: check if this is correct, or maybe we want to actually store it as quats?\r\n\t\t\tthis._bindPoses[i] = quat.toMatrix3D();\r\n\t\t\tthis._bindPoses[i].appendTranslation(pos.x, pos.y, pos.z);\r\n\t\t\tvar inv:Matrix3D = this._bindPoses[i].clone();\r\n\t\t\tinv.invert();\r\n\t\t\tjoint.inverseBindPose = inv.rawData;\r\n\r\n\t\t\tthis._skeleton.joints[i++] = joint;\r\n\r\n\t\t\tch = this.getNextChar();\r\n\r\n\t\t\tif (ch == \"/\") {\r\n\t\t\t\tthis.putBack();\r\n\t\t\t\tch = this.getNextToken();\r\n\t\t\t\tif (ch == MD5MeshParser.COMMENT_TOKEN)\r\n\t\t\t\t\tthis.ignoreLine();\r\n\t\t\t\tch = this.getNextChar();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif (ch != \"}\")\r\n\t\t\t\tthis.putBack();\r\n\t\t} while (ch != \"}\");\r\n\t}\r\n\r\n\t/**\r\n\t * Puts back the last read character into the data stream.\r\n\t */\r\n\tprivate putBack():void\r\n\t{\r\n\t\tthis._parseIndex--;\r\n\t\tthis._charLineIndex--;\r\n\t\tthis._reachedEOF = this._parseIndex >= this._textData.length;\r\n\t}\r\n\r\n\t/**\r\n\t * Parses the mesh geometry.\r\n\t */\r\n\tprivate parseMesh():void\r\n\t{\r\n\t\tvar token:string = this.getNextToken();\r\n\t\tvar ch:string;\r\n\t\tvar vertexData:Array<VertexData>;\r\n\t\tvar weights:Array<JointData>;\r\n\t\tvar indices:Array<number> /*uint*/;\r\n\r\n\t\tif (token != \"{\")\r\n\t\t\tthis.sendUnknownKeywordError();\r\n\r\n\t\tif (this._shaders == null)\r\n\t\t\tthis._shaders = new Array<string>();\r\n\r\n\t\twhile (ch != \"}\") {\r\n\t\t\tch = this.getNextToken();\r\n\t\t\tswitch (ch) {\r\n\t\t\t\tcase MD5MeshParser.COMMENT_TOKEN:\r\n\t\t\t\t\tthis.ignoreLine();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5MeshParser.MESH_SHADER_TOKEN:\r\n\t\t\t\t\tthis._shaders.push(this.parseLiteralstring());\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5MeshParser.MESH_NUM_VERTS_TOKEN:\r\n\t\t\t\t\tvertexData = new Array<VertexData>(this.getNextInt());\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5MeshParser.MESH_NUM_TRIS_TOKEN:\r\n\t\t\t\t\tindices = new Array<number>(this.getNextInt()*3) /*uint*/;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5MeshParser.MESH_NUM_WEIGHTS_TOKEN:\r\n\t\t\t\t\tweights = new Array<JointData>(this.getNextInt());\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5MeshParser.MESH_VERT_TOKEN:\r\n\t\t\t\t\tthis.parseVertex(vertexData);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5MeshParser.MESH_TRI_TOKEN:\r\n\t\t\t\t\tthis.parseTri(indices);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase MD5MeshParser.MESH_WEIGHT_TOKEN:\r\n\t\t\t\t\tthis.parseJoint(weights);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this._meshData == null)\r\n\t\t\tthis._meshData = new Array<MeshData>();\r\n\r\n\t\tvar i:number /*uint*/ = this._meshData.length;\r\n\t\tthis._meshData[i] = new MeshData();\r\n\t\tthis._meshData[i].vertexData = vertexData;\r\n\t\tthis._meshData[i].weightData = weights;\r\n\t\tthis._meshData[i].indices = indices;\r\n\t}\r\n\r\n\t/**\r\n\t * Converts the mesh data to a SkinnedSub instance.\r\n\t * @param vertexData The mesh's vertices.\r\n\t * @param weights The joint weights per vertex.\r\n\t * @param indices The indices for the faces.\r\n\t * @return A SubGeometry instance containing all geometrical data for the current mesh.\r\n\t */\r\n\tprivate translateGeom(vertexData:Array<VertexData>, weights:Array<JointData>, indices:Array<number> /*uint*/):TriangleSubGeometry\r\n\t{\r\n\t\tvar len:number /*int*/ = vertexData.length;\r\n\t\tvar v1:number /*int*/, v2:number /*int*/, v3:number /*int*/;\r\n\t\tvar vertex:VertexData;\r\n\t\tvar weight:JointData;\r\n\t\tvar bindPose:Matrix3D;\r\n\t\tvar pos:Vector3D;\r\n\t\tvar subGeom:TriangleSubGeometry = new TriangleSubGeometry(true);\r\n\t\tvar uvs:Array<number> = new Array<number>(len*2);\r\n\t\tvar vertices:Array<number> = new Array<number>(len*3);\r\n\t\tvar jointIndices:Array<number> = new Array<number>(len*this._maxJointCount);\r\n\t\tvar jointWeights:Array<number> = new Array<number>(len*this._maxJointCount);\r\n\t\tvar l:number /*int*/ = 0;\r\n\t\tvar nonZeroWeights:number /*int*/;\r\n\r\n\t\tfor (var i:number /*int*/ = 0; i < len; ++i) {\r\n\t\t\tvertex = vertexData[i];\r\n\t\t\tv1 = vertex.index*3;\r\n\t\t\tv2 = v1 + 1;\r\n\t\t\tv3 = v1 + 2;\r\n\t\t\tvertices[v1] = vertices[v2] = vertices[v3] = 0;\r\n\r\n\t\t\tnonZeroWeights = 0;\r\n\t\t\tfor (var j:number /*int*/ = 0; j < vertex.countWeight; ++j) {\r\n\t\t\t\tweight = weights[vertex.startWeight + j];\r\n\t\t\t\tif (weight.bias > 0) {\r\n\t\t\t\t\tbindPose = this._bindPoses[weight.joint];\r\n\t\t\t\t\tpos = bindPose.transformVector(weight.pos);\r\n\t\t\t\t\tvertices[v1] += pos.x*weight.bias;\r\n\t\t\t\t\tvertices[v2] += pos.y*weight.bias;\r\n\t\t\t\t\tvertices[v3] += pos.z*weight.bias;\r\n\r\n\t\t\t\t\t// indices need to be multiplied by 3 (amount of matrix registers)\r\n\t\t\t\t\tjointIndices[l] = weight.joint*3;\r\n\t\t\t\t\tjointWeights[l++] = weight.bias;\r\n\t\t\t\t\t++nonZeroWeights;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfor (j = nonZeroWeights; j < this._maxJointCount; ++j) {\r\n\t\t\t\tjointIndices[l] = 0;\r\n\t\t\t\tjointWeights[l++] = 0;\r\n\t\t\t}\r\n\r\n\t\t\tv1 = vertex.index << 1;\r\n\t\t\tuvs[v1++] = vertex.s;\r\n\t\t\tuvs[v1] = vertex.t;\r\n\t\t}\r\n\r\n\t\tsubGeom.jointsPerVertex = this._maxJointCount;\r\n\t\tsubGeom.updateIndices(indices);\r\n\t\tsubGeom.updatePositions(vertices);\r\n\t\tsubGeom.updateUVs(uvs);\r\n\t\tsubGeom.updateJointIndices(jointIndices);\r\n\t\tsubGeom.updateJointWeights(jointWeights);\r\n\t\t// cause explicit updates\r\n\t\tsubGeom.vertexNormals;\r\n\t\tsubGeom.vertexTangents;\r\n\t\t// turn auto updates off because they may be animated and set explicitly\r\n\t\tsubGeom.autoDeriveTangents = false;\r\n\t\tsubGeom.autoDeriveNormals = false;\r\n\r\n\t\treturn subGeom;\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieve the next triplet of vertex indices that form a face.\r\n\t * @param indices The index list in which to store the read data.\r\n\t */\r\n\tprivate parseTri(indices:Array<number> /*uint*/):void\r\n\t{\r\n\t\tvar index:number /*int*/ = this.getNextInt()*3;\r\n\t\tindices[index] = this.getNextInt();\r\n\t\tindices[index + 1] = this.getNextInt();\r\n\t\tindices[index + 2] = this.getNextInt();\r\n\t}\r\n\r\n\t/**\r\n\t * Reads a new joint data set for a single joint.\r\n\t * @param weights the target list to contain the weight data.\r\n\t */\r\n\tprivate parseJoint(weights:Array<JointData>):void\r\n\t{\r\n\t\tvar weight:JointData = new JointData();\r\n\t\tweight.index = this.getNextInt();\r\n\t\tweight.joint = this.getNextInt();\r\n\t\tweight.bias = this.getNextNumber();\r\n\t\tweight.pos = this.parseVector3D();\r\n\t\tweights[weight.index] = weight;\r\n\t}\r\n\r\n\t/**\r\n\t * Reads the data for a single vertex.\r\n\t * @param vertexData The list to contain the vertex data.\r\n\t */\r\n\tprivate parseVertex(vertexData:Array<VertexData>):void\r\n\t{\r\n\t\tvar vertex:VertexData = new VertexData();\r\n\t\tvertex.index = this.getNextInt();\r\n\t\tthis.parseUV(vertex);\r\n\t\tvertex.startWeight = this.getNextInt();\r\n\t\tvertex.countWeight = this.getNextInt();\r\n\t\t//\t\t\tif (vertex.countWeight > _maxJointCount) _maxJointCount = vertex.countWeight;\r\n\t\tvertexData[vertex.index] = vertex;\r\n\t}\r\n\r\n\t/**\r\n\t * Reads the next uv coordinate.\r\n\t * @param vertexData The vertexData to contain the UV coordinates.\r\n\t */\r\n\tprivate parseUV(vertexData:VertexData):void\r\n\t{\r\n\t\tvar ch:string = this.getNextToken();\r\n\t\tif (ch != \"(\")\r\n\t\t\tthis.sendParseError(\"(\");\r\n\t\tvertexData.s = this.getNextNumber();\r\n\t\tvertexData.t = this.getNextNumber();\r\n\r\n\t\tif (this.getNextToken() != \")\")\r\n\t\t\tthis.sendParseError(\")\");\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the next token in the data stream.\r\n\t */\r\n\tprivate getNextToken():string\r\n\t{\r\n\t\tvar ch:string;\r\n\t\tvar token:string = \"\";\r\n\r\n\t\twhile (!this._reachedEOF) {\r\n\t\t\tch = this.getNextChar();\r\n\t\t\tif (ch == \" \" || ch == \"\\r\" || ch == \"\\n\" || ch == \"\\t\") {\r\n\t\t\t\tif (token != MD5MeshParser.COMMENT_TOKEN)\r\n\t\t\t\t\tthis.skipWhiteSpace();\r\n\t\t\t\tif (token != \"\")\r\n\t\t\t\t\treturn token;\r\n\t\t\t} else\r\n\t\t\t\ttoken += ch;\r\n\r\n\t\t\tif (token == MD5MeshParser.COMMENT_TOKEN)\r\n\t\t\t\treturn token;\r\n\t\t}\r\n\r\n\t\treturn token;\r\n\t}\r\n\r\n\t/**\r\n\t * Skips all whitespace in the data stream.\r\n\t */\r\n\tprivate skipWhiteSpace():void\r\n\t{\r\n\t\tvar ch:string;\r\n\r\n\t\tdo\r\n\t\t\tch = this.getNextChar(); while (ch == \"\\n\" || ch == \" \" || ch == \"\\r\" || ch == \"\\t\");\r\n\r\n\t\tthis.putBack();\r\n\t}\r\n\r\n\t/**\r\n\t * Skips to the next line.\r\n\t */\r\n\tprivate ignoreLine():void\r\n\t{\r\n\t\tvar ch:string;\r\n\t\twhile (!this._reachedEOF && ch != \"\\n\")\r\n\t\t\tch = this.getNextChar();\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieves the next single character in the data stream.\r\n\t */\r\n\tprivate getNextChar():string\r\n\t{\r\n\t\tvar ch:string = this._textData.charAt(this._parseIndex++);\r\n\r\n\t\tif (ch == \"\\n\") {\r\n\t\t\t++this._line;\r\n\t\t\tthis._charLineIndex = 0;\r\n\t\t} else if (ch != \"\\r\")\r\n\t\t\t++this._charLineIndex;\r\n\r\n\t\tif (this._parseIndex >= this._textData.length)\r\n\t\t\tthis._reachedEOF = true;\r\n\r\n\t\treturn ch;\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieves the next integer in the data stream.\r\n\t */\r\n\tprivate getNextInt():number /*int*/\r\n\t{\r\n\t\tvar i:number = parseInt(this.getNextToken());\r\n\t\tif (isNaN(i))\r\n\t\t\tthis.sendParseError(\"int type\");\r\n\t\treturn i;\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieves the next floating point number in the data stream.\r\n\t */\r\n\tprivate getNextNumber():number\r\n\t{\r\n\t\tvar f:number = parseFloat(this.getNextToken());\r\n\t\tif (isNaN(f))\r\n\t\t\tthis.sendParseError(\"float type\");\r\n\t\treturn f;\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieves the next 3d vector in the data stream.\r\n\t */\r\n\tprivate parseVector3D():Vector3D\r\n\t{\r\n\t\tvar vec:Vector3D = new Vector3D();\r\n\t\tvar ch:string = this.getNextToken();\r\n\r\n\t\tif (ch != \"(\")\r\n\t\t\tthis.sendParseError(\"(\");\r\n\t\tvec.x = -this.getNextNumber();\r\n\t\tvec.y = this.getNextNumber();\r\n\t\tvec.z = this.getNextNumber();\r\n\r\n\t\tif (this.getNextToken() != \")\")\r\n\t\t\tthis.sendParseError(\")\");\r\n\r\n\t\treturn vec;\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieves the next quaternion in the data stream.\r\n\t */\r\n\tprivate parseQuaternion():Quaternion\r\n\t{\r\n\t\tvar quat:Quaternion = new Quaternion();\r\n\t\tvar ch:string = this.getNextToken();\r\n\r\n\t\tif (ch != \"(\")\r\n\t\t\tthis.sendParseError(\"(\");\r\n\t\tquat.x = this.getNextNumber();\r\n\t\tquat.y = -this.getNextNumber();\r\n\t\tquat.z = -this.getNextNumber();\r\n\r\n\t\t// quat supposed to be unit length\r\n\t\tvar t:number = 1 - quat.x*quat.x - quat.y*quat.y - quat.z*quat.z;\r\n\t\tquat.w = t < 0? 0 : -Math.sqrt(t);\r\n\r\n\t\tif (this.getNextToken() != \")\")\r\n\t\t\tthis.sendParseError(\")\");\r\n\r\n\t\tvar rotQuat:Quaternion = new Quaternion();\r\n\t\trotQuat.multiply(this._rotationQuat, quat);\r\n\t\treturn rotQuat;\r\n\t}\r\n\r\n\t/**\r\n\t * Parses the command line data.\r\n\t */\r\n\tprivate parseCMD():void\r\n\t{\r\n\t\t// just ignore the command line property\r\n\t\tthis.parseLiteralstring();\r\n\t}\r\n\r\n\t/**\r\n\t * Retrieves the next literal string in the data stream. A literal string is a sequence of characters bounded\r\n\t * by double quotes.\r\n\t */\r\n\tprivate parseLiteralstring():string\r\n\t{\r\n\t\tthis.skipWhiteSpace();\r\n\r\n\t\tvar ch:string = this.getNextChar();\r\n\t\tvar str:string = \"\";\r\n\r\n\t\tif (ch != \"\\\"\")\r\n\t\t\tthis.sendParseError(\"\\\"\");\r\n\r\n\t\tdo {\r\n\t\t\tif (this._reachedEOF)\r\n\t\t\t\tthis.sendEOFError();\r\n\t\t\tch = this.getNextChar();\r\n\t\t\tif (ch != \"\\\"\")\r\n\t\t\t\tstr += ch;\r\n\t\t} while (ch != \"\\\"\");\r\n\r\n\t\treturn str;\r\n\t}\r\n\r\n\t/**\r\n\t * Throws an end-of-file error when a premature end of file was encountered.\r\n\t */\r\n\tprivate sendEOFError():void\r\n\t{\r\n\t\tthrow new Error(\"Unexpected end of file\");\r\n\t}\r\n\r\n\t/**\r\n\t * Throws an error when an unexpected token was encountered.\r\n\t * @param expected The token type that was actually expected.\r\n\t */\r\n\tprivate sendParseError(expected:string):void\r\n\t{\r\n\t\tthrow new Error(\"Unexpected token at line \" + (this._line + 1) + \", character \" + this._charLineIndex + \". \" + expected + \" expected, but \" + this._textData.charAt(this._parseIndex - 1) + \" encountered\");\r\n\t}\r\n\r\n\t/**\r\n\t * Throws an error when an unknown keyword was encountered.\r\n\t */\r\n\tprivate sendUnknownKeywordError():void\r\n\t{\r\n\t\tthrow new Error(\"Unknown keyword at line \" + (this._line + 1) + \", character \" + this._charLineIndex + \". \");\r\n\t}\r\n}\r\n\r\nexport = MD5MeshParser;\r\n\r\n\r\nclass VertexData\r\n{\r\n\tpublic index:number /*int*/;\r\n\tpublic s:number;\r\n\tpublic t:number;\r\n\tpublic startWeight:number /*int*/;\r\n\tpublic countWeight:number /*int*/;\r\n}\r\n\r\nclass JointData\r\n{\r\n\tpublic index:number /*int*/;\r\n\tpublic joint:number /*int*/;\r\n\tpublic bias:number;\r\n\tpublic pos:Vector3D;\r\n}\r\n\r\nclass MeshData\r\n{\r\n\tpublic vertexData:Array<VertexData>;\r\n\tpublic weightData:Array<JointData>;\r\n\tpublic indices:Array<number> /*uint*/;\r\n}",
    "import Geometry\t\t\t\t\t\t\t= require(\"awayjs-core/lib/data/Geometry\");\r\nimport TriangleSubGeometry\t\t\t\t= require(\"awayjs-core/lib/data/TriangleSubGeometry\");\r\nimport Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\nimport IAsset\t\t\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport URLLoaderDataFormat\t\t\t\t= require(\"awayjs-core/lib/net/URLLoaderDataFormat\");\r\nimport URLRequest\t\t\t\t\t\t= require(\"awayjs-core/lib/net/URLRequest\");\r\nimport ParserBase\t\t\t\t\t\t= require(\"awayjs-core/lib/parsers/ParserBase\");\r\nimport ParserUtils\t\t\t\t\t\t= require(\"awayjs-core/lib/parsers/ParserUtils\");\r\nimport ResourceDependency\t\t\t\t= require(\"awayjs-core/lib/parsers/ResourceDependency\");\r\nimport Texture2DBase\t\t\t\t\t= require(\"awayjs-core/lib/textures/Texture2DBase\");\r\nimport TextureBase\t\t\t\t\t\t= require(\"awayjs-core/lib/textures/TextureBase\");\r\nimport ByteArray\t\t\t\t\t\t= require(\"awayjs-core/lib/utils/ByteArray\");\r\n\r\nimport DisplayObjectContainer\t\t\t= require(\"awayjs-display/lib/containers/DisplayObjectContainer\");\r\nimport Mesh\t\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Mesh\");\r\nimport DefaultMaterialManager\t\t\t= require(\"awayjs-display/lib/managers/DefaultMaterialManager\");\r\nimport MaterialBase\t\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\r\n\r\nimport MethodMaterial\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/MethodMaterial\");\r\nimport MethodMaterialMode\t\t\t\t= require(\"awayjs-methodmaterials/lib/MethodMaterialMode\");\r\n\r\n/**\r\n * Max3DSParser provides a parser for the 3ds data type.\r\n */\r\nclass Max3DSParser extends ParserBase\r\n{\r\n\tprivate _byteData:ByteArray;\r\n\r\n\tprivate _textures:Object;\r\n\tprivate _materials:Object;\r\n\tprivate _unfinalized_objects:Object;\r\n\r\n\tprivate _cur_obj_end:number;\r\n\tprivate _cur_obj:ObjectVO;\r\n\r\n\tprivate _cur_mat_end:number;\r\n\tprivate _cur_mat:MaterialVO;\r\n\tprivate _useSmoothingGroups:boolean;\r\n\r\n\t/**\r\n\t * Creates a new <code>Max3DSParser</code> object.\r\n\t *\r\n\t * @param useSmoothingGroups Determines whether the parser looks for smoothing groups in the 3ds file or assumes uniform smoothing. Defaults to true.\r\n\t */\r\n\tconstructor(useSmoothingGroups:boolean = true)\r\n\t{\r\n\t\tsuper(URLLoaderDataFormat.ARRAY_BUFFER);\r\n\r\n\t\tthis._useSmoothingGroups = useSmoothingGroups;\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates whether or not a given file extension is supported by the parser.\r\n\t * @param extension The file extension of a potential file to be parsed.\r\n\t * @return Whether or not the given file type is supported.\r\n\t */\r\n\tpublic static supportsType(extension:string):boolean\r\n\t{\r\n\t\textension = extension.toLowerCase();\r\n\t\treturn extension == \"3ds\";\r\n\t}\r\n\r\n\t/**\r\n\t * Tests whether a data block can be parsed by the parser.\r\n\t * @param data The data block to potentially be parsed.\r\n\t * @return Whether or not the given data is supported.\r\n\t */\r\n\tpublic static supportsData(data:any):boolean\r\n\t{\r\n\t\tvar ba:ByteArray;\r\n\r\n\t\tba = ParserUtils.toByteArray(data);\r\n\t\tif (ba) {\r\n\t\t\tba.position = 0;\r\n\t\t\tif (ba.readShort() == 0x4d4d)\r\n\t\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iResolveDependency(resourceDependency:ResourceDependency):void\r\n\t{\r\n\t\tif (resourceDependency.assets.length == 1) {\r\n\t\t\tvar asset:IAsset;\r\n\r\n\t\t\tasset = resourceDependency.assets[0];\r\n\t\t\tif (asset.isAsset(TextureBase)) {\r\n\t\t\t\tvar tex:TextureVO;\r\n\r\n\t\t\t\ttex = this._textures[resourceDependency.id];\r\n\t\t\t\ttex.texture = <Texture2DBase> asset;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iResolveDependencyFailure(resourceDependency:ResourceDependency):void\r\n\t{\r\n\t\t// TODO: Implement\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pProceedParsing():boolean\r\n\t{\r\n\t\tif (!this._byteData) {\r\n\t\t\tthis._byteData = this._pGetByteData();\r\n\t\t\tthis._byteData.position = 0;\r\n\r\n\t\t\t//----------------------------------------------------------------------------\r\n\t\t\t// LITTLE_ENDIAN - Default for ArrayBuffer / Not implemented in ByteArray\r\n\t\t\t//----------------------------------------------------------------------------\r\n\t\t\t//this._byteData.endian = Endian.LITTLE_ENDIAN;// Should be default\r\n\t\t\t//----------------------------------------------------------------------------\r\n\r\n\t\t\tthis._textures = {};\r\n\t\t\tthis._materials = {};\r\n\t\t\tthis._unfinalized_objects = {};\r\n\t\t}\r\n\r\n\t\t// TODO: With this construct, the loop will run no-op for as long\r\n\t\t// as there is time once file has finished reading. Consider a nice\r\n\t\t// way to stop loop when byte array is empty, without putting it in\r\n\t\t// the while-conditional, which will prevent finalizations from\r\n\t\t// happening after the last chunk.\r\n\t\twhile (this._pHasTime()) {\r\n\r\n\t\t\t// If we are currently working on an object, and the most recent chunk was\r\n\t\t\t// the last one in that object, finalize the current object.\r\n\t\t\tif (this._cur_mat && this._byteData.position >= this._cur_mat_end)\r\n\t\t\t\tthis.finalizeCurrentMaterial();\r\n\t\t\telse if (this._cur_obj && this._byteData.position >= this._cur_obj_end) {\r\n\t\t\t\t// Can't finalize at this point, because we have to wait until the full\r\n\t\t\t\t// animation section has been parsed for any potential pivot definitions\r\n\t\t\t\tthis._unfinalized_objects[this._cur_obj.name] = this._cur_obj;\r\n\t\t\t\tthis._cur_obj_end = Number.MAX_VALUE /*uint*/;\r\n\t\t\t\tthis._cur_obj = null;\r\n\t\t\t}\r\n\r\n\t\t\tif (this._byteData.getBytesAvailable() > 0) {\r\n\t\t\t\tvar cid:number /*uint*/;\r\n\t\t\t\tvar len:number /*uint*/;\r\n\t\t\t\tvar end:number /*uint*/;\r\n\r\n\t\t\t\tcid = this._byteData.readUnsignedShort();\r\n\t\t\t\tlen = this._byteData.readUnsignedInt();\r\n\t\t\t\tend = this._byteData.position + (len - 6);\r\n\r\n\t\t\t\tswitch (cid) {\r\n\t\t\t\t\tcase 0x4D4D: // MAIN3DS\r\n\t\t\t\t\tcase 0x3D3D: // EDIT3DS\r\n\t\t\t\t\tcase 0xB000: // KEYF3DS\r\n\t\t\t\t\t\t// This types are \"container chunks\" and contain only\r\n\t\t\t\t\t\t// sub-chunks (no data on their own.) This means that\r\n\t\t\t\t\t\t// there is nothing more to parse at this point, and\r\n\t\t\t\t\t\t// instead we should progress to the next chunk, which\r\n\t\t\t\t\t\t// will be the first sub-chunk of this one.\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 0xAFFF: // MATERIAL\r\n\t\t\t\t\t\tthis._cur_mat_end = end;\r\n\t\t\t\t\t\tthis._cur_mat = this.parseMaterial();\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 0x4000: // EDIT_OBJECT\r\n\t\t\t\t\t\tthis._cur_obj_end = end;\r\n\t\t\t\t\t\tthis._cur_obj = new ObjectVO();\r\n\t\t\t\t\t\tthis._cur_obj.name = this.readNulTermstring();\r\n\t\t\t\t\t\tthis._cur_obj.materials = new Array<string>();\r\n\t\t\t\t\t\tthis._cur_obj.materialFaces = {};\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 0x4100: // OBJ_TRIMESH\r\n\t\t\t\t\t\tthis._cur_obj.type = Mesh.assetType;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 0x4110: // TRI_VERTEXL\r\n\t\t\t\t\t\tthis.parseVertexList();\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 0x4120: // TRI_FACELIST\r\n\t\t\t\t\t\tthis.parseFaceList();\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 0x4140: // TRI_MAPPINGCOORDS\r\n\t\t\t\t\t\tthis.parseUVList();\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 0x4130: // Face materials\r\n\t\t\t\t\t\tthis.parseFaceMaterialList();\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 0x4160: // Transform\r\n\t\t\t\t\t\tthis._cur_obj.transform = this.readTransform();\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 0xB002: // Object animation (including pivot)\r\n\t\t\t\t\t\tthis.parseObjectAnimation(end);\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 0x4150: // Smoothing groups\r\n\t\t\t\t\t\tthis.parseSmoothingGroups();\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t// Skip this (unknown) chunk\r\n\t\t\t\t\t\tthis._byteData.position += (len - 6);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Pause parsing if there were any dependencies found during this\r\n\t\t\t\t// iteration (i.e. if there are any dependencies that need to be\r\n\t\t\t\t// retrieved at this time.)\r\n\t\t\t\tif (this.dependencies.length) {\r\n\t\t\t\t\tthis._pPauseAndRetrieveDependencies();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// More parsing is required if the entire byte array has not yet\r\n\t\t// been read, or if there is a currently non-finalized object in\r\n\t\t// the pipeline.\r\n\t\tif (this._byteData.getBytesAvailable() || this._cur_obj || this._cur_mat) {\r\n\t\t\treturn ParserBase.MORE_TO_PARSE;\r\n\t\t} else {\r\n\t\t\tvar name:string;\r\n\r\n\t\t\t// Finalize any remaining objects before ending.\r\n\t\t\tfor (name in this._unfinalized_objects) {\r\n\t\t\t\tvar obj:DisplayObjectContainer;\r\n\t\t\t\tobj = this.constructObject(this._unfinalized_objects[name]);\r\n\t\t\t\tif (obj) {\r\n\t\t\t\t\t//add to the content property\r\n\t\t\t\t\t(<DisplayObjectContainer> this._pContent).addChild(obj);\r\n\r\n\t\t\t\t\tthis._pFinalizeAsset(obj, name);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn ParserBase.PARSING_DONE;\r\n\t\t}\r\n\t}\r\n\r\n\tpublic _pStartParsing(frameLimit:number)\r\n\t{\r\n\t\tsuper._pStartParsing(frameLimit);\r\n\r\n\t\t//create a content object for Loaders\r\n\t\tthis._pContent = new DisplayObjectContainer();\r\n\t}\r\n\r\n\tprivate parseMaterial():MaterialVO\r\n\t{\r\n\t\tvar mat:MaterialVO;\r\n\r\n\t\tmat = new MaterialVO();\r\n\r\n\t\twhile (this._byteData.position < this._cur_mat_end) {\r\n\t\t\tvar cid:number /*uint*/;\r\n\t\t\tvar len:number /*uint*/;\r\n\t\t\tvar end:number /*uint*/;\r\n\r\n\t\t\tcid = this._byteData.readUnsignedShort();\r\n\t\t\tlen = this._byteData.readUnsignedInt();\r\n\t\t\tend = this._byteData.position + (len - 6);\r\n\r\n\t\t\tswitch (cid) {\r\n\t\t\t\tcase 0xA000: // Material name\r\n\t\t\t\t\tmat.name = this.readNulTermstring();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 0xA010: // Ambient color\r\n\t\t\t\t\tmat.ambientColor = this.readColor();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 0xA020: // Diffuse color\r\n\t\t\t\t\tmat.diffuseColor = this.readColor();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 0xA030: // Specular color\r\n\t\t\t\t\tmat.specularColor = this.readColor();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 0xA081: // Two-sided, existence indicates \"true\"\r\n\t\t\t\t\tmat.twoSided = true;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 0xA200: // Main (color) texture\r\n\t\t\t\t\tmat.colorMap = this.parseTexture(end);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 0xA204: // Specular map\r\n\t\t\t\t\tmat.specularMap = this.parseTexture(end);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tthis._byteData.position = end;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn mat;\r\n\t}\r\n\r\n\tprivate parseTexture(end:number /*uint*/):TextureVO\r\n\t{\r\n\t\tvar tex:TextureVO;\r\n\r\n\t\ttex = new TextureVO();\r\n\r\n\t\twhile (this._byteData.position < end) {\r\n\t\t\tvar cid:number /*uint*/;\r\n\t\t\tvar len:number /*uint*/;\r\n\r\n\t\t\tcid = this._byteData.readUnsignedShort();\r\n\t\t\tlen = this._byteData.readUnsignedInt();\r\n\r\n\t\t\tswitch (cid) {\r\n\t\t\t\tcase 0xA300:\r\n\t\t\t\t\ttex.url = this.readNulTermstring();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\t\t\t\t\t// Skip this unknown texture sub-chunk\r\n\t\t\t\t\tthis._byteData.position += (len - 6);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._textures[tex.url] = tex;\r\n\t\tthis._pAddDependency(tex.url, new URLRequest(tex.url));\r\n\r\n\t\treturn tex;\r\n\t}\r\n\r\n\tprivate parseVertexList():void\r\n\t{\r\n\t\tvar i:number /*uint*/;\r\n\t\tvar len:number /*uint*/;\r\n\t\tvar count:number /*uint*/;\r\n\r\n\t\tcount = this._byteData.readUnsignedShort();\r\n\t\tthis._cur_obj.verts = new Array<number>(count*3);\r\n\r\n\t\ti = 0;\r\n\t\tlen = this._cur_obj.verts.length;\r\n\t\twhile (i < len) {\r\n\t\t\tvar x:number, y:number, z:number;\r\n\r\n\t\t\tx = this._byteData.readFloat();\r\n\t\t\ty = this._byteData.readFloat();\r\n\t\t\tz = this._byteData.readFloat();\r\n\r\n\t\t\tthis._cur_obj.verts[i++] = x;\r\n\t\t\tthis._cur_obj.verts[i++] = z;\r\n\t\t\tthis._cur_obj.verts[i++] = y;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate parseFaceList():void\r\n\t{\r\n\t\tvar i:number /*uint*/;\r\n\t\tvar len:number /*uint*/;\r\n\t\tvar count:number /*uint*/;\r\n\r\n\t\tcount = this._byteData.readUnsignedShort();\r\n\t\tthis._cur_obj.indices = new Array<number>(count*3) /*uint*/;\r\n\r\n\t\ti = 0;\r\n\t\tlen = this._cur_obj.indices.length;\r\n\t\twhile (i < len) {\r\n\t\t\tvar i0:number /*uint*/, i1:number /*uint*/, i2:number /*uint*/;\r\n\r\n\t\t\ti0 = this._byteData.readUnsignedShort();\r\n\t\t\ti1 = this._byteData.readUnsignedShort();\r\n\t\t\ti2 = this._byteData.readUnsignedShort();\r\n\r\n\t\t\tthis._cur_obj.indices[i++] = i0;\r\n\t\t\tthis._cur_obj.indices[i++] = i2;\r\n\t\t\tthis._cur_obj.indices[i++] = i1;\r\n\r\n\t\t\t// Skip \"face info\", irrelevant in Away3D\r\n\t\t\tthis._byteData.position += 2;\r\n\t\t}\r\n\r\n\t\tthis._cur_obj.smoothingGroups = new Array<number>(count) /*uint*/;\r\n\t}\r\n\r\n\tprivate parseSmoothingGroups():void\r\n\t{\r\n\t\tvar len:number /*uint*/ = this._cur_obj.indices.length/3;\r\n\t\tvar i:number /*uint*/ = 0;\r\n\t\twhile (i < len) {\r\n\t\t\tthis._cur_obj.smoothingGroups[i] = this._byteData.readUnsignedInt();\r\n\t\t\ti++;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate parseUVList():void\r\n\t{\r\n\t\tvar i:number /*uint*/;\r\n\t\tvar len:number /*uint*/;\r\n\t\tvar count:number /*uint*/;\r\n\r\n\t\tcount = this._byteData.readUnsignedShort();\r\n\t\tthis._cur_obj.uvs = new Array<number>(count*2);\r\n\r\n\t\ti = 0;\r\n\t\tlen = this._cur_obj.uvs.length;\r\n\t\twhile (i < len) {\r\n\t\t\tthis._cur_obj.uvs[i++] = this._byteData.readFloat();\r\n\t\t\tthis._cur_obj.uvs[i++] = 1.0 - this._byteData.readFloat();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate parseFaceMaterialList():void\r\n\t{\r\n\t\tvar mat:string;\r\n\t\tvar count:number /*uint*/;\r\n\t\tvar i:number /*uint*/;\r\n\t\tvar faces:Array<number> /*uint*/;\r\n\r\n\t\tmat = this.readNulTermstring();\r\n\t\tcount = this._byteData.readUnsignedShort();\r\n\r\n\t\tfaces = new Array<number>(count) /*uint*/;\r\n\t\ti = 0;\r\n\t\twhile (i < faces.length)\r\n\t\t\tfaces[i++] = this._byteData.readUnsignedShort();\r\n\r\n\t\tthis._cur_obj.materials.push(mat);\r\n\t\tthis._cur_obj.materialFaces[mat] = faces;\r\n\t}\r\n\r\n\tprivate parseObjectAnimation(end:number):void\r\n\t{\r\n\t\tvar vo:ObjectVO;\r\n\t\tvar obj:DisplayObjectContainer;\r\n\t\tvar pivot:Vector3D;\r\n\t\tvar name:string;\r\n\t\tvar hier:number /*uint*/;\r\n\r\n\t\t// Pivot defaults to origin\r\n\t\tpivot = new Vector3D;\r\n\r\n\t\twhile (this._byteData.position < end) {\r\n\t\t\tvar cid:number /*uint*/;\r\n\t\t\tvar len:number /*uint*/;\r\n\r\n\t\t\tcid = this._byteData.readUnsignedShort();\r\n\t\t\tlen = this._byteData.readUnsignedInt();\r\n\r\n\t\t\tswitch (cid) {\r\n\t\t\t\tcase 0xb010: // Name/hierarchy\r\n\t\t\t\t\tname = this.readNulTermstring();\r\n\t\t\t\t\tthis._byteData.position += 4;\r\n\t\t\t\t\thier = this._byteData.readShort();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 0xb013: // Pivot\r\n\t\t\t\t\tpivot.x = this._byteData.readFloat();\r\n\t\t\t\t\tpivot.z = this._byteData.readFloat();\r\n\t\t\t\t\tpivot.y = this._byteData.readFloat();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tthis._byteData.position += (len - 6);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// If name is \"$$$DUMMY\" this is an empty object (e.g. a container)\r\n\t\t// and will be ignored in this version of the parser\r\n\t\t// TODO: Implement containers in 3DS parser.\r\n\t\tif (name != '$$$DUMMY' && this._unfinalized_objects.hasOwnProperty(name)) {\r\n\t\t\tvo = this._unfinalized_objects[name];\r\n\t\t\tobj = this.constructObject(vo, pivot);\r\n\r\n\t\t\tif (obj) {\r\n\t\t\t\t//add to the content property\r\n\t\t\t\t(<DisplayObjectContainer> this._pContent).addChild(obj);\r\n\r\n\t\t\t\tthis._pFinalizeAsset(obj, vo.name);\r\n\t\t\t}\r\n\r\n\r\n\t\t\tdelete this._unfinalized_objects[name];\r\n\t\t}\r\n\t}\r\n\r\n\tprivate constructObject(obj:ObjectVO, pivot:Vector3D = null):DisplayObjectContainer\r\n\t{\r\n\t\tif (obj.type == Mesh.assetType) {\r\n\t\t\tvar i:number /*uint*/;\r\n\t\t\tvar sub:TriangleSubGeometry;\r\n\t\t\tvar geom:Geometry;\r\n\t\t\tvar mat:MaterialBase;\r\n\t\t\tvar mesh:Mesh;\r\n\t\t\tvar mtx:Matrix3D;\r\n\t\t\tvar vertices:Array<VertexVO>;\r\n\t\t\tvar faces:Array<FaceVO>;\r\n\r\n\t\t\tif (obj.materials.length > 1)\r\n\t\t\t\tconsole.log(\"The Away3D 3DS parser does not support multiple materials per mesh at this point.\");\r\n\r\n\t\t\t// Ignore empty objects\r\n\t\t\tif (!obj.indices || obj.indices.length == 0)\r\n\t\t\t\treturn null;\r\n\r\n\t\t\tvertices = new Array<VertexVO>(obj.verts.length/3);\r\n\t\t\tfaces = new Array<FaceVO>(obj.indices.length/3);\r\n\r\n\t\t\tthis.prepareData(vertices, faces, obj);\r\n\r\n\t\t\tif (this._useSmoothingGroups)\r\n\t\t\t\tthis.applySmoothGroups(vertices, faces);\r\n\r\n\t\t\tobj.verts = new Array<number>(vertices.length*3);\r\n\t\t\tfor (i = 0; i < vertices.length; i++) {\r\n\t\t\t\tobj.verts[i*3] = vertices[i].x;\r\n\t\t\t\tobj.verts[i*3 + 1] = vertices[i].y;\r\n\t\t\t\tobj.verts[i*3 + 2] = vertices[i].z;\r\n\t\t\t}\r\n\t\t\tobj.indices = new Array<number>(faces.length*3) /*uint*/;\r\n\r\n\t\t\tfor (i = 0; i < faces.length; i++) {\r\n\t\t\t\tobj.indices[i*3] = faces[i].a;\r\n\t\t\t\tobj.indices[i*3 + 1] = faces[i].b;\r\n\t\t\t\tobj.indices[i*3 + 2] = faces[i].c;\r\n\t\t\t}\r\n\r\n\t\t\tif (obj.uvs) {\r\n\t\t\t\t// If the object had UVs to start with, use UVs generated by\r\n\t\t\t\t// smoothing group splitting algorithm. Otherwise those UVs\r\n\t\t\t\t// will be nonsense and should be skipped.\r\n\t\t\t\tobj.uvs = new Array<number>(vertices.length*2);\r\n\t\t\t\tfor (i = 0; i < vertices.length; i++) {\r\n\t\t\t\t\tobj.uvs[i*2] = vertices[i].u;\r\n\t\t\t\t\tobj.uvs[i*2 + 1] = vertices[i].v;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tgeom = new Geometry();\r\n\r\n\t\t\t// Construct sub-geometries (potentially splitting buffers)\r\n\t\t\t// and add them to geometry.\r\n\t\t\tsub = new TriangleSubGeometry(true);\r\n\t\t\tsub.updateIndices(obj.indices);\r\n\t\t\tsub.updatePositions(obj.verts);\r\n\t\t\tsub.updateUVs(obj.uvs);\r\n\r\n\t\t\tgeom.addSubGeometry(sub);\r\n\r\n\t\t\tif (obj.materials.length > 0) {\r\n\t\t\t\tvar mname:string;\r\n\t\t\t\tmname = obj.materials[0];\r\n\t\t\t\tmat = this._materials[mname].material;\r\n\t\t\t}\r\n\r\n\t\t\t// Apply pivot translation to geometry if a pivot was\r\n\t\t\t// found while parsing the keyframe chunk earlier.\r\n\t\t\tif (pivot) {\r\n\t\t\t\tif (obj.transform) {\r\n\t\t\t\t\t// If a transform was found while parsing the\r\n\t\t\t\t\t// object chunk, use it to find the local pivot vector\r\n\t\t\t\t\tvar dat:Array<number> = obj.transform.concat();\r\n\t\t\t\t\tdat[12] = 0;\r\n\t\t\t\t\tdat[13] = 0;\r\n\t\t\t\t\tdat[14] = 0;\r\n\t\t\t\t\tmtx = new Matrix3D(dat);\r\n\t\t\t\t\tpivot = mtx.transformVector(pivot);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tpivot.scaleBy(-1);\r\n\r\n\t\t\t\tmtx = new Matrix3D();\r\n\t\t\t\tmtx.appendTranslation(pivot.x, pivot.y, pivot.z);\r\n\t\t\t\tgeom.applyTransformation(mtx);\r\n\t\t\t}\r\n\r\n\t\t\t// Apply transformation to geometry if a transformation\r\n\t\t\t// was found while parsing the object chunk earlier.\r\n\t\t\tif (obj.transform) {\r\n\t\t\t\tmtx = new Matrix3D(obj.transform);\r\n\t\t\t\tmtx.invert();\r\n\t\t\t\tgeom.applyTransformation(mtx);\r\n\t\t\t}\r\n\r\n\t\t\t// Final transform applied to geometry. Finalize the geometry,\r\n\t\t\t// which will no longer be modified after this point.\r\n\t\t\tthis._pFinalizeAsset(geom, obj.name.concat('_geom'));\r\n\r\n\t\t\t// Build mesh and return it\r\n\t\t\tmesh = new Mesh(geom, mat);\r\n\t\t\tmesh.transform.matrix3D = new Matrix3D(obj.transform);\r\n\t\t\treturn mesh;\r\n\t\t}\r\n\r\n\t\t// If reached, unknown\r\n\t\treturn null;\r\n\t}\r\n\r\n\tprivate prepareData(vertices:Array<VertexVO>, faces:Array<FaceVO>, obj:ObjectVO):void\r\n\t{\r\n\t\t// convert raw ObjectVO's data to structured VertexVO and FaceVO\r\n\t\tvar i:number /*int*/;\r\n\t\tvar j:number /*int*/;\r\n\t\tvar k:number /*int*/;\r\n\t\tvar len:number /*int*/ = obj.verts.length;\r\n\t\tfor (i = 0, j = 0, k = 0; i < len;) {\r\n\t\t\tvar v:VertexVO = new VertexVO;\r\n\t\t\tv.x = obj.verts[i++];\r\n\t\t\tv.y = obj.verts[i++];\r\n\t\t\tv.z = obj.verts[i++];\r\n\t\t\tif (obj.uvs) {\r\n\t\t\t\tv.u = obj.uvs[j++];\r\n\t\t\t\tv.v = obj.uvs[j++];\r\n\t\t\t}\r\n\t\t\tvertices[k++] = v;\r\n\t\t}\r\n\t\tlen = obj.indices.length;\r\n\t\tfor (i = 0, k = 0; i < len;) {\r\n\t\t\tvar f:FaceVO = new FaceVO();\r\n\t\t\tf.a = obj.indices[i++];\r\n\t\t\tf.b = obj.indices[i++];\r\n\t\t\tf.c = obj.indices[i++];\r\n\t\t\tf.smoothGroup = obj.smoothingGroups[k] || 0;\r\n\t\t\tfaces[k++] = f;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate applySmoothGroups(vertices:Array<VertexVO>, faces:Array<FaceVO>):void\r\n\t{\r\n\t\t// clone vertices according to following rule:\r\n\t\t// clone if vertex's in faces from groups 1+2 and 3\r\n\t\t// don't clone if vertex's in faces from groups 1+2, 3 and 1+3\r\n\r\n\t\tvar i:number /*int*/;\r\n\t\tvar j:number /*int*/;\r\n\t\tvar k:number /*int*/;\r\n\t\tvar l:number /*int*/;\r\n\t\tvar len:number /*int*/;\r\n\t\tvar numVerts:number /*uint*/ = vertices.length;\r\n\t\tvar numFaces:number /*uint*/ = faces.length;\r\n\r\n\t\t// extract groups data for vertices\r\n\t\tvar vGroups:Array<Array<number>> /*uint*/ = new Array<Array<number>>(numVerts) /*uint*/;\r\n\t\tfor (i = 0; i < numVerts; i++)\r\n\t\t\tvGroups[i] = new Array<number>() /*uint*/;\r\n\t\tfor (i = 0; i < numFaces; i++) {\r\n\t\t\tvar face:FaceVO = faces[i];\r\n\t\t\tfor (j = 0; j < 3; j++) {\r\n\t\t\t\tvar groups:Array<number> /*uint*/ = vGroups[(j == 0)? face.a : ((j == 1)? face.b : face.c)];\r\n\t\t\t\tvar group:number /*uint*/ = face.smoothGroup;\r\n\t\t\t\tfor (k = groups.length - 1; k >= 0; k--) {\r\n\t\t\t\t\tif ((group & groups[k]) > 0) {\r\n\t\t\t\t\t\tgroup |= groups[k];\r\n\t\t\t\t\t\tgroups.splice(k, 1);\r\n\t\t\t\t\t\tk = groups.length - 1;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tgroups.push(group);\r\n\t\t\t}\r\n\t\t}\r\n\t\t// clone vertices\r\n\t\tvar vClones:Array<Array<number>> /*uint*/ = new Array<Array<number>>(numVerts) /*uint*/;\r\n\t\tfor (i = 0; i < numVerts; i++) {\r\n\t\t\tif ((len = vGroups[i].length) < 1)\r\n\t\t\t\tcontinue;\r\n\t\t\tvar clones:Array<number> /*uint*/ = new Array<number>(len) /*uint*/;\r\n\t\t\tvClones[i] = clones;\r\n\t\t\tclones[0] = i;\r\n\t\t\tvar v0:VertexVO = vertices[i];\r\n\t\t\tfor (j = 1; j < len; j++) {\r\n\t\t\t\tvar v1:VertexVO = new VertexVO;\r\n\t\t\t\tv1.x = v0.x;\r\n\t\t\t\tv1.y = v0.y;\r\n\t\t\t\tv1.z = v0.z;\r\n\t\t\t\tv1.u = v0.u;\r\n\t\t\t\tv1.v = v0.v;\r\n\t\t\t\tclones[j] = vertices.length;\r\n\t\t\t\tvertices.push(v1);\r\n\t\t\t}\r\n\t\t}\r\n\t\tnumVerts = vertices.length;\r\n\r\n\t\tfor (i = 0; i < numFaces; i++) {\r\n\t\t\tface = faces[i];\r\n\t\t\tgroup = face.smoothGroup;\r\n\t\t\tfor (j = 0; j < 3; j++) {\r\n\t\t\t\tk = (j == 0)? face.a : ((j == 1)? face.b : face.c);\r\n\t\t\t\tgroups = vGroups[k];\r\n\t\t\t\tlen = groups.length;\r\n\t\t\t\tclones = vClones[k];\r\n\t\t\t\tfor (l = 0; l < len; l++) {\r\n\t\t\t\t\tif (((group == 0) && (groups[l] == 0)) || ((group & groups[l]) > 0)) {\r\n\t\t\t\t\t\tvar index:number /*uint*/ = clones[l];\r\n\t\t\t\t\t\tif (group == 0) {\r\n\t\t\t\t\t\t\t// vertex is unique if no smoothGroup found\r\n\t\t\t\t\t\t\tgroups.splice(l, 1);\r\n\t\t\t\t\t\t\tclones.splice(l, 1);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (j == 0)\r\n\t\t\t\t\t\t\tface.a = index; else if (j == 1)\r\n\t\t\t\t\t\t\tface.b = index; else\r\n\t\t\t\t\t\t\tface.c = index;\r\n\t\t\t\t\t\tl = len;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate finalizeCurrentMaterial():void\r\n\t{\r\n\t\tvar mat:MethodMaterial;\r\n\r\n\t\tif (this._cur_mat.colorMap)\r\n\t\t\tmat = new MethodMaterial(this._cur_mat.colorMap.texture || DefaultMaterialManager.getDefaultTexture());\r\n\t\telse\r\n\t\t\tmat = new MethodMaterial(this._cur_mat.ambientColor);\r\n\r\n\t\tmat.diffuseColor = this._cur_mat.diffuseColor;\r\n\t\tmat.specularColor = this._cur_mat.specularColor;\r\n\r\n\t\tif (this.materialMode >= 2)\r\n\t\t\tmat.mode = MethodMaterialMode.MULTI_PASS\r\n\r\n\t\tmat.bothSides = this._cur_mat.twoSided;\r\n\r\n\t\tthis._pFinalizeAsset(mat, this._cur_mat.name);\r\n\r\n\t\tthis._materials[this._cur_mat.name] = this._cur_mat;\r\n\t\tthis._cur_mat.material = mat;\r\n\r\n\t\tthis._cur_mat = null;\r\n\t}\r\n\r\n\tprivate readNulTermstring():string\r\n\t{\r\n\t\tvar chr:number /*int*/;\r\n\t\tvar str:string = \"\";\r\n\r\n\t\twhile ((chr = this._byteData.readUnsignedByte()) > 0)\r\n\t\t\tstr += String.fromCharCode(chr);\r\n\r\n\t\treturn str;\r\n\t}\r\n\r\n\tprivate readTransform():Array<number>\r\n\t{\r\n\t\tvar data:Array<number>;\r\n\r\n\t\tdata = new Array<number>(16);\r\n\r\n\t\t// X axis\r\n\t\tdata[0] = this._byteData.readFloat(); // X\r\n\t\tdata[2] = this._byteData.readFloat(); // Z\r\n\t\tdata[1] = this._byteData.readFloat(); // Y\r\n\t\tdata[3] = 0;\r\n\r\n\t\t// Z axis\r\n\t\tdata[8] = this._byteData.readFloat(); // X\r\n\t\tdata[10] = this._byteData.readFloat(); // Z\r\n\t\tdata[9] = this._byteData.readFloat(); // Y\r\n\t\tdata[11] = 0;\r\n\r\n\t\t// Y Axis\r\n\t\tdata[4] = this._byteData.readFloat(); // X\r\n\t\tdata[6] = this._byteData.readFloat(); // Z\r\n\t\tdata[5] = this._byteData.readFloat(); // Y\r\n\t\tdata[7] = 0;\r\n\r\n\t\t// Translation\r\n\t\tdata[12] = this._byteData.readFloat(); // X\r\n\t\tdata[14] = this._byteData.readFloat(); // Z\r\n\t\tdata[13] = this._byteData.readFloat(); // Y\r\n\t\tdata[15] = 1;\r\n\r\n\t\treturn data;\r\n\t}\r\n\r\n\tprivate readColor():number /*int*/\r\n\t{\r\n\t\tvar cid:number /*int*/;\r\n\t\tvar len:number /*int*/;\r\n\t\tvar r:number /*int*/, g:number /*int*/, b:number /*int*/;\r\n\r\n\t\tcid = this._byteData.readUnsignedShort();\r\n\t\tlen = this._byteData.readUnsignedInt();\r\n\r\n\t\tswitch (cid) {\r\n\t\t\tcase 0x0010: // Floats\r\n\t\t\t\tr = this._byteData.readFloat()*255;\r\n\t\t\t\tg = this._byteData.readFloat()*255;\r\n\t\t\t\tb = this._byteData.readFloat()*255;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 0x0011: // 24-bit color\r\n\t\t\t\tr = this._byteData.readUnsignedByte();\r\n\t\t\t\tg = this._byteData.readUnsignedByte();\r\n\t\t\t\tb = this._byteData.readUnsignedByte();\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tthis._byteData.position += (len - 6);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn (r << 16) | (g << 8) | b;\r\n\t}\r\n}\r\n\r\nexport = Max3DSParser;\r\n\r\n/**\r\n *\r\n */\r\nclass FaceVO\r\n{\r\n\tpublic a:number /*int*/;\r\n\tpublic b:number /*int*/;\r\n\tpublic c:number /*int*/;\r\n\tpublic smoothGroup:number /*int*/;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nclass MaterialVO\r\n{\r\n\tpublic name:string;\r\n\tpublic ambientColor:number /*int*/;\r\n\tpublic diffuseColor:number /*int*/;\r\n\tpublic specularColor:number /*int*/;\r\n\tpublic twoSided:boolean;\r\n\tpublic colorMap:TextureVO;\r\n\tpublic specularMap:TextureVO;\r\n\tpublic material:MaterialBase;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nclass ObjectVO\r\n{\r\n\tpublic name:string;\r\n\tpublic type:string;\r\n\tpublic pivotX:number;\r\n\tpublic pivotY:number;\r\n\tpublic pivotZ:number;\r\n\tpublic transform:Array<number>;\r\n\tpublic verts:Array<number>;\r\n\tpublic indices:Array<number> /*int*/;\r\n\tpublic uvs:Array<number>;\r\n\tpublic materialFaces:Object;\r\n\tpublic materials:Array<string>;\r\n\tpublic smoothingGroups:Array<number> /*int*/;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nclass TextureVO\r\n{\r\n\tpublic url:string;\r\n\tpublic texture:Texture2DBase;\r\n}\r\n\r\n/**\r\n *\r\n */\r\nclass VertexVO\r\n{\r\n\tpublic x:number;\r\n\tpublic y:number;\r\n\tpublic z:number;\r\n\tpublic u:number;\r\n\tpublic v:number;\r\n\tpublic normal:Vector3D;\r\n\tpublic tangent:Vector3D;\r\n}",
    "import TriangleSubGeometry\t\t\t\t= require(\"awayjs-core/lib/data/TriangleSubGeometry\");\r\nimport Geometry\t\t\t\t\t\t\t= require(\"awayjs-core/lib/data/Geometry\");\r\nimport Matrix3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Matrix3D\");\r\nimport Quaternion\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Quaternion\");\r\nimport Vector3D\t\t\t\t\t\t\t= require(\"awayjs-core/lib/geom/Vector3D\");\r\nimport IAsset\t\t\t\t\t\t\t= require(\"awayjs-core/lib/library/IAsset\");\r\nimport URLLoaderDataFormat\t\t\t\t= require(\"awayjs-core/lib/net/URLLoaderDataFormat\");\r\nimport URLRequest\t\t\t\t\t\t= require(\"awayjs-core/lib/net/URLRequest\");\r\nimport ParserBase\t\t\t\t\t\t= require(\"awayjs-core/lib/parsers/ParserBase\");\r\nimport ParserUtils\t\t\t\t\t\t= require(\"awayjs-core/lib/parsers/ParserUtils\");\r\nimport ResourceDependency\t\t\t\t= require(\"awayjs-core/lib/parsers/ResourceDependency\");\r\nimport Texture2DBase\t\t\t\t\t= require(\"awayjs-core/lib/textures/Texture2DBase\");\r\nimport TextureBase\t\t\t\t\t\t= require(\"awayjs-core/lib/textures/TextureBase\");\r\n\r\nimport DisplayObjectContainer\t\t\t= require(\"awayjs-display/lib/containers/DisplayObjectContainer\");\r\nimport Mesh\t\t\t\t\t\t\t\t= require(\"awayjs-display/lib/entities/Mesh\");\r\nimport DefaultMaterialManager\t\t\t= require(\"awayjs-display/lib/managers/DefaultMaterialManager\");\r\nimport MaterialBase\t\t\t\t\t\t= require(\"awayjs-display/lib/materials/MaterialBase\");\r\n\r\nimport MethodMaterial\t\t\t\t\t= require(\"awayjs-methodmaterials/lib/MethodMaterial\");\r\nimport MethodMaterialMode\t\t\t\t= require(\"awayjs-methodmaterials/lib/MethodMaterialMode\");\r\nimport SpecularBasicMethod\t\t\t\t= require(\"awayjs-methodmaterials/lib/methods/SpecularBasicMethod\");\r\n\r\n/**\r\n * OBJParser provides a parser for the OBJ data type.\r\n */\r\nclass OBJParser extends ParserBase\r\n{\r\n\tprivate _textData:string;\r\n\tprivate _startedParsing:boolean;\r\n\tprivate _charIndex:number;\r\n\tprivate _oldIndex:number;\r\n\tprivate _stringLength:number;\r\n\tprivate _currentObject:ObjectGroup;\r\n\tprivate _currentGroup:Group;\r\n\tprivate _currentMaterialGroup:MaterialGroup;\r\n\tprivate _objects:Array<ObjectGroup>;\r\n\tprivate _materialIDs:string[];\r\n\tprivate _materialLoaded:Array<LoadedMaterial>;\r\n\tprivate _materialSpecularData:Array<SpecularData>;\r\n\tprivate _meshes:Array<Mesh>;\r\n\tprivate _lastMtlID:string;\r\n\tprivate _objectIndex:number;\r\n\tprivate _realIndices;\r\n\tprivate _vertexIndex:number;\r\n\tprivate _vertices:Array<Vertex>;\r\n\tprivate _vertexNormals:Array<Vertex>;\r\n\tprivate _uvs:Array<UV>;\r\n\tprivate _scale:number;\r\n\tprivate _mtlLib:boolean;\r\n\tprivate _mtlLibLoaded:boolean = true;\r\n\tprivate _activeMaterialID:string = \"\";\r\n\r\n\t/**\r\n\t * Creates a new OBJParser object.\r\n\t * @param uri The url or id of the data or file to be parsed.\r\n\t * @param extra The holder for extra contextual data that the parser might need.\r\n\t */\r\n\tconstructor(scale:number = 1)\r\n\t{\r\n\t\tsuper(URLLoaderDataFormat.TEXT);\r\n\t\tthis._scale = scale;\r\n\t}\r\n\r\n\t/**\r\n\t * Scaling factor applied directly to vertices data\r\n\t * @param value The scaling factor.\r\n\t */\r\n\tpublic set scale(value:number)\r\n\t{\r\n\t\tthis._scale = value;\r\n\t}\r\n\r\n\t/**\r\n\t * Indicates whether or not a given file extension is supported by the parser.\r\n\t * @param extension The file extension of a potential file to be parsed.\r\n\t * @return Whether or not the given file type is supported.\r\n\t */\r\n\tpublic static supportsType(extension:string):boolean\r\n\t{\r\n\t\textension = extension.toLowerCase();\r\n\t\treturn extension == \"obj\";\r\n\t}\r\n\r\n\t/**\r\n\t * Tests whether a data block can be parsed by the parser.\r\n\t * @param data The data block to potentially be parsed.\r\n\t * @return Whether or not the given data is supported.\r\n\t */\r\n\tpublic static supportsData(data:any):boolean\r\n\t{\r\n\t\tvar content:string = ParserUtils.toString(data);\r\n\t\tvar hasV:boolean = false;\r\n\t\tvar hasF:boolean = false;\r\n\r\n\t\tif (content) {\r\n\t\t\thasV = content.indexOf(\"\\nv \") != -1;\r\n\t\t\thasF = content.indexOf(\"\\nf \") != -1;\r\n\t\t}\r\n\r\n\t\treturn hasV && hasF;\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iResolveDependency(resourceDependency:ResourceDependency)\r\n\t{\r\n\t\tif (resourceDependency.id == 'mtl') {\r\n\t\t\tvar str:string = ParserUtils.toString(resourceDependency.data);\r\n\t\t\tthis.parseMtl(str);\r\n\r\n\t\t} else {\r\n\t\t\tvar asset:IAsset;\r\n\r\n\t\t\tif (resourceDependency.assets.length != 1) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tasset = resourceDependency.assets[0];\r\n\r\n\t\t\tif (asset.isAsset(TextureBase)) {\r\n\r\n\t\t\t\tvar lm:LoadedMaterial = new LoadedMaterial();\r\n\t\t\t\tlm.materialID = resourceDependency.id;\r\n\t\t\t\tlm.texture = <Texture2DBase> asset;\r\n\r\n\t\t\t\tthis._materialLoaded.push(lm);\r\n\r\n\t\t\t\tif (this._meshes.length > 0) {\r\n\t\t\t\t\tthis.applyMaterial(lm);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _iResolveDependencyFailure(resourceDependency:ResourceDependency)\r\n\t{\r\n\t\tif (resourceDependency.id == \"mtl\") {\r\n\t\t\tthis._mtlLib = false;\r\n\t\t\tthis._mtlLibLoaded = false;\r\n\t\t} else {\r\n\t\t\tvar lm:LoadedMaterial = new LoadedMaterial();\r\n\t\t\tlm.materialID = resourceDependency.id;\r\n\t\t\tthis._materialLoaded.push(lm);\r\n\t\t}\r\n\r\n\t\tif (this._meshes.length > 0)\r\n\t\t\tthis.applyMaterial(lm);\r\n\t}\r\n\r\n\t/**\r\n\t * @inheritDoc\r\n\t */\r\n\tpublic _pProceedParsing():boolean\r\n\t{\r\n\t\tvar line:string;\r\n\t\tvar creturn:string = String.fromCharCode(10);\r\n\t\tvar trunk;\r\n\r\n\t\tif (!this._startedParsing) {\r\n\t\t\tthis._textData = this._pGetTextData();\r\n\t\t\t// Merge linebreaks that are immediately preceeded by\r\n\t\t\t// the \"escape\" backward slash into single lines.\r\n\t\t\tthis._textData = this._textData.replace(/\\\\[\\r\\n]+\\s*/gm, ' ');\r\n\t\t}\r\n\r\n\t\tif (this._textData.indexOf(creturn) == -1)\r\n\t\t\tcreturn = String.fromCharCode(13);\r\n\r\n\t\tif (!this._startedParsing) {\r\n\t\t\tthis._startedParsing = true;\r\n\t\t\tthis._vertices = new Array<Vertex>();\r\n\t\t\tthis._vertexNormals = new Array<Vertex>();\r\n\t\t\tthis._materialIDs = new Array<string>();\r\n\t\t\tthis._materialLoaded = new Array<LoadedMaterial>();\r\n\t\t\tthis._meshes = new Array<Mesh>();\r\n\t\t\tthis._uvs = new Array<UV>();\r\n\t\t\tthis._stringLength = this._textData.length;\r\n\t\t\tthis._charIndex = this._textData.indexOf(creturn, 0);\r\n\t\t\tthis._oldIndex = 0;\r\n\t\t\tthis._objects = new Array<ObjectGroup>();\r\n\t\t\tthis._objectIndex = 0;\r\n\t\t}\r\n\r\n\t\twhile (this._charIndex < this._stringLength && this._pHasTime()) {\r\n\t\t\tthis._charIndex = this._textData.indexOf(creturn, this._oldIndex);\r\n\r\n\t\t\tif (this._charIndex == -1)\r\n\t\t\t\tthis._charIndex = this._stringLength;\r\n\r\n\t\t\tline = this._textData.substring(this._oldIndex, this._charIndex);\r\n\t\t\tline = line.split('\\r').join(\"\");\r\n\t\t\tline = line.replace(\"  \", \" \");\r\n\t\t\ttrunk = line.split(\" \");\r\n\t\t\tthis._oldIndex = this._charIndex + 1;\r\n\t\t\tthis.parseLine(trunk);\r\n\r\n\t\t\t// If whatever was parsed on this line resulted in the\r\n\t\t\t// parsing being paused to retrieve dependencies, break\r\n\t\t\t// here and do not continue parsing until un-paused.\r\n\t\t\tif (this.parsingPaused) {\r\n\t\t\t\treturn ParserBase.MORE_TO_PARSE;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif (this._charIndex >= this._stringLength) {\r\n\r\n\t\t\tif (this._mtlLib && !this._mtlLibLoaded) {\r\n\t\t\t\treturn ParserBase.MORE_TO_PARSE;\r\n\t\t\t}\r\n\r\n\t\t\tthis.translate();\r\n\t\t\tthis.applyMaterials();\r\n\r\n\t\t\treturn ParserBase.PARSING_DONE;\r\n\t\t}\r\n\r\n\t\treturn ParserBase.MORE_TO_PARSE;\r\n\t}\r\n\r\n\tpublic _pStartParsing(frameLimit:number)\r\n\t{\r\n\t\tsuper._pStartParsing(frameLimit);\r\n\r\n\t\t//create a content object for Loaders\r\n\t\tthis._pContent = new DisplayObjectContainer();\r\n\t}\r\n\r\n\t/**\r\n\t * Parses a single line in the OBJ file.\r\n\t */\r\n\tprivate parseLine(trunk)\r\n\t{\r\n\t\tswitch (trunk[0]) {\r\n\r\n\t\t\tcase \"mtllib\":\r\n\r\n\t\t\t\tthis._mtlLib = true;\r\n\t\t\t\tthis._mtlLibLoaded = false;\r\n\t\t\t\tthis.loadMtl(trunk[1]);\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase \"g\":\r\n\r\n\t\t\t\tthis.createGroup(trunk);\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase \"o\":\r\n\r\n\t\t\t\tthis.createObject(trunk);\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase \"usemtl\":\r\n\r\n\t\t\t\tif (this._mtlLib) {\r\n\r\n\t\t\t\t\tif (!trunk[1])\r\n\t\t\t\t\t\ttrunk[1] = \"def000\";\r\n\r\n\t\t\t\t\tthis._materialIDs.push(trunk[1]);\r\n\t\t\t\t\tthis._activeMaterialID = trunk[1];\r\n\r\n\t\t\t\t\tif (this._currentGroup)\r\n\t\t\t\t\t\tthis._currentGroup.materialID = this._activeMaterialID;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase \"v\":\r\n\r\n\t\t\t\tthis.parseVertex(trunk);\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase \"vt\":\r\n\r\n\t\t\t\tthis.parseUV(trunk);\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase \"vn\":\r\n\r\n\t\t\t\tthis.parseVertexNormal(trunk);\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase \"f\":\r\n\r\n\t\t\t\tthis.parseFace(trunk);\r\n\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Converts the parsed data into an Away3D scenegraph structure\r\n\t */\r\n\tprivate translate()\r\n\t{\r\n\t\tfor (var objIndex:number = 0; objIndex < this._objects.length; ++objIndex) {\r\n\t\t\tvar groups:Array<Group> = this._objects[objIndex].groups;\r\n\t\t\tvar numGroups:number = groups.length;\r\n\t\t\tvar materialGroups:Array<MaterialGroup>;\r\n\t\t\tvar numMaterialGroups:number;\r\n\t\t\tvar geometry:Geometry;\r\n\t\t\tvar mesh:Mesh;\r\n\r\n\t\t\tvar m:number;\r\n\t\t\tvar sm:number;\r\n\t\t\tvar bmMaterial:MethodMaterial;\r\n\r\n\t\t\tfor (var g:number = 0; g < numGroups; ++g) {\r\n\t\t\t\tgeometry = new Geometry();\r\n\t\t\t\tmaterialGroups = groups[g].materialGroups;\r\n\t\t\t\tnumMaterialGroups = materialGroups.length;\r\n\r\n\t\t\t\tfor (m = 0; m < numMaterialGroups; ++m)\r\n\t\t\t\t\tthis.translateMaterialGroup(materialGroups[m], geometry);\r\n\r\n\t\t\t\tif (geometry.subGeometries.length == 0)\r\n\t\t\t\t\tcontinue;\r\n\r\n\t\t\t\t// Finalize and force type-based name\r\n\t\t\t\tthis._pFinalizeAsset(<IAsset> geometry);//, \"\");\r\n\r\n\t\t\t\tbmMaterial = new MethodMaterial(DefaultMaterialManager.getDefaultTexture());\r\n\r\n\t\t\t\t//check for multipass\r\n\t\t\t\tif (this.materialMode >= 2)\r\n\t\t\t\t\tbmMaterial.mode = MethodMaterialMode.MULTI_PASS;\r\n\r\n\t\t\t\tmesh = new Mesh(geometry, bmMaterial);\r\n\r\n\t\t\t\tif (this._objects[objIndex].name) {\r\n\t\t\t\t\t// this is a full independent object ('o' tag in OBJ file)\r\n\t\t\t\t\tmesh.name = this._objects[objIndex].name;\r\n\r\n\t\t\t\t} else if (groups[g].name) {\r\n\r\n\t\t\t\t\t// this is a group so the sub groups contain the actual mesh object names ('g' tag in OBJ file)\r\n\t\t\t\t\tmesh.name = groups[g].name;\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// No name stored. Use empty string which will force it\r\n\t\t\t\t\t// to be overridden by finalizeAsset() to type default.\r\n\t\t\t\t\tmesh.name = \"\";\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._meshes.push(mesh);\r\n\r\n\t\t\t\tif (groups[g].materialID != \"\")\r\n\t\t\t\t\tbmMaterial.name = groups[g].materialID + \"~\" + mesh.name; else\r\n\t\t\t\t\tbmMaterial.name = this._lastMtlID + \"~\" + mesh.name;\r\n\r\n\t\t\t\tif (mesh.subMeshes.length > 1) {\r\n\t\t\t\t\tfor (sm = 1; sm < mesh.subMeshes.length; ++sm)\r\n\t\t\t\t\t\tmesh.subMeshes[sm].material = bmMaterial;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//add to the content property\r\n\t\t\t\t(<DisplayObjectContainer> this._pContent).addChild(mesh);\r\n\r\n\t\t\t\tthis._pFinalizeAsset(<IAsset> mesh);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Translates an obj's material group to a subgeometry.\r\n\t * @param materialGroup The material group data to convert.\r\n\t * @param geometry The Geometry to contain the converted SubGeometry.\r\n\t */\r\n\tprivate translateMaterialGroup(materialGroup:MaterialGroup, geometry:Geometry)\r\n\t{\r\n\t\tvar faces:Array<FaceData> = materialGroup.faces;\r\n\t\tvar face:FaceData;\r\n\t\tvar numFaces:number = faces.length;\r\n\t\tvar numVerts:number;\r\n\t\tvar sub:TriangleSubGeometry;\r\n\r\n\t\tvar vertices:Array<number> = new Array<number>();\r\n\t\tvar uvs:Array<number> = new Array<number>();\r\n\t\tvar normals:Array<number> = new Array<number>();\r\n\t\tvar indices:Array<number> /*uint*/ = new Array<number>();\r\n\r\n\t\tthis._realIndices = [];\r\n\t\tthis._vertexIndex = 0;\r\n\r\n\t\tvar j:number;\r\n\t\tfor (var i:number = 0; i < numFaces; ++i) {\r\n\r\n\t\t\tface = faces[i];\r\n\t\t\tnumVerts = face.indexIds.length - 1;\r\n\r\n\t\t\tfor (j = 1; j < numVerts; ++j) {\r\n\r\n\t\t\t\tthis.translateVertexData(face, j, vertices, uvs, indices, normals);\r\n\t\t\t\tthis.translateVertexData(face, 0, vertices, uvs, indices, normals);\r\n\t\t\t\tthis.translateVertexData(face, j + 1, vertices, uvs, indices, normals);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (vertices.length > 0) {\r\n\t\t\tsub = new TriangleSubGeometry(true);\r\n\t\t\tsub.autoDeriveNormals = normals.length? false : true;\r\n\t\t\tsub.updateIndices(indices);\r\n\t\t\tsub.updatePositions(vertices);\r\n\t\t\tsub.updateVertexNormals(normals);\r\n\t\t\tsub.updateUVs(uvs);\r\n\r\n\t\t\tgeometry.addSubGeometry(sub);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate translateVertexData(face:FaceData, vertexIndex:number, vertices:Array<number>, uvs:Array<number>, indices:Array<number> /*uint*/, normals:Array<number>)\r\n\t{\r\n\t\tvar index:number;\r\n\t\tvar vertex:Vertex;\r\n\t\tvar vertexNormal:Vertex;\r\n\t\tvar uv:UV;\r\n\r\n\t\tif (!this._realIndices[face.indexIds[vertexIndex]]) {\r\n\r\n\t\t\tindex = this._vertexIndex;\r\n\t\t\tthis._realIndices[face.indexIds[vertexIndex]] = ++this._vertexIndex;\r\n\t\t\tvertex = this._vertices[face.vertexIndices[vertexIndex] - 1];\r\n\t\t\tvertices.push(vertex.x*this._scale, vertex.y*this._scale, vertex.z*this._scale);\r\n\r\n\t\t\tif (face.normalIndices.length > 0) {\r\n\t\t\t\tvertexNormal = this._vertexNormals[face.normalIndices[vertexIndex] - 1];\r\n\t\t\t\tnormals.push(vertexNormal.x, vertexNormal.y, vertexNormal.z);\r\n\t\t\t}\r\n\r\n\t\t\tif (face.uvIndices.length > 0) {\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\tuv = this._uvs[face.uvIndices[vertexIndex] - 1];\r\n\t\t\t\t\tuvs.push(uv.u, uv.v);\r\n\r\n\t\t\t\t} catch (e) {\r\n\r\n\t\t\t\t\tswitch (vertexIndex) {\r\n\t\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\t\tuvs.push(0, 1);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\t\tuvs.push(.5, 0);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\t\tuvs.push(1, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\t\t\tindex = this._realIndices[face.indexIds[vertexIndex]] - 1;\r\n\t\t}\r\n\r\n\t\tindices.push(index);\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new object group.\r\n\t * @param trunk The data block containing the object tag and its parameters\r\n\t */\r\n\tprivate createObject(trunk)\r\n\t{\r\n\t\tthis._currentGroup = null;\r\n\t\tthis._currentMaterialGroup = null;\r\n\t\tthis._objects.push(this._currentObject = new ObjectGroup());\r\n\r\n\t\tif (trunk)\r\n\t\t\tthis._currentObject.name = trunk[1];\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new group.\r\n\t * @param trunk The data block containing the group tag and its parameters\r\n\t */\r\n\tprivate createGroup(trunk)\r\n\t{\r\n\t\tif (!this._currentObject)\r\n\t\t\tthis.createObject(null);\r\n\t\tthis._currentGroup = new Group();\r\n\r\n\t\tthis._currentGroup.materialID = this._activeMaterialID;\r\n\r\n\t\tif (trunk)\r\n\t\t\tthis._currentGroup.name = trunk[1];\r\n\t\tthis._currentObject.groups.push(this._currentGroup);\r\n\r\n\t\tthis.createMaterialGroup(null);\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a new material group.\r\n\t * @param trunk The data block containing the material tag and its parameters\r\n\t */\r\n\tprivate createMaterialGroup(trunk)\r\n\t{\r\n\t\tthis._currentMaterialGroup = new MaterialGroup();\r\n\t\tif (trunk)\r\n\t\t\tthis._currentMaterialGroup.url = trunk[1];\r\n\t\tthis._currentGroup.materialGroups.push(this._currentMaterialGroup);\r\n\t}\r\n\r\n\t/**\r\n\t * Reads the next vertex coordinates.\r\n\t * @param trunk The data block containing the vertex tag and its parameters\r\n\t */\r\n\tprivate parseVertex(trunk)\r\n\t{\r\n\t\t//for the very rare cases of other delimiters/charcodes seen in some obj files\r\n\r\n\t\tvar v1:number, v2:number , v3:number;\r\n\t\tif (trunk.length > 4) {\r\n\t\t\tvar nTrunk = [];\r\n\t\t\tvar val:number;\r\n\r\n\t\t\tfor (var i:number = 1; i < trunk.length; ++i) {\r\n\t\t\t\tval = parseFloat(trunk[i]);\r\n\t\t\t\tif (!isNaN(val))\r\n\t\t\t\t\tnTrunk.push(val);\r\n\t\t\t}\r\n\r\n\t\t\tv1 = <number> nTrunk[0];\r\n\t\t\tv2 = <number> nTrunk[1];\r\n\t\t\tv3 = <number> -nTrunk[2];\r\n\t\t\tthis._vertices.push(new Vertex(v1, v2, v3));\r\n\r\n\t\t} else {\r\n\t\t\tv1 = <number> parseFloat(trunk[1]);\r\n\t\t\tv2 = <number> parseFloat(trunk[2]);\r\n\t\t\tv3 = <number> -parseFloat(trunk[3]);\r\n\r\n\t\t\tthis._vertices.push(new Vertex(v1, v2, v3));\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Reads the next uv coordinates.\r\n\t * @param trunk The data block containing the uv tag and its parameters\r\n\t */\r\n\tprivate parseUV(trunk)\r\n\t{\r\n\t\tif (trunk.length > 3) {\r\n\t\t\tvar nTrunk = [];\r\n\t\t\tvar val:number;\r\n\t\t\tfor (var i:number = 1; i < trunk.length; ++i) {\r\n\t\t\t\tval = parseFloat(trunk[i]);\r\n\t\t\t\tif (!isNaN(val))\r\n\t\t\t\t\tnTrunk.push(val);\r\n\t\t\t}\r\n\t\t\tthis._uvs.push(new UV(nTrunk[0], 1 - nTrunk[1]));\r\n\r\n\t\t} else {\r\n\t\t\tthis._uvs.push(new UV(parseFloat(trunk[1]), 1 - parseFloat(trunk[2])));\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Reads the next vertex normal coordinates.\r\n\t * @param trunk The data block containing the vertex normal tag and its parameters\r\n\t */\r\n\tprivate parseVertexNormal(trunk)\r\n\t{\r\n\t\tif (trunk.length > 4) {\r\n\t\t\tvar nTrunk = [];\r\n\t\t\tvar val:number;\r\n\t\t\tfor (var i:number = 1; i < trunk.length; ++i) {\r\n\t\t\t\tval = parseFloat(trunk[i]);\r\n\t\t\t\tif (!isNaN(val))\r\n\t\t\t\t\tnTrunk.push(val);\r\n\t\t\t}\r\n\t\t\tthis._vertexNormals.push(new Vertex(nTrunk[0], nTrunk[1], -nTrunk[2]));\r\n\r\n\t\t} else {\r\n\t\t\tthis._vertexNormals.push(new Vertex(parseFloat(trunk[1]), parseFloat(trunk[2]), -parseFloat(trunk[3])));\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Reads the next face's indices.\r\n\t * @param trunk The data block containing the face tag and its parameters\r\n\t */\r\n\tprivate parseFace(trunk)\r\n\t{\r\n\t\tvar len:number = trunk.length;\r\n\t\tvar face:FaceData = new FaceData();\r\n\r\n\t\tif (!this._currentGroup) {\r\n\t\t\tthis.createGroup(null);\r\n\t\t}\r\n\r\n\t\tvar indices;\r\n\t\tfor (var i:number = 1; i < len; ++i) {\r\n\r\n\t\t\tif (trunk[i] == \"\") {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\tindices = trunk[i].split(\"/\");\r\n\t\t\tface.vertexIndices.push(this.parseIndex(parseInt(indices[0]), this._vertices.length));\r\n\r\n\t\t\tif (indices[1] && String(indices[1]).length > 0)\r\n\t\t\t\tface.uvIndices.push(this.parseIndex(parseInt(indices[1]), this._uvs.length));\r\n\r\n\t\t\tif (indices[2] && String(indices[2]).length > 0)\r\n\t\t\t\tface.normalIndices.push(this.parseIndex(parseInt(indices[2]), this._vertexNormals.length));\r\n\r\n\t\t\tface.indexIds.push(trunk[i]);\r\n\t\t}\r\n\r\n\t\tthis._currentMaterialGroup.faces.push(face);\r\n\t}\r\n\r\n\t/**\r\n\t * This is a hack around negative face coords\r\n\t */\r\n\tprivate parseIndex(index:number, length:number):number\r\n\t{\r\n\t\tif (index < 0)\r\n\t\t\treturn index + length + 1; else\r\n\t\t\treturn index;\r\n\t}\r\n\r\n\tprivate parseMtl(data:string)\r\n\t{\r\n\t\tvar materialDefinitions = data.split('newmtl');\r\n\t\tvar lines;\r\n\t\tvar trunk;\r\n\t\tvar j:number;\r\n\r\n\t\tvar basicSpecularMethod:SpecularBasicMethod;\r\n\t\tvar useSpecular:boolean;\r\n\t\tvar useColor:boolean;\r\n\t\tvar diffuseColor:number;\r\n\t\tvar color:number;\r\n\t\tvar specularColor:number;\r\n\t\tvar specular:number;\r\n\t\tvar alpha:number;\r\n\t\tvar mapkd:string;\r\n\r\n\t\tfor (var i:number = 0; i < materialDefinitions.length; ++i) {\r\n\r\n\r\n\t\t\tlines = (materialDefinitions[i].split('\\r')).join(\"\").split('\\n');\r\n\t\t\t//lines = (materialDefinitions[i].split('\\r') as Array).join(\"\").split('\\n');\r\n\r\n\t\t\tif (lines.length == 1)\r\n\t\t\t\tlines = materialDefinitions[i].split(String.fromCharCode(13));\r\n\r\n\t\t\tdiffuseColor = color = specularColor = 0xFFFFFF;\r\n\t\t\tspecular = 0;\r\n\t\t\tuseSpecular = false;\r\n\t\t\tuseColor = false;\r\n\t\t\talpha = 1;\r\n\t\t\tmapkd = \"\";\r\n\r\n\t\t\tfor (j = 0; j < lines.length; ++j) {\r\n\r\n\t\t\t\tlines[j] = lines[j].replace(/\\s+$/, \"\");\r\n\r\n\t\t\t\tif (lines[j].substring(0, 1) != \"#\" && (j == 0 || lines[j] != \"\")) {\r\n\t\t\t\t\ttrunk = lines[j].split(\" \");\r\n\r\n\t\t\t\t\tif (String(trunk[0]).charCodeAt(0) == 9 || String(trunk[0]).charCodeAt(0) == 32)\r\n\t\t\t\t\t\ttrunk[0] = trunk[0].substring(1, trunk[0].length);\r\n\r\n\t\t\t\t\tif (j == 0) {\r\n\t\t\t\t\t\tthis._lastMtlID = trunk.join(\"\");\r\n\t\t\t\t\t\tthis._lastMtlID = (this._lastMtlID == \"\")? \"def000\" : this._lastMtlID;\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tswitch (trunk[0]) {\r\n\r\n\t\t\t\t\t\t\tcase \"Ka\":\r\n\t\t\t\t\t\t\t\tif (trunk[1] && !isNaN(Number(trunk[1])) && trunk[2] && !isNaN(Number(trunk[2])) && trunk[3] && !isNaN(Number(trunk[3])))\r\n\t\t\t\t\t\t\t\t\tcolor = trunk[1]*255 << 16 | trunk[2]*255 << 8 | trunk[3]*255;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase \"Ks\":\r\n\t\t\t\t\t\t\t\tif (trunk[1] && !isNaN(Number(trunk[1])) && trunk[2] && !isNaN(Number(trunk[2])) && trunk[3] && !isNaN(Number(trunk[3]))) {\r\n\t\t\t\t\t\t\t\t\tspecularColor = trunk[1]*255 << 16 | trunk[2]*255 << 8 | trunk[3]*255;\r\n\t\t\t\t\t\t\t\t\tuseSpecular = true;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase \"Ns\":\r\n\t\t\t\t\t\t\t\tif (trunk[1] && !isNaN(Number(trunk[1])))\r\n\t\t\t\t\t\t\t\t\tspecular = Number(trunk[1])*0.001;\r\n\t\t\t\t\t\t\t\tif (specular == 0)\r\n\t\t\t\t\t\t\t\t\tuseSpecular = false;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase \"Kd\":\r\n\t\t\t\t\t\t\t\tif (trunk[1] && !isNaN(Number(trunk[1])) && trunk[2] && !isNaN(Number(trunk[2])) && trunk[3] && !isNaN(Number(trunk[3]))) {\r\n\t\t\t\t\t\t\t\t\tdiffuseColor = trunk[1]*255 << 16 | trunk[2]*255 << 8 | trunk[3]*255;\r\n\t\t\t\t\t\t\t\t\tuseColor = true;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase \"tr\":\r\n\t\t\t\t\t\t\tcase \"d\":\r\n\t\t\t\t\t\t\t\tif (trunk[1] && !isNaN(Number(trunk[1])))\r\n\t\t\t\t\t\t\t\t\talpha = Number(trunk[1]);\r\n\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\tcase \"map_Kd\":\r\n\t\t\t\t\t\t\t\tmapkd = this.parseMapKdString(trunk);\r\n\t\t\t\t\t\t\t\tmapkd = mapkd.replace(/\\\\/g, \"/\");\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (mapkd != \"\") {\r\n\r\n\t\t\t\tif (useSpecular) {\r\n\r\n\t\t\t\t\tbasicSpecularMethod = new SpecularBasicMethod();\r\n\t\t\t\t\tbasicSpecularMethod.specularColor = specularColor;\r\n\t\t\t\t\tbasicSpecularMethod.specular = specular;\r\n\r\n\t\t\t\t\tvar specularData:SpecularData = new SpecularData();\r\n\t\t\t\t\tspecularData.alpha = alpha;\r\n\t\t\t\t\tspecularData.basicSpecularMethod = basicSpecularMethod;\r\n\t\t\t\t\tspecularData.materialID = this._lastMtlID;\r\n\r\n\t\t\t\t\tif (!this._materialSpecularData)\r\n\t\t\t\t\t\tthis._materialSpecularData = new Array<SpecularData>();\r\n\r\n\t\t\t\t\tthis._materialSpecularData.push(specularData);\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._pAddDependency(this._lastMtlID, new URLRequest(mapkd));\r\n\r\n\t\t\t} else if (useColor && !isNaN(color)) {\r\n\r\n\t\t\t\tvar lm:LoadedMaterial = new LoadedMaterial();\r\n\t\t\t\tlm.materialID = this._lastMtlID;\r\n\r\n\t\t\t\tif (alpha == 0)\r\n\t\t\t\t\tconsole.log(\"Warning: an alpha value of 0 was found in mtl color tag (Tr or d) ref:\" + this._lastMtlID + \", mesh(es) using it will be invisible!\");\r\n\r\n\t\t\t\tvar cm:MethodMaterial;\r\n\r\n\t\t\t\tif (this.materialMode < 2) {\r\n\t\t\t\t\tcm = new MethodMaterial(color);\r\n\r\n\t\t\t\t\tvar colorMat:MethodMaterial = <MethodMaterial> cm;\r\n\r\n\t\t\t\t\tcolorMat.alpha = alpha;\r\n\t\t\t\t\tcolorMat.diffuseColor = diffuseColor;\r\n\t\t\t\t\tcolorMat.repeat = true;\r\n\r\n\t\t\t\t\tif (useSpecular) {\r\n\t\t\t\t\t\tcolorMat.specularColor = specularColor;\r\n\t\t\t\t\t\tcolorMat.specular = specular;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcm = new MethodMaterial(color);\r\n\t\t\t\t\tcm.mode = MethodMaterialMode.MULTI_PASS;\r\n\r\n\t\t\t\t\tvar colorMultiMat:MethodMaterial = <MethodMaterial> cm;\r\n\r\n\r\n\t\t\t\t\tcolorMultiMat.diffuseColor = diffuseColor;\r\n\t\t\t\t\tcolorMultiMat.repeat = true;\r\n\r\n\t\t\t\t\tif (useSpecular) {\r\n\t\t\t\t\t\tcolorMultiMat.specularColor = specularColor;\r\n\t\t\t\t\t\tcolorMultiMat.specular = specular;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlm.cm = cm;\r\n\r\n\t\t\t\tthis._materialLoaded.push(lm);\r\n\r\n\t\t\t\tif (this._meshes.length > 0)\r\n\t\t\t\t\tthis.applyMaterial(lm);\r\n\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis._mtlLibLoaded = true;\r\n\t}\r\n\r\n\tprivate parseMapKdString(trunk):string\r\n\t{\r\n\t\tvar url:string = \"\";\r\n\t\tvar i:number;\r\n\t\tvar breakflag:boolean;\r\n\r\n\t\tfor (i = 1; i < trunk.length;) {\r\n\t\t\tswitch (trunk[i]) {\r\n\t\t\t\tcase \"-blendu\":\r\n\t\t\t\tcase \"-blendv\":\r\n\t\t\t\tcase \"-cc\":\r\n\t\t\t\tcase \"-clamp\":\r\n\t\t\t\tcase \"-texres\":\r\n\t\t\t\t\ti += 2; //Skip ahead 1 attribute\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"-mm\":\r\n\t\t\t\t\ti += 3; //Skip ahead 2 attributes\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"-o\":\r\n\t\t\t\tcase \"-s\":\r\n\t\t\t\tcase \"-t\":\r\n\t\t\t\t\ti += 4; //Skip ahead 3 attributes\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tbreakflag = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tif (breakflag)\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\t//Reconstruct URL/filename\r\n\t\tfor (i; i < trunk.length; i++) {\r\n\t\t\turl += trunk[i];\r\n\t\t\turl += \" \";\r\n\t\t}\r\n\r\n\t\t//Remove the extraneous space and/or newline from the right side\r\n\t\turl = url.replace(/\\s+$/, \"\");\r\n\r\n\t\treturn url;\r\n\t}\r\n\r\n\tprivate loadMtl(mtlurl:string)\r\n\t{\r\n\t\t// Add raw-data dependency to queue and load dependencies now,\r\n\t\t// which will pause the parsing in the meantime.\r\n\t\tthis._pAddDependency('mtl', new URLRequest(mtlurl), true);\r\n\t\tthis._pPauseAndRetrieveDependencies();//\r\n\t}\r\n\r\n\tprivate applyMaterial(lm:LoadedMaterial)\r\n\t{\r\n\t\tvar decomposeID;\r\n\t\tvar mesh:Mesh;\r\n\t\tvar tm:MethodMaterial;\r\n\t\tvar j:number;\r\n\t\tvar specularData:SpecularData;\r\n\r\n\t\tfor (var i:number = 0; i < this._meshes.length; ++i) {\r\n\t\t\tmesh = this._meshes[i];\r\n\t\t\tdecomposeID = mesh.material.name.split(\"~\");\r\n\r\n\t\t\tif (decomposeID[0] == lm.materialID) {\r\n\r\n\t\t\t\tif (lm.cm) {\r\n\t\t\t\t\tif (mesh.material)\r\n\t\t\t\t\t\tmesh.material = null;\r\n\t\t\t\t\tmesh.material = lm.cm;\r\n\r\n\t\t\t\t} else if (lm.texture) {\r\n\t\t\t\t\tif (this.materialMode < 2) { // if materialMode is 0 or 1, we create a SinglePass\r\n\t\t\t\t\t\ttm = <MethodMaterial > mesh.material;\r\n\r\n\t\t\t\t\t\ttm.texture = lm.texture;\r\n\t\t\t\t\t\ttm.color = lm.color;\r\n\t\t\t\t\t\ttm.alpha = lm.alpha;\r\n\t\t\t\t\t\ttm.repeat = true;\r\n\r\n\t\t\t\t\t\tif (lm.specularMethod) {\r\n\r\n\t\t\t\t\t\t\t// By setting the specularMethod property to null before assigning\r\n\t\t\t\t\t\t\t// the actual method instance, we avoid having the properties of\r\n\t\t\t\t\t\t\t// the new method being overridden with the settings from the old\r\n\t\t\t\t\t\t\t// one, which is default behavior of the setter.\r\n\t\t\t\t\t\t\ttm.specularMethod = null;\r\n\t\t\t\t\t\t\ttm.specularMethod = lm.specularMethod;\r\n\r\n\t\t\t\t\t\t} else if (this._materialSpecularData) {\r\n\r\n\t\t\t\t\t\t\tfor (j = 0; j < this._materialSpecularData.length; ++j) {\r\n\t\t\t\t\t\t\t\tspecularData = this._materialSpecularData[j];\r\n\r\n\t\t\t\t\t\t\t\tif (specularData.materialID == lm.materialID) {\r\n\t\t\t\t\t\t\t\t\ttm.specularMethod = null; // Prevent property overwrite (see above)\r\n\t\t\t\t\t\t\t\t\ttm.specularMethod = specularData.basicSpecularMethod;\r\n\t\t\t\t\t\t\t\t\ttm.color = specularData.color;\r\n\t\t\t\t\t\t\t\t\ttm.alpha = specularData.alpha;\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else { //if materialMode==2 this is a MultiPassTexture\r\n\t\t\t\t\t\ttm = <MethodMaterial> mesh.material;\r\n\t\t\t\t\t\ttm.mode = MethodMaterialMode.MULTI_PASS;\r\n\r\n\t\t\t\t\t\ttm.texture = lm.texture;\r\n\t\t\t\t\t\ttm.color = lm.color;\r\n\t\t\t\t\t\ttm.repeat = true;\r\n\r\n\t\t\t\t\t\tif (lm.specularMethod) {\r\n\t\t\t\t\t\t\t// By setting the specularMethod property to null before assigning\r\n\t\t\t\t\t\t\t// the actual method instance, we avoid having the properties of\r\n\t\t\t\t\t\t\t// the new method being overridden with the settings from the old\r\n\t\t\t\t\t\t\t// one, which is default behavior of the setter.\r\n\t\t\t\t\t\t\ttm.specularMethod = null;\r\n\t\t\t\t\t\t\ttm.specularMethod = lm.specularMethod;\r\n\t\t\t\t\t\t} else if (this._materialSpecularData) {\r\n\t\t\t\t\t\t\tfor (j = 0; j < this._materialSpecularData.length; ++j) {\r\n\t\t\t\t\t\t\t\tspecularData = this._materialSpecularData[j];\r\n\r\n\t\t\t\t\t\t\t\tif (specularData.materialID == lm.materialID) {\r\n\t\t\t\t\t\t\t\t\ttm.specularMethod = null; // Prevent property overwrite (see above)\r\n\t\t\t\t\t\t\t\t\ttm.specularMethod = specularData.basicSpecularMethod;\r\n\t\t\t\t\t\t\t\t\ttm.color = specularData.color;\r\n\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmesh.material.name = decomposeID[1]? decomposeID[1] : decomposeID[0];\r\n\t\t\t\tthis._meshes.splice(i, 1);\r\n\t\t\t\t--i;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (lm.cm || tm)\r\n\t\t\tthis._pFinalizeAsset(lm.cm || tm);\r\n\t}\r\n\r\n\tprivate applyMaterials()\r\n\t{\r\n\t\tif (this._materialLoaded.length == 0)\r\n\t\t\treturn;\r\n\r\n\t\tfor (var i:number = 0; i < this._materialLoaded.length; ++i)\r\n\t\t\tthis.applyMaterial(this._materialLoaded[i]);\r\n\t}\r\n}\r\n\r\nexport = OBJParser;\r\n\r\nclass ObjectGroup\r\n{\r\n\tpublic name:string;\r\n\tpublic groups:Group[] = new Array<Group>();\r\n}\r\n\r\nclass Group\r\n{\r\n\tpublic name:string;\r\n\tpublic materialID:string;\r\n\tpublic materialGroups:MaterialGroup[] = new Array<MaterialGroup>();\r\n}\r\n\r\nclass MaterialGroup\r\n{\r\n\tpublic url:string;\r\n\tpublic faces:FaceData[] = new Array<FaceData>();\r\n}\r\n\r\nclass SpecularData\r\n{\r\n\tpublic materialID:string;\r\n\tpublic basicSpecularMethod:SpecularBasicMethod;\r\n\tpublic color:number = 0xFFFFFF;\r\n\tpublic alpha:number = 1;\r\n}\r\n\r\nclass LoadedMaterial\r\n{\r\n\tpublic materialID:string;\r\n\tpublic texture:Texture2DBase;\r\n\tpublic cm:MaterialBase;\r\n\tpublic specularMethod:SpecularBasicMethod;\r\n\tpublic color:number = 0xFFFFFF;\r\n\tpublic alpha:number = 1;\r\n}\r\n\r\nclass FaceData\r\n{\r\n\tpublic vertexIndices:Array<number> /*uint*/ = new Array<number>();\r\n\tpublic uvIndices:Array<number> /*uint*/ = new Array<number>();\r\n\tpublic normalIndices:Array<number> /*uint*/ = new Array<number>();\r\n\tpublic indexIds:string[] = new Array<string>(); // used for real index lookups\r\n}\r\n\r\n/**\r\n* Texture coordinates value object.\r\n*/\r\nclass UV\r\n{\r\n\tprivate _u:number;\r\n\tprivate _v:number;\r\n\r\n\t/**\r\n\t * Creates a new <code>UV</code> object.\r\n\t *\r\n\t * @param    u        [optional]    The horizontal coordinate of the texture value. Defaults to 0.\r\n\t * @param    v        [optional]    The vertical coordinate of the texture value. Defaults to 0.\r\n\t */\r\n\tconstructor(u:number = 0, v:number = 0)\r\n\t{\r\n\t\tthis._u = u;\r\n\t\tthis._v = v;\r\n\t}\r\n\r\n\t/**\r\n\t * Defines the vertical coordinate of the texture value.\r\n\t */\r\n\tpublic get v():number\r\n\t{\r\n\t\treturn this._v;\r\n\t}\r\n\r\n\tpublic set v(value:number)\r\n\t{\r\n\t\tthis._v = value;\r\n\t}\r\n\r\n\t/**\r\n\t * Defines the horizontal coordinate of the texture value.\r\n\t */\r\n\tpublic get u():number\r\n\t{\r\n\t\treturn this._u;\r\n\t}\r\n\r\n\tpublic set u(value:number)\r\n\t{\r\n\t\tthis._u = value;\r\n\t}\r\n\r\n\t/**\r\n\t * returns a new UV value Object\r\n\t */\r\n\tpublic clone():UV\r\n\t{\r\n\t\treturn new UV(this._u, this._v);\r\n\t}\r\n\r\n\t/**\r\n\t * returns the value object as a string for trace/debug purpose\r\n\t */\r\n\tpublic toString():string\r\n\t{\r\n\t\treturn this._u + \",\" + this._v;\r\n\t}\r\n}\r\n\r\nclass Vertex\r\n{\r\n\tprivate _x:number;\r\n\tprivate _y:number;\r\n\tprivate _z:number;\r\n\tprivate _index:number;\r\n\r\n\t/**\r\n\t * Creates a new <code>Vertex</code> value object.\r\n\t *\r\n\t * @param    x            [optional]    The x value. Defaults to 0.\r\n\t * @param    y            [optional]    The y value. Defaults to 0.\r\n\t * @param    z            [optional]    The z value. Defaults to 0.\r\n\t * @param    index        [optional]    The index value. Defaults is NaN.\r\n\t */\r\n\tconstructor(x:number = 0, y:number = 0, z:number = 0, index:number = 0)\r\n\t{\r\n\t\tthis._x = x;\r\n\t\tthis._y = y;\r\n\t\tthis._z = z;\r\n\t\tthis._index = index;\r\n\t}\r\n\r\n\t/**\r\n\t * To define/store the index of value object\r\n\t * @param    ind        The index\r\n\t */\r\n\tpublic set index(ind:number)\r\n\t{\r\n\t\tthis._index = ind;\r\n\t}\r\n\r\n\tpublic get index():number\r\n\t{\r\n\t\treturn this._index;\r\n\t}\r\n\r\n\t/**\r\n\t * To define/store the x value of the value object\r\n\t * @param    value        The x value\r\n\t */\r\n\tpublic get x():number\r\n\t{\r\n\t\treturn this._x;\r\n\t}\r\n\r\n\tpublic set x(value:number)\r\n\t{\r\n\t\tthis._x = value;\r\n\t}\r\n\r\n\t/**\r\n\t * To define/store the y value of the value object\r\n\t * @param    value        The y value\r\n\t */\r\n\tpublic get y():number\r\n\t{\r\n\t\treturn this._y;\r\n\t}\r\n\r\n\tpublic set y(value:number)\r\n\t{\r\n\t\tthis._y = value;\r\n\t}\r\n\r\n\t/**\r\n\t * To define/store the z value of the value object\r\n\t * @param    value        The z value\r\n\t */\r\n\tpublic get z():number\r\n\t{\r\n\t\treturn this._z;\r\n\t}\r\n\r\n\tpublic set z(value:number)\r\n\t{\r\n\t\tthis._z = value;\r\n\t}\r\n\r\n\t/**\r\n\t * returns a new Vertex value Object\r\n\t */\r\n\tpublic clone():Vertex\r\n\t{\r\n\t\treturn new Vertex(this._x, this._y, this._z);\r\n\t}\r\n}",
    "import AssetLoader\t\t\t\t\t\t= require(\"awayjs-core/lib/library/AssetLoader\");\r\n\r\nimport AWDParser\t\t\t\t\t\t= require(\"awayjs-parsers/lib/AWDParser\");\r\nimport Max3DSParser\t\t\t\t\t\t= require(\"awayjs-parsers/lib/Max3DSParser\");\r\nimport MD2Parser\t\t\t\t\t\t= require(\"awayjs-parsers/lib/MD2Parser\");\r\nimport OBJParser\t\t\t\t\t\t= require(\"awayjs-parsers/lib/OBJParser\");\r\n\r\n/**\r\n *\r\n */\r\nclass Parsers\r\n{\r\n\t/**\r\n\t * A list of all parsers that come bundled with Away3D. Use this to quickly\r\n\t * enable support for all bundled parsers to the file format auto-detection\r\n\t * feature, using any of the enableParsers() methods on loaders, e.g.:\r\n\t *\r\n\t * <code>AssetLibrary.enableParsers(Parsers.ALL_BUNDLED);</code>\r\n\t *\r\n\t * Beware however that this requires all parser classes to be included in the\r\n\t * SWF file, which will add 50-100 kb to the file. When only a limited set of\r\n\t * file formats are used, SWF file size can be saved by adding the parsers\r\n\t * individually using AssetLibrary.enableParser()\r\n\t *\r\n\t * A third way is to specify a parser for each loaded file, thereby bypassing\r\n\t * the auto-detection mechanisms altogether, while at the same time allowing\r\n\t * any properties that are unique to that parser to be set for that load.\r\n\t *\r\n\t * The bundled parsers are:\r\n\t *\r\n\t * <ul>\r\n\t * <li>AC3D (.ac)</li>\r\n\t * <li>Away Data version 1 ASCII and version 2 binary (.awd). AWD1 BSP unsupported</li>\r\n\t * <li>3DMax (.3ds)</li>\r\n\t * <li>DXF (.dxf)</li>\r\n\t * <li>Quake 2 MD2 models (.md2)</li>\r\n\t * <li>Doom 3 MD5 animation clips (.md5anim)</li>\r\n\t * <li>Doom 3 MD5 meshes (.md5mesh)</li>\r\n\t * <li>Wavefront OBJ (.obj)</li>\r\n\t * <li>Collada (.dae)</li>\r\n\t * <li>Images (.jpg, .png)</li>\r\n\t * </ul>\r\n\t *\r\n\t * @see away.library.AssetLibrary.enableParser\r\n\t */\r\n\tpublic static ALL_BUNDLED:Array<Object> = Array<Object>(AWDParser, Max3DSParser, MD2Parser, OBJParser);\r\n\r\n\t/**\r\n\t * Short-hand function to enable all bundled parsers for auto-detection. In practice,\r\n\t * this is the same as invoking enableParsers(Parsers.ALL_BUNDLED) on any of the\r\n\t * loader classes SingleFileLoader, AssetLoader, AssetLibrary or Loader3D.\r\n\t *\r\n\t * See notes about file size in the documentation for the ALL_BUNDLED constant.\r\n\t *\r\n\t * @see away.parsers.Parsers.ALL_BUNDLED\r\n\t */\r\n\tpublic static enableAllBundled():void\r\n\t{\r\n\t\tAssetLoader.enableParsers(Parsers.ALL_BUNDLED);\r\n\t}\r\n}\r\n\r\nexport = Parsers;"
  ],
  "sourceRoot": ""
}