var BitmapImage2D = require("awayjs-core/lib/image/BitmapImage2D");
var Sampler2D = require("awayjs-core/lib/image/Sampler2D");
var LoaderEvent = require("awayjs-core/lib/events/LoaderEvent");
var Vector3D = require("awayjs-core/lib/geom/Vector3D");
var AssetLibrary = require("awayjs-core/lib/library/AssetLibrary");
var URLRequest = require("awayjs-core/lib/net/URLRequest");
var Debug = require("awayjs-core/lib/utils/Debug");
var RequestAnimationFrame = require("awayjs-core/lib/utils/RequestAnimationFrame");
var View = require("awayjs-display/lib/View");
var DirectionalLight = require("awayjs-display/lib/display/DirectionalLight");
var Sprite = require("awayjs-display/lib/display/Sprite");
var StaticLightPicker = require("awayjs-display/lib/materials/lightpickers/StaticLightPicker");
var PrimitiveTorusPrefab = require("awayjs-display/lib/prefabs/PrimitiveTorusPrefab");
var PrimitiveCubePrefab = require("awayjs-display/lib/prefabs/PrimitiveCubePrefab");
var PrimitiveCapsulePrefab = require("awayjs-display/lib/prefabs/PrimitiveCapsulePrefab");
var DefaultRenderer = require("awayjs-renderergl/lib/DefaultRenderer");
var MethodMaterial = require("awayjs-methodmaterials/lib/MethodMaterial");
var OBJParser = require("awayjs-parsers/lib/OBJParser");
var ElementsType = require("awayjs-display/lib/graphics/ElementsType");
var MaterialAlphaTest = (function () {
    function MaterialAlphaTest() {
        var _this = this;
        this.sprites = new Array();
        this.aValues = Array(0, .1, .5, .8, .9, .99, 1);
        this.aValuesP = 0;
        Debug.LOG_PI_ERRORS = false;
        Debug.THROW_ERRORS = false;
        this.view = new View(new DefaultRenderer());
        this.raf = new RequestAnimationFrame(this.render, this);
        this.onResize();
        this.light = new DirectionalLight();
        this.light.color = 0xFFFFFF;
        this.light.direction = new Vector3D(1, 1, 0);
        this.light.ambient = 0;
        this.light.ambientColor = 0xFFFFFF;
        this.light.diffuse = 1;
        this.light.specular = 1;
        this.lightB = new DirectionalLight();
        this.lightB.color = 0xFF0000;
        this.lightB.direction = new Vector3D(-1, 0, 1);
        this.lightB.ambient = 0;
        this.lightB.ambientColor = 0xFFFFFF;
        this.lightB.diffuse = 1;
        this.lightB.specular = 1;
        this.view.scene.addChild(this.light);
        this.view.scene.addChild(this.lightB);
        this.view.backgroundColor = 0x222222;
        AssetLibrary.enableParser(OBJParser);
        var session;
        session = AssetLibrary.getLoader();
        session.addEventListener(LoaderEvent.LOAD_COMPLETE, function (event) { return _this.onLoadComplete(event); });
        session.load(new URLRequest('assets/platonic.obj'));
        session = AssetLibrary.getLoader();
        session.addEventListener(LoaderEvent.LOAD_COMPLETE, function (event) { return _this.onLoadComplete(event); });
        session.load(new URLRequest('assets/dots.png'));
        window.onresize = function (event) { return _this.onResize(event); };
        document.onmousedown = function (event) { return _this.onMouseDown(event); };
    }
    MaterialAlphaTest.prototype.onMouseDown = function (event) {
        this.cubeColorMaterial.alpha = this.torusTextureMaterial.alpha = this.loadedSpriteMaterial.alpha = this.aValues[this.aValuesP];
        alert('Alpha: ' + this.aValues[this.aValuesP]);
        this.aValuesP++;
        if (this.aValuesP > this.aValues.length - 1)
            this.aValuesP = 0;
    };
    MaterialAlphaTest.prototype.render = function (dt) {
        if (this.sprites)
            for (var c = 0; c < this.sprites.length; c++)
                this.sprites[c].rotationY += .35;
        this.view.render();
    };
    MaterialAlphaTest.prototype.onLoadComplete = function (event) {
        var loader = event.target;
        var l = loader.baseDependency.assets.length;
        for (var c = 0; c < l; c++) {
            var d = loader.baseDependency.assets[c];
            console.log(d.name);
            switch (d.assetType) {
                case Sprite.assetType:
                    var sprite = d;
                    this.loadedSprite = sprite;
                    if (d.name == 'Sprite_g0') {
                        this.loadedSprite = sprite;
                        sprite.y = -400;
                        sprite.transform.scaleTo(5, 5, 5);
                    }
                    else {
                        sprite.transform.scaleTo(3.5, 3.5, 3.5);
                    }
                    if (this.loadedSpriteMaterial)
                        sprite.material = this.loadedSpriteMaterial;
                    this.view.scene.addChild(sprite);
                    this.sprites.push(sprite);
                    this.raf.start();
                    break;
                case BitmapImage2D.assetType:
                    // Light Picker
                    this.staticLightPicker = new StaticLightPicker([this.light, this.lightB]);
                    // Material for loaded sprite
                    this.loadedSpriteMaterial = new MethodMaterial(d);
                    this.loadedSpriteMaterial.style.sampler = new Sampler2D(true, true, false);
                    this.loadedSpriteMaterial.lightPicker = this.staticLightPicker;
                    this.loadedSpriteMaterial.alpha = 1;
                    this.loadedSpriteMaterial.bothSides = true;
                    if (this.loadedSprite)
                        this.loadedSprite.material = this.loadedSpriteMaterial;
                    // Torus Texture Material
                    this.torusTextureMaterial = new MethodMaterial(d);
                    this.torusTextureMaterial.style.sampler = new Sampler2D(true, true, false);
                    this.torusTextureMaterial.lightPicker = this.staticLightPicker;
                    this.torusTextureMaterial.bothSides = true;
                    this.torusTextureMaterial.alpha = .8;
                    // Torus
                    var torus = new PrimitiveTorusPrefab(this.torusTextureMaterial, ElementsType.TRIANGLE, 150, 50, 64, 64);
                    // Torus Sprite ( left )
                    var torusSprite = torus.getNewObject();
                    torusSprite.rotationX = 90;
                    torusSprite.x = 600;
                    this.sprites.push(torusSprite);
                    this.view.scene.addChild(torusSprite);
                    // Torus Color Material
                    this.cubeColorMaterial = new MethodMaterial(0x0090ff);
                    this.cubeColorMaterial.lightPicker = this.staticLightPicker;
                    this.cubeColorMaterial.alpha = .8;
                    this.cubeColorMaterial.bothSides = true;
                    var cube = new PrimitiveCubePrefab(this.cubeColorMaterial, ElementsType.TRIANGLE, 300, 300, 300, 20, 20, 20);
                    // Torus Sprite ( right )
                    var cubeSprite = cube.getNewObject();
                    cubeSprite.rotationX = 90;
                    cubeSprite.x = -600;
                    this.sprites.push(cubeSprite);
                    this.view.scene.addChild(cubeSprite);
                    this.capsuleColorMaterial = new MethodMaterial(0x00ffff);
                    this.capsuleColorMaterial.lightPicker = this.staticLightPicker;
                    var capsule = new PrimitiveCapsulePrefab(this.capsuleColorMaterial, ElementsType.TRIANGLE, 100, 200);
                    // Torus Sprite ( right )
                    var capsuleSprite = capsule.getNewObject();
                    this.sprites.push(capsuleSprite);
                    this.view.scene.addChild(capsuleSprite);
                    this.cubeColorMaterial.alpha = this.torusTextureMaterial.alpha = this.loadedSpriteMaterial.alpha = 1;
                    break;
            }
        }
    };
    MaterialAlphaTest.prototype.onResize = function (event) {
        if (event === void 0) { event = null; }
        this.view.y = 0;
        this.view.x = 0;
        this.view.width = window.innerWidth;
        this.view.height = window.innerHeight;
    };
    return MaterialAlphaTest;
})();

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1hdGVyaWFscy9NYXRlcmlhbEFscGhhVGVzdC50cyJdLCJuYW1lcyI6WyJNYXRlcmlhbEFscGhhVGVzdCIsIk1hdGVyaWFsQWxwaGFUZXN0LmNvbnN0cnVjdG9yIiwiTWF0ZXJpYWxBbHBoYVRlc3Qub25Nb3VzZURvd24iLCJNYXRlcmlhbEFscGhhVGVzdC5yZW5kZXIiLCJNYXRlcmlhbEFscGhhVGVzdC5vbkxvYWRDb21wbGV0ZSIsIk1hdGVyaWFsQWxwaGFUZXN0Lm9uUmVzaXplIl0sIm1hcHBpbmdzIjoiQUFBQSxJQUFPLGFBQWEsV0FBYyxxQ0FBcUMsQ0FBQyxDQUFDO0FBQ3pFLElBQU8sU0FBUyxXQUFlLGlDQUFpQyxDQUFDLENBQUM7QUFFbEUsSUFBTyxXQUFXLFdBQWUsb0NBQW9DLENBQUMsQ0FBQztBQUN2RSxJQUFPLFFBQVEsV0FBZ0IsK0JBQStCLENBQUMsQ0FBQztBQUNoRSxJQUFPLFlBQVksV0FBZSxzQ0FBc0MsQ0FBQyxDQUFDO0FBSzFFLElBQU8sVUFBVSxXQUFlLGdDQUFnQyxDQUFDLENBQUM7QUFFbEUsSUFBTyxLQUFLLFdBQWdCLDZCQUE2QixDQUFDLENBQUM7QUFDM0QsSUFBTyxxQkFBcUIsV0FBWSw2Q0FBNkMsQ0FBQyxDQUFDO0FBR3ZGLElBQU8sSUFBSSxXQUFpQix5QkFBeUIsQ0FBQyxDQUFDO0FBQ3ZELElBQU8sZ0JBQWdCLFdBQWMsNkNBQTZDLENBQUMsQ0FBQztBQUNwRixJQUFPLE1BQU0sV0FBZ0IsbUNBQW1DLENBQUMsQ0FBQztBQUNsRSxJQUFPLGlCQUFpQixXQUFhLDZEQUE2RCxDQUFDLENBQUM7QUFDcEcsSUFBTyxvQkFBb0IsV0FBYSxpREFBaUQsQ0FBQyxDQUFDO0FBQzNGLElBQU8sbUJBQW1CLFdBQWEsZ0RBQWdELENBQUMsQ0FBQztBQUN6RixJQUFPLHNCQUFzQixXQUFZLG1EQUFtRCxDQUFDLENBQUM7QUFHOUYsSUFBTyxlQUFlLFdBQWMsdUNBQXVDLENBQUMsQ0FBQztBQUU3RSxJQUFPLGNBQWMsV0FBYywyQ0FBMkMsQ0FBQyxDQUFDO0FBRWhGLElBQU8sU0FBUyxXQUFlLDhCQUE4QixDQUFDLENBQUM7QUFDL0QsSUFBTyxZQUFZLFdBQVcsMENBQTBDLENBQUMsQ0FBQztBQUUxRSxJQUFNLGlCQUFpQjtJQWtCdEJBLFNBbEJLQSxpQkFBaUJBO1FBQXZCQyxpQkE2TENBO1FBekxRQSxZQUFPQSxHQUFvQkEsSUFBSUEsS0FBS0EsRUFBVUEsQ0FBQ0E7UUFNL0NBLFlBQU9BLEdBQWlCQSxLQUFLQSxDQUFTQSxDQUFDQSxFQUFFQSxFQUFFQSxFQUFFQSxFQUFFQSxFQUFFQSxFQUFFQSxFQUFFQSxFQUFFQSxFQUFFQSxHQUFHQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNqRUEsYUFBUUEsR0FBVUEsQ0FBQ0EsQ0FBQ0E7UUFTM0JBLEtBQUtBLENBQUNBLGFBQWFBLEdBQUdBLEtBQUtBLENBQUNBO1FBQzVCQSxLQUFLQSxDQUFDQSxZQUFZQSxHQUFHQSxLQUFLQSxDQUFDQTtRQUUzQkEsSUFBSUEsQ0FBQ0EsSUFBSUEsR0FBR0EsSUFBSUEsSUFBSUEsQ0FBQ0EsSUFBSUEsZUFBZUEsRUFBRUEsQ0FBQ0EsQ0FBQ0E7UUFDNUNBLElBQUlBLENBQUNBLEdBQUdBLEdBQUdBLElBQUlBLHFCQUFxQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsRUFBRUEsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFDeERBLElBQUlBLENBQUNBLFFBQVFBLEVBQUVBLENBQUNBO1FBRWhCQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFHQSxJQUFJQSxnQkFBZ0JBLEVBQUVBLENBQUNBO1FBQ3BDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxLQUFLQSxHQUFHQSxRQUFRQSxDQUFDQTtRQUM1QkEsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsU0FBU0EsR0FBR0EsSUFBSUEsUUFBUUEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDN0NBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLE9BQU9BLEdBQUdBLENBQUNBLENBQUNBO1FBQ3ZCQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxZQUFZQSxHQUFHQSxRQUFRQSxDQUFDQTtRQUNuQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsT0FBT0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDdkJBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLFFBQVFBLEdBQUdBLENBQUNBLENBQUNBO1FBRXhCQSxJQUFJQSxDQUFDQSxNQUFNQSxHQUFHQSxJQUFJQSxnQkFBZ0JBLEVBQUVBLENBQUNBO1FBQ3JDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxLQUFLQSxHQUFFQSxRQUFRQSxDQUFDQTtRQUM1QkEsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsU0FBU0EsR0FBR0EsSUFBSUEsUUFBUUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDL0NBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLE9BQU9BLEdBQUdBLENBQUNBLENBQUNBO1FBQ3hCQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxZQUFZQSxHQUFHQSxRQUFRQSxDQUFDQTtRQUNwQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsT0FBT0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDeEJBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLFFBQVFBLEdBQUdBLENBQUNBLENBQUNBO1FBRXpCQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxRQUFRQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQTtRQUNyQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsUUFBUUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7UUFFdENBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLGVBQWVBLEdBQUdBLFFBQVFBLENBQUNBO1FBRXJDQSxZQUFZQSxDQUFDQSxZQUFZQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQTtRQUVyQ0EsSUFB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dXJjZXNDb250ZW50IjpbImltcG9ydCBCaXRtYXBJbWFnZTJEXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvaW1hZ2UvQml0bWFwSW1hZ2UyRFwiKTtcbmltcG9ydCBTYW1wbGVyMkRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2ltYWdlL1NhbXBsZXIyRFwiKTtcbmltcG9ydCBCbGVuZE1vZGVcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2ltYWdlL0JsZW5kTW9kZVwiKTtcbmltcG9ydCBMb2FkZXJFdmVudFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvZXZlbnRzL0xvYWRlckV2ZW50XCIpO1xuaW1wb3J0IFZlY3RvcjNEXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2dlb20vVmVjdG9yM0RcIik7XG5pbXBvcnQgQXNzZXRMaWJyYXJ5XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1jb3JlL2xpYi9saWJyYXJ5L0Fzc2V0TGlicmFyeVwiKTtcbmltcG9ydCBMb2FkZXJcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvbGlicmFyeS9Mb2FkZXJcIik7XG5pbXBvcnQgSUFzc2V0XHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL2xpYnJhcnkvSUFzc2V0XCIpO1xuaW1wb3J0IFVSTExvYWRlclx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvbmV0L1VSTExvYWRlclwiKTtcbmltcG9ydCBVUkxMb2FkZXJEYXRhRm9ybWF0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL25ldC9VUkxMb2FkZXJEYXRhRm9ybWF0XCIpO1xuaW1wb3J0IFVSTFJlcXVlc3RcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL25ldC9VUkxSZXF1ZXN0XCIpO1xuaW1wb3J0IFBlcnNwZWN0aXZlUHJvamVjdGlvblx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvcHJvamVjdGlvbnMvUGVyc3BlY3RpdmVQcm9qZWN0aW9uXCIpO1xuaW1wb3J0IERlYnVnXHRcdFx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL3V0aWxzL0RlYnVnXCIpO1xuaW1wb3J0IFJlcXVlc3RBbmltYXRpb25GcmFtZVx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvdXRpbHMvUmVxdWVzdEFuaW1hdGlvbkZyYW1lXCIpO1xuXG5pbXBvcnQgU2NlbmVcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvZGlzcGxheS9TY2VuZVwiKTtcbmltcG9ydCBWaWV3XHRcdFx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvVmlld1wiKTtcbmltcG9ydCBEaXJlY3Rpb25hbExpZ2h0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvZGlzcGxheS9EaXJlY3Rpb25hbExpZ2h0XCIpO1xuaW1wb3J0IFNwcml0ZVx0XHRcdFx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9kaXNwbGF5L1Nwcml0ZVwiKTtcbmltcG9ydCBTdGF0aWNMaWdodFBpY2tlclx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9tYXRlcmlhbHMvbGlnaHRwaWNrZXJzL1N0YXRpY0xpZ2h0UGlja2VyXCIpO1xuaW1wb3J0IFByaW1pdGl2ZVRvcnVzUHJlZmFiXHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL3ByZWZhYnMvUHJpbWl0aXZlVG9ydXNQcmVmYWJcIik7XG5pbXBvcnQgUHJpbWl0aXZlQ3ViZVByZWZhYlx0XHRcdD0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9wcmVmYWJzL1ByaW1pdGl2ZUN1YmVQcmVmYWJcIik7XG5pbXBvcnQgUHJpbWl0aXZlQ2Fwc3VsZVByZWZhYlx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvcHJlZmFicy9QcmltaXRpdmVDYXBzdWxlUHJlZmFiXCIpO1xuaW1wb3J0IFNpbmdsZTJEVGV4dHVyZVx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL3RleHR1cmVzL1NpbmdsZTJEVGV4dHVyZVwiKTtcblxuaW1wb3J0IERlZmF1bHRSZW5kZXJlclx0XHRcdFx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL0RlZmF1bHRSZW5kZXJlclwiKTtcblxuaW1wb3J0IE1ldGhvZE1hdGVyaWFsXHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtbWV0aG9kbWF0ZXJpYWxzL2xpYi9NZXRob2RNYXRlcmlhbFwiKTtcblxuaW1wb3J0IE9CSlBhcnNlclx0XHRcdFx0XHQ9IHJlcXVpcmUoXCJhd2F5anMtcGFyc2Vycy9saWIvT0JKUGFyc2VyXCIpO1xuaW1wb3J0IEVsZW1lbnRzVHlwZSA9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvZ3JhcGhpY3MvRWxlbWVudHNUeXBlXCIpO1xuXG5jbGFzcyBNYXRlcmlhbEFscGhhVGVzdFxue1xuXHRwcml2YXRlIHZpZXc6Vmlldztcblx0cHJpdmF0ZSByYWY6UmVxdWVzdEFuaW1hdGlvbkZyYW1lO1xuXHRwcml2YXRlIHNwcml0ZXMgIDogQXJyYXk8U3ByaXRlPiA9IG5ldyBBcnJheTxTcHJpdGU+KCk7XG5cdHByaXZhdGUgbG9hZGVkU3ByaXRlTWF0ZXJpYWw6TWV0aG9kTWF0ZXJpYWw7XG5cdHByaXZhdGUgbGlnaHQ6RGlyZWN0aW9uYWxMaWdodDtcblx0cHJpdmF0ZSBsaWdodEI6RGlyZWN0aW9uYWxMaWdodDtcblx0cHJpdmF0ZSBsb2FkZWRTcHJpdGU6U3ByaXRlO1xuXG5cdHByaXZhdGUgYVZhbHVlczpBcnJheTxudW1iZXI+ID0gQXJyYXk8bnVtYmVyPigwLCAuMSwgLjUsIC44LCAuOSwgLjk5LCAxKTtcblx0cHJpdmF0ZSBhVmFsdWVzUDpudW1iZXIgPSAwO1xuXG5cdHByaXZhdGUgdG9ydXNUZXh0dXJlTWF0ZXJpYWw6TWV0aG9kTWF0ZXJpYWw7XG5cdHByaXZhdGUgY3ViZUNvbG9yTWF0ZXJpYWw6TWV0aG9kTWF0ZXJpYWw7XG5cdHByaXZhdGUgY2Fwc3VsZUNvbG9yTWF0ZXJpYWw6TWV0aG9kTWF0ZXJpYWw7XG5cdHByaXZhdGUgc3RhdGljTGlnaHRQaWNrZXI6U3RhdGljTGlnaHRQaWNrZXI7XG5cblx0Y29uc3RydWN0b3IoKVxuXHR7XG5cdFx0RGVidWcuTE9HX1BJX0VSUk9SUyA9IGZhbHNlO1xuXHRcdERlYnVnLlRIUk9XX0VSUk9SUyA9IGZhbHNlO1xuXG5cdFx0dGhpcy52aWV3ID0gbmV3IFZpZXcobmV3IERlZmF1bHRSZW5kZXJlcigpKTtcblx0XHR0aGlzLnJhZiA9IG5ldyBSZXF1ZXN0QW5pbWF0aW9uRnJhbWUodGhpcy5yZW5kZXIsIHRoaXMpO1xuXHRcdHRoaXMub25SZXNpemUoKTtcblxuXHRcdHRoaXMubGlnaHQgPSBuZXcgRGlyZWN0aW9uYWxMaWdodCgpO1xuXHRcdHRoaXMubGlnaHQuY29sb3IgPSAweEZGRkZGRjtcblx0XHR0aGlzLmxpZ2h0LmRpcmVjdGlvbiA9IG5ldyBWZWN0b3IzRCgxLCAxLCAwKTtcblx0XHR0aGlzLmxpZ2h0LmFtYmllbnQgPSAwO1xuXHRcdHRoaXMubGlnaHQuYW1iaWVudENvbG9yID0gMHhGRkZGRkY7XG5cdFx0dGhpcy5saWdodC5kaWZmdXNlID0gMTtcblx0XHR0aGlzLmxpZ2h0LnNwZWN1bGFyID0gMTtcblxuXHRcdHRoaXMubGlnaHRCID0gbmV3IERpcmVjdGlvbmFsTGlnaHQoKTtcblx0XHR0aGlzLmxpZ2h0Qi5jb2xvcj0gMHhGRjAwMDA7XG5cdFx0dGhpcy5saWdodEIuZGlyZWN0aW9uID0gbmV3IFZlY3RvcjNEKC0xLCAwLCAxKTtcblx0XHR0aGlzLmxpZ2h0Qi5hbWJpZW50ID0gMDtcblx0XHR0aGlzLmxpZ2h0Qi5hbWJpZW50Q29sb3IgPSAweEZGRkZGRjtcblx0XHR0aGlzLmxpZ2h0Qi5kaWZmdXNlID0gMTtcblx0XHR0aGlzLmxpZ2h0Qi5zcGVjdWxhciA9IDE7XG5cblx0XHR0aGlzLnZpZXcuc2NlbmUuYWRkQ2hpbGQodGhpcy5saWdodCk7XG5cdFx0dGhpcy52aWV3LnNjZW5lLmFkZENoaWxkKHRoaXMubGlnaHRCKTtcblxuXHRcdHRoaXMudmlldy5iYWNrZ3JvdW5kQ29sb3IgPSAweDIyMjIyMjtcblxuXHRcdEFzc2V0TGlicmFyeS5lbmFibGVQYXJzZXIoT0JKUGFyc2VyKTtcblxuXHRcdHZhciBzZXNzaW9uOkxvYWRlcjtcblxuXHRcdHNlc3Npb24gPSBBc3NldExpYnJhcnkuZ2V0TG9hZGVyKCk7XG5cdFx0c2Vzc2lvbi5hZGRFdmVudExpc3RlbmVyKExvYWRlckV2ZW50LkxPQURfQ09NUExFVEUsIChldmVudDpMb2FkZXJFdmVudCkgPT4gdGhpcy5vbkxvYWRDb21wbGV0ZShldmVudCkpO1xuXHRcdHNlc3Npb24ubG9hZChuZXcgVVJMUmVxdWVzdCgnYXNzZXRzL3BsYXRvbmljLm9iaicpKTtcblxuXHRcdHNlc3Npb24gPSBBc3NldExpYnJhcnkuZ2V0TG9hZGVyKCk7XG5cdFx0c2Vzc2lvbi5hZGRFdmVudExpc3RlbmVyKExvYWRlckV2ZW50LkxPQURfQ09NUExFVEUsIChldmVudDpMb2FkZXJFdmVudCkgPT4gdGhpcy5vbkxvYWRDb21wbGV0ZShldmVudCkpO1xuXHRcdHNlc3Npb24ubG9hZChuZXcgVVJMUmVxdWVzdCgnYXNzZXRzL2RvdHMucG5nJykpO1xuXG5cdFx0d2luZG93Lm9ucmVzaXplID0gKGV2ZW50OlVJRXZlbnQpID0+IHRoaXMub25SZXNpemUoZXZlbnQpO1xuXHRcdGRvY3VtZW50Lm9ubW91c2Vkb3duID0gKGV2ZW50Ok1vdXNlRXZlbnQpID0+IHRoaXMub25Nb3VzZURvd24oZXZlbnQpO1xuXHR9XG5cblx0cHJpdmF0ZSBvbk1vdXNlRG93bihldmVudDpNb3VzZUV2ZW50KVxuXHR7XG5cdFx0dGhpcy5jdWJlQ29sb3JNYXRlcmlhbC5hbHBoYSA9IHRoaXMudG9ydXNUZXh0dXJlTWF0ZXJpYWwuYWxwaGEgPSB0aGlzLmxvYWRlZFNwcml0ZU1hdGVyaWFsLmFscGhhID0gdGhpcy5hVmFsdWVzW3RoaXMuYVZhbHVlc1BdO1xuXG5cdFx0YWxlcnQoICdBbHBoYTogJyArIHRoaXMuYVZhbHVlc1t0aGlzLmFWYWx1ZXNQXSk7XG5cblx0XHR0aGlzLmFWYWx1ZXNQKys7XG5cblx0XHRpZiAodGhpcy5hVmFsdWVzUCA+IHRoaXMuYVZhbHVlcy5sZW5ndGggLTEpXG5cdFx0XHR0aGlzLmFWYWx1ZXNQICA9IDA7XG5cdH1cblxuXHRwcml2YXRlIHJlbmRlcihkdDpudW1iZXIpXG5cdHtcblx0XHRpZiAodGhpcy5zcHJpdGVzKVxuXHRcdFx0Zm9yICh2YXIgYzpudW1iZXIgPSAwOyBjIDwgdGhpcy5zcHJpdGVzLmxlbmd0aDsgYysrKVxuXHRcdFx0XHR0aGlzLnNwcml0ZXNbY10ucm90YXRpb25ZICs9IC4zNTtcblxuXHRcdHRoaXMudmlldy5yZW5kZXIoKTtcblx0fVxuXG5cdHB1YmxpYyBvbkxvYWRDb21wbGV0ZShldmVudDpMb2FkZXJFdmVudClcblx0e1xuXHRcdHZhciBsb2FkZXI6TG9hZGVyID0gZXZlbnQudGFyZ2V0O1xuXHRcdHZhciBsOm51bWJlciA9IGxvYWRlci5iYXNlRGVwZW5kZW5jeS5hc3NldHMubGVuZ3RoXG5cblx0XHRmb3IgKHZhciBjOm51bWJlciA9IDA7IGMgPCBsOyBjICsrKSB7XG5cblx0XHRcdHZhciBkOklBc3NldCA9IGxvYWRlci5iYXNlRGVwZW5kZW5jeS5hc3NldHNbY107XG5cblx0XHRcdGNvbnNvbGUubG9nKCBkLm5hbWUpO1xuXG5cdFx0XHRzd2l0Y2ggKGQuYXNzZXRUeXBlKSB7XG5cdFx0XHRcdGNhc2UgU3ByaXRlLmFzc2V0VHlwZTpcblx0XHRcdFx0XHR2YXIgc3ByaXRlOlNwcml0ZSA9IDxTcHJpdGU+IGQ7XG5cblx0XHRcdFx0XHR0aGlzLmxvYWRlZFNwcml0ZSA9IHNwcml0ZTtcblxuXHRcdFx0XHRcdGlmIChkLm5hbWUgPT0gJ1Nwcml0ZV9nMCcpIHtcblx0XHRcdFx0XHRcdHRoaXMubG9hZGVkU3ByaXRlID0gc3ByaXRlO1xuXHRcdFx0XHRcdFx0c3ByaXRlLnkgPSAtNDAwO1xuXHRcdFx0XHRcdFx0c3ByaXRlLnRyYW5zZm9ybS5zY2FsZVRvKDUsIDUsIDUpO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRzcHJpdGUudHJhbnNmb3JtLnNjYWxlVG8oMy41LCAzLjUsIDMuNSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHRoaXMubG9hZGVkU3ByaXRlTWF0ZXJpYWwpXG5cdFx0XHRcdFx0XHRzcHJpdGUubWF0ZXJpYWwgPSB0aGlzLmxvYWRlZFNwcml0ZU1hdGVyaWFsO1xuXG5cdFx0XHRcdFx0dGhpcy52aWV3LnNjZW5lLmFkZENoaWxkKHNwcml0ZSk7XG5cdFx0XHRcdFx0dGhpcy5zcHJpdGVzLnB1c2goc3ByaXRlKTtcblxuXHRcdFx0XHRcdHRoaXMucmFmLnN0YXJ0KCk7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdGNhc2UgQml0bWFwSW1hZ2UyRC5hc3NldFR5cGU6XG5cdFx0XHRcdFx0Ly8gTGlnaHQgUGlja2VyXG5cdFx0XHRcdFx0dGhpcy5zdGF0aWNMaWdodFBpY2tlciA9IG5ldyBTdGF0aWNMaWdodFBpY2tlciggW3RoaXMubGlnaHQgLCB0aGlzLmxpZ2h0QiBdICk7XG5cblx0XHRcdFx0XHQvLyBNYXRlcmlhbCBmb3IgbG9hZGVkIHNwcml0ZVxuXHRcdFx0XHRcdHRoaXMubG9hZGVkU3ByaXRlTWF0ZXJpYWwgPSBuZXcgTWV0aG9kTWF0ZXJpYWwoPEJpdG1hcEltYWdlMkQ+IGQpO1xuXHRcdFx0XHRcdHRoaXMubG9hZGVkU3ByaXRlTWF0ZXJpYWwuc3R5bGUuc2FtcGxlciA9IG5ldyBTYW1wbGVyMkQodHJ1ZSwgdHJ1ZSwgZmFsc2UpO1xuXHRcdFx0XHRcdHRoaXMubG9hZGVkU3ByaXRlTWF0ZXJpYWwubGlnaHRQaWNrZXIgPSB0aGlzLnN0YXRpY0xpZ2h0UGlja2VyO1xuXHRcdFx0XHRcdHRoaXMubG9hZGVkU3ByaXRlTWF0ZXJpYWwuYWxwaGEgPSAxO1xuXHRcdFx0XHRcdHRoaXMubG9hZGVkU3ByaXRlTWF0ZXJpYWwuYm90aFNpZGVzID0gdHJ1ZTtcblxuXHRcdFx0XHRcdGlmICh0aGlzLmxvYWRlZFNwcml0ZSlcblx0XHRcdFx0XHRcdHRoaXMubG9hZGVkU3ByaXRlLm1hdGVyaWFsID0gdGhpcy5sb2FkZWRTcHJpdGVNYXRlcmlhbDtcblxuXHRcdFx0XHRcdC8vIFRvcnVzIFRleHR1cmUgTWF0ZXJpYWxcblx0XHRcdFx0XHR0aGlzLnRvcnVzVGV4dHVyZU1hdGVyaWFsID0gbmV3IE1ldGhvZE1hdGVyaWFsKDxCaXRtYXBJbWFnZTJEPiBkKTtcblx0XHRcdFx0XHR0aGlzLnRvcnVzVGV4dHVyZU1hdGVyaWFsLnN0eWxlLnNhbXBsZXIgPSBuZXcgU2FtcGxlcjJEKHRydWUsIHRydWUsIGZhbHNlKTtcblx0XHRcdFx0XHR0aGlzLnRvcnVzVGV4dHVyZU1hdGVyaWFsLmxpZ2h0UGlja2VyID0gdGhpcy5zdGF0aWNMaWdodFBpY2tlciA7XG5cdFx0XHRcdFx0dGhpcy50b3J1c1RleHR1cmVNYXRlcmlhbC5ib3RoU2lkZXMgPSB0cnVlO1xuXHRcdFx0XHRcdHRoaXMudG9ydXNUZXh0dXJlTWF0ZXJpYWwuYWxwaGEgPSAuODtcblxuXHRcdFx0XHRcdC8vIFRvcnVzXG5cdFx0XHRcdFx0dmFyIHRvcnVzOlByaW1pdGl2ZVRvcnVzUHJlZmFiID0gbmV3IFByaW1pdGl2ZVRvcnVzUHJlZmFiKHRoaXMudG9ydXNUZXh0dXJlTWF0ZXJpYWwsIEVsZW1lbnRzVHlwZS5UUklBTkdMRSwgMTUwICwgNTAgLCA2NCAsIDY0KTtcblxuXHRcdFx0XHRcdC8vIFRvcnVzIFNwcml0ZSAoIGxlZnQgKVxuXHRcdFx0XHRcdHZhciB0b3J1c1Nwcml0ZTpTcHJpdGUgPSA8U3ByaXRlPiB0b3J1cy5nZXROZXdPYmplY3QoKTtcblx0XHRcdFx0XHR0b3J1c1Nwcml0ZS5yb3RhdGlvblggPSA5MDtcblx0XHRcdFx0XHR0b3J1c1Nwcml0ZS54ID0gNjAwO1xuXHRcdFx0XHRcdHRoaXMuc3ByaXRlcy5wdXNoKHRvcnVzU3ByaXRlKTtcblx0XHRcdFx0XHR0aGlzLnZpZXcuc2NlbmUuYWRkQ2hpbGQodG9ydXNTcHJpdGUpO1xuXG5cdFx0XHRcdFx0Ly8gVG9ydXMgQ29sb3IgTWF0ZXJpYWxcblx0XHRcdFx0XHR0aGlzLmN1YmVDb2xvck1hdGVyaWFsID0gbmV3IE1ldGhvZE1hdGVyaWFsKDB4MDA5MGZmKTtcblx0XHRcdFx0XHR0aGlzLmN1YmVDb2xvck1hdGVyaWFsLmxpZ2h0UGlja2VyID0gdGhpcy5zdGF0aWNMaWdodFBpY2tlciA7XG5cdFx0XHRcdFx0dGhpcy5jdWJlQ29sb3JNYXRlcmlhbC5hbHBoYSA9IC44O1xuXHRcdFx0XHRcdHRoaXMuY3ViZUNvbG9yTWF0ZXJpYWwuYm90aFNpZGVzID0gdHJ1ZTtcblxuXHRcdFx0XHRcdHZhciBjdWJlOlByaW1pdGl2ZUN1YmVQcmVmYWIgPSBuZXcgUHJpbWl0aXZlQ3ViZVByZWZhYih0aGlzLmN1YmVDb2xvck1hdGVyaWFsLCBFbGVtZW50c1R5cGUuVFJJQU5HTEUsIDMwMCwgMzAwLCAzMDAsIDIwLCAyMCwgMjApO1xuXG5cdFx0XHRcdFx0Ly8gVG9ydXMgU3ByaXRlICggcmlnaHQgKVxuXHRcdFx0XHRcdHZhciBjdWJlU3ByaXRlOlNwcml0ZSA9IDxTcHJpdGU+IGN1YmUuZ2V0TmV3T2JqZWN0KCk7XG5cdFx0XHRcdFx0Y3ViZVNwcml0ZS5yb3RhdGlvblggPSA5MDtcblx0XHRcdFx0XHRjdWJlU3ByaXRlLnggPSAtNjAwO1xuXHRcdFx0XHRcdHRoaXMuc3ByaXRlcy5wdXNoKGN1YmVTcHJpdGUpO1xuXHRcdFx0XHRcdHRoaXMudmlldy5zY2VuZS5hZGRDaGlsZChjdWJlU3ByaXRlKTtcblxuXHRcdFx0XHRcdHRoaXMuY2Fwc3VsZUNvbG9yTWF0ZXJpYWwgPSBuZXcgTWV0aG9kTWF0ZXJpYWwoMHgwMGZmZmYpO1xuXHRcdFx0XHRcdHRoaXMuY2Fwc3VsZUNvbG9yTWF0ZXJpYWwubGlnaHRQaWNrZXIgPSB0aGlzLnN0YXRpY0xpZ2h0UGlja2VyO1xuXG5cdFx0XHRcdFx0dmFyIGNhcHN1bGU6UHJpbWl0aXZlQ2Fwc3VsZVByZWZhYiA9IG5ldyBQcmltaXRpdmVDYXBzdWxlUHJlZmFiKHRoaXMuY2Fwc3VsZUNvbG9yTWF0ZXJpYWwsIEVsZW1lbnRzVHlwZS5UUklBTkdMRSwgMTAwLCAyMDApO1xuXG5cdFx0XHRcdFx0Ly8gVG9ydXMgU3ByaXRlICggcmlnaHQgKVxuXHRcdFx0XHRcdHZhciBjYXBzdWxlU3ByaXRlOlNwcml0ZSA9IDxTcHJpdGU+IGNhcHN1bGUuZ2V0TmV3T2JqZWN0KCk7XG5cdFx0XHRcdFx0dGhpcy5zcHJpdGVzLnB1c2goY2Fwc3VsZVNwcml0ZSk7XG5cdFx0XHRcdFx0dGhpcy52aWV3LnNjZW5lLmFkZENoaWxkKGNhcHN1bGVTcHJpdGUpO1xuXG5cdFx0XHRcdFx0dGhpcy5jdWJlQ29sb3JNYXRlcmlhbC5hbHBoYSA9IHRoaXMudG9ydXNUZXh0dXJlTWF0ZXJpYWwuYWxwaGEgPSB0aGlzLmxvYWRlZFNwcml0ZU1hdGVyaWFsLmFscGhhID0gMTtcblxuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdHB1YmxpYyBvblJlc2l6ZShldmVudDpVSUV2ZW50ID0gbnVsbClcblx0e1xuXHRcdHRoaXMudmlldy55ID0gMDtcblx0XHR0aGlzLnZpZXcueCA9IDA7XG5cblx0XHR0aGlzLnZpZXcud2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDtcblx0XHR0aGlzLnZpZXcuaGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0O1xuXHR9XG59Il19