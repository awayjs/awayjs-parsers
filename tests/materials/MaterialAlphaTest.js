"use strict";
var BitmapImage2D_1 = require("awayjs-core/lib/image/BitmapImage2D");
var Sampler2D_1 = require("awayjs-core/lib/image/Sampler2D");
var LoaderEvent_1 = require("awayjs-core/lib/events/LoaderEvent");
var Vector3D_1 = require("awayjs-core/lib/geom/Vector3D");
var AssetLibrary_1 = require("awayjs-core/lib/library/AssetLibrary");
var URLRequest_1 = require("awayjs-core/lib/net/URLRequest");
var Debug_1 = require("awayjs-core/lib/utils/Debug");
var RequestAnimationFrame_1 = require("awayjs-core/lib/utils/RequestAnimationFrame");
var View_1 = require("awayjs-display/lib/View");
var DirectionalLight_1 = require("awayjs-display/lib/display/DirectionalLight");
var Sprite_1 = require("awayjs-display/lib/display/Sprite");
var ElementsType_1 = require("awayjs-display/lib/graphics/ElementsType");
var StaticLightPicker_1 = require("awayjs-display/lib/materials/lightpickers/StaticLightPicker");
var PrimitiveTorusPrefab_1 = require("awayjs-display/lib/prefabs/PrimitiveTorusPrefab");
var PrimitiveCubePrefab_1 = require("awayjs-display/lib/prefabs/PrimitiveCubePrefab");
var PrimitiveCapsulePrefab_1 = require("awayjs-display/lib/prefabs/PrimitiveCapsulePrefab");
var DefaultRenderer_1 = require("awayjs-renderergl/lib/DefaultRenderer");
var MethodMaterial_1 = require("awayjs-methodmaterials/lib/MethodMaterial");
var OBJParser_1 = require("awayjs-parsers/lib/OBJParser");
var MaterialAlphaTest = (function () {
    function MaterialAlphaTest() {
        var _this = this;
        this.sprites = new Array();
        this.aValues = Array(0, .1, .5, .8, .9, .99, 1);
        this.aValuesP = 0;
        Debug_1.default.LOG_PI_ERRORS = false;
        Debug_1.default.THROW_ERRORS = false;
        this.view = new View_1.default(new DefaultRenderer_1.default());
        this.raf = new RequestAnimationFrame_1.default(this.render, this);
        this.onResize();
        this.light = new DirectionalLight_1.default();
        this.light.color = 0xFFFFFF;
        this.light.direction = new Vector3D_1.default(1, 1, 0);
        this.light.ambient = 0;
        this.light.ambientColor = 0xFFFFFF;
        this.light.diffuse = 1;
        this.light.specular = 1;
        this.lightB = new DirectionalLight_1.default();
        this.lightB.color = 0xFF0000;
        this.lightB.direction = new Vector3D_1.default(-1, 0, 1);
        this.lightB.ambient = 0;
        this.lightB.ambientColor = 0xFFFFFF;
        this.lightB.diffuse = 1;
        this.lightB.specular = 1;
        this.view.scene.addChild(this.light);
        this.view.scene.addChild(this.lightB);
        this.view.backgroundColor = 0x222222;
        AssetLibrary_1.default.enableParser(OBJParser_1.default);
        var session;
        session = AssetLibrary_1.default.getLoader();
        session.addEventListener(LoaderEvent_1.default.LOAD_COMPLETE, function (event) { return _this.onLoadComplete(event); });
        session.load(new URLRequest_1.default('assets/platonic.obj'));
        session = AssetLibrary_1.default.getLoader();
        session.addEventListener(LoaderEvent_1.default.LOAD_COMPLETE, function (event) { return _this.onLoadComplete(event); });
        session.load(new URLRequest_1.default('assets/dots.png'));
        window.onresize = function (event) { return _this.onResize(event); };
        document.onmousedown = function (event) { return _this.onMouseDown(event); };
    }
    MaterialAlphaTest.prototype.onMouseDown = function (event) {
        this.cubeColorMaterial.alpha = this.torusTextureMaterial.alpha = this.loadedSpriteMaterial.alpha = this.aValues[this.aValuesP];
        alert('Alpha: ' + this.aValues[this.aValuesP]);
        this.aValuesP++;
        if (this.aValuesP > this.aValues.length - 1)
            this.aValuesP = 0;
    };
    MaterialAlphaTest.prototype.render = function (dt) {
        if (this.sprites)
            for (var c = 0; c < this.sprites.length; c++)
                this.sprites[c].rotationY += .35;
        this.view.render();
    };
    MaterialAlphaTest.prototype.onLoadComplete = function (event) {
        var loader = event.target;
        var l = loader.baseDependency.assets.length;
        for (var c = 0; c < l; c++) {
            var d = loader.baseDependency.assets[c];
            console.log(d.name);
            switch (d.assetType) {
                case Sprite_1.default.assetType:
                    var sprite = d;
                    this.loadedSprite = sprite;
                    if (d.name == 'Sprite_g0') {
                        this.loadedSprite = sprite;
                        sprite.y = -400;
                        sprite.transform.scaleTo(5, 5, 5);
                    }
                    else {
                        sprite.transform.scaleTo(3.5, 3.5, 3.5);
                    }
                    if (this.loadedSpriteMaterial)
                        sprite.material = this.loadedSpriteMaterial;
                    this.view.scene.addChild(sprite);
                    this.sprites.push(sprite);
                    this.raf.start();
                    break;
                case BitmapImage2D_1.default.assetType:
                    // Light Picker
                    this.staticLightPicker = new StaticLightPicker_1.default([this.light, this.lightB]);
                    // Material for loaded sprite
                    this.loadedSpriteMaterial = new MethodMaterial_1.default(d);
                    this.loadedSpriteMaterial.style.sampler = new Sampler2D_1.default(true, true, false);
                    this.loadedSpriteMaterial.lightPicker = this.staticLightPicker;
                    this.loadedSpriteMaterial.alpha = 1;
                    this.loadedSpriteMaterial.bothSides = true;
                    if (this.loadedSprite)
                        this.loadedSprite.material = this.loadedSpriteMaterial;
                    // Torus Texture Material
                    this.torusTextureMaterial = new MethodMaterial_1.default(d);
                    this.torusTextureMaterial.style.sampler = new Sampler2D_1.default(true, true, false);
                    this.torusTextureMaterial.lightPicker = this.staticLightPicker;
                    this.torusTextureMaterial.bothSides = true;
                    this.torusTextureMaterial.alpha = .8;
                    // Torus
                    var torus = new PrimitiveTorusPrefab_1.default(this.torusTextureMaterial, ElementsType_1.default.TRIANGLE, 150, 50, 64, 64);
                    // Torus Sprite ( left )
                    var torusSprite = torus.getNewObject();
                    torusSprite.rotationX = 90;
                    torusSprite.x = 600;
                    this.sprites.push(torusSprite);
                    this.view.scene.addChild(torusSprite);
                    // Torus Color Material
                    this.cubeColorMaterial = new MethodMaterial_1.default(0x0090ff);
                    this.cubeColorMaterial.lightPicker = this.staticLightPicker;
                    this.cubeColorMaterial.alpha = .8;
                    this.cubeColorMaterial.bothSides = true;
                    var cube = new PrimitiveCubePrefab_1.default(this.cubeColorMaterial, ElementsType_1.default.TRIANGLE, 300, 300, 300, 20, 20, 20);
                    // Torus Sprite ( right )
                    var cubeSprite = cube.getNewObject();
                    cubeSprite.rotationX = 90;
                    cubeSprite.x = -600;
                    this.sprites.push(cubeSprite);
                    this.view.scene.addChild(cubeSprite);
                    this.capsuleColorMaterial = new MethodMaterial_1.default(0x00ffff);
                    this.capsuleColorMaterial.lightPicker = this.staticLightPicker;
                    var capsule = new PrimitiveCapsulePrefab_1.default(this.capsuleColorMaterial, ElementsType_1.default.TRIANGLE, 100, 200);
                    // Torus Sprite ( right )
                    var capsuleSprite = capsule.getNewObject();
                    this.sprites.push(capsuleSprite);
                    this.view.scene.addChild(capsuleSprite);
                    this.cubeColorMaterial.alpha = this.torusTextureMaterial.alpha = this.loadedSpriteMaterial.alpha = 1;
                    break;
            }
        }
    };
    MaterialAlphaTest.prototype.onResize = function (event) {
        if (event === void 0) { event = null; }
        this.view.y = 0;
        this.view.x = 0;
        this.view.width = window.innerWidth;
        this.view.height = window.innerHeight;
    };
    return MaterialAlphaTest;
}());

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1hdGVyaWFscy9NYXRlcmlhbEFscGhhVGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsOEJBQTZCLHFDQUFxQyxDQUFDLENBQUE7QUFDbkUsMEJBQTBCLGlDQUFpQyxDQUFDLENBQUE7QUFDNUQsNEJBQTRCLG9DQUFvQyxDQUFDLENBQUE7QUFDakUseUJBQTBCLCtCQUErQixDQUFDLENBQUE7QUFDMUQsNkJBQTZCLHNDQUFzQyxDQUFDLENBQUE7QUFHcEUsMkJBQTJCLGdDQUFnQyxDQUFDLENBQUE7QUFDNUQsc0JBQXVCLDZCQUE2QixDQUFDLENBQUE7QUFDckQsc0NBQW1DLDZDQUE2QyxDQUFDLENBQUE7QUFFakYscUJBQXVCLHlCQUF5QixDQUFDLENBQUE7QUFDakQsaUNBQWdDLDZDQUE2QyxDQUFDLENBQUE7QUFDOUUsdUJBQXdCLG1DQUFtQyxDQUFDLENBQUE7QUFDNUQsNkJBQTZCLDBDQUEwQyxDQUFDLENBQUE7QUFDeEUsa0NBQWdDLDZEQUE2RCxDQUFDLENBQUE7QUFDOUYscUNBQW1DLGlEQUFpRCxDQUFDLENBQUE7QUFDckYsb0NBQWtDLGdEQUFnRCxDQUFDLENBQUE7QUFDbkYsdUNBQW9DLG1EQUFtRCxDQUFDLENBQUE7QUFFeEYsZ0NBQStCLHVDQUF1QyxDQUFDLENBQUE7QUFFdkUsK0JBQThCLDJDQUEyQyxDQUFDLENBQUE7QUFFMUUsMEJBQTBCLDhCQUE4QixDQUFDLENBQUE7QUFFekQ7SUFrQkM7UUFsQkQsaUJBNkxDO1FBekxRLFlBQU8sR0FBb0IsSUFBSSxLQUFLLEVBQVUsQ0FBQztRQU0vQyxZQUFPLEdBQWlCLEtBQUssQ0FBUyxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUNqRSxhQUFRLEdBQVUsQ0FBQyxDQUFDO1FBUzNCLGVBQUssQ0FBQyxhQUFhLEdBQUcsS0FBSyxDQUFDO1FBQzVCLGVBQUssQ0FBQyxZQUFZLEdBQUcsS0FBSyxDQUFDO1FBRTNCLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxjQUFJLENBQUMsSUFBSSx5QkFBZSxFQUFFLENBQUMsQ0FBQztRQUM1QyxJQUFJLENBQUMsR0FBRyxHQUFHLElBQUksK0JBQXFCLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsQ0FBQztRQUN4RCxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7UUFFaEIsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLDBCQUFnQixFQUFFLENBQUM7UUFDcEMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLEdBQUcsUUFBUSxDQUFDO1FBQzVCLElBQUksQ0FBQyxLQUFLLENBQUMsU0FBUyxHQUFHLElBQUksa0JBQVEsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQzdDLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxHQUFHLENBQUMsQ0FBQztRQUN2QixJQUFJLENBQUMsS0FBSyxDQUFDLFlBQVksR0FBRyxRQUFRLENBQUM7UUFDbkMsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLEdBQUcsQ0FBQyxDQUFDO1FBQ3ZCLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxHQUFHLENBQUMsQ0FBQztRQUV4QixJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksMEJBQWdCLEVBQUUsQ0FBQztRQUNyQyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssR0FBRSxRQUFRLENBQUM7UUFDNUIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxTQUFTLEdBQUcsSUFBSSxrQkFBUSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUMvQyxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sR0FBRyxDQUFDLENBQUM7UUFDeEIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxZQUFZLEdBQUcsUUFBUSxDQUFDO1FBQ3BDLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxHQUFHLENBQUMsQ0FBQztRQUN4QixJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsR0FBRyxDQUFDLENBQUM7UUFFekIsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNyQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBRXRDLElBQUksQ0FBQyxJQUFJLENBQUMsZUFBZSxHQUFHLFFBQVEsQ0FBQztRQUVyQyxzQkFBWSxDQUFDLFlBQVksQ0FBQyxtQkFBUyxDQUFDLENBQUM7UUFFckMsSUFBSSxPQUFjLENBQUM7UUFFbkIsT0FBTyxHQUFHLHNCQUFZLENBQUMsU0FBUyxFQUFFLENBQUM7UUFDbkMsT0FBTyxDQUFDLGdCQUFnQixDQUFDLHFCQUFXLENBQUMsYUFBYSxFQUFFLFVBQUMsS0FBaUIsSUFBSyxPQUFBLEtBQUksQ0FBQyxjQUFjLENBQUMsS0FBSyxDQUFDLEVBQTFCLENBQTBCLENBQUMsQ0FBQztRQUN2RyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksb0JBQVUsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLENBQUM7UUFFcEQsT0FBTyxHQUFHLHNCQUFZLENBQUMsU0FBUyxFQUFFLENBQUM7UUFDbkMsT0FBTyxDQUFDLGdCQUFnQixDQUFDLHFCQUFXLENBQUMsYUFBYSxFQUFFLFVBQUMsS0FBaUIsSUFBSyxPQUFBLEtBQUksQ0FBQyxjQUFjLENBQUMsS0FBSyxDQUFDLEVBQTFCLENBQTBCLENBQUMsQ0FBQztRQUN2RyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksb0JBQVUsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLENBQUM7UUFFaEQsTUFBTSxDQUFDLFFBQVEsR0FBRyxVQUFDLEtBQWEsSUFBSyxPQUFBLEtBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLEVBQXBCLENBQW9CLENBQUM7UUFDMUQsUUFBUSxDQUFDLFdBQVcsR0FBRyxVQUFDLEtBQWdCLElBQUssT0FBQSxLQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxFQUF2QixDQUF1QixDQUFDO0lBQ3RFLENBQUM7SUFFTyx1Q0FBVyxHQUFuQixVQUFvQixLQUFnQjtRQUVuQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLG9CQUFvQixDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUUvSCxLQUFLLENBQUUsU0FBUyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7UUFFaEQsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBRWhCLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEdBQUUsQ0FBQyxDQUFDO1lBQzFDLElBQUksQ0FBQyxRQUFRLEdBQUksQ0FBQyxDQUFDO0lBQ3JCLENBQUM7SUFFTyxrQ0FBTSxHQUFkLFVBQWUsRUFBUztRQUV2QixFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDO1lBQ2hCLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFVLENBQUMsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFO2dCQUNsRCxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsSUFBSSxHQUFHLENBQUM7UUFFbkMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztJQUNwQixDQUFDO0lBRU0sMENBQWMsR0FBckIsVUFBc0IsS0FBaUI7UUFFdEMsSUFBSSxNQUFNLEdBQVUsS0FBSyxDQUFDLE1BQU0sQ0FBQztRQUNqQyxJQUFJLENBQUMsR0FBVSxNQUFNLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUE7UUFFbEQsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQVUsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxFQUFHLEVBQUUsQ0FBQztZQUVwQyxJQUFJLENBQUMsR0FBVSxNQUFNLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUUvQyxPQUFPLENBQUMsR0FBRyxDQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUVyQixNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztnQkFDckIsS0FBSyxnQkFBTSxDQUFDLFNBQVM7b0JBQ3BCLElBQUksTUFBTSxHQUFtQixDQUFDLENBQUM7b0JBRS9CLElBQUksQ0FBQyxZQUFZLEdBQUcsTUFBTSxDQUFDO29CQUUzQixFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxJQUFJLFdBQVcsQ0FBQyxDQUFDLENBQUM7d0JBQzNCLElBQUksQ0FBQyxZQUFZLEdBQUcsTUFBTSxDQUFDO3dCQUMzQixNQUFNLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDO3dCQUNoQixNQUFNLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO29CQUNuQyxDQUFDO29CQUFDLElBQUksQ0FBQyxDQUFDO3dCQUNQLE1BQU0sQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUM7b0JBQ3pDLENBQUM7b0JBRUQsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLG9CQUFvQixDQUFDO3dCQUM3QixNQUFNLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxvQkFBb0IsQ0FBQztvQkFFN0MsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDO29CQUNqQyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztvQkFFMUIsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUUsQ0FBQztvQkFDakIsS0FBSyxDQUFDO2dCQUNQLEtBQUssdUJBQWEsQ0FBQyxTQUFTO29CQUMzQixlQUFlO29CQUNmLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxJQUFJLDJCQUFpQixDQUFFLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRyxJQUFJLENBQUMsTUFBTSxDQUFFLENBQUUsQ0FBQztvQkFFOUUsNkJBQTZCO29CQUM3QixJQUFJLENBQUMsb0JBQW9CLEdBQUcsSUFBSSx3QkFBYyxDQUFpQixDQUFDLENBQUMsQ0FBQztvQkFDbEUsSUFBSSxDQUFDLG9CQUFvQixDQUFDLEtBQUssQ0FBQyxPQUFPLEdBQUcsSUFBSSxtQkFBUyxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsS0FBSyxDQUFDLENBQUM7b0JBQzNFLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixDQUFDO29CQUMvRCxJQUFJLENBQUMsb0JBQW9CLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQztvQkFDcEMsSUFBSSxDQUFDLG9CQUFvQixDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUM7b0JBRTNDLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUM7d0JBQ3JCLElBQUksQ0FBQyxZQUFZLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxvQkFBb0IsQ0FBQztvQkFFeEQseUJBQXlCO29CQUN6QixJQUFJLENBQUMsb0JBQW9CLEdBQUcsSUFBSSx3QkFBYyxDQUFpQixDQUFDLENBQUMsQ0FBQztvQkFDbEUsSUFBSSxDQUFDLG9CQUFvQixDQUFDLEtBQUssQ0FBQyxPQUFPLEdBQUcsSUFBSSxtQkFBUyxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsS0FBSyxDQUFDLENBQUM7b0JBQzNFLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixDQUFFO29CQUNoRSxJQUFJLENBQUMsb0JBQW9CLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQztvQkFDM0MsSUFBSSxDQUFDLG9CQUFvQixDQUFDLEtBQUssR0FBRyxFQUFFLENBQUM7b0JBRXJDLFFBQVE7b0JBQ1IsSUFBSSxLQUFLLEdBQXdCLElBQUksOEJBQW9CLENBQUMsSUFBSSxDQUFDLG9CQUFvQixFQUFFLHNCQUFZLENBQUMsUUFBUSxFQUFFLEdBQUcsRUFBRyxFQUFFLEVBQUcsRUFBRSxFQUFHLEVBQUUsQ0FBQyxDQUFDO29CQUVoSSx3QkFBd0I7b0JBQ3hCLElBQUksV0FBVyxHQUFtQixLQUFLLENBQUMsWUFBWSxFQUFFLENBQUM7b0JBQ3ZELFdBQVcsQ0FBQyxTQUFTLEdBQUcsRUFBRSxDQUFDO29CQUMzQixXQUFXLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQztvQkFDcEIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7b0JBQy9CLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsQ0FBQztvQkFFdEMsdUJBQXVCO29CQUN2QixJQUFJLENBQUMsaUJBQWlCLEdBQUcsSUFBSSx3QkFBYyxDQUFDLFFBQVEsQ0FBQyxDQUFDO29CQUN0RCxJQUFJLENBQUMsaUJBQWlCLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxpQkFBaUIsQ0FBRTtvQkFDN0QsSUFBSSxDQUFDLGlCQUFpQixDQUFDLEtBQUssR0FBRyxFQUFFLENBQUM7b0JBQ2xDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDO29CQUV4QyxJQUFJLElBQUksR0FBdUIsSUFBSSw2QkFBbUIsQ0FBQyxJQUFJLENBQUMsaUJBQWlCLEVBQUUsc0JBQVksQ0FBQyxRQUFRLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQztvQkFFakkseUJBQXlCO29CQUN6QixJQUFJLFVBQVUsR0FBbUIsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO29CQUNyRCxVQUFVLENBQUMsU0FBUyxHQUFHLEVBQUUsQ0FBQztvQkFDMUIsVUFBVSxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQztvQkFDcEIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7b0JBQzlCLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsQ0FBQztvQkFFckMsSUFBSSxDQUFDLG9CQUFvQixHQUFHLElBQUksd0JBQWMsQ0FBQyxRQUFRLENBQUMsQ0FBQztvQkFDekQsSUFBSSxDQUFDLG9CQUFvQixDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsaUJBQWlCLENBQUM7b0JBRS9ELElBQUksT0FBTyxHQUEwQixJQUFJLGdDQUFzQixDQUFDLElBQUksQ0FBQyxvQkFBb0IsRUFBRSxzQkFBWSxDQUFDLFFBQVEsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUM7b0JBRTVILHlCQUF5QjtvQkFDekIsSUFBSSxhQUFhLEdBQW1CLE9BQU8sQ0FBQyxZQUFZLEVBQUUsQ0FBQztvQkFDM0QsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUM7b0JBQ2pDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxhQUFhLENBQUMsQ0FBQztvQkFFeEMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsb0JBQW9CLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDO29CQUVyRyxLQUFLLENBQUM7WUFDUixDQUFDO1FBQ0YsQ0FBQztJQUNGLENBQUM7SUFFTSxvQ0FBUSxHQUFmLFVBQWdCLEtBQW9CO1FBQXBCLHFCQUFvQixHQUFwQixZQUFvQjtRQUVuQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDaEIsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBRWhCLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxHQUFHLE1BQU0sQ0FBQyxVQUFVLENBQUM7UUFDcEMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDLFdBQVcsQ0FBQztJQUN2QyxDQUFDO0lBQ0Ysd0JBQUM7QUFBRCxDQTdMQSxBQTZMQyxJQUFBIiwiZmlsZSI6Im1hdGVyaWFscy9NYXRlcmlhbEFscGhhVGVzdC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBCaXRtYXBJbWFnZTJEXHRcdFx0XHRmcm9tIFwiYXdheWpzLWNvcmUvbGliL2ltYWdlL0JpdG1hcEltYWdlMkRcIjtcbmltcG9ydCBTYW1wbGVyMkRcdFx0XHRcdFx0ZnJvbSBcImF3YXlqcy1jb3JlL2xpYi9pbWFnZS9TYW1wbGVyMkRcIjtcbmltcG9ydCBMb2FkZXJFdmVudFx0XHRcdFx0XHRmcm9tIFwiYXdheWpzLWNvcmUvbGliL2V2ZW50cy9Mb2FkZXJFdmVudFwiO1xuaW1wb3J0IFZlY3RvcjNEXHRcdFx0XHRcdFx0ZnJvbSBcImF3YXlqcy1jb3JlL2xpYi9nZW9tL1ZlY3RvcjNEXCI7XG5pbXBvcnQgQXNzZXRMaWJyYXJ5XHRcdFx0XHRcdGZyb20gXCJhd2F5anMtY29yZS9saWIvbGlicmFyeS9Bc3NldExpYnJhcnlcIjtcbmltcG9ydCBMb2FkZXJcdFx0XHRcdFx0XHRmcm9tIFwiYXdheWpzLWNvcmUvbGliL2xpYnJhcnkvTG9hZGVyXCI7XG5pbXBvcnQgSUFzc2V0XHRcdFx0XHRcdFx0ZnJvbSBcImF3YXlqcy1jb3JlL2xpYi9saWJyYXJ5L0lBc3NldFwiO1xuaW1wb3J0IFVSTFJlcXVlc3RcdFx0XHRcdFx0ZnJvbSBcImF3YXlqcy1jb3JlL2xpYi9uZXQvVVJMUmVxdWVzdFwiO1xuaW1wb3J0IERlYnVnXHRcdFx0XHRcdFx0ZnJvbSBcImF3YXlqcy1jb3JlL2xpYi91dGlscy9EZWJ1Z1wiO1xuaW1wb3J0IFJlcXVlc3RBbmltYXRpb25GcmFtZVx0XHRmcm9tIFwiYXdheWpzLWNvcmUvbGliL3V0aWxzL1JlcXVlc3RBbmltYXRpb25GcmFtZVwiO1xuXG5pbXBvcnQgVmlld1x0XHRcdFx0XHRcdFx0ZnJvbSBcImF3YXlqcy1kaXNwbGF5L2xpYi9WaWV3XCI7XG5pbXBvcnQgRGlyZWN0aW9uYWxMaWdodFx0XHRcdFx0ZnJvbSBcImF3YXlqcy1kaXNwbGF5L2xpYi9kaXNwbGF5L0RpcmVjdGlvbmFsTGlnaHRcIjtcbmltcG9ydCBTcHJpdGVcdFx0XHRcdFx0XHRmcm9tIFwiYXdheWpzLWRpc3BsYXkvbGliL2Rpc3BsYXkvU3ByaXRlXCI7XG5pbXBvcnQgRWxlbWVudHNUeXBlXHRcdFx0XHRcdGZyb20gXCJhd2F5anMtZGlzcGxheS9saWIvZ3JhcGhpY3MvRWxlbWVudHNUeXBlXCI7XG5pbXBvcnQgU3RhdGljTGlnaHRQaWNrZXJcdFx0XHRmcm9tIFwiYXdheWpzLWRpc3BsYXkvbGliL21hdGVyaWFscy9saWdodHBpY2tlcnMvU3RhdGljTGlnaHRQaWNrZXJcIjtcbmltcG9ydCBQcmltaXRpdmVUb3J1c1ByZWZhYlx0XHRcdGZyb20gXCJhd2F5anMtZGlzcGxheS9saWIvcHJlZmFicy9QcmltaXRpdmVUb3J1c1ByZWZhYlwiO1xuaW1wb3J0IFByaW1pdGl2ZUN1YmVQcmVmYWJcdFx0XHRmcm9tIFwiYXdheWpzLWRpc3BsYXkvbGliL3ByZWZhYnMvUHJpbWl0aXZlQ3ViZVByZWZhYlwiO1xuaW1wb3J0IFByaW1pdGl2ZUNhcHN1bGVQcmVmYWJcdFx0ZnJvbSBcImF3YXlqcy1kaXNwbGF5L2xpYi9wcmVmYWJzL1ByaW1pdGl2ZUNhcHN1bGVQcmVmYWJcIjtcblxuaW1wb3J0IERlZmF1bHRSZW5kZXJlclx0XHRcdFx0ZnJvbSBcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9EZWZhdWx0UmVuZGVyZXJcIjtcblxuaW1wb3J0IE1ldGhvZE1hdGVyaWFsXHRcdFx0XHRmcm9tIFwiYXdheWpzLW1ldGhvZG1hdGVyaWFscy9saWIvTWV0aG9kTWF0ZXJpYWxcIjtcblxuaW1wb3J0IE9CSlBhcnNlclx0XHRcdFx0XHRmcm9tIFwiYXdheWpzLXBhcnNlcnMvbGliL09CSlBhcnNlclwiO1xuXG5jbGFzcyBNYXRlcmlhbEFscGhhVGVzdFxue1xuXHRwcml2YXRlIHZpZXc6Vmlldztcblx0cHJpdmF0ZSByYWY6UmVxdWVzdEFuaW1hdGlvbkZyYW1lO1xuXHRwcml2YXRlIHNwcml0ZXMgIDogQXJyYXk8U3ByaXRlPiA9IG5ldyBBcnJheTxTcHJpdGU+KCk7XG5cdHByaXZhdGUgbG9hZGVkU3ByaXRlTWF0ZXJpYWw6TWV0aG9kTWF0ZXJpYWw7XG5cdHByaXZhdGUgbGlnaHQ6RGlyZWN0aW9uYWxMaWdodDtcblx0cHJpdmF0ZSBsaWdodEI6RGlyZWN0aW9uYWxMaWdodDtcblx0cHJpdmF0ZSBsb2FkZWRTcHJpdGU6U3ByaXRlO1xuXG5cdHByaXZhdGUgYVZhbHVlczpBcnJheTxudW1iZXI+ID0gQXJyYXk8bnVtYmVyPigwLCAuMSwgLjUsIC44LCAuOSwgLjk5LCAxKTtcblx0cHJpdmF0ZSBhVmFsdWVzUDpudW1iZXIgPSAwO1xuXG5cdHByaXZhdGUgdG9ydXNUZXh0dXJlTWF0ZXJpYWw6TWV0aG9kTWF0ZXJpYWw7XG5cdHByaXZhdGUgY3ViZUNvbG9yTWF0ZXJpYWw6TWV0aG9kTWF0ZXJpYWw7XG5cdHByaXZhdGUgY2Fwc3VsZUNvbG9yTWF0ZXJpYWw6TWV0aG9kTWF0ZXJpYWw7XG5cdHByaXZhdGUgc3RhdGljTGlnaHRQaWNrZXI6U3RhdGljTGlnaHRQaWNrZXI7XG5cblx0Y29uc3RydWN0b3IoKVxuXHR7XG5cdFx0RGVidWcuTE9HX1BJX0VSUk9SUyA9IGZhbHNlO1xuXHRcdERlYnVnLlRIUk9XX0VSUk9SUyA9IGZhbHNlO1xuXG5cdFx0dGhpcy52aWV3ID0gbmV3IFZpZXcobmV3IERlZmF1bHRSZW5kZXJlcigpKTtcblx0XHR0aGlzLnJhZiA9IG5ldyBSZXF1ZXN0QW5pbWF0aW9uRnJhbWUodGhpcy5yZW5kZXIsIHRoaXMpO1xuXHRcdHRoaXMub25SZXNpemUoKTtcblxuXHRcdHRoaXMubGlnaHQgPSBuZXcgRGlyZWN0aW9uYWxMaWdodCgpO1xuXHRcdHRoaXMubGlnaHQuY29sb3IgPSAweEZGRkZGRjtcblx0XHR0aGlzLmxpZ2h0LmRpcmVjdGlvbiA9IG5ldyBWZWN0b3IzRCgxLCAxLCAwKTtcblx0XHR0aGlzLmxpZ2h0LmFtYmllbnQgPSAwO1xuXHRcdHRoaXMubGlnaHQuYW1iaWVudENvbG9yID0gMHhGRkZGRkY7XG5cdFx0dGhpcy5saWdodC5kaWZmdXNlID0gMTtcblx0XHR0aGlzLmxpZ2h0LnNwZWN1bGFyID0gMTtcblxuXHRcdHRoaXMubGlnaHRCID0gbmV3IERpcmVjdGlvbmFsTGlnaHQoKTtcblx0XHR0aGlzLmxpZ2h0Qi5jb2xvcj0gMHhGRjAwMDA7XG5cdFx0dGhpcy5saWdodEIuZGlyZWN0aW9uID0gbmV3IFZlY3RvcjNEKC0xLCAwLCAxKTtcblx0XHR0aGlzLmxpZ2h0Qi5hbWJpZW50ID0gMDtcblx0XHR0aGlzLmxpZ2h0Qi5hbWJpZW50Q29sb3IgPSAweEZGRkZGRjtcblx0XHR0aGlzLmxpZ2h0Qi5kaWZmdXNlID0gMTtcblx0XHR0aGlzLmxpZ2h0Qi5zcGVjdWxhciA9IDE7XG5cblx0XHR0aGlzLnZpZXcuc2NlbmUuYWRkQ2hpbGQodGhpcy5saWdodCk7XG5cdFx0dGhpcy52aWV3LnNjZW5lLmFkZENoaWxkKHRoaXMubGlnaHRCKTtcblxuXHRcdHRoaXMudmlldy5iYWNrZ3JvdW5kQ29sb3IgPSAweDIyMjIyMjtcblxuXHRcdEFzc2V0TGlicmFyeS5lbmFibGVQYXJzZXIoT0JKUGFyc2VyKTtcblxuXHRcdHZhciBzZXNzaW9uOkxvYWRlcjtcblxuXHRcdHNlc3Npb24gPSBBc3NldExpYnJhcnkuZ2V0TG9hZGVyKCk7XG5cdFx0c2Vzc2lvbi5hZGRFdmVudExpc3RlbmVyKExvYWRlckV2ZW50LkxPQURfQ09NUExFVEUsIChldmVudDpMb2FkZXJFdmVudCkgPT4gdGhpcy5vbkxvYWRDb21wbGV0ZShldmVudCkpO1xuXHRcdHNlc3Npb24ubG9hZChuZXcgVVJMUmVxdWVzdCgnYXNzZXRzL3BsYXRvbmljLm9iaicpKTtcblxuXHRcdHNlc3Npb24gPSBBc3NldExpYnJhcnkuZ2V0TG9hZGVyKCk7XG5cdFx0c2Vzc2lvbi5hZGRFdmVudExpc3RlbmVyKExvYWRlckV2ZW50LkxPQURfQ09NUExFVEUsIChldmVudDpMb2FkZXJFdmVudCkgPT4gdGhpcy5vbkxvYWRDb21wbGV0ZShldmVudCkpO1xuXHRcdHNlc3Npb24ubG9hZChuZXcgVVJMUmVxdWVzdCgnYXNzZXRzL2RvdHMucG5nJykpO1xuXG5cdFx0d2luZG93Lm9ucmVzaXplID0gKGV2ZW50OlVJRXZlbnQpID0+IHRoaXMub25SZXNpemUoZXZlbnQpO1xuXHRcdGRvY3VtZW50Lm9ubW91c2Vkb3duID0gKGV2ZW50Ok1vdXNlRXZlbnQpID0+IHRoaXMub25Nb3VzZURvd24oZXZlbnQpO1xuXHR9XG5cblx0cHJpdmF0ZSBvbk1vdXNlRG93bihldmVudDpNb3VzZUV2ZW50KVxuXHR7XG5cdFx0dGhpcy5jdWJlQ29sb3JNYXRlcmlhbC5hbHBoYSA9IHRoaXMudG9ydXNUZXh0dXJlTWF0ZXJpYWwuYWxwaGEgPSB0aGlzLmxvYWRlZFNwcml0ZU1hdGVyaWFsLmFscGhhID0gdGhpcy5hVmFsdWVzW3RoaXMuYVZhbHVlc1BdO1xuXG5cdFx0YWxlcnQoICdBbHBoYTogJyArIHRoaXMuYVZhbHVlc1t0aGlzLmFWYWx1ZXNQXSk7XG5cblx0XHR0aGlzLmFWYWx1ZXNQKys7XG5cblx0XHRpZiAodGhpcy5hVmFsdWVzUCA+IHRoaXMuYVZhbHVlcy5sZW5ndGggLTEpXG5cdFx0XHR0aGlzLmFWYWx1ZXNQICA9IDA7XG5cdH1cblxuXHRwcml2YXRlIHJlbmRlcihkdDpudW1iZXIpXG5cdHtcblx0XHRpZiAodGhpcy5zcHJpdGVzKVxuXHRcdFx0Zm9yICh2YXIgYzpudW1iZXIgPSAwOyBjIDwgdGhpcy5zcHJpdGVzLmxlbmd0aDsgYysrKVxuXHRcdFx0XHR0aGlzLnNwcml0ZXNbY10ucm90YXRpb25ZICs9IC4zNTtcblxuXHRcdHRoaXMudmlldy5yZW5kZXIoKTtcblx0fVxuXG5cdHB1YmxpYyBvbkxvYWRDb21wbGV0ZShldmVudDpMb2FkZXJFdmVudClcblx0e1xuXHRcdHZhciBsb2FkZXI6TG9hZGVyID0gZXZlbnQudGFyZ2V0O1xuXHRcdHZhciBsOm51bWJlciA9IGxvYWRlci5iYXNlRGVwZW5kZW5jeS5hc3NldHMubGVuZ3RoXG5cblx0XHRmb3IgKHZhciBjOm51bWJlciA9IDA7IGMgPCBsOyBjICsrKSB7XG5cblx0XHRcdHZhciBkOklBc3NldCA9IGxvYWRlci5iYXNlRGVwZW5kZW5jeS5hc3NldHNbY107XG5cblx0XHRcdGNvbnNvbGUubG9nKCBkLm5hbWUpO1xuXG5cdFx0XHRzd2l0Y2ggKGQuYXNzZXRUeXBlKSB7XG5cdFx0XHRcdGNhc2UgU3ByaXRlLmFzc2V0VHlwZTpcblx0XHRcdFx0XHR2YXIgc3ByaXRlOlNwcml0ZSA9IDxTcHJpdGU+IGQ7XG5cblx0XHRcdFx0XHR0aGlzLmxvYWRlZFNwcml0ZSA9IHNwcml0ZTtcblxuXHRcdFx0XHRcdGlmIChkLm5hbWUgPT0gJ1Nwcml0ZV9nMCcpIHtcblx0XHRcdFx0XHRcdHRoaXMubG9hZGVkU3ByaXRlID0gc3ByaXRlO1xuXHRcdFx0XHRcdFx0c3ByaXRlLnkgPSAtNDAwO1xuXHRcdFx0XHRcdFx0c3ByaXRlLnRyYW5zZm9ybS5zY2FsZVRvKDUsIDUsIDUpO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRzcHJpdGUudHJhbnNmb3JtLnNjYWxlVG8oMy41LCAzLjUsIDMuNSk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKHRoaXMubG9hZGVkU3ByaXRlTWF0ZXJpYWwpXG5cdFx0XHRcdFx0XHRzcHJpdGUubWF0ZXJpYWwgPSB0aGlzLmxvYWRlZFNwcml0ZU1hdGVyaWFsO1xuXG5cdFx0XHRcdFx0dGhpcy52aWV3LnNjZW5lLmFkZENoaWxkKHNwcml0ZSk7XG5cdFx0XHRcdFx0dGhpcy5zcHJpdGVzLnB1c2goc3ByaXRlKTtcblxuXHRcdFx0XHRcdHRoaXMucmFmLnN0YXJ0KCk7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdGNhc2UgQml0bWFwSW1hZ2UyRC5hc3NldFR5cGU6XG5cdFx0XHRcdFx0Ly8gTGlnaHQgUGlja2VyXG5cdFx0XHRcdFx0dGhpcy5zdGF0aWNMaWdodFBpY2tlciA9IG5ldyBTdGF0aWNMaWdodFBpY2tlciggW3RoaXMubGlnaHQgLCB0aGlzLmxpZ2h0QiBdICk7XG5cblx0XHRcdFx0XHQvLyBNYXRlcmlhbCBmb3IgbG9hZGVkIHNwcml0ZVxuXHRcdFx0XHRcdHRoaXMubG9hZGVkU3ByaXRlTWF0ZXJpYWwgPSBuZXcgTWV0aG9kTWF0ZXJpYWwoPEJpdG1hcEltYWdlMkQ+IGQpO1xuXHRcdFx0XHRcdHRoaXMubG9hZGVkU3ByaXRlTWF0ZXJpYWwuc3R5bGUuc2FtcGxlciA9IG5ldyBTYW1wbGVyMkQodHJ1ZSwgdHJ1ZSwgZmFsc2UpO1xuXHRcdFx0XHRcdHRoaXMubG9hZGVkU3ByaXRlTWF0ZXJpYWwubGlnaHRQaWNrZXIgPSB0aGlzLnN0YXRpY0xpZ2h0UGlja2VyO1xuXHRcdFx0XHRcdHRoaXMubG9hZGVkU3ByaXRlTWF0ZXJpYWwuYWxwaGEgPSAxO1xuXHRcdFx0XHRcdHRoaXMubG9hZGVkU3ByaXRlTWF0ZXJpYWwuYm90aFNpZGVzID0gdHJ1ZTtcblxuXHRcdFx0XHRcdGlmICh0aGlzLmxvYWRlZFNwcml0ZSlcblx0XHRcdFx0XHRcdHRoaXMubG9hZGVkU3ByaXRlLm1hdGVyaWFsID0gdGhpcy5sb2FkZWRTcHJpdGVNYXRlcmlhbDtcblxuXHRcdFx0XHRcdC8vIFRvcnVzIFRleHR1cmUgTWF0ZXJpYWxcblx0XHRcdFx0XHR0aGlzLnRvcnVzVGV4dHVyZU1hdGVyaWFsID0gbmV3IE1ldGhvZE1hdGVyaWFsKDxCaXRtYXBJbWFnZTJEPiBkKTtcblx0XHRcdFx0XHR0aGlzLnRvcnVzVGV4dHVyZU1hdGVyaWFsLnN0eWxlLnNhbXBsZXIgPSBuZXcgU2FtcGxlcjJEKHRydWUsIHRydWUsIGZhbHNlKTtcblx0XHRcdFx0XHR0aGlzLnRvcnVzVGV4dHVyZU1hdGVyaWFsLmxpZ2h0UGlja2VyID0gdGhpcy5zdGF0aWNMaWdodFBpY2tlciA7XG5cdFx0XHRcdFx0dGhpcy50b3J1c1RleHR1cmVNYXRlcmlhbC5ib3RoU2lkZXMgPSB0cnVlO1xuXHRcdFx0XHRcdHRoaXMudG9ydXNUZXh0dXJlTWF0ZXJpYWwuYWxwaGEgPSAuODtcblxuXHRcdFx0XHRcdC8vIFRvcnVzXG5cdFx0XHRcdFx0dmFyIHRvcnVzOlByaW1pdGl2ZVRvcnVzUHJlZmFiID0gbmV3IFByaW1pdGl2ZVRvcnVzUHJlZmFiKHRoaXMudG9ydXNUZXh0dXJlTWF0ZXJpYWwsIEVsZW1lbnRzVHlwZS5UUklBTkdMRSwgMTUwICwgNTAgLCA2NCAsIDY0KTtcblxuXHRcdFx0XHRcdC8vIFRvcnVzIFNwcml0ZSAoIGxlZnQgKVxuXHRcdFx0XHRcdHZhciB0b3J1c1Nwcml0ZTpTcHJpdGUgPSA8U3ByaXRlPiB0b3J1cy5nZXROZXdPYmplY3QoKTtcblx0XHRcdFx0XHR0b3J1c1Nwcml0ZS5yb3RhdGlvblggPSA5MDtcblx0XHRcdFx0XHR0b3J1c1Nwcml0ZS54ID0gNjAwO1xuXHRcdFx0XHRcdHRoaXMuc3ByaXRlcy5wdXNoKHRvcnVzU3ByaXRlKTtcblx0XHRcdFx0XHR0aGlzLnZpZXcuc2NlbmUuYWRkQ2hpbGQodG9ydXNTcHJpdGUpO1xuXG5cdFx0XHRcdFx0Ly8gVG9ydXMgQ29sb3IgTWF0ZXJpYWxcblx0XHRcdFx0XHR0aGlzLmN1YmVDb2xvck1hdGVyaWFsID0gbmV3IE1ldGhvZE1hdGVyaWFsKDB4MDA5MGZmKTtcblx0XHRcdFx0XHR0aGlzLmN1YmVDb2xvck1hdGVyaWFsLmxpZ2h0UGlja2VyID0gdGhpcy5zdGF0aWNMaWdodFBpY2tlciA7XG5cdFx0XHRcdFx0dGhpcy5jdWJlQ29sb3JNYXRlcmlhbC5hbHBoYSA9IC44O1xuXHRcdFx0XHRcdHRoaXMuY3ViZUNvbG9yTWF0ZXJpYWwuYm90aFNpZGVzID0gdHJ1ZTtcblxuXHRcdFx0XHRcdHZhciBjdWJlOlByaW1pdGl2ZUN1YmVQcmVmYWIgPSBuZXcgUHJpbWl0aXZlQ3ViZVByZWZhYih0aGlzLmN1YmVDb2xvck1hdGVyaWFsLCBFbGVtZW50c1R5cGUuVFJJQU5HTEUsIDMwMCwgMzAwLCAzMDAsIDIwLCAyMCwgMjApO1xuXG5cdFx0XHRcdFx0Ly8gVG9ydXMgU3ByaXRlICggcmlnaHQgKVxuXHRcdFx0XHRcdHZhciBjdWJlU3ByaXRlOlNwcml0ZSA9IDxTcHJpdGU+IGN1YmUuZ2V0TmV3T2JqZWN0KCk7XG5cdFx0XHRcdFx0Y3ViZVNwcml0ZS5yb3RhdGlvblggPSA5MDtcblx0XHRcdFx0XHRjdWJlU3ByaXRlLnggPSAtNjAwO1xuXHRcdFx0XHRcdHRoaXMuc3ByaXRlcy5wdXNoKGN1YmVTcHJpdGUpO1xuXHRcdFx0XHRcdHRoaXMudmlldy5zY2VuZS5hZGRDaGlsZChjdWJlU3ByaXRlKTtcblxuXHRcdFx0XHRcdHRoaXMuY2Fwc3VsZUNvbG9yTWF0ZXJpYWwgPSBuZXcgTWV0aG9kTWF0ZXJpYWwoMHgwMGZmZmYpO1xuXHRcdFx0XHRcdHRoaXMuY2Fwc3VsZUNvbG9yTWF0ZXJpYWwubGlnaHRQaWNrZXIgPSB0aGlzLnN0YXRpY0xpZ2h0UGlja2VyO1xuXG5cdFx0XHRcdFx0dmFyIGNhcHN1bGU6UHJpbWl0aXZlQ2Fwc3VsZVByZWZhYiA9IG5ldyBQcmltaXRpdmVDYXBzdWxlUHJlZmFiKHRoaXMuY2Fwc3VsZUNvbG9yTWF0ZXJpYWwsIEVsZW1lbnRzVHlwZS5UUklBTkdMRSwgMTAwLCAyMDApO1xuXG5cdFx0XHRcdFx0Ly8gVG9ydXMgU3ByaXRlICggcmlnaHQgKVxuXHRcdFx0XHRcdHZhciBjYXBzdWxlU3ByaXRlOlNwcml0ZSA9IDxTcHJpdGU+IGNhcHN1bGUuZ2V0TmV3T2JqZWN0KCk7XG5cdFx0XHRcdFx0dGhpcy5zcHJpdGVzLnB1c2goY2Fwc3VsZVNwcml0ZSk7XG5cdFx0XHRcdFx0dGhpcy52aWV3LnNjZW5lLmFkZENoaWxkKGNhcHN1bGVTcHJpdGUpO1xuXG5cdFx0XHRcdFx0dGhpcy5jdWJlQ29sb3JNYXRlcmlhbC5hbHBoYSA9IHRoaXMudG9ydXNUZXh0dXJlTWF0ZXJpYWwuYWxwaGEgPSB0aGlzLmxvYWRlZFNwcml0ZU1hdGVyaWFsLmFscGhhID0gMTtcblxuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdHB1YmxpYyBvblJlc2l6ZShldmVudDpVSUV2ZW50ID0gbnVsbClcblx0e1xuXHRcdHRoaXMudmlldy55ID0gMDtcblx0XHR0aGlzLnZpZXcueCA9IDA7XG5cblx0XHR0aGlzLnZpZXcud2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDtcblx0XHR0aGlzLnZpZXcuaGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0O1xuXHR9XG59Il0sInNvdXJjZVJvb3QiOiIuL3Rlc3RzIn0=
