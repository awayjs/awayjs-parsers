"use strict";
var BitmapImage2D_1 = require("awayjs-core/lib/image/BitmapImage2D");
var Sampler2D_1 = require("awayjs-core/lib/image/Sampler2D");
var LoaderEvent_1 = require("awayjs-core/lib/events/LoaderEvent");
var Vector3D_1 = require("awayjs-core/lib/geom/Vector3D");
var AssetLibrary_1 = require("awayjs-core/lib/library/AssetLibrary");
var URLRequest_1 = require("awayjs-core/lib/net/URLRequest");
var Debug_1 = require("awayjs-core/lib/utils/Debug");
var RequestAnimationFrame_1 = require("awayjs-core/lib/utils/RequestAnimationFrame");
var View_1 = require("awayjs-display/lib/View");
var DisplayObjectContainer_1 = require("awayjs-display/lib/display/DisplayObjectContainer");
var DirectionalLight_1 = require("awayjs-display/lib/display/DirectionalLight");
var Sprite_1 = require("awayjs-display/lib/display/Sprite");
var StaticLightPicker_1 = require("awayjs-display/lib/materials/lightpickers/StaticLightPicker");
var DefaultRenderer_1 = require("awayjs-renderergl/lib/DefaultRenderer");
var MethodMaterial_1 = require("awayjs-methodmaterials/lib/MethodMaterial");
var OBJParser_1 = require("awayjs-parsers/lib/OBJParser");
/**
 *
 */
var ObjChiefTestDay = (function () {
    function ObjChiefTestDay() {
        var _this = this;
        this.sprites = new Array();
        this.spartan = new DisplayObjectContainer_1.default();
        this.spartanFlag = false;
        Debug_1.default.LOG_PI_ERRORS = false;
        Debug_1.default.THROW_ERRORS = false;
        this.view = new View_1.default(new DefaultRenderer_1.default());
        this.view.camera.z = -50;
        this.view.camera.y = 20;
        this.view.camera.projection.near = 0.1;
        this.view.backgroundColor = 0xCEC8C6;
        this.raf = new RequestAnimationFrame_1.default(this.render, this);
        this.light = new DirectionalLight_1.default();
        this.light.color = 0xc1582d;
        this.light.direction = new Vector3D_1.default(1, 0, 0);
        this.light.ambient = 0.4;
        this.light.ambientColor = 0x85b2cd;
        this.light.diffuse = 2.8;
        this.light.specular = 1.8;
        this.view.scene.addChild(this.light);
        this.spartan.transform.scaleTo(.25, .25, .25);
        this.spartan.y = 0;
        this.view.scene.addChild(this.spartan);
        AssetLibrary_1.default.enableParser(OBJParser_1.default);
        var session;
        session = AssetLibrary_1.default.getLoader();
        session.addEventListener(LoaderEvent_1.default.LOAD_COMPLETE, function (event) { return _this.onLoadComplete(event); });
        session.load(new URLRequest_1.default('assets/Halo_3_SPARTAN4.obj'));
        session = AssetLibrary_1.default.getLoader();
        session.addEventListener(LoaderEvent_1.default.LOAD_COMPLETE, function (event) { return _this.onLoadComplete(event); });
        session.load(new URLRequest_1.default('assets/terrain.obj'));
        session = AssetLibrary_1.default.getLoader();
        session.addEventListener(LoaderEvent_1.default.LOAD_COMPLETE, function (event) { return _this.onLoadComplete(event); });
        session.load(new URLRequest_1.default('assets/masterchief_base.png'));
        session = AssetLibrary_1.default.getLoader();
        session.addEventListener(LoaderEvent_1.default.LOAD_COMPLETE, function (event) { return _this.onLoadComplete(event); });
        session.load(new URLRequest_1.default('assets/stone_tx.jpg'));
        window.onresize = function (event) { return _this.onResize(); };
        this.raf.start();
    }
    ObjChiefTestDay.prototype.render = function () {
        if (this.terrain)
            this.terrain.rotationY += 0.4;
        this.spartan.rotationY += 0.4;
        this.view.render();
    };
    ObjChiefTestDay.prototype.onLoadComplete = function (event) {
        var loader = event.target;
        var l = loader.baseDependency.assets.length;
        console.log('------------------------------------------------------------------------------');
        console.log('events.LoaderEvent.RESOURCE_COMPLETE', event, l, loader);
        console.log('------------------------------------------------------------------------------');
        var l = loader.baseDependency.assets.length;
        for (var c = 0; c < l; c++) {
            var d = loader.baseDependency.assets[c];
            console.log(d.name, event.url);
            switch (d.assetType) {
                case Sprite_1.default.assetType:
                    if (event.url == 'assets/Halo_3_SPARTAN4.obj') {
                        var sprite = d;
                        this.spartan.addChild(sprite);
                        this.spartanFlag = true;
                        this.sprites.push(sprite);
                    }
                    else if (event.url == 'assets/terrain.obj') {
                        this.terrain = d;
                        this.terrain.y = 98;
                        this.terrain.graphics.scaleUV(20, 20);
                        this.view.scene.addChild(this.terrain);
                    }
                    break;
                case BitmapImage2D_1.default.assetType:
                    if (event.url == 'assets/masterchief_base.png') {
                        this.mat = new MethodMaterial_1.default(d);
                        this.mat.style.sampler = new Sampler2D_1.default(true, true, false);
                        this.mat.lightPicker = new StaticLightPicker_1.default([this.light]);
                    }
                    else if (event.url == 'assets/stone_tx.jpg') {
                        this.terrainMaterial = new MethodMaterial_1.default(d);
                        this.terrainMaterial.style.sampler = new Sampler2D_1.default(true, true, false);
                        this.terrainMaterial.lightPicker = new StaticLightPicker_1.default([this.light]);
                    }
                    break;
            }
        }
        if (this.terrain && this.terrainMaterial)
            this.terrain.material = this.terrainMaterial;
        if (this.mat && this.spartanFlag)
            for (var c = 0; c < this.sprites.length; c++)
                this.sprites[c].material = this.mat;
        this.onResize();
    };
    ObjChiefTestDay.prototype.onResize = function (event) {
        if (event === void 0) { event = null; }
        this.view.y = 0;
        this.view.x = 0;
        this.view.width = window.innerWidth;
        this.view.height = window.innerHeight;
    };
    return ObjChiefTestDay;
}());

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBhcnNlcnMvT2JqQ2hpZWZUZXN0RGF5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSw4QkFBNkIscUNBQXFDLENBQUMsQ0FBQTtBQUNuRSwwQkFBMEIsaUNBQWlDLENBQUMsQ0FBQTtBQUM1RCw0QkFBNEIsb0NBQW9DLENBQUMsQ0FBQTtBQUNqRSx5QkFBMEIsK0JBQStCLENBQUMsQ0FBQTtBQUMxRCw2QkFBNkIsc0NBQXNDLENBQUMsQ0FBQTtBQUdwRSwyQkFBMkIsZ0NBQWdDLENBQUMsQ0FBQTtBQUM1RCxzQkFBdUIsNkJBQTZCLENBQUMsQ0FBQTtBQUNyRCxzQ0FBbUMsNkNBQTZDLENBQUMsQ0FBQTtBQUVqRixxQkFBdUIseUJBQXlCLENBQUMsQ0FBQTtBQUNqRCx1Q0FBb0MsbURBQW1ELENBQUMsQ0FBQTtBQUN4RixpQ0FBZ0MsNkNBQTZDLENBQUMsQ0FBQTtBQUM5RSx1QkFBd0IsbUNBQW1DLENBQUMsQ0FBQTtBQUM1RCxrQ0FBZ0MsNkRBQTZELENBQUMsQ0FBQTtBQUU5RixnQ0FBK0IsdUNBQXVDLENBQUMsQ0FBQTtBQUV2RSwrQkFBOEIsMkNBQTJDLENBQUMsQ0FBQTtBQUUxRSwwQkFBMEIsOEJBQThCLENBQUMsQ0FBQTtBQUV6RDs7R0FFRztBQUNIO0lBZ0JDO1FBaEJELGlCQThJQztRQTFJUSxZQUFPLEdBQWlCLElBQUksS0FBSyxFQUFVLENBQUM7UUFPNUMsWUFBTyxHQUEwQixJQUFJLGdDQUFzQixFQUFFLENBQUM7UUFHOUQsZ0JBQVcsR0FBVyxLQUFLLENBQUM7UUFJbkMsZUFBSyxDQUFDLGFBQWEsR0FBRyxLQUFLLENBQUM7UUFDNUIsZUFBSyxDQUFDLFlBQVksR0FBRyxLQUFLLENBQUM7UUFFM0IsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLGNBQUksQ0FBQyxJQUFJLHlCQUFlLEVBQUUsQ0FBQyxDQUFDO1FBQzVDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQztRQUN6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QUFFLENBQUM7SUFDakIsQ0FBQztJQUVNLGtDQUFRLEdBQWYsVUFBZ0IsS0FBb0I7UUFBcEIscUJBQW9CLEdBQXBCLFlBQW9CO1FBRW5DLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNoQixJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7UUFFaEIsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLEdBQUcsTUFBTSxDQUFDLFVBQVUsQ0FBQztRQUNwQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUMsV0FBVyxDQUFDO0lBQ3ZDLENBQUM7SUFDRixzQkFBQztBQUFELENBOUlBLEFBOElDLElBQUEiLCJmaWxlIjoicGFyc2Vycy9PYmpDaGllZlRlc3REYXkuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQml0bWFwSW1hZ2UyRFx0XHRcdFx0ZnJvbSBcImF3YXlqcy1jb3JlL2xpYi9pbWFnZS9CaXRtYXBJbWFnZTJEXCI7XG5pbXBvcnQgU2FtcGxlcjJEXHRcdFx0XHRcdGZyb20gXCJhd2F5anMtY29yZS9saWIvaW1hZ2UvU2FtcGxlcjJEXCI7XG5pbXBvcnQgTG9hZGVyRXZlbnRcdFx0XHRcdFx0ZnJvbSBcImF3YXlqcy1jb3JlL2xpYi9ldmVudHMvTG9hZGVyRXZlbnRcIjtcbmltcG9ydCBWZWN0b3IzRFx0XHRcdFx0XHRcdGZyb20gXCJhd2F5anMtY29yZS9saWIvZ2VvbS9WZWN0b3IzRFwiO1xuaW1wb3J0IEFzc2V0TGlicmFyeVx0XHRcdFx0XHRmcm9tIFwiYXdheWpzLWNvcmUvbGliL2xpYnJhcnkvQXNzZXRMaWJyYXJ5XCI7XG5pbXBvcnQgTG9hZGVyXHRcdFx0XHRcdFx0ZnJvbSBcImF3YXlqcy1jb3JlL2xpYi9saWJyYXJ5L0xvYWRlclwiO1xuaW1wb3J0IElBc3NldFx0XHRcdFx0XHRcdGZyb20gXCJhd2F5anMtY29yZS9saWIvbGlicmFyeS9JQXNzZXRcIjtcbmltcG9ydCBVUkxSZXF1ZXN0XHRcdFx0XHRcdGZyb20gXCJhd2F5anMtY29yZS9saWIvbmV0L1VSTFJlcXVlc3RcIjtcbmltcG9ydCBEZWJ1Z1x0XHRcdFx0XHRcdGZyb20gXCJhd2F5anMtY29yZS9saWIvdXRpbHMvRGVidWdcIjtcbmltcG9ydCBSZXF1ZXN0QW5pbWF0aW9uRnJhbWVcdFx0ZnJvbSBcImF3YXlqcy1jb3JlL2xpYi91dGlscy9SZXF1ZXN0QW5pbWF0aW9uRnJhbWVcIjtcblxuaW1wb3J0IFZpZXdcdFx0XHRcdFx0XHRcdGZyb20gXCJhd2F5anMtZGlzcGxheS9saWIvVmlld1wiO1xuaW1wb3J0IERpc3BsYXlPYmplY3RDb250YWluZXJcdFx0ZnJvbSBcImF3YXlqcy1kaXNwbGF5L2xpYi9kaXNwbGF5L0Rpc3BsYXlPYmplY3RDb250YWluZXJcIjtcbmltcG9ydCBEaXJlY3Rpb25hbExpZ2h0XHRcdFx0XHRmcm9tIFwiYXdheWpzLWRpc3BsYXkvbGliL2Rpc3BsYXkvRGlyZWN0aW9uYWxMaWdodFwiO1xuaW1wb3J0IFNwcml0ZVx0XHRcdFx0XHRcdGZyb20gXCJhd2F5anMtZGlzcGxheS9saWIvZGlzcGxheS9TcHJpdGVcIjtcbmltcG9ydCBTdGF0aWNMaWdodFBpY2tlclx0XHRcdGZyb20gXCJhd2F5anMtZGlzcGxheS9saWIvbWF0ZXJpYWxzL2xpZ2h0cGlja2Vycy9TdGF0aWNMaWdodFBpY2tlclwiO1xuXG5pbXBvcnQgRGVmYXVsdFJlbmRlcmVyXHRcdFx0XHRmcm9tIFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL0RlZmF1bHRSZW5kZXJlclwiO1xuXG5pbXBvcnQgTWV0aG9kTWF0ZXJpYWxcdFx0XHRcdGZyb20gXCJhd2F5anMtbWV0aG9kbWF0ZXJpYWxzL2xpYi9NZXRob2RNYXRlcmlhbFwiO1xuXG5pbXBvcnQgT0JKUGFyc2VyXHRcdFx0XHRcdGZyb20gXCJhd2F5anMtcGFyc2Vycy9saWIvT0JKUGFyc2VyXCI7XG5cbi8qKlxuICogXG4gKi9cbmNsYXNzIE9iakNoaWVmVGVzdERheVxue1xuXHRwcml2YXRlIHZpZXc6Vmlldztcblx0cHJpdmF0ZSByYWY6UmVxdWVzdEFuaW1hdGlvbkZyYW1lO1xuXHRwcml2YXRlIHNwcml0ZXM6QXJyYXk8U3ByaXRlPiA9IG5ldyBBcnJheTxTcHJpdGU+KCk7XG5cdHByaXZhdGUgbWF0Ok1ldGhvZE1hdGVyaWFsO1xuXG5cdHByaXZhdGUgdGVycmFpbk1hdGVyaWFsOk1ldGhvZE1hdGVyaWFsO1xuXG5cdHByaXZhdGUgbGlnaHQ6RGlyZWN0aW9uYWxMaWdodDtcblxuXHRwcml2YXRlIHNwYXJ0YW46RGlzcGxheU9iamVjdENvbnRhaW5lciA9IG5ldyBEaXNwbGF5T2JqZWN0Q29udGFpbmVyKCk7XG5cdHByaXZhdGUgdGVycmFpbjpTcHJpdGU7XG5cblx0cHJpdmF0ZSBzcGFydGFuRmxhZzpib29sZWFuID0gZmFsc2U7XG5cblx0Y29uc3RydWN0b3IoKVxuXHR7XG5cdFx0RGVidWcuTE9HX1BJX0VSUk9SUyA9IGZhbHNlO1xuXHRcdERlYnVnLlRIUk9XX0VSUk9SUyA9IGZhbHNlO1xuXG5cdFx0dGhpcy52aWV3ID0gbmV3IFZpZXcobmV3IERlZmF1bHRSZW5kZXJlcigpKTtcblx0XHR0aGlzLnZpZXcuY2FtZXJhLnogPSAtNTA7XG5cdFx0dGhpcy52aWV3LmNhbWVyYS55ID0gMjA7XG5cdFx0dGhpcy52aWV3LmNhbWVyYS5wcm9qZWN0aW9uLm5lYXIgPSAwLjE7XG5cdFx0dGhpcy52aWV3LmJhY2tncm91bmRDb2xvciA9IDB4Q0VDOEM2O1xuXG5cdFx0dGhpcy5yYWYgPSBuZXcgUmVxdWVzdEFuaW1hdGlvbkZyYW1lKHRoaXMucmVuZGVyLCB0aGlzKTtcblxuXHRcdHRoaXMubGlnaHQgPSBuZXcgRGlyZWN0aW9uYWxMaWdodCgpO1xuXHRcdHRoaXMubGlnaHQuY29sb3IgPSAweGMxNTgyZDtcblx0XHR0aGlzLmxpZ2h0LmRpcmVjdGlvbiA9IG5ldyBWZWN0b3IzRCgxLCAwLCAwKTtcblx0XHR0aGlzLmxpZ2h0LmFtYmllbnQgPSAwLjQ7XG5cdFx0dGhpcy5saWdodC5hbWJpZW50Q29sb3IgPSAweDg1YjJjZDtcblx0XHR0aGlzLmxpZ2h0LmRpZmZ1c2UgPSAyLjg7XG5cdFx0dGhpcy5saWdodC5zcGVjdWxhciA9IDEuODtcblx0XHR0aGlzLnZpZXcuc2NlbmUuYWRkQ2hpbGQodGhpcy5saWdodCk7XG5cblx0XHR0aGlzLnNwYXJ0YW4udHJhbnNmb3JtLnNjYWxlVG8oLjI1LCAuMjUsIC4yNSk7XG5cdFx0dGhpcy5zcGFydGFuLnkgPSAwO1xuXHRcdHRoaXMudmlldy5zY2VuZS5hZGRDaGlsZCh0aGlzLnNwYXJ0YW4pO1xuXG5cdFx0QXNzZXRMaWJyYXJ5LmVuYWJsZVBhcnNlcihPQkpQYXJzZXIpO1xuXG5cdFx0dmFyIHNlc3Npb246TG9hZGVyO1xuXG5cdFx0c2Vzc2lvbiA9IEFzc2V0TGlicmFyeS5nZXRMb2FkZXIoKTtcblx0XHRzZXNzaW9uLmFkZEV2ZW50TGlzdGVuZXIoTG9hZGVyRXZlbnQuTE9BRF9DT01QTEVURSwgKGV2ZW50OkxvYWRlckV2ZW50KSA9PiB0aGlzLm9uTG9hZENvbXBsZXRlKGV2ZW50KSk7XG5cdFx0c2Vzc2lvbi5sb2FkKG5ldyBVUkxSZXF1ZXN0KCdhc3NldHMvSGFsb18zX1NQQVJUQU40Lm9iaicpKTtcblxuXHRcdHNlc3Npb24gPSBBc3NldExpYnJhcnkuZ2V0TG9hZGVyKCk7XG5cdFx0c2Vzc2lvbi5hZGRFdmVudExpc3RlbmVyKExvYWRlckV2ZW50LkxPQURfQ09NUExFVEUsIChldmVudDpMb2FkZXJFdmVudCkgPT4gdGhpcy5vbkxvYWRDb21wbGV0ZShldmVudCkpO1xuXHRcdHNlc3Npb24ubG9hZChuZXcgVVJMUmVxdWVzdCgnYXNzZXRzL3RlcnJhaW4ub2JqJykpO1xuXG5cdFx0c2Vzc2lvbiA9IEFzc2V0TGlicmFyeS5nZXRMb2FkZXIoKTtcblx0XHRzZXNzaW9uLmFkZEV2ZW50TGlzdGVuZXIoTG9hZGVyRXZlbnQuTE9BRF9DT01QTEVURSwgKGV2ZW50OkxvYWRlckV2ZW50KSA9PiB0aGlzLm9uTG9hZENvbXBsZXRlKGV2ZW50KSk7XG5cdFx0c2Vzc2lvbi5sb2FkKG5ldyBVUkxSZXF1ZXN0KCdhc3NldHMvbWFzdGVyY2hpZWZfYmFzZS5wbmcnKSk7XG5cblx0XHRzZXNzaW9uID0gQXNzZXRMaWJyYXJ5LmdldExvYWRlcigpO1xuXHRcdHNlc3Npb24uYWRkRXZlbnRMaXN0ZW5lcihMb2FkZXJFdmVudC5MT0FEX0NPTVBMRVRFLCAoZXZlbnQ6TG9hZGVyRXZlbnQpID0+IHRoaXMub25Mb2FkQ29tcGxldGUoZXZlbnQpKTtcblx0XHRzZXNzaW9uLmxvYWQobmV3IFVSTFJlcXVlc3QoJ2Fzc2V0cy9zdG9uZV90eC5qcGcnKSk7XG5cblx0XHR3aW5kb3cub25yZXNpemUgPSAoZXZlbnQ6VUlFdmVudCkgPT4gdGhpcy5vblJlc2l6ZSgpO1xuXG5cdFx0dGhpcy5yYWYuc3RhcnQoKTtcblx0fVxuXG5cdHByaXZhdGUgcmVuZGVyKClcblx0e1xuXHRcdGlmICggdGhpcy50ZXJyYWluKVxuXHRcdFx0dGhpcy50ZXJyYWluLnJvdGF0aW9uWSArPSAwLjQ7XG5cblx0XHR0aGlzLnNwYXJ0YW4ucm90YXRpb25ZICs9IDAuNDtcblx0XHR0aGlzLnZpZXcucmVuZGVyKCk7XG5cdH1cblxuXHRwdWJsaWMgb25Mb2FkQ29tcGxldGUoZXZlbnQ6TG9hZGVyRXZlbnQpXG5cdHtcblx0XHR2YXIgbG9hZGVyOkxvYWRlciA9IGV2ZW50LnRhcmdldDtcblx0XHR2YXIgbDpudW1iZXIgPSBsb2FkZXIuYmFzZURlcGVuZGVuY3kuYXNzZXRzLmxlbmd0aDtcblxuXHRcdGNvbnNvbGUubG9nKCctLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0nKTtcblx0XHRjb25zb2xlLmxvZygnZXZlbnRzLkxvYWRlckV2ZW50LlJFU09VUkNFX0NPTVBMRVRFJywgZXZlbnQsIGwsIGxvYWRlcik7XG5cdFx0Y29uc29sZS5sb2coJy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLScpO1xuXG5cdFx0dmFyIGw6bnVtYmVyID0gbG9hZGVyLmJhc2VEZXBlbmRlbmN5LmFzc2V0cy5sZW5ndGg7XG5cblx0XHRmb3IgKHZhciBjOm51bWJlciA9IDA7IGMgPCBsOyBjKyspIHtcblxuXHRcdFx0dmFyIGQ6SUFzc2V0ID0gbG9hZGVyLmJhc2VEZXBlbmRlbmN5LmFzc2V0c1tjXTtcblxuXHRcdFx0Y29uc29sZS5sb2coIGQubmFtZSAsIGV2ZW50LnVybCk7XG5cblx0XHRcdHN3aXRjaCAoZC5hc3NldFR5cGUpIHtcblx0XHRcdFx0Y2FzZSBTcHJpdGUuYXNzZXRUeXBlOlxuXHRcdFx0XHRcdGlmIChldmVudC51cmwgPT0nYXNzZXRzL0hhbG9fM19TUEFSVEFONC5vYmonKSB7XG5cdFx0XHRcdFx0XHR2YXIgc3ByaXRlOlNwcml0ZSA9IDxTcHJpdGU+IGQ7XG5cblx0XHRcdFx0XHRcdHRoaXMuc3BhcnRhbi5hZGRDaGlsZChzcHJpdGUpO1xuXHRcdFx0XHRcdFx0dGhpcy5zcGFydGFuRmxhZyA9IHRydWU7XG5cdFx0XHRcdFx0XHR0aGlzLnNwcml0ZXMucHVzaChzcHJpdGUpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAoZXZlbnQudXJsID09J2Fzc2V0cy90ZXJyYWluLm9iaicpIHtcblx0XHRcdFx0XHRcdHRoaXMudGVycmFpbiA9IDxTcHJpdGU+IGQ7XG5cdFx0XHRcdFx0XHR0aGlzLnRlcnJhaW4ueSA9IDk4O1xuXHRcdFx0XHRcdFx0dGhpcy50ZXJyYWluLmdyYXBoaWNzLnNjYWxlVVYoMjAsIDIwKTtcblx0XHRcdFx0XHRcdHRoaXMudmlldy5zY2VuZS5hZGRDaGlsZCh0aGlzLnRlcnJhaW4pO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRjYXNlIEJpdG1hcEltYWdlMkQuYXNzZXRUeXBlOlxuXHRcdFx0XHRcdGlmIChldmVudC51cmwgPT0gJ2Fzc2V0cy9tYXN0ZXJjaGllZl9iYXNlLnBuZycgKSB7XG5cdFx0XHRcdFx0XHR0aGlzLm1hdCA9IG5ldyBNZXRob2RNYXRlcmlhbCg8Qml0bWFwSW1hZ2UyRD4gZCk7XG5cdFx0XHRcdFx0XHR0aGlzLm1hdC5zdHlsZS5zYW1wbGVyID0gbmV3IFNhbXBsZXIyRCh0cnVlLCB0cnVlLCBmYWxzZSk7XG5cdFx0XHRcdFx0XHR0aGlzLm1hdC5saWdodFBpY2tlciA9IG5ldyBTdGF0aWNMaWdodFBpY2tlcihbdGhpcy5saWdodF0pO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAoZXZlbnQudXJsID09ICdhc3NldHMvc3RvbmVfdHguanBnJykge1xuXHRcdFx0XHRcdFx0dGhpcy50ZXJyYWluTWF0ZXJpYWwgPSBuZXcgTWV0aG9kTWF0ZXJpYWwoPEJpdG1hcEltYWdlMkQ+IGQpO1xuXHRcdFx0XHRcdFx0dGhpcy50ZXJyYWluTWF0ZXJpYWwuc3R5bGUuc2FtcGxlciA9IG5ldyBTYW1wbGVyMkQodHJ1ZSwgdHJ1ZSwgZmFsc2UpO1xuXHRcdFx0XHRcdFx0dGhpcy50ZXJyYWluTWF0ZXJpYWwubGlnaHRQaWNrZXIgPSBuZXcgU3RhdGljTGlnaHRQaWNrZXIoW3RoaXMubGlnaHRdKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRicmVhaztcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAodGhpcy50ZXJyYWluICYmIHRoaXMudGVycmFpbk1hdGVyaWFsKVxuXHRcdFx0dGhpcy50ZXJyYWluLm1hdGVyaWFsID0gdGhpcy50ZXJyYWluTWF0ZXJpYWw7XG5cblx0XHRpZiAodGhpcy5tYXQgJiYgdGhpcy5zcGFydGFuRmxhZylcblx0XHRcdGZvciAodmFyIGM6bnVtYmVyID0gMDsgYyA8IHRoaXMuc3ByaXRlcy5sZW5ndGg7IGMrKylcblx0XHRcdFx0dGhpcy5zcHJpdGVzW2NdLm1hdGVyaWFsID0gdGhpcy5tYXQ7XG5cblx0XHR0aGlzLm9uUmVzaXplKCk7XG5cdH1cblxuXHRwdWJsaWMgb25SZXNpemUoZXZlbnQ6VUlFdmVudCA9IG51bGwpXG5cdHtcblx0XHR0aGlzLnZpZXcueSA9IDA7XG5cdFx0dGhpcy52aWV3LnggPSAwO1xuXG5cdFx0dGhpcy52aWV3LndpZHRoID0gd2luZG93LmlubmVyV2lkdGg7XG5cdFx0dGhpcy52aWV3LmhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodDtcblx0fVxufSJdLCJzb3VyY2VSb290IjoiLi90ZXN0cyJ9
